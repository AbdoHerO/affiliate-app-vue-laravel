import{u as Ce,C as ke,P as we}from"./ProductDrawer-BdxS4Gzs.js";import{u as ce,a as $e}from"./VNavigationDrawer-CkHpOB1y.js";import{u as Ae}from"./useApi-Bt_X5NBj.js";import{u as ue}from"./useNotifications-DDBS_wPD.js";import{d as de,aL as me,r as f,V as y,w as K,D as ve,g as $,o as u,f as i,b as e,l as w,e as t,az as q,t as c,ac as k,c as b,m as r,F as G,i as pe,aU as De,s as P,aV as Se,aP as ze}from"./main-uLG9IIeX.js";import{V as J,b as qe,c as Pe}from"./VCard-CB1gT6RB.js";import{V as se}from"./VDivider-UqGR4x4D.js";import{V as W}from"./VCardText-BZtszuIK.js";import{V as Ie}from"./VImg-BS6_svHJ.js";import{V as Te}from"./VForm-C9FiqBHN.js";import{V as ee,a as A}from"./VRow-aGfXYx3U.js";import{V as te}from"./VTextField-Dxeq5kx5.js";import{V as H}from"./VSelect-sWnAtot-.js";import{V as re}from"./VTextarea-BuIc6d95.js";import{V as ie}from"./VSpacer-BCNmCEP9.js";import{V as Ue}from"./VDialog-DU1pBIct.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Fe}from"./VBreadcrumbs-D7yKQl5l.js";import{V as Le}from"./VChip-B84WcmDa.js";import{V as ne}from"./VBadge-C2esTGRG.js";import{V as Me}from"./VPagination-DYW6O4lq.js";import"./VTooltip-Ce3bfmSx.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VAlert-TgguXW_5.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VTable-0U-NvIH3.js";import"./ssrBoot-BPhRU-mF.js";import"./VAvatar-bHPDEsYY.js";import"./VField-CfH1YcVv.js";/* empty css              */import"./VList-uZDByhc2.js";import"./dialog-transition-2hF0ajsQ.js";import"./VMenu-DP1p-55V.js";import"./VCheckboxBtn-CogF2AUK.js";const Be={class:"d-flex align-center gap-3"},je={key:0},Oe={key:0,class:"text-center py-8"},Ee={key:1},Ne={class:"mb-6"},Re={class:"flex-grow-1"},Qe={class:"text-subtitle-1 mb-1"},Ge={key:0,class:"text-caption text-medium-emphasis mb-2"},He={class:"d-flex align-center gap-4"},Je={class:"text-body-2"},We={class:"text-caption text-success"},Xe={class:"d-flex align-center gap-2"},Ye={class:"px-3"},Ze={class:"text-right"},Ke={class:"text-subtitle-2"},et={class:"d-flex justify-space-between mb-2"},tt={class:"font-weight-medium"},at={class:"d-flex justify-space-between mb-2"},lt={class:"text-success font-weight-medium"},ot={class:"d-flex justify-space-between"},st={class:"text-h6"},rt={class:"text-h6"},it={key:1},nt={key:2,class:"text-center py-8"},ct={class:"text-body-1 mb-4"},ut={class:"d-flex w-100 gap-3"},dt=de({__name:"AffiliateCartModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","success"],setup(ae,{emit:a}){const g=ae,h=a,{t:j}=me(),{showSuccess:I,showError:F}=ue(),_=ce(),T=f([]),C=f(!1),m=f("cart"),x=f(!1),D=f(""),d=f({nom_complet:"",telephone:"",city_id:"",adresse:"",note:""}),S={nom_complet:[o=>!!o||"Le nom complet est requis",o=>o.length>=3||"Le nom doit contenir au moins 3 caractères"],telephone:[o=>!!o||"Le téléphone est requis",o=>/^[0-9+\-\s()]+$/.test(o)||"Format de téléphone invalide"],city_id:[o=>!!o||"La ville est requise"],adresse:[o=>!!o||"L'adresse est requise",o=>o.length>=10||"L'adresse doit contenir au moins 10 caractères"]},z=y({get:()=>g.modelValue,set:o=>h("update:modelValue",o)}),L=y(()=>_.hasItems),M=y(()=>d.value.nom_complet.length>=3&&d.value.telephone.length>0&&d.value.city_id.length>0&&d.value.adresse.length>=10&&!x.value),O=y(()=>T.value),X=()=>{z.value=!1,h("close")},E=()=>{m.value="cart"},Y=()=>{m.value="checkout"},V=async(o,s)=>{try{s<=0?await _.removeItem(o):await _.updateItem(o,{qty:s})}catch(l){console.error("Update quantity error:",l)}},N=async o=>{try{await _.removeItem(o)}catch(s){console.error("Remove item error:",s)}},U=async()=>{await _.clear()},B=async()=>{if(M.value){x.value=!0;try{const o=await _.checkout(d.value);o.success&&(D.value=o.data.commande.id,m.value="success",I(`Commande créée avec succès! Référence: ${o.data.commande.id}`),h("success"))}catch(o){console.error("Checkout error:",o),F("Erreur lors de la création de la commande. Veuillez réessayer plus tard.")}finally{x.value=!1}}},Z=()=>{d.value={nom_complet:"",telephone:"",city_id:"",adresse:"",note:""},m.value="cart",D.value=""},R=async()=>{if(!(C.value||T.value.length>0)){C.value=!0;try{const o=await _.fetchCities();T.value=o}catch(o){console.error("Failed to load cities:",o)}finally{C.value=!1}}};return K(z,o=>{o?(_.fetchCart(),R()):Z()}),ve(()=>{R()}),(o,s)=>(u(),$(Ue,{modelValue:z.value,"onUpdate:modelValue":s[5]||(s[5]=l=>z.value=l),"max-width":"900",persistent:"",scrollable:""},{default:i(()=>[e(J,null,{default:i(()=>[e(qe,{class:"d-flex align-center justify-space-between"},{default:i(()=>[t("div",Be,[m.value==="checkout"?(u(),$(q,{key:0,icon:"tabler-arrow-left",onClick:E,class:"cursor-pointer"})):w("",!0),t("span",null,c(m.value==="cart"?"Mon Panier":m.value==="checkout"?"Informations Client":"Commande Confirmée"),1)]),e(k,{icon:"tabler-x",variant:"text",size:"small",onClick:X})]),_:1}),e(se),e(W,{class:"pa-6"},{default:i(()=>[m.value==="cart"?(u(),b("div",je,[r(_).hasItems?(u(),b("div",Ee,[t("div",Ne,[(u(!0),b(G,null,pe(r(_).items,l=>(u(),b("div",{key:l.key,class:"d-flex align-center gap-4 pa-4 border rounded mb-3"},[e(Ie,{src:l.product.image||"/images/placeholder.jpg",width:"80",height:"80",cover:"",class:"rounded"},null,8,["src"]),t("div",Re,[t("h4",Qe,c(l.product.titre),1),l.variant?(u(),b("div",Ge,c(l.variant.attribut_principal)+": "+c(l.variant.valeur),1)):w("",!0),t("div",He,[t("span",Je,c(l.sell_price||l.product.prix_vente)+" MAD",1),t("span",We,"+"+c(((l.item_commission||0)/l.qty).toFixed(2))+" MAD commission",1)])]),t("div",Xe,[e(k,{icon:"tabler-minus",size:"small",variant:"outlined",onClick:Q=>V(l.key,l.qty-1)},null,8,["onClick"]),t("span",Ye,c(l.qty),1),e(k,{icon:"tabler-plus",size:"small",variant:"outlined",disabled:l.qty>=l.stock_available,onClick:Q=>V(l.key,l.qty+1)},null,8,["disabled","onClick"])]),t("div",Ze,[t("div",Ke,c(l.item_total)+" MAD",1)]),e(k,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:Q=>N(l.key)},null,8,["onClick"])]))),128))]),e(J,{variant:"outlined",class:"mb-6"},{default:i(()=>[e(W,null,{default:i(()=>[t("div",et,[s[8]||(s[8]=t("span",null,"Sous-total:",-1)),t("span",tt,c(r(_).subtotal)+" MAD",1)]),t("div",at,[s[9]||(s[9]=t("span",null,"Commission estimée:",-1)),t("span",lt,"+"+c(r(_).estimatedCommission)+" MAD",1)]),e(se,{class:"my-3"}),t("div",ot,[t("span",st,c(r(j)("labels.totalArticles"))+":",1),t("span",rt,c(r(_).totalQty),1)])]),_:1})]),_:1})])):(u(),b("div",Oe,[e(q,{icon:"tabler-shopping-cart-off",size:"64",class:"mb-4",color:"grey"}),s[6]||(s[6]=t("h3",{class:"text-h6 mb-2"},"Votre panier est vide",-1)),s[7]||(s[7]=t("p",{class:"text-body-2 text-medium-emphasis"},"Ajoutez des produits depuis le catalogue",-1))]))])):m.value==="checkout"?(u(),b("div",it,[e(Te,{onSubmit:De(B,["prevent"])},{default:i(()=>[e(ee,null,{default:i(()=>[e(A,{cols:"12",md:"6"},{default:i(()=>[e(te,{modelValue:d.value.nom_complet,"onUpdate:modelValue":s[0]||(s[0]=l=>d.value.nom_complet=l),label:"Nom complet *",rules:S.nom_complet,required:""},null,8,["modelValue","rules"])]),_:1}),e(A,{cols:"12",md:"6"},{default:i(()=>[e(te,{modelValue:d.value.telephone,"onUpdate:modelValue":s[1]||(s[1]=l=>d.value.telephone=l),label:"Téléphone *",rules:S.telephone,required:""},null,8,["modelValue","rules"])]),_:1}),e(A,{cols:"12"},{default:i(()=>[e(H,{modelValue:d.value.city_id,"onUpdate:modelValue":s[2]||(s[2]=l=>d.value.city_id=l),items:O.value,"item-title":"name","item-value":"city_id",label:"Ville *",rules:S.city_id,required:""},null,8,["modelValue","items","rules"])]),_:1}),e(A,{cols:"12"},{default:i(()=>[e(re,{modelValue:d.value.adresse,"onUpdate:modelValue":s[3]||(s[3]=l=>d.value.adresse=l),label:"Adresse complète *",rules:S.adresse,rows:"3",required:""},null,8,["modelValue","rules"])]),_:1}),e(A,{cols:"12"},{default:i(()=>[e(re,{modelValue:d.value.note,"onUpdate:modelValue":s[4]||(s[4]=l=>d.value.note=l),label:"Note (optionnel)",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])):m.value==="success"?(u(),b("div",nt,[e(q,{icon:"tabler-check-circle",size:"64",class:"mb-4",color:"success"}),s[10]||(s[10]=t("h3",{class:"text-h5 mb-2"},"Commande créée avec succès!",-1)),t("p",ct,"Référence: "+c(D.value),1),s[11]||(s[11]=t("p",{class:"text-body-2 text-medium-emphasis"}," Votre commande a été transmise et sera traitée par l'équipe admin. ",-1))])):w("",!0)]),_:1}),m.value!=="success"?(u(),$(Pe,{key:0,class:"pa-6 pt-0"},{default:i(()=>[t("div",ut,[m.value==="cart"?(u(),b(G,{key:0},[r(_).hasItems?(u(),$(k,{key:0,variant:"outlined",onClick:U},{default:i(()=>s[12]||(s[12]=[P(" Vider le panier ")])),_:1,__:[12]})):w("",!0),e(ie),e(k,{color:"primary",disabled:!L.value,onClick:Y},{default:i(()=>s[13]||(s[13]=[P(" Valider la commande ")])),_:1,__:[13]},8,["disabled"])],64)):m.value==="checkout"?(u(),b(G,{key:1},[e(k,{variant:"outlined",onClick:E},{default:i(()=>[P(c(r(j)("actions.backToCart")),1)]),_:1}),e(ie),e(k,{color:"primary",disabled:!M.value,loading:x.value,onClick:B},{default:i(()=>s[14]||(s[14]=[P(" Envoyer la commande ")])),_:1,__:[14]},8,["disabled","loading"])],64)):w("",!0)])]),_:1})):w("",!0)]),_:1})]),_:1},8,["modelValue"]))}}),mt=fe(dt,[["__scopeId","data-v-c5c27203"]]),vt={class:"affiliate-catalogue"},pt={class:"d-flex align-center justify-space-between mb-6"},ft={class:"text-h4 mb-2"},_t={class:"text-body-1 text-medium-emphasis mb-0"},gt={class:"d-flex align-center gap-4"},ht={class:"cart-button-container"},yt={class:"d-flex align-center gap-2"},bt={class:"cart-button-text"},xt={class:"filters-section mb-6"},Vt={class:"d-flex align-center justify-space-between mb-3"},Ct={class:"d-flex align-center gap-2"},kt={class:"text-subtitle-1 font-weight-medium"},wt={class:"results-info"},$t={class:"text-h6 text-primary font-weight-bold"},At={class:"text-caption text-medium-emphasis"},Dt={key:0,class:"text-center py-8"},St={class:"text-body-1 mt-4"},zt={key:1,class:"text-center py-12"},qt={class:"text-h5 mb-2"},Pt={class:"text-body-1 text-medium-emphasis mb-4"},It={key:3,class:"d-flex justify-center mt-8"},Tt=de({__name:"index",setup(ae){const{t:a}=me(),g=Ce(),h=ce(),{showSuccess:j,showError:I}=ue(),{cartDrawerOpen:F,openCartDrawer:_,closeCartDrawer:T}=$e(),C=f(""),m=f(""),x=f(void 0),D=f(""),d=f(""),S=f("created_at"),z=f("desc"),L=f(null),M=f([]),O=f(!1),X=y(()=>[{title:a("nav_dashboard"),to:{name:"affiliate-dashboard"}},{title:a("catalogue.title"),active:!0}]),E=y(()=>g.isLoading),Y=y(()=>g.items),V=y(()=>g.pagination),N=y(()=>g.hasItems);y(()=>g.selectedProduct),y(()=>g.isDetailLoading);const U=f(!1),B=f(null),Z=y(()=>[{value:"created_at:desc",text:a("catalogue.filters.sort_newest")},{value:"created_at:asc",text:a("catalogue.filters.sort_oldest")},{value:"prix_vente:asc",text:a("catalogue.filters.sort_price_asc")},{value:"prix_vente:desc",text:a("catalogue.filters.sort_price_desc")},{value:"prix_affilie:asc",text:a("catalogue.filters.sort_profit_asc")},{value:"prix_affilie:desc",text:a("catalogue.filters.sort_profit_desc")},{value:"titre:asc",text:a("catalogue.filters.sort_name_asc")},{value:"titre:desc",text:a("catalogue.filters.sort_name_desc")}]),R=y(()=>[{value:void 0,text:a("catalogue.filters.all_commissions")},{value:20,text:a("catalogue.filters.profit_over",{amount:"20 MAD"})},{value:50,text:a("catalogue.filters.profit_over",{amount:"50 MAD"})},{value:100,text:a("catalogue.filters.profit_over",{amount:"100 MAD"})},{value:200,text:a("catalogue.filters.profit_over",{amount:"200 MAD"})},{value:500,text:a("catalogue.filters.profit_over",{amount:"500 MAD"})}]),o=y(()=>!!(C.value||m.value||x.value||D.value||d.value)),s=y(()=>{let n=0;return C.value&&n++,m.value&&n++,x.value&&n++,D.value&&n++,d.value&&n++,n}),l=async()=>{const[n,v]=(S.value+":"+z.value).split(":");await g.fetchList({q:C.value||void 0,category_id:m.value||void 0,min_profit:x.value,size:D.value||void 0,color:d.value||void 0,page:V.value.current_page,per_page:V.value.per_page})},Q=()=>{L.value&&clearTimeout(L.value),L.value=setTimeout(()=>{g.setPage(1),l()},300)},le=()=>{g.setPage(1),l()},_e=n=>{const[v,p]=n.split(":");S.value=v,z.value=p,le()},oe=()=>{C.value="",m.value="",x.value=void 0,D.value="",d.value="",S.value="created_at",z.value="desc",g.resetFilters(),l()},ge=n=>{g.setPage(n),l()},he=async n=>{try{B.value=n,U.value=!0}catch{U.value=!1,I(a("catalogue.errors.product_loading_error"))}},ye=async n=>{try{if(console.log("🛒 [Catalogue] Adding to cart:",n),!n.produit_id){I(a("catalogue.errors.invalid_product"));return}if(n.qty<1){I(a("catalogue.errors.invalid_quantity"));return}await h.addItem(n),await h.fetchCart(),await g.fetchCartSummary(),j(a("affiliate_catalogue_added_to_cart")),console.log("✅ [Catalogue] Item added, cart count:",h.count),setTimeout(()=>{_()},300)}catch(v){console.error("❌ [Catalogue] Add to cart error:",v)}},be=n=>{console.log("Variant changed:",n)},xe=n=>{console.log("Quantity changed:",n)},Ve=async()=>{O.value=!0;try{const{data:n,error:v}=await Ae("/affiliate/categories",{method:"GET"});if(v.value)throw v.value;n.value&&n.value.data&&(M.value=n.value.data.filter(p=>p.actif))}catch(n){console.error("Error loading categories:",n),I(a("affiliate.catalogue.errorLoadingCategories"))}finally{O.value=!1}};return K(C,Q),K([m,x,D,d],le),ve(async()=>{await Ve(),await l(),await g.fetchCartSummary(),await h.fetchCart()}),(n,v)=>(u(),b("div",vt,[e(Fe,{items:X.value,class:"pa-0 mb-4"},null,8,["items"]),t("div",pt,[t("div",null,[t("h1",ft,c(r(a)("catalogue.title")),1),t("p",_t,c(r(a)("catalogue.showing_results",{from:V.value.from,to:V.value.to,total:V.value.total})),1)]),t("div",gt,[t("div",ht,[r(h).count>0?(u(),$(Le,{key:0,color:"success",variant:"elevated",size:"small",class:"cart-summary-chip mb-2"},{default:i(()=>[e(q,{icon:"tabler-check-circle",start:"",size:"16"}),P(" "+c(r(a)("affiliate_catalogue_cart_summary",{count:r(h).count,plural:r(h).count>1?"s":"",total:r(h).subtotal.toFixed(2)})),1)]),_:1})):w("",!0),e(k,{color:"primary",variant:"elevated",size:"large",class:"cart-button",onClick:r(_)},{default:i(()=>[e(ne,{content:r(h).count,"model-value":r(h).count>0,color:"error","offset-x":"-5","offset-y":"-5"},{default:i(()=>[t("div",yt,[e(q,{icon:"tabler-shopping-cart",size:"20"}),t("span",bt,c(r(h).count>0?r(a)("actions.viewCart"):r(a)("cart.title")),1)])]),_:1},8,["content","model-value"])]),_:1},8,["onClick"])])])]),t("div",xt,[e(J,{class:"search-card mb-4",elevation:"1"},{default:i(()=>[e(W,{class:"py-3"},{default:i(()=>[e(te,{modelValue:C.value,"onUpdate:modelValue":v[0]||(v[0]=p=>C.value=p),placeholder:r(a)("catalogue.search_placeholder"),"prepend-inner-icon":"tabler-search",variant:"solo",density:"comfortable","hide-details":"",clearable:"",class:"search-field","bg-color":"transparent"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),e(J,{class:"filters-card",elevation:"1"},{default:i(()=>[e(W,{class:"py-4"},{default:i(()=>[t("div",Vt,[t("div",Ct,[e(q,{icon:"tabler-adjustments-horizontal",size:"20"}),t("span",kt,c(r(a)("affiliate_catalogue_advanced_filters")),1),o.value?(u(),$(ne,{key:0,content:s.value,color:"primary",inline:""},null,8,["content"])):w("",!0)]),o.value?(u(),$(k,{key:0,variant:"text",size:"small",color:"error","prepend-icon":"tabler-refresh",onClick:oe},{default:i(()=>[P(c(r(a)("affiliate_catalogue_clear_filters")),1)]),_:1})):w("",!0)]),e(ee,{class:"align-center"},{default:i(()=>[e(A,{cols:"12",md:"3",sm:"6"},{default:i(()=>[e(H,{modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=p=>m.value=p),items:[{value:"",title:r(a)("catalogue.all_categories")},...M.value.map(p=>({value:p.id,title:p.nom}))],label:r(a)("affiliate.catalogue.category"),"item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"tabler-category",class:"filter-select"},null,8,["modelValue","items","label"])]),_:1}),e(A,{cols:"12",md:"3",sm:"6"},{default:i(()=>[e(H,{modelValue:x.value,"onUpdate:modelValue":v[2]||(v[2]=p=>x.value=p),items:R.value,label:r(a)("affiliate_catalogue_commission_min"),"item-title":"text","item-value":"value",variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"tabler-coins",class:"filter-select"},null,8,["modelValue","items","label"])]),_:1}),e(A,{cols:"12",md:"4",sm:"8"},{default:i(()=>[e(H,{"model-value":S.value+":"+z.value,items:Z.value,label:r(a)("affiliate.catalogue.sortBy"),"item-title":"text","item-value":"value",variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"tabler-sort-ascending",class:"filter-select","onUpdate:modelValue":_e},null,8,["model-value","items","label"])]),_:1}),e(A,{cols:"12",md:"2",sm:"4",class:"text-center"},{default:i(()=>[t("div",wt,[t("div",$t,c(V.value.total||0),1),t("div",At,c(r(a)("affiliate_catalogue_products_count")),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),E.value?(u(),b("div",Dt,[e(Se,{indeterminate:"",color:"primary",size:"64"}),t("p",St,c(r(a)("catalogue.loading")),1)])):N.value?(u(),$(ee,{key:2,class:"catalogue-grid"},{default:i(()=>[(u(!0),b(G,null,pe(Y.value,p=>(u(),$(A,{key:p.id,cols:"12",sm:"6",md:"4",lg:"3",class:"catalogue-grid__item"},{default:i(()=>[e(ke,{product:p,onOpen:he,onAddToCart:ye,onVariantChange:be,onQtyChange:xe},null,8,["product"])]),_:2},1024))),128))]),_:1})):(u(),b("div",zt,[e(q,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),t("h3",qt,c(r(a)("catalogue.no_products")),1),t("p",Pt,c(r(a)("catalogue.no_products_subtitle")),1),o.value?(u(),$(k,{key:0,color:"primary",variant:"outlined",onClick:oe},{default:i(()=>[P(c(r(a)("catalogue.clear_filters")),1)]),_:1})):w("",!0)])),N.value&&V.value.last_page>1?(u(),b("div",It,[e(Me,{"model-value":V.value.current_page,length:V.value.last_page,"total-visible":7,"onUpdate:modelValue":ge},null,8,["model-value","length"])])):w("",!0),e(we,{modelValue:U.value,"onUpdate:modelValue":v[3]||(v[3]=p=>U.value=p),"product-id":B.value},null,8,["modelValue","product-id"]),e(mt,{modelValue:r(F),"onUpdate:modelValue":v[4]||(v[4]=p=>ze(F)?F.value=p:null),onClose:r(T),onSuccess:r(T)},null,8,["modelValue","onClose","onSuccess"])]))}}),_a=fe(Tt,[["__scopeId","data-v-69861101"]]);export{_a as default};
