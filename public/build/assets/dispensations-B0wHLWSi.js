import{d as O,aL as G,r as m,V as J,o as K,c as x,b as h,f as n,e as t,v as r,n as o,g as a,t as d,az as f,ac as _,aW as Q,m as X,h as Y,b6 as k}from"./main-3LuWNv9W.js";import{b as C,V as z,c as T}from"./VCard-QqgF9aMj.js";import{V as D}from"./VCardText-Dqaeyxp0.js";import{V as U}from"./VDataTable-Dz5dOo4J.js";import{V as v}from"./VChip-D2hyzrT3.js";import{V as B}from"./VAvatar-CH3JpKwD.js";import{V as Z}from"./VForm-BMJZijf-.js";import{V as ee,a as V}from"./VRow-aVZbYr4A.js";import{V as te}from"./VSelect-V4QjM3w5.js";import{V as M}from"./VTextField-CsO1UfXI.js";import{V as ae}from"./VTextarea-BxOghhaY.js";import{V as N}from"./VSpacer-Ckvg-9-2.js";import{V as H}from"./VDialog-DuTMUR2U.js";import"./createSimpleFunctional-CbZg_Do-.js";import"./VImg-DjZhnPY1.js";import"./VPagination-C9G78dYZ.js";import"./VCheckboxBtn-BQUGQfLA.js";import"./VField-CzoZXYxi.js";import"./forwardRefs-BZg6tG7B.js";import"./VTable-Dyn4MLHa.js";import"./filter-DJ4i-HET.js";import"./VDivider-D28qXVrs.js";/* empty css              */import"./VList-DWKF8cD-.js";import"./ssrBoot-DPE17Lki.js";import"./dialog-transition-TWAYErkS.js";import"./VMenu-cCaIVuKn.js";import"./VOverlay-DHKe6cTP.js";import"./lazy-vcHGEOxt.js";const le={class:"d-flex justify-space-between align-center mb-6"},oe={class:"text-h4 font-weight-bold mb-1"},se={class:"text-body-1 mb-0"},ie={class:"d-flex align-center"},re={class:"font-weight-medium"},ne={class:"text-body-2 text-medium-emphasis"},de={class:"d-flex gap-2"},ce={class:"text-center py-8"},me={class:"text-h6 mb-2"},ue={class:"text-body-2"},fe={class:"d-flex align-center"},pe={key:0,class:"text-body-1 ms-2"},_e={class:"text-truncate",style:{"max-width":"200px"}},ve={key:1,class:"text-medium-emphasis"},ye={class:"d-flex align-center"},he={class:"text-body-2"},Ve={class:"text-center py-8"},be={class:"text-h6 mb-2"},ge={class:"text-body-2"},Ye=O({__name:"dispensations",setup(we){const{t:l}=G(),p=m(!1),c=m({affiliate_id:"",points:"",comment:"",reference:""}),$=m([]),A=m([]),b=m(!1),y=m(!1),g=m(null),q=m([]),w=m(!1),F=m({current_page:1,last_page:1,per_page:10,total:0}),I=J(()=>[{title:l("affiliate"),key:"affiliate",sortable:!1},{title:l("available_points"),key:"profil_affilie.points",sortable:!0},{title:l("total_signups"),key:"total_signups",sortable:!0},{title:l("verified_signups"),key:"verified_signups",sortable:!0},{title:l("actions"),key:"actions",sortable:!1}]),R=async()=>{b.value=!0;try{const i=await k.get("/admin/rewards",{params:{per_page:100}});i.data.success&&($.value=i.data.data,A.value=i.data.data.map(s=>{var e;return{value:(e=s.profil_affilie)==null?void 0:e.id,title:`${s.nom_complet} (${s.email})`}}))}catch(i){console.error("Failed to fetch affiliates:",i)}finally{b.value=!1}},L=(i=null)=>{var s;c.value={affiliate_id:((s=i==null?void 0:i.profil_affilie)==null?void 0:s.id)||"",points:"100",comment:i?`RÃ©compense pour ${i.nom_complet}`:"",reference:`REWARD-${Date.now()}`},p.value=!0},E=async i=>{var s;g.value=i,y.value=!0,await P((s=i.profil_affilie)==null?void 0:s.id)},P=async(i,s=1)=>{w.value=!0;try{const e=await k.get(`/admin/rewards/${i}/history`,{params:{page:s,per_page:F.value.per_page}});e.data.success&&(q.value=e.data.data.rewards,F.value=e.data.data.pagination)}catch(e){console.error("Failed to fetch affiliate history:",e)}finally{w.value=!1}},S=async()=>{try{const i=await k.post("/admin/rewards",c.value);i.data.success&&(p.value=!1,R(),console.log("Reward created successfully:",i.data.data))}catch(i){console.error("Failed to create reward:",i)}},W=i=>new Date(i).toLocaleDateString(),j=i=>`${i} pts`;return K(()=>{R()}),(i,s)=>(h(),x("div",null,[n("div",le,[n("div",null,[n("h1",oe,r(o(l)("rewards_management")),1),n("p",se,r(o(l)("rewards_subtitle")),1)])]),t(z,null,{default:a(()=>[t(C,null,{default:a(()=>[d(r(o(l)("affiliates_rewards_management")),1)]),_:1}),t(D,null,{default:a(()=>[t(U,{headers:I.value,items:$.value,loading:b.value,"item-value":"id",class:"text-no-wrap"},{"item.affiliate":a(({item:e})=>[n("div",ie,[t(B,{size:"32",class:"me-3",color:"primary",variant:"tonal"},{default:a(()=>[t(f,{icon:"tabler-user-star"})]),_:1}),n("div",null,[n("div",re,r(e.nom_complet),1),n("div",ne,r(e.email),1)])])]),"item.profil_affilie.points":a(({item:e})=>[t(v,{color:"primary",size:"small"},{default:a(()=>{var u;return[d(r(((u=e.profil_affilie)==null?void 0:u.points)||0)+" pts ",1)]}),_:2},1024)]),"item.total_signups":a(({item:e})=>[t(v,{color:"info",size:"small",variant:"outlined"},{default:a(()=>[d(r(e.total_signups||0),1)]),_:2},1024)]),"item.verified_signups":a(({item:e})=>[t(v,{color:"success",size:"small",variant:"outlined"},{default:a(()=>[d(r(e.verified_signups||0),1)]),_:2},1024)]),"item.actions":a(({item:e})=>[n("div",de,[t(_,{color:"primary",size:"small",onClick:u=>L(e)},{default:a(()=>[t(f,{start:"",icon:"tabler-gift"}),d(" "+r(o(l)("create_reward")),1)]),_:2},1032,["onClick"]),t(_,{color:"info",variant:"outlined",size:"small",onClick:u=>E(e)},{default:a(()=>[t(f,{start:"",icon:"tabler-history"}),d(" "+r(o(l)("rewards_history")),1)]),_:2},1032,["onClick"])])]),"no-data":a(()=>[n("div",ce,[t(f,{icon:"tabler-users-off",size:"64",class:"mb-4",color:"disabled"}),n("h6",me,r(o(l)("no_affiliates")),1),n("p",ue,r(o(l)("no_affiliates_description")),1)])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),t(H,{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=e=>p.value=e),"max-width":"600"},{default:a(()=>[t(z,null,{default:a(()=>[t(C,null,{default:a(()=>[d(r(o(l)("create_reward")),1)]),_:1}),t(D,null,{default:a(()=>[t(Z,{onSubmit:Q(S,["prevent"])},{default:a(()=>[t(ee,null,{default:a(()=>[t(V,{cols:"12"},{default:a(()=>[t(te,{modelValue:c.value.affiliate_id,"onUpdate:modelValue":s[0]||(s[0]=e=>c.value.affiliate_id=e),items:A.value,label:o(l)("affiliate"),rules:[e=>!!e||o(l)("affiliate_required")],required:""},null,8,["modelValue","items","label","rules"])]),_:1}),t(V,{cols:"12"},{default:a(()=>[t(M,{modelValue:c.value.points,"onUpdate:modelValue":s[1]||(s[1]=e=>c.value.points=e),type:"number",label:o(l)("points"),rules:[e=>!!e||o(l)("points_required"),e=>e>0||o(l)("points_must_be_positive"),e=>e<=1e4||o(l)("points_max_limit")],required:""},null,8,["modelValue","label","rules"])]),_:1}),t(V,{cols:"12"},{default:a(()=>[t(ae,{modelValue:c.value.comment,"onUpdate:modelValue":s[2]||(s[2]=e=>c.value.comment=e),label:o(l)("comment"),rules:[e=>!!e||o(l)("comment_required"),e=>e.length>=10||o(l)("comment_min_length")],rows:"3",required:""},null,8,["modelValue","label","rules"])]),_:1}),t(V,{cols:"12"},{default:a(()=>[t(M,{modelValue:c.value.reference,"onUpdate:modelValue":s[3]||(s[3]=e=>c.value.reference=e),label:o(l)("reference_optional"),placeholder:o(l)("campaign_code_or_reference")},null,8,["modelValue","label","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),t(T,null,{default:a(()=>[t(N),t(_,{variant:"outlined",onClick:s[4]||(s[4]=e=>p.value=!1)},{default:a(()=>[d(r(o(l)("cancel")),1)]),_:1}),t(_,{color:"primary",onClick:S},{default:a(()=>[d(r(o(l)("create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(H,{modelValue:y.value,"onUpdate:modelValue":s[7]||(s[7]=e=>y.value=e),"max-width":"900"},{default:a(()=>[t(z,null,{default:a(()=>[t(C,null,{default:a(()=>[n("div",fe,[t(f,{icon:"tabler-history",class:"me-2"}),d(" "+r(o(l)("rewards_history"))+" ",1),g.value?(h(),x("span",pe," - "+r(g.value.nom_complet),1)):X("",!0)])]),_:1}),t(D,null,{default:a(()=>[t(U,{headers:[{title:o(l)("date"),key:"created_at"},{title:o(l)("points"),key:"points"},{title:o(l)("comment"),key:"comment"},{title:o(l)("reference"),key:"reference"},{title:o(l)("admin"),key:"created_by_admin"}],items:q.value,loading:w.value,"item-value":"id",class:"text-no-wrap"},{"item.created_at":a(({item:e})=>[d(r(W(e.created_at)),1)]),"item.points":a(({item:e})=>[t(v,{color:"warning",size:"small"},{default:a(()=>[d(r(j(e.points)),1)]),_:2},1024)]),"item.comment":a(({item:e})=>[n("span",_e,r(e.comment),1)]),"item.reference":a(({item:e})=>[e.reference?(h(),Y(v,{key:0,color:"info",size:"small",variant:"outlined"},{default:a(()=>[d(r(e.reference),1)]),_:2},1024)):(h(),x("span",ve,"-"))]),"item.created_by_admin":a(({item:e})=>{var u;return[n("div",ye,[t(B,{size:"24",class:"me-2",color:"secondary",variant:"tonal"},{default:a(()=>[t(f,{icon:"tabler-shield",size:"16"})]),_:1}),n("span",he,r(((u=e.created_by_admin)==null?void 0:u.nom_complet)||"System"),1)])]}),"no-data":a(()=>[n("div",Ve,[t(f,{icon:"tabler-history-off",size:"64",class:"mb-4",color:"disabled"}),n("h6",be,r(o(l)("no_rewards_history")),1),n("p",ge,r(o(l)("no_rewards_history_description")),1)])]),_:1},8,["headers","items","loading"])]),_:1}),t(T,null,{default:a(()=>[t(N),t(_,{variant:"outlined",onClick:s[6]||(s[6]=e=>y.value=!1)},{default:a(()=>[d(r(o(l)("close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Ye as default};
