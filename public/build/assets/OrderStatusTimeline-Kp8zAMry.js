import{d as z,aL as E,r as y,V as S,o as j,h as p,b as r,g as t,e as s,t as u,az as f,v as a,n as h,c as n,aU as B,ac as N,f as o,F as O,j as P,m as g,ba as $}from"./main-BW7J9dbc.js";import{V as D,b as F}from"./VCard-BBEboEsQ.js";import{V as L}from"./VCardText-CXwuP4rm.js";import{V as q}from"./VAlert-C-u8vegp.js";import{V as A,a as J}from"./VTimeline-M1uGP7Nt.js";import{V as M}from"./VChip-Dc9HlRo1.js";import{V as R,a as U,b as G,c as H}from"./VExpansionPanels-CaG50yjF.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={key:0,class:"d-flex justify-center py-8"},W={key:2,class:"text-center py-8"},X={class:"text-body-1 text-disabled"},Y={class:"timeline-content"},Z={class:"d-flex justify-space-between align-start mb-2"},ee={class:"text-h6 mb-1"},te={class:"d-flex align-center gap-2 text-caption text-medium-emphasis"},se={key:0,class:"mb-2"},ae={class:"text-body-2 text-medium-emphasis"},re={key:1,class:"text-body-2 mb-2"},oe={key:2,class:"d-flex align-center gap-2 text-caption text-medium-emphasis"},ie={key:3,class:"mt-2"},ne={class:"text-caption"},le=z({__name:"OrderStatusTimeline",props:{orderId:{},endpoint:{},orderType:{}},setup(k,{expose:T}){const l=k,{t:m}=E(),x=y([]),v=y(!1),d=y(null),C=S(()=>x.value.length>0),b=async()=>{var i,c;if(l.orderId){v.value=!0,d.value=null;try{let e="";l.endpoint==="admin"?l.orderType==="shipping"?e=`admin/shipping/orders/${l.orderId}/timeline`:e=`admin/preorders/${l.orderId}/timeline`:e=`affiliate/orders/${l.orderId}/timeline`;const _=await $(e);_.success?x.value=_.data:d.value=_.message||"Erreur lors du chargement de l'historique"}catch(e){console.error("Error fetching timeline:",e),d.value=((c=(i=e.response)==null?void 0:i.data)==null?void 0:c.message)||"Erreur lors du chargement de l'historique"}finally{v.value=!1}}},V=i=>({en_attente:"warning",confirmee:"info",expediee:"primary",livree:"success",annulee:"error",retournee:"secondary",returned_to_warehouse:"info",refusee:"error",injoignable:"warning",echec_livraison:"error",pending:"warning",received:"info",in_transit:"primary",shipped:"primary",at_facility:"info",ready_for_delivery:"primary",out_for_delivery:"primary",delivery_attempted:"warning",delivered:"success",returned:"secondary",refused:"error",cancelled:"error",unknown:"secondary"})[i]||"secondary",I=i=>({admin:"tabler-user-shield",affiliate:"tabler-user-star",ozon_express:"tabler-truck",system:"tabler-robot"})[i]||"tabler-circle",w=i=>new Date(i).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return j(()=>{b()}),T({refresh:b}),(i,c)=>(r(),p(D,null,{default:t(()=>[s(F,{class:"d-flex align-center gap-2"},{default:t(()=>[s(f,{icon:"tabler-timeline"}),u(" "+a(h(m)("order_status_timeline")),1)]),_:1}),s(L,null,{default:t(()=>[v.value?(r(),n("div",Q,[s(B,{indeterminate:"",color:"primary",size:"40"})])):d.value?(r(),p(q,{key:1,type:"error",variant:"tonal",class:"mb-4"},{append:t(()=>[s(N,{variant:"text",size:"small",onClick:b},{default:t(()=>[u(a(h(m)("retry")),1)]),_:1})]),default:t(()=>[u(a(d.value)+" ",1)]),_:1})):C.value?(r(),p(A,{key:3,side:"end",align:"start","truncate-line":"both",density:"compact",class:"timeline-custom"},{default:t(()=>[(r(!0),n(O,null,P(x.value,(e,_)=>(r(),p(J,{key:e.id,"dot-color":V(e.to_status),size:"small"},{icon:t(()=>[s(f,{icon:I(e.source),size:"16"},null,8,["icon"])]),default:t(()=>[o("div",Y,[o("div",Z,[o("div",null,[o("h6",ee,a(e.status_label),1),o("div",te,[s(M,{color:V(e.to_status),size:"x-small",variant:"tonal"},{default:t(()=>[u(a(e.source_label),1)]),_:2},1032,["color"]),o("span",null,a(w(e.created_at)),1)])])]),e.from_status?(r(),n("div",se,[o("span",ae,a(e.from_status)+" â†’ "+a(e.to_status),1)])):g("",!0),e.note?(r(),n("p",re,a(e.note),1)):g("",!0),e.changed_by?(r(),n("div",oe,[s(f,{icon:"tabler-user",size:"14"}),o("span",null,a(e.changed_by.name),1)])):g("",!0),e.meta&&Object.keys(e.meta).length>0?(r(),n("div",ie,[s(R,{variant:"accordion",class:"timeline-meta"},{default:t(()=>[s(U,null,{default:t(()=>[s(G,{class:"text-caption"},{default:t(()=>[u(a(h(m)("additional_details")),1)]),_:1}),s(H,null,{default:t(()=>[o("pre",ne,a(JSON.stringify(e.meta,null,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)])):g("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})):(r(),n("div",W,[s(f,{icon:"tabler-timeline-event-x",size:"48",class:"text-disabled mb-4"}),o("p",X,a(h(m)("no_status_history")),1)]))]),_:1})]),_:1}))}}),ge=K(le,[["__scopeId","data-v-a43ec431"]]);export{ge as O};
