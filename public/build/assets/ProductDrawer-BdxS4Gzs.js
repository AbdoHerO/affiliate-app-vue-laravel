import{b4 as Ze,r as C,c7 as Qe,V as I,d as $e,aL as Pe,w as we,g as K,o as d,f as h,e,b as c,l as E,aV as Ne,az as U,s as L,t as s,aU as Me,ac as J,c as x,F as oe,i as ce,p as qe,v as Fe,m as n,G as Oe,cX as Ue,ai as He}from"./main-uLG9IIeX.js";import{V as Te}from"./VCard-CB1gT6RB.js";import{V as Se}from"./VImg-BS6_svHJ.js";import{V as te}from"./VChip-B84WcmDa.js";import{V as Ve}from"./VTooltip-Ce3bfmSx.js";import{V as Be}from"./VCardText-BZtszuIK.js";import{_ as Ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as be}from"./useApi-Bt_X5NBj.js";import{u as Ge}from"./useNotifications-DDBS_wPD.js";import{u as Re,V as We,a as Je}from"./VNavigationDrawer-CkHpOB1y.js";import{V as Ke,a as Le}from"./VRow-aGfXYx3U.js";import{V as je}from"./VTextField-Dxeq5kx5.js";import{V as et}from"./VAlert-TgguXW_5.js";import{V as tt}from"./VTable-0U-NvIH3.js";const Xe=Ze("affiliate-catalogue",()=>{const ue=C([]),de=C(null),i=C(!1),H=C(!1),g=C(null),a=Qe({current_page:1,last_page:1,per_page:12,total:0,from:0,to:0}),j=Qe({q:"",category_id:"",min_profit:void 0,color:"",size:"",page:1,per_page:12}),ae=C({items_count:0,total_amount:0}),X=C(null),G=C(null),B=C(!1),Y=C(null),R=C(null),W=C(null),D=C(1),P=C(0),l=C({}),me=C([]),ie=C([]),re=C([]),q=(t,r)=>{const _=(t==null?void 0:t.trim())||"∅",f=(r==null?void 0:r.trim())||"∅";return`${_}|${f}`},ve=t=>{l.value={},me.value=[],ie.value=[],re.value=[];const r=new Set,_=new Map;t.forEach(f=>{const{type:z,color:M,size:v,id:$,stock_available:Z,image_url:ne}=f,w=q(M,v);l.value[w]={id:$,stock_available:Z||0,image_url:ne},v&&r.add(v),M&&_.set(M,{name:M,swatch:M,image_url:ne}),M&&v&&re.value.push({qty:Z||0,color:M,size:v})}),me.value=Array.from(r).sort((f,z)=>{const M=["XS","S","M","L","XL","2XL","3XL","4XL","5XL"],v=M.indexOf(f),$=M.indexOf(z);return v!==-1&&$!==-1?v-$:v!==-1?-1:$!==-1?1:f.localeCompare(z)}),ie.value=Array.from(_.values()).sort((f,z)=>f.name.localeCompare(z.name)),re.value.sort((f,z)=>{const M=["XS","S","M","L","XL","2XL","3XL","4XL","5XL"],v=M.indexOf(f.size),$=M.indexOf(z.size);if(v!==$){if(v!==-1&&$!==-1)return v-$;if(v!==-1)return-1;if($!==-1)return 1}return f.color.localeCompare(z.color)})},Ce=I(()=>ue.value.length>0),o=I(()=>i.value),T=I(()=>H.value),N=I(()=>a.total),{showSuccess:m,showError:b}=Ge(),V=t=>{var $,Z,ne,w;console.log("🔄 [Store] Mapping product to normalized:",t.id,{title:t.titre,images:t.images,variantes:t.variantes,variants:t.variants});const r=((Z=($=t.images)==null?void 0:$[0])==null?void 0:Z.url)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNTAgMTAwQzE2MS4wNDYgMTAwIDE3MCA5MC45NTQzIDE3MCA4MEM1NyA2OS4wNDU3IDE0Ny45NTQgNjAgMTM2IDYwQzEyNC45NTQgNjAgMTE2IDY5LjA0NTcgMTE2IDgwQzExNiA5MC45NTQzIDEyNC45NTQgMTAwIDEzNiAxMDBIMTUwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8cGF0aCBkPSJNMTgwIDEyMEgxMjBDMTE2LjY4NiAxMjAgMTE0IDEyMi42ODYgMTE0IDEyNlYyMDBDMTE0IDIwMy4zMTQgMTE2LjY4NiAyMDYgMTIwIDIwNkgxODBDMTgzLjMxNCAyMDYgMTg2IDIwMy4zMTQgMTg2IDIwMFYxMjZDMTg2IDEyMi42ODYgMTgzLjMxNCAxMjAgMTgwIDEyMFoiIGZpbGw9IiNDQ0NDQ0MiLz4KPC9zdmc+";console.log("🖼️ [Store] Main image extracted:",r);let _=[],f=[],z=[],M=[];const v=t.variants;if(v&&(v.sizes||v.colors))console.log("🎯 [Store] Using API-parsed variants:",v),v.sizes&&Array.isArray(v.sizes)&&(_=v.sizes.filter(k=>k.stock>0),M=_.map(k=>k.value)),v.colors&&Array.isArray(v.colors)&&(f=v.colors.filter(k=>k.stock>0),z=f.map(k=>({name:k.value,swatch:k.color||k.value,image_url:k.image_url})));else{console.log("🔧 [Store] Manually parsing variants from variantes array");const k=new Set,fe=new Map;(ne=t.variantes)==null||ne.forEach(y=>{var he,ye;const ee=y.stock||0;if(ee<=0)return;const _e=(he=y.attribut_principal)==null?void 0:he.toLowerCase();if(console.log("🔧 [Store] Processing variant:",{id:y.id,attribut_principal:y.attribut_principal,valeur:y.valeur,stock:ee,attributCode:_e,color:y.color,image_url:y.image_url}),(ye=y.valeur)!=null&&ye.includes(" - ")){const[xe,Ie]=y.valeur.split(" - ");xe&&fe.set(xe,{name:xe,swatch:y.color||xe,image_url:y.image_url||void 0}),Ie&&k.add(Ie),xe&&f.push({id:y.id,value:xe,color:y.color||void 0,image_url:y.image_url||void 0,stock:ee}),Ie&&_.push({id:y.id,value:Ie,stock:ee})}else["taille","size"].includes(_e)?(k.add(y.valeur),_.push({id:y.id,value:y.valeur,stock:ee})):["couleur","color"].includes(_e)&&(fe.set(y.valeur,{name:y.valeur,swatch:y.color||y.valeur,image_url:y.image_url||void 0}),f.push({id:y.id,value:y.valeur,color:y.color||void 0,image_url:y.image_url||void 0,stock:ee}))}),z=Array.from(fe.values()).sort((y,ee)=>y.name.localeCompare(ee.name)),M=Array.from(k).sort((y,ee)=>{const _e=["XS","S","M","L","XL","2XL","3XL","4XL","5XL"],he=_e.indexOf(y),ye=_e.indexOf(ee);return he!==-1&&ye!==-1?he-ye:he!==-1?-1:ye!==-1?1:y.localeCompare(ee)})}return console.log("✅ [Store] Final normalized product:",{id:t.id,mainImage:r,colors:z,sizes:M,variantSizes:_,variantColors:f,totalVariants:((w=t.variantes)==null?void 0:w.length)||0}),{id:t.id,titre:t.titre,categorie:t.categorie,mainImage:r,prix_achat:t.prix_achat,prix_vente:t.prix_vente,prix_affilie:t.prix_affilie,stock_total:t.stock_total,quantite_min:t.quantite_min||1,rating_value:t.rating_value||0,variants:{sizes:_,colors:f},colors:z,sizes:M,variantsByCombo:{},slug:t.slug,description:t.description}},Q=(t,r)=>{var f;const _=(f=t.colors)==null?void 0:f.find(z=>z.name===r);return _!=null&&_.image_url?_.image_url:t.mainImage},le=async t=>{i.value=!0,g.value=null;try{const r={...j,...t},_=new URLSearchParams(Object.entries(r).filter(([$,Z])=>Z!==void 0&&Z!=="").map(([$,Z])=>[$,String(Z)])).toString(),f=_?`/affiliate/catalogue?${_}`:"/affiliate/catalogue",{data:z,error:M}=await be(f);if(M.value)throw M.value;const v=z.value;if(v){const $=v.data||[];ue.value=$.map(Z=>V(Z)),v.meta&&Object.assign(a,{current_page:v.meta.current_page,last_page:v.meta.last_page,per_page:v.meta.per_page,total:v.meta.total,from:v.meta.from,to:v.meta.to})}}catch(r){g.value=r.message||"Erreur lors du chargement du catalogue",b(g.value||"Erreur inconnue")}finally{i.value=!1}},Ae=async t=>{H.value=!0,g.value=null;try{const{data:r,error:_}=await be(`/affiliate/catalogue/${t}`,{method:"GET"});if(_.value)throw _.value;r.value&&(de.value=r.value)}catch(r){g.value=r.message||"Erreur lors du chargement du produit",b(g.value||"Erreur inconnue")}finally{H.value=!1}},ze=async t=>{try{const{data:r,error:_}=await be("/affiliate/cart/items",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(_.value)throw _.value;return m("Produit ajouté au panier"),await ge(),r.value}catch(r){const _=r.message||"Erreur lors de l'ajout au panier";throw b(_),r}},ge=async()=>{try{const{data:t,error:r}=await be("/affiliate/cart/summary",{method:"GET"});if(r.value)throw r.value;t.value&&(ae.value=t.value)}catch(t){console.error("Error fetching cart summary:",t)}},p=t=>{Object.assign(j,t),j.page=1},u=()=>{Object.assign(j,{q:"",category_id:"",min_profit:void 0,color:"",size:"",page:1,per_page:12})},O=()=>{de.value=null},S=t=>{j.page=t},F=async t=>{X.value=t,H.value=!0,g.value=null;try{const{data:r,error:_}=await be(`/affiliate/catalogue/${t}`);if(_.value){g.value=_.value.message||"Failed to fetch product details",b(g.value||"Failed to fetch product details");return}if(r.value){const f=r.value;G.value=se(f),ve(f.variantes||[]),Y.value=null,R.value=null,W.value=null,D.value=f.quantite_min||1,P.value=0}}catch(r){g.value=r.message||"Failed to fetch product details",b(g.value||"Failed to fetch product details")}finally{H.value=!1}},se=t=>{var v,$,Z,ne;const r=((v=t.images)==null?void 0:v.sort((w,k)=>w.ordre-k.ordre))||[],_=(($=r[0])==null?void 0:$.url)||"",f=[],z=[],M=[];return(Z=t.variantes)==null||Z.forEach(w=>{var fe,y;const k=((fe=w.attribut)==null?void 0:fe.code)||((y=w.attribut_principal)==null?void 0:y.toLowerCase());["taille","size"].includes(k)?f.push({id:w.id,value:w.valeur,stock:w.stock}):["couleur","color"].includes(k)&&z.push({id:w.id,name:w.valeur,swatch:w.color||w.swatch,image_url:w.image_url||void 0,stock:w.stock}),M.push({size:["taille","size"].includes(k)?w.valeur:void 0,color:["couleur","color"].includes(k)?w.valeur:void 0,stock:w.stock,variant_id:w.id})}),{id:t.id,ref:t.ref,titre:t.titre,description:t.description,copywriting:t.copywriting,notes_admin:t.notes_admin,prix_achat:t.prix_achat,prix_vente:t.prix_vente,prix_affilie:t.prix_affilie,stock_total:t.stock_total,quantite_min:t.quantite_min||1,rating_value:t.rating_value,categorie:t.categorie,gallery:{main:_,thumbnails:r},sizes:f.sort((w,k)=>w.value.localeCompare(k.value)),colors:z.sort((w,k)=>w.name.localeCompare(k.name)),matrix:M,images:r,videos:((ne=t.videos)==null?void 0:ne.map(w=>({id:w.id,url:w.url,title:w.titre||w.title})))||[]}},A=(t,r)=>{var z,M;const _=q(t,r),f=l.value[_];if(f){W.value=f.id,P.value=f.stock_available;const v=((z=G.value)==null?void 0:z.quantite_min)||1;D.value>P.value?D.value=Math.max(v,Math.min(P.value,v)):D.value<v&&(D.value=v)}else W.value=null,P.value=0,D.value=((M=G.value)==null?void 0:M.quantite_min)||1};return{items:ue,selectedProduct:de,loading:i,detailLoading:H,error:g,pagination:a,filters:j,cartSummary:ae,selectedId:X,drawerProduct:G,addingToCart:B,selectedColor:Y,selectedSize:R,selectedVariantId:W,selectedQty:D,maxQty:P,variantsByCombo:l,sizes:me,colors:ie,matrixRows:re,hasItems:Ce,isLoading:o,isDetailLoading:T,totalItems:N,fetchList:le,fetchOne:Ae,addToCart:ze,fetchCartSummary:ge,updateFilters:p,resetFilters:u,clearSelectedProduct:O,setPage:S,mapProductToNormalized:V,imageForColor:Q,fetchOneForDrawer:F,selectColor:t=>{Y.value=t,A(Y.value,R.value);const r=l.value[q(t,null)];r!=null&&r.image_url&&G.value&&(G.value.gallery.main=r.image_url)},selectSize:t=>{R.value=t,A(Y.value,R.value)},addToCartFromDrawer:async t=>{var r;B.value=!0;try{const{data:_,error:f}=await be("/affiliate/cart/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(f.value){if(f.value.status===422){const z=((r=f.value.data)==null?void 0:r.message)||"Stock insuffisant ou données invalides";b(z)}else f.value.status===404?b("Produit non trouvé"):b(f.value.message||"Erreur lors de l'ajout au panier");return!1}return _.value?(await ge(),!0):!1}catch(_){return b(_.message||"Erreur lors de l'ajout au panier"),!1}finally{B.value=!1}}}}),at={class:"catalogue-card__image-container"},lt={class:"d-flex align-center justify-center fill-height bg-grey-lighten-4"},st={key:0,class:"mb-2"},ot={class:"d-flex align-center gap-1 flex-wrap"},it={class:"text-caption"},rt={key:1,class:"mb-3"},nt={class:"d-flex align-center gap-1 flex-wrap"},ct={key:2,class:"mb-2"},ut={class:"text-caption d-flex align-center"},dt={class:"mb-3"},mt={class:"d-flex align-center justify-space-between mb-2"},vt={class:"text-body-2 text-medium-emphasis"},gt={class:"font-weight-medium"},pt={class:"text-body-2 text-medium-emphasis"},ft={class:"font-weight-medium"},_t={class:"text-primary font-weight-bold mb-2"},ht={key:3,class:"text-caption text-warning mb-2"},yt={class:"text-body-1 font-weight-medium catalogue-card__title mb-1"},xt={class:"d-flex align-center justify-space-between mb-2"},bt={class:"text-caption text-medium-emphasis"},wt={key:0,class:"d-flex align-center"},Ct={class:"text-caption font-weight-medium"},De="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xNTAgMTAwQzE2MS4wNDYgMTAwIDE3MCA5MC45NTQzIDE3MCA4MEM1NyA2OS4wNDU3IDE0Ny45NTQgNjAgMTM2IDYwQzEyNC45NTQgNjAgMTE2IDY5LjA0NTcgMTE2IDgwQzExNiA5MC45NTQzIDEyNC45NTQgMTAwIDEzNiAxMDBIMTUwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8cGF0aCBkPSJNMTgwIDEyMEgxMjBDMTE2LjY4NiAxMjAgMTE0IDEyMi42ODYgMTE0IDEyNlYyMDBDMTE0IDIwMy4zMTQgMTE2LjY4NiAyMDYgMTIwIDIwNkgxODBDMTgzLjMxNCAyMDYgMTg2IDIwMy4zMTQgMTg2IDIwMFYxMjZDMTg2IDEyMi42ODYgMTgzLjMxNCAxMjAgMTgwIDEyMFoiIGZpbGw9IiNDQ0NDQ0MiLz4KPC9zdmc+",Mt=$e({__name:"CatalogueCard",props:{product:{}},emits:["open","addToCart","variantChange","qtyChange"],setup(ue,{emit:de}){const i=ue,H=de,{t:g}=Pe();Xe(),C(!1);const a=C(""),j=C(""),ae=C(1);we(()=>i.product.quantite_min,o=>{o&&ae.value<o&&(ae.value=o)},{immediate:!0});const X=C(""),G=C(!0),B=C(!1),Y=I(()=>i.product.stock_total===0?"error":i.product.stock_total<10?"warning":"primary"),R=I(()=>i.product.stock_total===0?g("catalogue.card.out_of_stock"):i.product.stock_total.toString()),W=I(()=>`+${Math.max(0,(i.product.prix_vente||0)-(i.product.prix_achat||0)).toFixed(2)} MAD`),D=I(()=>{var T,N;const o=[];return console.log("🎨 [CatalogueCard] Computing color swatches for product:",i.product.id,{enhancedColors:i.product.colors,variantColors:(T=i.product.variants)==null?void 0:T.colors}),i.product.colors&&i.product.colors.length>0?i.product.colors.forEach(m=>{var V,Q;const b=(Q=(V=i.product.variants)==null?void 0:V.colors)==null?void 0:Q.find(le=>le.value===m.name);b&&b.stock>0&&o.push({id:b.id,name:m.name,swatch:m.swatch||b.color,stock:b.stock})}):(N=i.product.variants)!=null&&N.colors&&i.product.variants.colors.forEach(m=>{m.stock>0&&o.push({id:m.id,name:m.value,swatch:m.color,stock:m.stock})}),console.log("🎨 [CatalogueCard] Final color swatches:",o),o}),P=I(()=>{var T,N;const o=[];return console.log("📏 [CatalogueCard] Computing size chips for product:",i.product.id,{enhancedSizes:i.product.sizes,variantSizes:(T=i.product.variants)==null?void 0:T.sizes}),i.product.sizes&&i.product.sizes.length>0?i.product.sizes.forEach(m=>{var V,Q;const b=(Q=(V=i.product.variants)==null?void 0:V.sizes)==null?void 0:Q.find(le=>le.value===m);b&&b.stock>0&&o.push({id:b.id,value:m,stock:b.stock})}):(N=i.product.variants)!=null&&N.sizes&&i.product.variants.sizes.forEach(m=>{m.stock>0&&o.push(m)}),console.log("📏 [CatalogueCard] Final size chips:",o),o});we(()=>i.product.mainImage,o=>{var T,N,m,b,V,Q;console.log("🖼️ [CatalogueCard] Image watch triggered:",{productId:i.product.id,newImage:o,hasColors:(T=i.product.colors)==null?void 0:T.length,hasVariantColors:(m=(N=i.product.variants)==null?void 0:N.colors)==null?void 0:m.length,hasSizes:(b=i.product.sizes)==null?void 0:b.length,hasVariantSizes:(Q=(V=i.product.variants)==null?void 0:V.sizes)==null?void 0:Q.length}),o?(X.value=o,G.value=!0,B.value=!1):(X.value=De,G.value=!1,B.value=!1)},{immediate:!0});const l=I(()=>a.value?P.value.find(o=>o.id===a.value):j.value?D.value.find(o=>o.id===j.value):null),me=I(()=>{var N;let o=i.product.stock_total;l.value&&(o=l.value.stock);const T=Math.min(o,10);return console.log("📊 [CatalogueCard] Max quantity calculated:",{productId:i.product.id,totalStock:i.product.stock_total,selectedVariant:l.value,variantStock:(N=l.value)==null?void 0:N.stock,finalMax:T}),T});I(()=>{const o=i.product.stock_total>0&&ae.value<=me.value;return P.value.length>0&&D.value.length>0?o&&a.value&&j.value:P.value.length>0?o&&a.value:D.value.length>0?o&&j.value:o});const ie=o=>{a.value=o,H("variantChange",o)},re=o=>{var N,m,b;j.value=o,console.log("🎨 [CatalogueCard] Color selected:",o);const T=D.value.find(V=>V.id===o);if(T){console.log("🎨 [CatalogueCard] Found color:",T);const V=(m=(N=i.product.variants)==null?void 0:N.colors)==null?void 0:m.find(Q=>Q.id===o);if(V!=null&&V.image_url)console.log("🖼️ [CatalogueCard] Using variant image:",V.image_url),X.value=V.image_url,G.value=!0,B.value=!1;else{const Q=(b=i.product.colors)==null?void 0:b.find(le=>le.name===T.name);Q!=null&&Q.image_url?(console.log("🖼️ [CatalogueCard] Using enhanced color image:",Q.image_url),X.value=Q.image_url,G.value=!0,B.value=!1):(console.log("🖼️ [CatalogueCard] No variant image, using main image"),X.value=i.product.mainImage)}}H("variantChange",o)},q=()=>{H("open",i.product.id)};we(()=>i.product.id,()=>{a.value="",j.value="",ae.value=i.product.quantite_min||1,X.value=i.product.mainImage});const ve=()=>{G.value=!1,B.value=!1},Ce=()=>{G.value=!1,B.value=!0,console.log("❌ [CatalogueCard] Image failed to load:",X.value),X.value!==De&&(X.value=De)};return(o,T)=>(d(),K(Te,{class:"catalogue-card",elevation:"2",onClick:q},{default:h(()=>[e("div",at,[c(Se,{src:X.value||De,alt:o.product.titre,"aspect-ratio":"1.2",cover:"",class:"catalogue-card__image",onLoad:ve,onError:Ce},{placeholder:h(()=>[e("div",lt,[G.value&&!B.value?(d(),K(Ne,{key:0,indeterminate:"",color:"primary",size:"40"})):B.value?(d(),K(U,{key:1,icon:"tabler-photo-off",size:"40",color:"grey"})):E("",!0)])]),_:1},8,["src","alt"]),c(te,{color:Y.value,size:"small",variant:"elevated",class:"catalogue-card__stock-badge"},{default:h(()=>[L(s(R.value),1)]),_:1},8,["color"]),c(J,{icon:"",size:"small",variant:"elevated",color:"primary",class:"catalogue-card__eye-btn",onClick:Me(q,["stop"])},{default:h(()=>[c(U,{icon:"tabler-eye"})]),_:1})]),c(Be,{class:"catalogue-card__content pa-3"},{default:h(()=>{var N;return[D.value.length?(d(),x("div",st,[e("div",ot,[(d(!0),x(oe,null,ce(D.value.slice(0,3),(m,b)=>(d(),K(te,{key:m.id||b,color:j.value===m.id?"primary":"default",variant:j.value===m.id?"flat":"outlined",size:"small",class:"color-chip cursor-pointer",onClick:Me(V=>re(m.id),["stop"])},{default:h(()=>[m.swatch?(d(),K(U,{key:0,style:Oe({color:m.swatch}),icon:"tabler-circle-filled",start:"",size:"14"},null,8,["style"])):E("",!0),e("span",it,s(m.name),1)]),_:2},1032,["color","variant","onClick"]))),128)),D.value.length>3?(d(),K(Ve,{key:0,location:"top"},{activator:h(({props:m})=>[c(te,qe(m,{size:"small",variant:"outlined",class:"text-caption"}),{default:h(()=>[L(" +"+s(D.value.length-3),1)]),_:2},1040)]),default:h(()=>[e("span",null,s(D.value.slice(3).map(m=>m.name).join(", ")),1)]),_:1})):E("",!0)])])):E("",!0),P.value.length?(d(),x("div",rt,[e("div",nt,[(d(!0),x(oe,null,ce(P.value.slice(0,5),m=>(d(),K(te,{key:m.id,color:a.value===m.id?"primary":"default",variant:a.value===m.id?"flat":"outlined",size:"small",class:"size-chip",onClick:Me(b=>ie(m.id),["stop"])},{default:h(()=>[L(s(m.value),1)]),_:2},1032,["color","variant","onClick"]))),128))])])):E("",!0),P.value.length>0&&D.value.length>0?(d(),x("div",ct,[e("div",ut,[c(U,{icon:a.value&&j.value?"tabler-check-circle":"tabler-circle",color:a.value&&j.value?"success":"default",size:"14",class:"me-1"},null,8,["icon","color"]),e("span",{class:Fe(a.value&&j.value?"text-success":"text-medium-emphasis")},s(a.value&&j.value?"Variantes sélectionnées":"Sélectionnez taille et couleur"),3)])])):E("",!0),e("div",dt,[c(J,{color:"primary",variant:"flat",size:"small",block:"",onClick:Me(q,["stop"])},{default:h(()=>[c(U,{icon:"tabler-shopping-cart",class:"me-2"}),T[0]||(T[0]=L(" Commander "))]),_:1,__:[0]})]),e("div",mt,[e("div",vt,[L(s(n(g)("catalogue.buy"))+": ",1),e("span",gt,s(o.product.prix_achat)+" درهم",1)]),e("div",pt,[L(s(n(g)("catalogue.sell"))+": ",1),e("span",ft,s(o.product.prix_vente)+" درهم",1)])]),e("div",_t,s(W.value)+" "+s(n(g)("catalogue.profit")),1),o.product.quantite_min&&o.product.quantite_min>1?(d(),x("div",ht,[c(U,{icon:"tabler-info-circle",size:"14",class:"me-1"}),L(" Quantité min: "+s(o.product.quantite_min),1)])):E("",!0),e("h6",yt,s(o.product.titre),1),e("div",xt,[e("div",bt,s(((N=o.product.categorie)==null?void 0:N.nom)||"Sans catégorie"),1),o.product.rating_value?(d(),x("div",wt,[c(U,{icon:"tabler-star-filled",size:"14",color:"warning",class:"me-1"}),e("span",Ct,s(o.product.rating_value.toFixed(1)),1)])):E("",!0)])]}),_:1})]),_:1}))}}),Ha=Ye(Mt,[["__scopeId","data-v-f1044084"]]),zt={key:0,class:"d-flex justify-center align-center",style:{height:"100vh"}},kt={class:"product-drawer__header pa-4 border-b bg-surface position-sticky",style:{top:"0","z-index":"10"}},It={class:"d-flex justify-space-between align-center mb-3"},Dt={class:"flex-grow-1"},Tt={class:"text-h5 font-weight-bold mb-1"},St={class:"text-body-2 text-medium-emphasis"},At={class:"d-flex gap-3 flex-wrap"},Et={class:"drawer-content",style:{height:"calc(100vh - 140px)","overflow-y":"auto"}},Nt={class:"pa-6 border-b"},Vt={class:"main-image-container mb-4"},Qt={key:0,class:"thumbnails-rail"},Lt={class:"d-flex gap-2 flex-wrap justify-center"},jt={key:0,class:"mb-4"},$t={class:"text-subtitle-1 mb-3"},Pt={class:"d-flex gap-2 flex-wrap"},qt={key:0,class:"text-caption text-medium-emphasis mt-1"},Ft={key:1,class:"mb-4"},Ot={class:"text-subtitle-1 mb-3"},Bt={class:"d-flex gap-2 flex-wrap"},Yt={key:0,class:"text-caption text-medium-emphasis mt-1"},Gt={class:"mb-4"},Xt={class:"d-flex justify-space-between align-center mb-3"},Zt={class:"text-body-1"},Ut={class:"text-center"},Ht={class:"text-h6 text-primary"},Rt={class:"text-end"},Wt={class:"text-h6 text-success"},Jt={class:"mb-4"},Kt={class:"text-subtitle-1 mb-3"},ea={class:"d-flex align-center gap-3"},ta={class:"text-caption text-medium-emphasis"},aa={key:0,class:"text-caption text-warning mt-2"},la={key:1,class:"text-caption text-error mt-2"},sa={class:"pa-6 border-b"},oa={key:0,class:"mb-6"},ia={class:"text-h6 mb-3"},ra=["innerHTML"],na={key:1,class:"mb-6"},ca={class:"text-h6 mb-3"},ua={key:2,class:"mb-6"},da={class:"d-flex justify-space-between align-center mb-3"},ma={class:"text-h6"},va=["innerHTML"],ga={class:"pa-6"},pa={key:0,class:"mb-6"},fa={class:"font-weight-medium"},_a={class:"font-weight-medium"},ha={key:1,class:"mb-6"},ya={class:"text-h6 mb-3"},xa={class:"d-flex gap-3 flex-wrap"},ba={key:2,class:"mb-6"},wa={class:"text-h6 mb-3"},Ca={class:"d-flex gap-3 flex-wrap"},Ma={class:"d-flex align-center mb-2"},za={class:"text-body-2 font-weight-medium"},ka={class:"d-flex gap-2"},Ia={class:"drawer-footer pa-4 border-t bg-surface position-sticky",style:{bottom:"0","z-index":"10"}},Da={class:"d-flex justify-space-between align-center mb-3"},Ta={class:"text-body-2"},Sa={key:0,class:"me-2"},Aa={key:1,class:"me-2"},Ea={class:"text-h6 font-weight-bold text-success"},Na={key:2,class:"d-flex align-center justify-center pa-8"},Va=$e({__name:"ProductDrawer",props:{modelValue:{type:Boolean},productId:{}},emits:["update:modelValue"],setup(ue,{emit:de}){const i=ue,H=de,{t:g}=Pe(),a=Xe(),j=Re(),{showSuccess:ae,showError:X}=Ge(),{openCartDrawer:G}=Je(),B=C(0),Y=C(""),R=C(null),W=C(""),D=C(""),P=I({get:()=>i.modelValue,set:p=>H("update:modelValue",p)}),l=I(()=>a.drawerProduct),me=I(()=>a.detailLoading),ie=I(()=>a.addingToCart),re=I(()=>{var p;return Y.value?Y.value:(p=l.value)!=null&&p.gallery.main?l.value.gallery.main:""}),q=I(()=>a.maxQty),ve=I(()=>{var S;const p=((S=l.value)==null?void 0:S.quantite_min)||1;if(!l.value||a.selectedQty<p||a.selectedQty>q.value)return!1;const u=a.sizes.length>0,O=a.colors.length>0;return u&&O?a.selectedSize&&a.selectedColor&&a.selectedVariantId&&q.value>0:u?a.selectedSize&&a.selectedVariantId&&q.value>0:O?a.selectedColor&&a.selectedVariantId&&q.value>0:q.value>0});I(()=>l.value?l.value.prix_vente*a.selectedQty:0);const Ce=I(()=>l.value?l.value.prix_affilie*a.selectedQty:0),o=I(()=>{var p;return R.value||((p=l.value)==null?void 0:p.prix_vente)||0}),T=I(()=>l.value?Math.max(0,o.value-(l.value.prix_achat||0)):0);I(()=>T.value*a.selectedQty);const N=I(()=>a.matrixRows),m=p=>{var u;B.value=p,(u=l.value)!=null&&u.gallery.thumbnails[p]&&(Y.value=l.value.gallery.thumbnails[p].url)},b=p=>{if(W.value=p,a.selectColor(p),l.value){const u=a.colors.find(O=>O.name===p);u!=null&&u.image_url?Y.value=u.image_url:Y.value=l.value.gallery.main||""}},V=p=>{D.value=p,a.selectSize(p)},Q=(p,u)=>{const O=document.createElement("a");O.href=p,O.download=u,O.target="_blank",document.body.appendChild(O),O.click(),document.body.removeChild(O)},le=async p=>{try{await navigator.clipboard.writeText(p),ae("Texte copié dans le presse-papiers")}catch{X("Erreur lors de la copie")}},Ae=p=>{window.open(p,"_blank")},ze=async()=>{if(!(!l.value||!ve.value))try{await j.addItem({produit_id:l.value.id,variante_id:a.selectedVariantId||void 0,qty:a.selectedQty,sell_price:R.value||void 0}),ae(g("catalogue.cart.added_success")),a.selectedQty=1,P.value=!1,setTimeout(()=>{G()},300)}catch(p){console.error("Add to cart error:",p)}};we(()=>i.productId,async p=>{var u;p&&i.modelValue&&(await a.fetchOneForDrawer(p),B.value=0,Y.value=((u=l.value)==null?void 0:u.gallery.main)||"",W.value="",D.value="")},{immediate:!0}),we(()=>i.modelValue,p=>{p&&i.productId?(a.fetchOneForDrawer(i.productId),He(()=>{var u;!Y.value&&((u=l.value)!=null&&u.gallery.main)&&(Y.value=l.value.gallery.main)})):p||(a.selectedColor=null,a.selectedSize=null,a.selectedVariantId=null,a.selectedQty=1,a.maxQty=0,B.value=0,Y.value="",W.value="",D.value="")}),we([W,D],()=>{a.selectedColor=W.value||null,a.selectedSize=D.value||null},{immediate:!0}),Ue(()=>{P.value&&(P.value=!1)});const ge=p=>p?p.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").trim():"";return(p,u)=>(d(),K(We,{modelValue:P.value,"onUpdate:modelValue":u[6]||(u[6]=O=>P.value=O),location:"end",width:"1000",temporary:"",class:"product-drawer"},{default:h(()=>{var O;return[me.value?(d(),x("div",zt,[c(Ne,{indeterminate:"",color:"primary",size:"64"})])):l.value?(d(),x(oe,{key:1},[e("div",kt,[e("div",It,[e("div",Dt,[e("h2",Tt,s(l.value.titre),1),e("div",St,s((O=l.value.categorie)==null?void 0:O.nom),1)]),c(J,{icon:"tabler-x",variant:"text",size:"small",onClick:u[0]||(u[0]=S=>P.value=!1)})]),e("div",At,[c(te,{color:"primary",variant:"tonal",size:"small"},{default:h(()=>[c(U,{icon:"tabler-package",start:""}),L(" "+s(n(g)("catalogue.kpis.stock"))+": "+s(l.value.stock_total),1)]),_:1}),c(te,{color:"success",variant:"tonal",size:"small"},{default:h(()=>[c(U,{icon:"tabler-coins",start:""}),L(" "+s(n(g)("catalogue.kpis.profit"))+": +"+s(T.value.toFixed(2))+" MAD ",1)]),_:1}),c(te,{color:"info",variant:"tonal",size:"small"},{default:h(()=>[L(s(n(g)("catalogue.kpis.buy"))+": "+s(l.value.prix_achat)+" MAD ",1)]),_:1}),c(te,{color:"warning",variant:"tonal",size:"small"},{default:h(()=>[L(s(n(g)("catalogue.kpis.sell"))+": "+s(l.value.prix_vente)+" MAD ",1)]),_:1})])]),e("div",Et,[e("div",Nt,[c(Ke,null,{default:h(()=>[c(Le,{cols:"6"},{default:h(()=>[e("div",Vt,[c(Se,{src:re.value,alt:l.value.titre,"aspect-ratio":"1",cover:"",class:"rounded-lg main-image",style:{"max-height":"350px"}},null,8,["src","alt"])]),l.value.gallery.thumbnails.length>1?(d(),x("div",Qt,[e("div",Lt,[(d(!0),x(oe,null,ce(l.value.gallery.thumbnails,(S,F)=>(d(),x("div",{key:F,class:"position-relative thumbnail-container"},[c(Se,{src:S.url,alt:`${l.value.titre} - Image ${F+1}`,width:"60",height:"60",cover:"",class:Fe(["rounded cursor-pointer thumbnail",{"thumbnail--active":B.value===F}]),onClick:se=>m(F)},null,8,["src","alt","class","onClick"]),c(J,{icon:"tabler-download",size:"x-small",variant:"elevated",color:"primary",class:"download-btn",onClick:Me(se=>Q(S.url,`${l.value.titre}_image_${F+1}.jpg`),["stop"])},null,8,["onClick"])]))),128))])])):E("",!0)]),_:1}),c(Le,{cols:"6"},{default:h(()=>{var S,F,se;return[n(a).colors.length?(d(),x("div",jt,[e("h4",$t,s(n(g)("catalogue.variants.color")),1),e("div",Pt,[(d(!0),x(oe,null,ce(n(a).colors,A=>(d(),K(Ve,{key:A.name,location:"top"},{activator:h(({props:pe})=>[c(te,qe({ref_for:!0},pe,{color:n(a).selectedColor===A.name?"primary":"default",variant:n(a).selectedColor===A.name?"flat":"outlined",size:"large",class:"cursor-pointer color-chip",onClick:ke=>b(A.name)}),{default:h(()=>[A.swatch?(d(),K(U,{key:0,style:Oe({color:A.swatch}),icon:"tabler-circle-filled",start:""},null,8,["style"])):E("",!0),L(" "+s(A.name),1)]),_:2},1040,["color","variant","onClick"])]),default:h(()=>[e("span",null,s(A.name),1)]),_:2},1024))),128))]),!n(a).selectedColor&&n(a).colors.length?(d(),x("div",qt,s(n(g)("catalogue.select.color")),1)):E("",!0)])):E("",!0),n(a).sizes.length?(d(),x("div",Ft,[e("h4",Ot,s(n(g)("catalogue.variants.size")),1),e("div",Bt,[(d(!0),x(oe,null,ce(n(a).sizes,A=>(d(),K(te,{key:A,color:n(a).selectedSize===A?"primary":"default",variant:n(a).selectedSize===A?"flat":"outlined",size:"large",class:"cursor-pointer",onClick:pe=>V(A)},{default:h(()=>[L(s(A),1)]),_:2},1032,["color","variant","onClick"]))),128))]),!n(a).selectedSize&&n(a).sizes.length?(d(),x("div",Yt,s(n(g)("catalogue.select.size")),1)):E("",!0)])):E("",!0),e("div",Gt,[u[10]||(u[10]=e("h4",{class:"text-subtitle-1 mb-3"},"Prix et Commission",-1)),c(Te,{variant:"outlined",class:"pa-4"},{default:h(()=>{var A,pe,ke,Ee,t;return[e("div",Xt,[e("div",null,[u[7]||(u[7]=e("div",{class:"text-caption text-medium-emphasis"},"Prix d'achat",-1)),e("div",Zt,s(((A=l.value)==null?void 0:A.prix_achat)||0)+" MAD",1)]),e("div",Ut,[u[8]||(u[8]=e("div",{class:"text-caption text-medium-emphasis"},"Prix recommandé",-1)),e("div",Ht,s(((pe=l.value)==null?void 0:pe.prix_vente)||0)+" MAD",1)]),e("div",Rt,[u[9]||(u[9]=e("div",{class:"text-caption text-medium-emphasis"},"Commission unitaire",-1)),e("div",Wt,"+"+s(T.value.toFixed(2))+" MAD",1)])]),c(je,{modelValue:R.value,"onUpdate:modelValue":u[1]||(u[1]=r=>R.value=r),modelModifiers:{number:!0},label:"Prix de vente personnalisé (optionnel)",type:"number",variant:"outlined",density:"compact",suffix:"MAD",min:((ke=l.value)==null?void 0:ke.prix_achat)||0,placeholder:((t=(Ee=l.value)==null?void 0:Ee.prix_vente)==null?void 0:t.toString())||"0",hint:"Laissez vide pour utiliser le prix recommandé","persistent-hint":"",clearable:""},null,8,["modelValue","min","placeholder"])]}),_:1})]),e("div",Jt,[e("h4",Kt,s(n(g)("catalogue.detail.quantity")),1),e("div",ea,[c(J,{icon:"tabler-minus",size:"small",variant:"outlined",disabled:n(a).selectedQty<=(((S=l.value)==null?void 0:S.quantite_min)||1)||q.value===0,onClick:u[2]||(u[2]=A=>n(a).selectedQty--)},null,8,["disabled"]),c(je,{modelValue:n(a).selectedQty,"onUpdate:modelValue":u[3]||(u[3]=A=>n(a).selectedQty=A),modelModifiers:{number:!0},type:"number",variant:"outlined",density:"compact",style:{width:"80px"},min:((F=l.value)==null?void 0:F.quantite_min)||1,max:q.value,disabled:q.value===0,"hide-details":""},null,8,["modelValue","min","max","disabled"]),c(J,{icon:"tabler-plus",size:"small",variant:"outlined",disabled:n(a).selectedQty>=q.value||q.value===0,onClick:u[4]||(u[4]=A=>n(a).selectedQty++)},null,8,["disabled"]),e("span",ta,"Max: "+s(q.value),1)]),(se=l.value)!=null&&se.quantite_min&&l.value.quantite_min>1?(d(),x("div",aa,[c(U,{icon:"tabler-info-circle",size:"14",class:"me-1"}),L(" Quantité minimale: "+s(l.value.quantite_min),1)])):E("",!0),q.value===0?(d(),x("div",la,s(n(g)("catalogue.qty.max_zero")),1)):E("",!0)]),c(J,{color:"primary",size:"large",block:"",disabled:!ve.value,loading:ie.value,onClick:ze},{default:h(()=>[c(U,{icon:"tabler-shopping-cart",start:""}),L(" "+s(n(g)("catalogue.actions.add_to_cart")),1)]),_:1},8,["disabled","loading"])]}),_:1})]),_:1})]),e("div",sa,[l.value.description?(d(),x("div",oa,[e("h3",ia,s(n(g)("catalogue.detail.description")),1),e("div",{class:"text-body-1",innerHTML:ge(l.value.description)},null,8,ra)])):E("",!0),l.value.notes_admin?(d(),x("div",na,[e("h3",ca,s(n(g)("catalogue.admin_note")),1),c(et,{type:"info",variant:"tonal",class:"text-body-1"},{default:h(()=>[c(U,{icon:"tabler-info-circle",start:""}),L(" "+s(l.value.notes_admin),1)]),_:1})])):E("",!0),l.value.copywriting?(d(),x("div",ua,[e("div",da,[e("h3",ma,s(n(g)("catalogue.copywriting")),1),c(J,{variant:"outlined",size:"small","prepend-icon":"tabler-copy",onClick:u[5]||(u[5]=S=>le(l.value.copywriting))},{default:h(()=>u[11]||(u[11]=[L(" Copier ")])),_:1,__:[11]})]),c(Te,{variant:"outlined",class:"pa-4"},{default:h(()=>[e("div",{class:"text-body-1 copywriting-content",innerHTML:ge(l.value.copywriting)},null,8,va)]),_:1})])):E("",!0)]),e("div",ga,[N.value.length?(d(),x("div",pa,[u[12]||(u[12]=e("h3",{class:"text-h6 mb-3"},"Stock par combinaison",-1)),c(tt,{density:"compact"},{default:h(()=>[e("thead",null,[e("tr",null,[e("th",null,s(n(g)("catalogue.table.quantity")),1),e("th",null,s(n(g)("catalogue.table.color")),1),e("th",null,s(n(g)("catalogue.table.size")),1)])]),e("tbody",null,[(d(!0),x(oe,null,ce(N.value,(S,F)=>(d(),x("tr",{key:F},[e("td",null,[c(te,{color:S.qty>0?"success":"error",size:"small",variant:"tonal"},{default:h(()=>[L(s(S.qty),1)]),_:2},1032,["color"])]),e("td",fa,s(S.color),1),e("td",_a,s(S.size),1)]))),128))])]),_:1})])):E("",!0),l.value.images.length?(d(),x("div",ha,[e("h3",ya,s(n(g)("catalogue.assets.images")),1),e("div",xa,[(d(!0),x(oe,null,ce(l.value.images,(S,F)=>(d(),x("div",{key:F,class:"position-relative image-asset"},[c(Se,{src:S.url,width:"100",height:"100",cover:"",class:"rounded"},null,8,["src"]),c(Ve,{activator:"parent",location:"top"},{default:h(()=>[L(s(n(g)("catalogue.actions.download")),1)]),_:1}),c(J,{icon:"tabler-download",size:"small",variant:"elevated",color:"primary",class:"download-overlay",onClick:se=>Q(S.url,`${l.value.titre}_image_${F+1}.jpg`)},null,8,["onClick"])]))),128))])])):E("",!0),l.value.videos.length?(d(),x("div",ba,[e("h3",wa,s(n(g)("catalogue.assets.videos")),1),e("div",Ca,[(d(!0),x(oe,null,ce(l.value.videos,(S,F)=>(d(),K(Te,{key:F,variant:"outlined",width:"200",class:"video-asset"},{default:h(()=>[c(Be,{class:"pa-3"},{default:h(()=>[e("div",Ma,[c(U,{icon:"tabler-video",class:"me-2"}),e("span",za,s(S.title||`Video ${F+1}`),1)]),e("div",ka,[c(J,{size:"small",variant:"outlined","prepend-icon":"tabler-eye",onClick:se=>Ae(S.url)},{default:h(()=>[L(s(n(g)("actions.view")),1)]),_:2},1032,["onClick"]),c(J,{size:"small",variant:"outlined","prepend-icon":"tabler-download",onClick:se=>Q(S.url,`${l.value.titre}_video_${F+1}.mp4`)},{default:h(()=>[L(s(n(g)("catalogue.actions.download")),1)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])])):E("",!0)])]),e("div",Ia,[e("div",Da,[e("div",Ta,[n(a).selectedColor?(d(),x("span",Sa,s(n(a).selectedColor),1)):E("",!0),n(a).selectedSize?(d(),x("span",Aa,s(n(a).selectedSize),1)):E("",!0),e("span",null,"Qty: "+s(n(a).selectedQty),1)]),e("div",Ea," +"+s(Ce.value.toFixed(2))+" MAD ",1)]),c(J,{color:"primary",size:"large",block:"",disabled:!ve.value,loading:ie.value,onClick:ze},{default:h(()=>[c(U,{icon:"tabler-shopping-cart",start:""}),L(" "+s(n(g)("catalogue.actions.add_to_cart"))+" - "+s((o.value*n(a).selectedQty).toFixed(2))+" MAD ",1)]),_:1},8,["disabled","loading"])])],64)):(d(),x("div",Na,[c(Ne,{indeterminate:"",color:"primary"})]))]}),_:1},8,["modelValue"]))}}),Ra=Ye(Va,[["__scopeId","data-v-a6a31672"]]);export{Ha as C,Ra as P,Xe as u};
