import{b5 as w,r as c,V as h,b6 as l}from"./main-3LuWNv9W.js";const A=w("shipping",()=>{const u=c([]),p=c(null),g=c([]),o=c(!1),t=c(null),v=c({current_page:1,last_page:1,per_page:15,total:0}),i=c({page:1,perPage:15,sort:"updated_at",dir:"desc"}),f=h(()=>u.value.length>0),m=h(()=>o.value),y=h(()=>g.value.length>0),d=async n=>{var a,r;o.value=!0,t.value=null;try{n&&Object.assign(i.value,n);const e=await l.get("/admin/shipping/orders",{params:i.value});if(e.data.success)u.value=e.data.data,v.value=e.data.pagination;else throw new Error(e.data.message||"Failed to fetch shipping orders")}catch(e){t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to fetch shipping orders",console.error("Error fetching shipping orders:",e)}finally{o.value=!1}};return{shippingOrders:u,currentShippingOrder:p,cities:g,loading:o,error:t,pagination:v,filters:i,hasShippingOrders:f,isLoading:m,hasCities:y,fetchShippingOrders:d,fetchShippingOrder:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.get(`admin/shipping/orders/${n}`);if(e.data.success)p.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch shipping order")}catch(e){t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to fetch shipping order",console.error("Error fetching shipping order:",e)}finally{o.value=!1}},addParcel:async(n,a)=>{var r,e;o.value=!0,t.value=null;try{const s=await l.post("admin/shipping/ozon/parcels",{commande_id:n,tracking_number:a});if(s.data.success)return s.data.data;throw new Error(s.data.message||"Failed to create parcel")}catch(s){throw t.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to create parcel",console.error("Error creating parcel:",s),s}finally{o.value=!1}},getTracking:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.post("admin/shipping/ozon/track",{tracking_number:n});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get tracking")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get tracking",console.error("Error getting tracking:",e),e}finally{o.value=!1}},getParcelInfo:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.post("admin/shipping/ozon/parcel-info",{tracking_number:n});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get parcel info")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get parcel info",console.error("Error getting parcel info:",e),e}finally{o.value=!1}},resendToOzon:async(n,a="ramassage")=>{var r,e;o.value=!0,t.value=null;try{const s=await l.post("admin/shipping/ozon/resend",{commande_id:n,mode:a});if(s.data.success)return await d(i.value),s.data.data;throw new Error(s.data.message||"Failed to resend to OzonExpress")}catch(s){throw t.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to resend to OzonExpress",console.error("Error resending to OzonExpress:",s),s}finally{o.value=!1}},trackParcel:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.post("admin/shipping/ozon/track",{tracking_number:n});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to track parcel")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to track parcel",console.error("Error tracking parcel:",e),e}finally{o.value=!1}},getParcelInfoNew:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.post("/admin/shipping/ozon/parcel-info",{tracking_number:n});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get parcel info")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get parcel info",console.error("Error getting parcel info:",e),e}finally{o.value=!1}},createDeliveryNote:async()=>{var n,a;o.value=!0,t.value=null;try{const r=await l.post("admin/shipping/ozon/dn/create");if(r.data.success)return r.data.data.ref;throw new Error(r.data.message||"Failed to create delivery note")}catch(r){throw t.value=((a=(n=r.response)==null?void 0:n.data)==null?void 0:a.message)||r.message||"Failed to create delivery note",console.error("Error creating delivery note:",r),r}finally{o.value=!1}},addParcelsToDeliveryNote:async(n,a)=>{var r,e;o.value=!0,t.value=null;try{const s=await l.post("admin/shipping/ozon/dn/add-parcels",{ref:n,codes:a});if(s.data.success)return s.data.data;throw new Error(s.data.message||"Failed to add parcels to delivery note")}catch(s){throw t.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to add parcels to delivery note",console.error("Error adding parcels to delivery note:",s),s}finally{o.value=!1}},saveDeliveryNote:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.post("admin/shipping/ozon/dn/save",{ref:n});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to save delivery note")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to save delivery note",console.error("Error saving delivery note:",e),e}finally{o.value=!1}},getDeliveryNotePdf:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.get("admin/shipping/ozon/dn/pdf",{params:{ref:n}});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get PDF links")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get PDF links",console.error("Error getting PDF links:",e),e}finally{o.value=!1}},fetchCities:async(n=!1)=>{var a,r;o.value=!0,t.value=null;try{const e=await l.get("admin/shipping/ozon/cities",{params:{refresh:n}});if(e.data.success)g.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch cities")}catch(e){t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to fetch cities",console.error("Error fetching cities:",e)}finally{o.value=!1}},resetFilters:()=>{i.value={page:1,perPage:15,sort:"updated_at",dir:"desc"}},clearCurrentShippingOrder:()=>{p.value=null},refreshTracking:async n=>{try{const a=await l.post("admin/shipping/orders/refresh-tracking",{tracking_number:n});return a.data.success&&await d(i.value),a.data}catch(a){throw console.error("Error refreshing tracking:",a),a}},refreshTrackingBulk:async n=>{try{const a=await l.post("admin/shipping/orders/refresh-tracking-bulk",{tracking_numbers:n});return a.data.success&&await d(i.value),a.data}catch(a){throw console.error("Error refreshing tracking bulk:",a),a}},updateShippingStatus:async(n,a)=>{var r,e;o.value=!0,t.value=null;try{const s=await l.post(`admin/shipping/orders/${n}/status`,a);if(s.data.success)return s.data;throw new Error(s.data.message||"Failed to update shipping status")}catch(s){throw t.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to update shipping status",console.error("Error updating shipping status:",s),new Error(t.value||"Failed to update shipping status")}finally{o.value=!1}},decrementStock:async n=>{var a,r;o.value=!0,t.value=null;try{const e=await l.post(`admin/shipping/orders/${n}/decrement-stock`);if(e.data.success)return await d(i.value),e.data;throw new Error(e.data.message||"Failed to decrement stock")}catch(e){throw t.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to decrement stock",console.error("Error decrementing stock:",e),new Error(t.value||"Failed to decrement stock")}finally{o.value=!1}},incrementStock:async(n,a)=>{var r,e;o.value=!0,t.value=null;try{const s=await l.post(`admin/shipping/orders/${n}/increment-stock`,{return_reason:a});if(s.data.success)return await d(i.value),s.data;throw new Error(s.data.message||"Failed to increment stock")}catch(s){throw t.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to increment stock",console.error("Error incrementing stock:",s),new Error(t.value||"Failed to increment stock")}finally{o.value=!1}},updateDeliveryBoyInfo:async(n,a)=>{var r,e;o.value=!0,t.value=null;try{const s=await l.post(`admin/shipping/orders/${n}/delivery-boy`,a);if(s.data.success)return s.data;throw new Error(s.data.message||"Failed to update delivery boy info")}catch(s){throw t.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to update delivery boy info",console.error("Error updating delivery boy info:",s),new Error(t.value||"Failed to update delivery boy info")}finally{o.value=!1}}}});export{A as u};
