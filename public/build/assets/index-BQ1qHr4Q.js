import{b4 as Fe,r as x,V as W,d as ge,g as F,o as V,f as e,l as A,b as t,e as a,t as l,ac as E,s as w,aL as De,j as We,b6 as Ae,b7 as Ne,w as ce,D as Re,c as pe,m as r,F as qe,i as Le,az as te}from"./main-uLG9IIeX.js";import{$ as ae}from"./api-DSi3Suj8.js";import{u as Te}from"./useNotifications-DDBS_wPD.js";import{useQuickConfirm as Ee}from"./useConfirmAction-C-KKQTYr.js";import{_ as ze}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-nczKusLe.js";import{C as Ue}from"./ConfirmActionDialog-uPYgr6qv.js";import{V as q,b as se,c as ye}from"./VCard-CB1gT6RB.js";import{V as j}from"./VCardText-BZtszuIK.js";import{V as le,a as P}from"./VRow-aGfXYx3U.js";import{V as G}from"./VChip-B84WcmDa.js";import{V as je}from"./VDataTable-DNqSzzrc.js";import{V as be}from"./VSpacer-BCNmCEP9.js";import{V as ve}from"./VDialog-DU1pBIct.js";import{V as fe,a as Me}from"./VTabs-BkhoRyPL.js";import{V as _e,a as Be}from"./VWindowItem-DPvP18Ki.js";import{V as he}from"./VDataTableServer-DfLBg0lg.js";import{V as we}from"./VTooltip-Ce3bfmSx.js";import{V as He}from"./VTextarea-BuIc6d95.js";import"./index-D-EbNoF1.js";import"./VBreadcrumbs-D7yKQl5l.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VAvatar-bHPDEsYY.js";import"./VImg-BS6_svHJ.js";/* empty css              */import"./VPagination-DYW6O4lq.js";import"./VSelect-sWnAtot-.js";import"./VTextField-Dxeq5kx5.js";import"./VField-CfH1YcVv.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VList-uZDByhc2.js";import"./ssrBoot-BPhRU-mF.js";import"./VDivider-UqGR4x4D.js";import"./dialog-transition-2hF0ajsQ.js";import"./VMenu-DP1p-55V.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";const Ie=Fe("affiliatePayments",()=>{const M=x([]),o=x([]),z=x(null),N=x({}),c=x({commissions:!1,withdrawals:!1,payout:!1}),k=x(null),R=x({current_page:1,last_page:1,per_page:15,total:0,from:null,to:null}),y=x({current_page:1,last_page:1,per_page:15,total:0,from:null,to:null}),h=x({q:"",status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}),b=x({status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}),n=W(()=>M.value.length>0),d=W(()=>o.value.length>0),g=W(()=>c.value.commissions),C=W(()=>c.value.withdrawals),D=W(()=>c.value.payout),L=W(()=>{var u;return((u=N.value.eligible)==null?void 0:u.total)||0}),ne=W(()=>{var u;return((u=N.value.eligible)==null?void 0:u.count)||0}),oe=async(u=1)=>{var _,U;c.value.commissions=!0,k.value=null;try{const p=new URLSearchParams;p.append("page",u.toString()),p.append("per_page",((_=h.value.per_page)==null?void 0:_.toString())||"15"),h.value.q&&p.append("q",h.value.q),(U=h.value.status)!=null&&U.length&&h.value.status.forEach(K=>p.append("status[]",K)),h.value.date_from&&p.append("date_from",h.value.date_from),h.value.date_to&&p.append("date_to",h.value.date_to),h.value.amount_min&&p.append("amount_min",h.value.amount_min.toString()),h.value.amount_max&&p.append("amount_max",h.value.amount_max.toString()),h.value.sort&&p.append("sort",h.value.sort),h.value.dir&&p.append("dir",h.value.dir);const S=await ae(`/affiliate/commissions?${p.toString()}`);if(S.success)M.value=S.data,R.value=S.pagination,N.value=S.summary||{};else throw new Error(S.message||"Failed to fetch commissions")}catch(p){k.value=p.message||"An error occurred while fetching commissions",console.error("Error fetching affiliate commissions:",p)}finally{c.value.commissions=!1}},B=async(u=1)=>{var _,U;c.value.withdrawals=!0,k.value=null;try{const p=new URLSearchParams;p.append("page",u.toString()),p.append("per_page",((_=b.value.per_page)==null?void 0:_.toString())||"15"),(U=b.value.status)!=null&&U.length&&b.value.status.forEach(K=>p.append("status[]",K)),b.value.date_from&&p.append("date_from",b.value.date_from),b.value.date_to&&p.append("date_to",b.value.date_to),b.value.sort&&p.append("sort",b.value.sort),b.value.dir&&p.append("dir",b.value.dir);const S=await ae(`/affiliate/withdrawals?${p.toString()}`);if(S.success)o.value=S.data,y.value=S.pagination;else throw new Error(S.message||"Failed to fetch withdrawals")}catch(p){k.value=p.message||"An error occurred while fetching withdrawals",console.error("Error fetching affiliate withdrawals:",p)}finally{c.value.withdrawals=!1}};return{commissions:M,withdrawals:o,currentWithdrawal:z,commissionsSummary:N,loading:c,error:k,commissionsPagination:R,withdrawalsPagination:y,commissionsFilters:h,withdrawalsFilters:b,hasCommissions:n,hasWithdrawals:d,isLoadingCommissions:g,isLoadingWithdrawals:C,isLoadingPayout:D,eligibleCommissionsTotal:L,eligibleCommissionsCount:ne,fetchCommissions:oe,fetchWithdrawals:B,fetchWithdrawal:async u=>{c.value.withdrawals=!0,k.value=null;try{const _=await ae(`/affiliate/withdrawals/${u}`);if(_.success)z.value=_.data;else throw new Error(_.message||"Failed to fetch withdrawal")}catch(_){k.value=_.message||"An error occurred while fetching the withdrawal",console.error("Error fetching affiliate withdrawal:",_)}finally{c.value.withdrawals=!1}},requestPayout:async u=>{c.value.payout=!0,k.value=null;try{const _=await ae("/affiliate/withdrawals/request",{method:"POST",body:JSON.stringify({notes:u})});if(_.success)return await Promise.all([oe(),B()]),_.data;throw new Error(_.message||"Failed to request payout")}catch(_){throw k.value=_.message||"An error occurred while requesting payout",console.error("Error requesting affiliate payout:",_),_}finally{c.value.payout=!1}},updateCommissionsFilters:u=>{h.value={...h.value,...u}},updateWithdrawalsFilters:u=>{b.value={...b.value,...u}},resetCommissionsFilters:()=>{h.value={q:"",status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}},resetWithdrawalsFilters:()=>{b.value={status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}},clearCurrentWithdrawal:()=>{z.value=null},getCommissionStatusColor:u=>({pending:"warning",eligible:"info",approved:"primary",paid:"success",canceled:"error",adjusted:"orange"})[u]||"secondary",getCommissionStatusLabel:u=>({pending:"En attente",eligible:"Éligible",approved:"Approuvée",paid:"Payée",canceled:"Annulée",adjusted:"Ajustée"})[u]||u,getWithdrawalStatusColor:u=>({pending:"warning",approved:"info",in_payment:"primary",paid:"success",rejected:"error",canceled:"secondary"})[u]||"secondary",getWithdrawalStatusLabel:u=>({pending:"En attente",approved:"Approuvé",in_payment:"En cours de paiement",paid:"Payé",rejected:"Rejeté",canceled:"Annulé"})[u]||u}}),Oe={class:"text-h5"},Xe={class:"text-body-2 text-medium-emphasis mb-0"},Ge={class:"text-center"},Je={class:"text-h4 mb-2"},Ke={class:"text-center"},Qe={class:"text-h4 mb-2"},Ye={class:"mb-3"},Ze={class:"text-body-1 font-weight-medium"},et={class:"mb-3"},tt={class:"text-body-1 font-weight-medium"},at={class:"mb-3"},st={class:"text-body-1 font-weight-medium"},ot={class:"mb-3"},it={class:"text-body-1 font-weight-medium"},lt={class:"mb-3"},nt={class:"text-body-1 font-weight-medium"},rt={class:"mb-3"},dt={class:"text-body-1 font-weight-medium"},mt={class:"mb-3"},ut={class:"text-body-1"},ct={class:"text-body-2 font-family-monospace"},pt={class:"text-body-2 font-family-monospace"},ft={class:"text-body-2 font-weight-medium"},_t={class:"text-body-2"},ht=ge({__name:"WithdrawalDetailsModal",props:{isVisible:{type:Boolean},withdrawal:{}},emits:["update:isVisible"],setup(M,{emit:o}){const z=M,N=o,c=W({get:()=>z.isVisible,set:n=>N("update:isVisible",n)}),k=n=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"MAD"}).format(n),R=n=>new Date(n).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=n=>({pending:"warning",approved:"info",in_payment:"primary",paid:"success",rejected:"error",canceled:"secondary"})[n]||"secondary",h=n=>({pending:"En attente",approved:"Approuvé",in_payment:"En cours de paiement",paid:"Payé",rejected:"Rejeté",canceled:"Annulé"})[n]||n,b=n=>({bank_transfer:"Virement bancaire",check:"Chèque",cash:"Espèces"})[n]||n;return(n,d)=>(V(),F(ve,{modelValue:c.value,"onUpdate:modelValue":d[2]||(d[2]=g=>c.value=g),"max-width":"800",persistent:""},{default:e(()=>[n.withdrawal?(V(),F(q,{key:0},{default:e(()=>[t(se,{class:"d-flex align-center justify-space-between"},{default:e(()=>[a("div",null,[a("h3",Oe,l(n.t("labels.withdrawalDetails")),1),a("p",Xe," Référence: #"+l(n.withdrawal.id.slice(-8)),1)]),t(E,{icon:"tabler-x",variant:"text",size:"small",onClick:d[0]||(d[0]=g=>c.value=!1)})]),_:1}),t(j,null,{default:e(()=>[t(le,null,{default:e(()=>[t(P,{cols:"12",md:"6"},{default:e(()=>[t(q,{variant:"tonal",color:"primary",class:"mb-4"},{default:e(()=>[t(j,null,{default:e(()=>[a("div",Ge,[a("h4",Je,l(k(n.withdrawal.amount)),1),t(G,{color:y(n.withdrawal.status),variant:"elevated",size:"large"},{default:e(()=>[w(l(h(n.withdrawal.status)),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),_:1}),t(P,{cols:"12",md:"6"},{default:e(()=>[t(q,{variant:"tonal",color:"success",class:"mb-4"},{default:e(()=>[t(j,null,{default:e(()=>[a("div",Ke,[a("h4",Qe,l(n.withdrawal.commission_count||0),1),d[3]||(d[3]=a("p",{class:"text-body-1 mb-0"},"Commission(s) incluse(s)",-1))])]),_:1})]),_:1})]),_:1}),t(P,{cols:"12"},{default:e(()=>[t(q,{variant:"outlined"},{default:e(()=>[t(se,null,{default:e(()=>d[4]||(d[4]=[w("Informations détaillées")])),_:1,__:[4]}),t(j,null,{default:e(()=>[t(le,null,{default:e(()=>[t(P,{cols:"12",sm:"6"},{default:e(()=>[a("div",Ye,[d[5]||(d[5]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"Méthode de paiement",-1)),a("p",Ze,l(b(n.withdrawal.method)),1)])]),_:1}),t(P,{cols:"12",sm:"6"},{default:e(()=>[a("div",et,[d[6]||(d[6]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"Date de création",-1)),a("p",tt,l(R(n.withdrawal.created_at)),1)])]),_:1}),n.withdrawal.approved_at?(V(),F(P,{key:0,cols:"12",sm:"6"},{default:e(()=>[a("div",at,[d[7]||(d[7]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"Date d'approbation",-1)),a("p",st,l(R(n.withdrawal.approved_at)),1)])]),_:1})):A("",!0),n.withdrawal.paid_at?(V(),F(P,{key:1,cols:"12",sm:"6"},{default:e(()=>[a("div",ot,[d[8]||(d[8]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"Date de paiement",-1)),a("p",it,l(R(n.withdrawal.paid_at)),1)])]),_:1})):A("",!0),n.withdrawal.payment_ref?(V(),F(P,{key:2,cols:"12"},{default:e(()=>[a("div",lt,[d[9]||(d[9]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"Référence de paiement",-1)),a("p",nt,l(n.withdrawal.payment_ref),1)])]),_:1})):A("",!0),n.withdrawal.iban_rib?(V(),F(P,{key:3,cols:"12"},{default:e(()=>[a("div",rt,[d[10]||(d[10]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"RIB/IBAN",-1)),a("p",dt,l(n.withdrawal.iban_rib),1)])]),_:1})):A("",!0),n.withdrawal.notes?(V(),F(P,{key:4,cols:"12"},{default:e(()=>[a("div",mt,[d[11]||(d[11]=a("p",{class:"text-caption text-medium-emphasis mb-1"},"Notes",-1)),a("p",ut,l(n.withdrawal.notes),1)])]),_:1})):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),n.withdrawal.items&&n.withdrawal.items.length>0?(V(),F(P,{key:0,cols:"12"},{default:e(()=>[t(q,{variant:"outlined"},{default:e(()=>[t(se,null,{default:e(()=>d[12]||(d[12]=[w("Commissions incluses")])),_:1,__:[12]}),t(j,null,{default:e(()=>[t(je,{headers:[{title:"Commission",key:"commission.id",sortable:!1},{title:"Commande",key:"commission.commande.id",sortable:!1},{title:"Montant",key:"amount",sortable:!1},{title:"Type",key:"commission.type",sortable:!1},{title:"Date",key:"commission.created_at",sortable:!1}],items:n.withdrawal.items,"items-per-page":"5",class:"text-no-wrap"},{"item.commission.id":e(({item:g})=>{var C,D;return[a("span",ct," #"+l(((D=(C=g.commission)==null?void 0:C.id)==null?void 0:D.slice(-8))||"N/A"),1)]}),"item.commission.commande.id":e(({item:g})=>{var C,D,L;return[a("span",pt," #"+l(((L=(D=(C=g.commission)==null?void 0:C.commande)==null?void 0:D.id)==null?void 0:L.slice(-8))||"N/A"),1)]}),"item.amount":e(({item:g})=>[a("span",ft,l(k(g.amount)),1)]),"item.commission.type":e(({item:g})=>[t(G,{size:"small",variant:"tonal"},{default:e(()=>{var C;return[w(l(((C=g.commission)==null?void 0:C.type)||"N/A"),1)]}),_:2},1024)]),"item.commission.created_at":e(({item:g})=>{var C;return[a("span",_t,l((C=g.commission)!=null&&C.created_at?R(g.commission.created_at):"N/A"),1)]}),_:1},8,["items"])]),_:1})]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),t(ye,null,{default:e(()=>[t(be),t(E,{variant:"outlined",onClick:d[1]||(d[1]=g=>c.value=!1)},{default:e(()=>[w(l(n.t("actions.close")),1)]),_:1})]),_:1})]),_:1})):A("",!0)]),_:1},8,["modelValue"]))}}),wt={class:"d-flex justify-space-between align-center mb-6"},gt={class:"text-h4 font-weight-bold mb-1"},yt={class:"text-body-1 text-medium-emphasis"},bt={class:"d-flex justify-space-between align-center"},vt={class:"text-caption text-medium-emphasis mb-1"},Ct={class:"text-h6 font-weight-bold"},xt={class:"text-caption text-medium-emphasis"},kt={class:"font-weight-medium"},Vt={class:"font-weight-bold"},St={class:"text-center py-8"},$t={class:"text-h6 mb-2"},Pt={class:"text-body-2 text-medium-emphasis"},Ft={class:"font-weight-medium"},Dt={class:"font-weight-bold"},Wt={class:"text-body-2"},At={class:"d-flex gap-1"},Nt={class:"text-center py-8"},Rt={class:"mb-4"},qt={class:"text-body-1 mb-2"},Lt={class:"text-body-2 text-medium-emphasis"},Ca=ge({__name:"index",setup(M){const{t:o}=De(),z=We(),{showSuccess:N,showError:c}=Te(),{confirm:k}=Ee(),R=Ae(),y=Ie(),{commissions:h,withdrawals:b,currentWithdrawal:n,commissionsSummary:d,loading:g,error:C,commissionsPagination:D,withdrawalsPagination:L,commissionsFilters:ne,withdrawalsFilters:oe,eligibleCommissionsTotal:B,eligibleCommissionsCount:Y}=Ne(y),T=x("commissions"),H=x(!1),J=x(""),I=x(null),Z=x(!1),re=W(()=>[{title:o("nav.dashboard"),to:{name:"affiliate-dashboard"}},{title:o("affiliate_payments_title"),active:!0}]),de=[{title:o("table.order"),key:"commande.id",sortable:!1},{title:o("table.product"),key:"commandeArticle.produit.titre",sortable:!1},{title:o("table.type"),key:"type",sortable:!0},{title:o("affiliate_payments_base_amount"),key:"base_amount",sortable:!0},{title:o("affiliate_payments_rate"),key:"rate",sortable:!0},{title:o("table.commission"),key:"amount",sortable:!0},{title:o("table.status"),key:"status",sortable:!0},{title:o("table.date"),key:"created_at",sortable:!0}],me=[{title:o("table.reference"),key:"id",sortable:!1},{title:o("table.amount"),key:"amount",sortable:!0},{title:o("affiliate_payments_method"),key:"method",sortable:!1},{title:o("table.status"),key:"status",sortable:!0},{title:o("affiliate_payments_commissions"),key:"commission_count",sortable:!1},{title:o("table.date"),key:"created_at",sortable:!0},{title:o("table.actions"),key:"actions",sortable:!1}],ie=W(()=>Y.value>0&&B.value>0),O=async(i=1)=>{try{await y.fetchCommissions(i)}catch{c(o("errors.commissions_load_failed"))}},u=async(i=1)=>{try{await y.fetchWithdrawals(i)}catch{c(o("errors.withdrawals_load_failed"))}},_=i=>{O(i)},U=i=>{u(i)},p=i=>{y.updateCommissionsFilters({per_page:i}),O()},S=i=>{y.updateWithdrawalsFilters({per_page:i}),u()},K=i=>{if(i.length>0){const{key:m,order:s}=i[0];y.updateCommissionsFilters({sort:m,dir:s}),O()}},Ce=i=>{if(i.length>0){const{key:m,order:s}=i[0];y.updateWithdrawalsFilters({sort:m,dir:s}),u()}},xe=()=>{if(!ie.value){c(o("errors.no_eligible_commissions"));return}H.value=!0,J.value=""},ke=async()=>{try{await k({title:o("affiliate_payments_confirm_withdrawal"),text:o("affiliate_payments_confirm_withdrawal_text",{amount:X(B.value),count:Y.value}),icon:"tabler-wallet",color:"primary"})&&(await y.requestPayout(J.value),N(o("affiliate_payments_withdrawal_success")),H.value=!1)}catch(i){c(i.message||o("errors.withdrawal_request_failed"))}},X=i=>i==null||isNaN(Number(i))?"0,00 MAD":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"MAD"}).format(Number(i)),ue=i=>new Date(i).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}),Ve=i=>i==null||isNaN(Number(i))?"N/A":`${(Number(i)*100).toFixed(2)}%`,Se=async i=>{try{await y.fetchWithdrawal(i),Z.value=!0}catch(m){c(m.message||o("errors.withdrawal_details_load"))}},$e=i=>["approved","in_payment","paid"].includes(i.status),Pe=i=>{console.log("Starting PDF download for withdrawal:",i);const m=R.token,s="http://localhost:8000/api",v=`${s}/affiliate/withdrawals/${i}/pdf`;if(console.log("PDF download details:",{token:m?`${m.substring(0,10)}...`:"NO TOKEN",url:v,apiBaseUrl:s}),!m){console.error("No auth token available"),c(o("affiliate_payments_session_expired"));return}I.value=i;const f=new XMLHttpRequest;f.open("GET",v,!0),f.setRequestHeader("Authorization",`Bearer ${m}`),f.setRequestHeader("Accept","application/pdf"),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.responseType="blob",f.onloadstart=function(){console.log("PDF download started...")},f.onprogress=function($){if($.lengthComputable){const ee=$.loaded/$.total*100;console.log(`PDF download progress: ${ee.toFixed(1)}%`)}},f.onload=function(){if(console.log(`PDF download completed with status: ${f.status}`),I.value=null,f.status===200){const $=f.response;if(console.log(`Received blob: ${$.size} bytes, type: ${$.type}`),$.type==="application/pdf"||$.type.includes("pdf")||$.size>1e3){const ee=window.URL.createObjectURL($),Q=document.createElement("a");Q.href=ee,Q.download=`facture-retrait-${i}.pdf`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),window.URL.revokeObjectURL(ee),N(o("affiliate_payments_pdf_download_success"))}else console.error("Invalid PDF blob:",{type:$.type,size:$.size}),c(o("affiliate_payments_pdf_invalid"))}else console.error(`PDF download failed with status: ${f.status}`),console.error("Response:",f.response),c(`Erreur lors du téléchargement: ${f.status}`)},f.onerror=function(){console.error("PDF download network error"),I.value=null,c(o("affiliate_payments_network_error"))},f.ontimeout=function(){console.error("PDF download timeout"),I.value=null,c(o("affiliate_payments_timeout_error"))},f.timeout=6e4,console.log("Sending PDF download request..."),f.send()};return ce(T,i=>{i==="commissions"?O():i==="withdrawals"&&u()}),ce(C,i=>{i&&c(i)}),Re(()=>{O()}),(i,m)=>(V(),pe("div",null,[t(ze,{items:re.value},null,8,["items"]),a("div",wt,[a("div",null,[a("h1",gt,l(r(o)("affiliate_payments_title")),1),a("p",yt,l(r(o)("affiliate_payments_description")),1)]),T.value==="commissions"?(V(),F(E,{key:0,color:"primary","prepend-icon":"tabler-wallet",disabled:!ie.value,loading:r(g).payout,onClick:xe},{default:e(()=>[w(l(r(o)("affiliate_payments_request_withdrawal")),1)]),_:1},8,["disabled","loading"])):A("",!0)]),T.value==="commissions"?(V(),F(le,{key:0,class:"mb-6"},{default:e(()=>[(V(!0),pe(qe,null,Le(r(d),(s,v)=>(V(),F(P,{key:v,cols:"12",sm:"6",md:"3"},{default:e(()=>[t(q,null,{default:e(()=>[t(j,null,{default:e(()=>[a("div",bt,[a("div",null,[a("p",vt,l(r(y).getCommissionStatusLabel(v)),1),a("h3",Ct,l(X(s.total)),1),a("p",xt,l(r(o)("affiliate_payments_commission_count",{count:s.count})),1)]),t(G,{color:r(y).getCommissionStatusColor(v),variant:"tonal",size:"small"},{default:e(()=>[w(l(v),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):A("",!0),t(Me,{modelValue:T.value,"onUpdate:modelValue":m[0]||(m[0]=s=>T.value=s),class:"mb-6"},{default:e(()=>[t(fe,{value:"commissions"},{default:e(()=>m[6]||(m[6]=[w("Commissions")])),_:1,__:[6]}),t(fe,{value:"withdrawals"},{default:e(()=>m[7]||(m[7]=[w("Retraits")])),_:1,__:[7]})]),_:1},8,["modelValue"]),t(Be,{modelValue:T.value,"onUpdate:modelValue":m[1]||(m[1]=s=>T.value=s)},{default:e(()=>[t(_e,{value:"commissions"},{default:e(()=>[t(q,null,{default:e(()=>[t(he,{headers:de,items:r(h),loading:r(g).commissions,"items-length":r(D).total,"items-per-page":r(D).per_page,page:r(D).current_page,"item-value":"id","onUpdate:page":_,"onUpdate:itemsPerPage":p,"onUpdate:sortBy":K},{"item.commande.id":e(({item:s})=>[t(E,{variant:"text",size:"small",color:"primary",onClick:v=>{var f;return r(z).push({name:"affiliate-orders-id",params:{id:(f=s.commande)==null?void 0:f.id}})}},{default:e(()=>{var v,f;return[w(" #"+l(((f=(v=s.commande)==null?void 0:v.id)==null?void 0:f.toString().slice(-8))||"N/A"),1)]}),_:2},1032,["onClick"])]),"item.commandeArticle.produit.titre":e(({item:s})=>{var v,f;return[a("span",kt,l(((f=(v=s.commandeArticle)==null?void 0:v.produit)==null?void 0:f.titre)||"N/A"),1)]}),"item.base_amount":e(({item:s})=>[w(l(X(s.base_amount)),1)]),"item.rate":e(({item:s})=>[w(l(Ve(s.rate)),1)]),"item.amount":e(({item:s})=>[a("span",Vt,l(X(s.amount)),1)]),"item.status":e(({item:s})=>[t(G,{color:r(y).getCommissionStatusColor(s.status),size:"small",variant:"tonal"},{default:e(()=>[w(l(r(y).getCommissionStatusLabel(s.status)),1)]),_:2},1032,["color"])]),"item.created_at":e(({item:s})=>[w(l(ue(s.created_at)),1)]),"no-data":e(()=>[a("div",St,[t(te,{icon:"tabler-percentage-off",size:"64",class:"text-disabled mb-4"}),a("h3",$t,l(r(o)("affiliate_payments_no_commissions_found")),1),a("p",Pt,l(r(o)("affiliate_payments_no_commissions_yet")),1)])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),_:1})]),_:1}),t(_e,{value:"withdrawals"},{default:e(()=>[t(q,null,{default:e(()=>[t(he,{headers:me,items:r(b),loading:r(g).withdrawals,"items-length":r(L).total,"items-per-page":r(L).per_page,page:r(L).current_page,"item-value":"id","onUpdate:page":U,"onUpdate:itemsPerPage":S,"onUpdate:sortBy":Ce},{"item.id":e(({item:s})=>[a("span",Ft," #"+l(s.id.toString().slice(-8)),1)]),"item.amount":e(({item:s})=>[a("span",Dt,l(X(s.amount)),1)]),"item.method":e(({item:s})=>[t(G,{size:"small",variant:"tonal",color:"info"},{default:e(()=>[w(l(s.method==="bank_transfer"?"Virement bancaire":s.method),1)]),_:2},1024)]),"item.status":e(({item:s})=>[t(G,{color:r(y).getWithdrawalStatusColor(s.status),size:"small",variant:"tonal"},{default:e(()=>[w(l(r(y).getWithdrawalStatusLabel(s.status)),1)]),_:2},1032,["color"])]),"item.commission_count":e(({item:s})=>[a("span",Wt,l(r(o)("affiliate_payments_commission_count",{count:s.commission_count})),1)]),"item.created_at":e(({item:s})=>[w(l(ue(s.created_at)),1)]),"item.actions":e(({item:s})=>[a("div",At,[t(E,{icon:"tabler-eye",size:"small",variant:"text",color:"primary",onClick:v=>Se(s.id)},{default:e(()=>[t(te,{icon:"tabler-eye"}),t(we,{activator:"parent",location:"top"},{default:e(()=>[w(l(i.$t("payments.actions.view")),1)]),_:1})]),_:2},1032,["onClick"]),$e(s)?(V(),F(E,{key:0,icon:"tabler-download",size:"small",variant:"text",color:"success",loading:I.value===s.id,onClick:v=>Pe(s.id)},{default:e(()=>[t(te,{icon:"tabler-download"}),t(we,{activator:"parent",location:"top"},{default:e(()=>[w(l(i.$t("payments.actions.download_pdf")),1)]),_:1})]),_:2},1032,["loading","onClick"])):A("",!0)])]),"no-data":e(()=>[a("div",Nt,[t(te,{icon:"tabler-wallet-off",size:"64",class:"text-disabled mb-4"}),m[8]||(m[8]=a("h3",{class:"text-h6 mb-2"},"Aucun retrait trouvé",-1)),m[9]||(m[9]=a("p",{class:"text-body-2 text-medium-emphasis"}," Vous n'avez pas encore demandé de retrait. ",-1))])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ve,{modelValue:H.value,"onUpdate:modelValue":m[4]||(m[4]=s=>H.value=s),"max-width":"500"},{default:e(()=>[t(q,null,{default:e(()=>[t(se,null,{default:e(()=>[w(l(r(o)("affiliate_payments_request_withdrawal")),1)]),_:1}),t(j,null,{default:e(()=>[a("div",Rt,[a("p",qt,[a("strong",null,l(r(o)("affiliate_payments_eligible_amount"))+":",1),w(" "+l(X(r(B))),1)]),a("p",Lt,l(r(o)("affiliate_payments_eligible_commissions_text",{count:r(Y)})),1)]),t(He,{modelValue:J.value,"onUpdate:modelValue":m[2]||(m[2]=s=>J.value=s),label:r(o)("affiliate_payments_notes_optional"),placeholder:r(o)("affiliate_payments_notes_placeholder"),rows:"3",counter:"1000",maxlength:"1000"},null,8,["modelValue","label","placeholder"])]),_:1}),t(ye,null,{default:e(()=>[t(be),t(E,{variant:"outlined",onClick:m[3]||(m[3]=s=>H.value=!1)},{default:e(()=>[w(l(r(o)("affiliate_payments_cancel")),1)]),_:1}),t(E,{color:"primary",loading:r(g).payout,onClick:ke},{default:e(()=>[w(l(r(o)("affiliate_payments_confirm_request")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ht,{"is-visible":Z.value,"onUpdate:isVisible":m[5]||(m[5]=s=>Z.value=s),withdrawal:r(n)},null,8,["is-visible","withdrawal"]),t(Ue)]))}});export{Ca as default};
