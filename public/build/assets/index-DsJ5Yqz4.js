import{d as et,aL as at,u as st,j as it,b7 as ot,r as S,V as w,D as lt,c as _,o as r,b as i,l as T,m as t,e as o,aV as rt,t as s,g as p,f as l,s as n,ac as x,F as P,i as U,az as M,aU as ct,ai as E}from"./main-uLG9IIeX.js";import{u as nt}from"./tickets-C9TttlTK.js";import{u as dt}from"./useNotifications-DDBS_wPD.js";import{useQuickConfirm as ut}from"./useConfirmAction-C-KKQTYr.js";import{_ as ft}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-nczKusLe.js";import{C as mt}from"./ConfirmActionDialog-uPYgr6qv.js";import{V as g}from"./VChip-B84WcmDa.js";import{b as G,V as H,c as _t}from"./VCard-CB1gT6RB.js";import{V as K}from"./VCardText-BZtszuIK.js";import{V as pt}from"./VAvatar-bHPDEsYY.js";import{V as gt}from"./VDivider-UqGR4x4D.js";import{V as ht}from"./VForm-C9FiqBHN.js";import{V as kt}from"./VTextarea-BuIc6d95.js";import{V as vt}from"./VFileInput-D1Glyc4K.js";import{V as bt}from"./VSpacer-BCNmCEP9.js";import{V as xt}from"./VAlert-TgguXW_5.js";import{_ as yt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./api-DSi3Suj8.js";import"./index-D-EbNoF1.js";import"./VBreadcrumbs-D7yKQl5l.js";import"./VDialog-DU1pBIct.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VImg-BS6_svHJ.js";import"./dialog-transition-2hF0ajsQ.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VField-CfH1YcVv.js";/* empty css              */const Vt={key:0,class:"text-center py-8"},Ct={class:"text-body-1 mt-4"},wt={key:1},Tt={class:"d-flex justify-space-between align-center mb-6"},Bt={class:"text-h4 font-weight-bold mb-1"},zt={class:"d-flex align-center gap-4"},St={class:"text-body-2 text-medium-emphasis"},Mt={class:"d-flex gap-2"},Dt={class:"d-flex align-start gap-3"},Ft={class:"flex-grow-1"},Lt={class:"d-flex align-center justify-space-between mb-2"},At={class:"font-weight-medium"},It={class:"text-caption text-medium-emphasis"},Nt={class:"message-content"},Rt={class:"text-body-1 mb-2",style:{"white-space":"pre-wrap"}},jt={key:0,class:"attachments"},qt={class:"text-subtitle-2 mb-2"},Pt={class:"d-flex flex-wrap gap-2"},Ut={class:"text-caption text-medium-emphasis mt-1"},Et={key:2,class:"text-center py-8"},Gt={class:"text-h6 mb-2"},Ht={class:"text-body-2 text-medium-emphasis mb-4"},Kt=et({__name:"index",setup(Qt){const{t:e}=at(),h=st(),D=it(),{showSuccess:B,showError:k}=dt(),u=ut(),{confirm:F}=u,f=nt(),{currentTicket:c,loading:y,error:L}=ot(f),v=S(""),z=S([]),V=S(),Q=w(()=>{var a;return[{title:e("nav.dashboard"),to:"/affiliate/dashboard"},{title:e("affiliate_tickets_title"),to:"/affiliate/tickets"},{title:e("affiliate_tickets_detail_title",{id:(a=h.params.id)==null?void 0:a.toString().slice(-8)}),active:!0}]}),$=w(()=>{var a;return((a=c.value)==null?void 0:a.status)!=="closed"}),J=w(()=>{var a;return((a=c.value)==null?void 0:a.status)==="closed"}),O=w(()=>{var a;return(a=c.value)!=null&&a.messages?[...c.value.messages].sort((m,d)=>new Date(m.created_at).getTime()-new Date(d.created_at).getTime()):[]}),W=async()=>{try{await f.fetchTicket(h.params.id),await E(),I()}catch{k(e("errors.ticket_load_failed")),D.push({name:"affiliate-tickets"})}},X=a=>{const m=a.target;m.files&&(z.value=Array.from(m.files))},A=async()=>{if(!v.value.trim()){k(e("errors.message_required"));return}try{await f.addMessage(h.params.id,{message:v.value,attachments:z.value}),v.value="",z.value=[],B(e("affiliate_tickets_message_success")),await E(),I()}catch(a){k(a.message||e("errors.message_add_failed"))}},Y=async()=>{try{await F({title:e("affiliate_tickets_close_title"),text:e("affiliate_tickets_close_text"),icon:"tabler-lock",color:"warning"})&&(await f.updateTicketStatus(h.params.id,"closed"),B(e("affiliate_tickets_close_success")))}catch(a){k(a.message||e("errors.ticket_close_failed"))}},Z=async()=>{try{await F({title:e("affiliate_tickets_reopen_title"),text:e("affiliate_tickets_reopen_text"),icon:"tabler-lock-open",color:"info"})&&(await f.updateTicketStatus(h.params.id,"open"),B(e("affiliate_tickets_reopen_success")))}catch(a){k(a.message||e("errors.ticket_reopen_failed"))}},I=()=>{V.value&&(V.value.scrollTop=V.value.scrollHeight)},N=a=>new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),tt=a=>{if(a===0)return"0 Bytes";const m=1024,d=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(a)/Math.log(m));return parseFloat((a/Math.pow(m,b)).toFixed(2))+" "+d[b]},R=()=>{D.push({name:"affiliate-tickets"})};return lt(()=>{W()}),(a,m)=>(r(),_("div",null,[i(ft,{items:Q.value},null,8,["items"]),t(y).detail?(r(),_("div",Vt,[i(rt,{indeterminate:"",color:"primary",size:"64"}),o("p",Ct,s(t(e)("affiliate_tickets_loading")),1)])):t(c)?(r(),_("div",wt,[o("div",Tt,[o("div",null,[o("h1",Bt,s(t(c).subject),1),o("div",zt,[i(g,{color:t(f).getStatusColor(t(c).status),variant:"tonal"},{default:l(()=>[n(s(t(f).getStatusLabel(t(c).status)),1)]),_:1},8,["color"]),i(g,{color:t(f).getPriorityColor(t(c).priority),variant:"tonal",size:"small"},{default:l(()=>[n(s(t(f).getPriorityLabel(t(c).priority)),1)]),_:1},8,["color"]),i(g,{color:"info",variant:"tonal",size:"small"},{default:l(()=>[n(s(t(f).getCategoryLabel(t(c).category)),1)]),_:1}),o("span",St,s(t(e)("affiliate_tickets_created_on",{date:N(t(c).created_at)})),1)])]),o("div",Mt,[J.value?(r(),p(x,{key:0,color:"info",variant:"outlined","prepend-icon":"tabler-lock-open",loading:t(y).status,onClick:Z},{default:l(()=>[n(s(t(e)("actions.reopen")),1)]),_:1},8,["loading"])):T("",!0),$.value?(r(),p(x,{key:1,color:"warning",variant:"outlined","prepend-icon":"tabler-lock",loading:t(y).status,onClick:Y},{default:l(()=>[n(s(t(e)("actions.close")),1)]),_:1},8,["loading"])):T("",!0),i(x,{variant:"outlined","prepend-icon":"tabler-arrow-left",onClick:R},{default:l(()=>[n(s(t(e)("actions.back")),1)]),_:1})])]),i(H,{class:"mb-6"},{default:l(()=>[i(G,null,{default:l(()=>[n(s(t(e)("affiliate_tickets_conversation")),1)]),_:1}),i(K,null,{default:l(()=>[o("div",{ref_key:"messagesContainer",ref:V,class:"messages-container",style:{"max-height":"500px","overflow-y":"auto"}},[(r(!0),_(P,null,U(O.value,d=>{var b,j,q;return r(),_("div",{key:d.id,class:"message mb-4"},[o("div",Dt,[i(pt,{size:"40"},{default:l(()=>[i(M,{icon:"tabler-user"})]),_:1}),o("div",Ft,[o("div",Lt,[o("div",null,[o("span",At,s(((b=d.sender)==null?void 0:b.nom_complet)||t(e)("support")),1),((j=d.sender)==null?void 0:j.id)===t(c).requester_id?(r(),p(g,{key:0,size:"x-small",color:"primary",variant:"tonal",class:"ml-2"},{default:l(()=>[n(s(t(e)("affiliate_tickets_you")),1)]),_:1})):(r(),p(g,{key:1,size:"x-small",color:"success",variant:"tonal",class:"ml-2"},{default:l(()=>[n(s(t(e)("affiliate_tickets_support")),1)]),_:1}))]),o("span",It,s(N(d.created_at)),1)]),o("div",Nt,[o("p",Rt,s(d.body),1),(q=d.attachments)!=null&&q.length?(r(),_("div",jt,[o("h4",qt,s(t(e)("affiliate_tickets_attachments"))+":",1),o("div",Pt,[(r(!0),_(P,null,U(d.attachments,C=>(r(),p(g,{key:C.id,size:"small",variant:"outlined","prepend-icon":"tabler-paperclip",clickable:"",color:"primary",href:C.url,target:"_blank",component:"a"},{default:l(()=>[i(M,{icon:"tabler-download",size:"16",class:"me-1"}),n(" "+s(C.original_name)+" ("+s(tt(C.size))+") ",1)]),_:2},1032,["href"]))),128))])])):T("",!0)])])]),i(gt,{class:"mt-4"})])}),128))],512)]),_:1})]),_:1}),t(c).status!=="closed"?(r(),p(H,{key:0},{default:l(()=>[i(G,null,{default:l(()=>[n(s(t(e)("affiliate_tickets_add_reply")),1)]),_:1}),i(K,null,{default:l(()=>[i(ht,{onSubmit:ct(A,["prevent"])},{default:l(()=>[i(kt,{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=d=>v.value=d),label:t(e)("affiliate_tickets_your_message"),placeholder:t(e)("affiliate_tickets_message_placeholder"),rows:"4",counter:"5000",maxlength:"5000",required:""},null,8,["modelValue","label","placeholder"]),i(vt,{label:t(e)("affiliate_tickets_attachments_optional"),multiple:"",accept:"image/*,.pdf,.doc,.docx,.txt","prepend-icon":"tabler-paperclip",class:"mt-4",onChange:X},null,8,["label"]),o("p",Ut,s(t(e)("affiliate_tickets_file_formats")),1)]),_:1})]),_:1}),i(_t,null,{default:l(()=>[i(bt),i(x,{color:"primary","prepend-icon":"tabler-send",loading:t(y).message,onClick:A},{default:l(()=>[n(s(t(e)("actions.send")),1)]),_:1},8,["loading"])]),_:1})]),_:1})):(r(),p(xt,{key:1,type:"info",variant:"tonal",class:"mt-6"},{default:l(()=>[n(s(t(e)("affiliate_tickets_closed_notice")),1)]),_:1}))])):t(L)?(r(),_("div",Et,[i(M,{icon:"tabler-alert-circle",size:"64",class:"text-error mb-4"}),o("h3",Gt,s(t(e)("general.error")),1),o("p",Ht,s(t(L)),1),i(x,{color:"primary",onClick:R},{default:l(()=>[n(s(t(e)("affiliate_tickets_back_to_tickets")),1)]),_:1})])):T("",!0),i(mt,{"is-dialog-visible":t(u).isDialogVisible.value,"is-loading":t(u).isLoading.value,"dialog-title":t(u).dialogTitle.value,"dialog-text":t(u).dialogText.value,"dialog-icon":t(u).dialogIcon.value,"dialog-color":t(u).dialogColor.value,"confirm-button-text":t(u).confirmButtonText.value,"cancel-button-text":t(u).cancelButtonText.value,onConfirm:t(u).handleConfirm,onCancel:t(u).handleCancel},null,8,["is-dialog-visible","is-loading","dialog-title","dialog-text","dialog-icon","dialog-color","confirm-button-text","cancel-button-text","onConfirm","onCancel"])]))}}),xe=yt(Kt,[["__scopeId","data-v-0f2a1a63"]]);export{xe as default};
