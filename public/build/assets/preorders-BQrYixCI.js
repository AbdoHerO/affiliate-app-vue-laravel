import{b5 as x,r as m,V as y,b6 as g}from"./main-BGmfaZsq.js";const N=x("preorders",()=>{const n=m([]),u=m(null),i=m(!1),d=m(null),w=m({current_page:1,last_page:1,per_page:15,total:0}),f=m({page:1,perPage:15,sort:"created_at",dir:"desc"}),E=y(()=>n.value.length>0),P=y(()=>i.value),h=async s=>{var o,t;i.value=!0,d.value=null;try{s&&Object.assign(f.value,s);const e=await g.get("admin/preorders",{params:f.value});if(e.data.success)n.value=e.data.data,w.value=e.data.pagination;else throw new Error(e.data.message||"Failed to fetch preorders")}catch(e){d.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||e.message||"Failed to fetch preorders",console.error("Error fetching preorders:",e)}finally{i.value=!1}};return{preorders:n,currentPreorder:u,loading:i,error:d,pagination:w,filters:f,hasPreorders:E,isLoading:P,fetchPreorders:h,fetchPreorder:async s=>{var o,t;i.value=!0,d.value=null;try{const e=await g.get(`admin/preorders/${s}`);if(e.data.success)u.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch preorder")}catch(e){d.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||e.message||"Failed to fetch preorder",console.error("Error fetching preorder:",e)}finally{i.value=!1}},updatePreorder:async(s,o)=>{var t,e;i.value=!0,d.value=null;try{const r=await g.put(`admin/preorders/${s}`,o);if(r.data.success){u.value=r.data.data;const a=n.value.findIndex(l=>l.id===s);return a!==-1&&(n.value[a]=r.data.data),r.data.data}else throw new Error(r.data.message||"Failed to update preorder")}catch(r){throw d.value=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||r.message||"Failed to update preorder",console.error("Error updating preorder:",r),r}finally{i.value=!1}},confirmPreorder:async s=>{var o,t;i.value=!0,d.value=null;try{const e=await g.post(`admin/preorders/${s}/confirm`);if(e.data.success){u.value=e.data.data;const r=n.value.findIndex(a=>a.id===s);return r!==-1&&(n.value[r]=e.data.data),e.data.data}else throw new Error(e.data.message||"Failed to confirm preorder")}catch(e){throw d.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||e.message||"Failed to confirm preorder",console.error("Error confirming preorder:",e),e}finally{i.value=!1}},resetFilters:()=>{f.value={page:1,perPage:15,sort:"created_at",dir:"desc"}},clearCurrentPreorder:()=>{u.value=null},bulkChangeStatus:async(s,o,t)=>{var e,r;try{const a=await g.post("admin/preorders/bulk/status",{ids:s,to:o,note:t});return a.data.success&&a.data.data.forEach(p=>{const c=n.value.findIndex(v=>v.id===p.id);c!==-1&&(n.value[c]={...n.value[c],...p})}),a.data}catch(a){const l=((r=(e=a.response)==null?void 0:e.data)==null?void 0:r.message)||"Erreur lors de la mise à jour en lot";throw d.value=l,new Error(l)}},bulkSendToShipping:async(s,o="ramassage")=>{var t,e;try{const r=await g.post("admin/preorders/bulk/send-to-shipping",{ids:s,mode:o});if(r.data.success){const a=r.data.results||[],l=a.filter(c=>c.success).length,p=a.filter(c=>!c.success).length;return await h(),{...r.data,summary:{total:s.length,success:l,errors:p,results:a}}}return r.data}catch(r){const a=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Erreur lors de l'envoi en lot";throw d.value=a,new Error(a)}},changeStatus:async(s,o,t,e)=>{var r,a,l;try{const p=await g.post(`admin/preorders/${s}/status`,{to:o,note:t,increment:e});if(p.data.success){const c=p.data.data,v=n.value.findIndex(S=>S.id===s);v!==-1&&(n.value[v]={...n.value[v],...c}),((r=u.value)==null?void 0:r.id)===s&&(u.value={...u.value,...c})}return p.data}catch(p){const c=((l=(a=p.response)==null?void 0:a.data)==null?void 0:l.message)||"Erreur lors du changement de statut";throw d.value=c,new Error(c)}},incrementNoAnswer:async s=>{var o,t,e;try{const r=await g.post(`admin/preorders/${s}/no-answer`);if(r.data.success){const a=n.value.findIndex(l=>l.id===s);a!==-1&&(n.value[a].no_answer_count=r.data.data.no_answer_count),((o=u.value)==null?void 0:o.id)===s&&(u.value.no_answer_count=r.data.data.no_answer_count)}return r.data}catch(r){const a=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Erreur lors de l'incrémentation";throw d.value=a,new Error(a)}},sendToShipping:async(s,o="ramassage")=>{var t,e;try{const r=await g.post(`admin/preorders/${s}/send-to-shipping`,{mode:o});return r.data.success&&await h(),r.data}catch(r){const a=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Erreur lors de l'envoi";throw d.value=a,new Error(a)}},moveToShippingLocal:async(s,o)=>{var t,e;try{const r=await g.post(`admin/preorders/${s}/move-to-shipping-local`,{note:o});return r.data.success&&await h(),r.data}catch(r){const a=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Erreur lors du déplacement vers l'expédition locale";throw d.value=a,new Error(a)}}}});export{N as u};
