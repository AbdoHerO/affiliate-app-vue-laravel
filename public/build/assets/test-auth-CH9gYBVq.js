import{u as S}from"./useAuth-CSUeXPIW.js";import{u as P}from"./useApi-C5OI9_Dc.js";import{d as R,b7 as N,r as h,o as $,c as A,b as m,e as a,g as t,t as n,az as k,f,m as g,h as v,n as i,v as p,ac as _,F as B,j as E}from"./main-BW7J9dbc.js";import{b as D,V as z}from"./VCard-BBEboEsQ.js";import{V as O}from"./VCardText-CXwuP4rm.js";import{V as b}from"./VChip-Dc9HlRo1.js";import{V as F,a as J}from"./VTimeline-M1uGP7Nt.js";import{V as j,a as q,b as M,c as G}from"./VExpansionPanels-CaG50yjF.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createSimpleFunctional-468wPgla.js";import"./VAvatar-CBx3oh99.js";import"./VImg-NyJdDnCF.js";import"./lazy-CTr8uHza.js";const K={class:"pa-6"},Q={class:"mb-4"},W={class:"d-flex gap-2 mb-4 flex-wrap"},X={key:0},Y={class:"d-flex align-center gap-2 mb-1"},Z={class:"text-body-2 mb-2"},ee={class:"text-caption"},te=R({__name:"test-auth",setup(se){const{isAuthenticated:u,hasRole:U}=S(),l=N(),T=h([]),d=h(!1),r=(s,e,o,c)=>{T.value.push({name:s,status:e,message:o,data:c})},y=()=>{T.value=[]},C=async()=>{var s;try{r("Login Test","pending","Testing login..."),await l.login({email:"admin@cod.test",password:"password"}),l.isAuthenticated?r("Login Test","success","Login successful!",{user:l.user,token:((s=l.token)==null?void 0:s.substring(0,20))+"..."}):r("Login Test","error","Login failed - not authenticated")}catch(e){r("Login Test","error",`Login failed: ${e.message}`)}},V=async()=>{var s,e,o;try{r("API Test","pending","Testing authenticated API call...");const{data:c,error:w}=await P("/admin/users?per_page=5");w.value?r("API Test","error",`API call failed: ${w.value.message||"Unknown error"}`,w.value):r("API Test","success","API call successful!",{userCount:((e=(s=c.value)==null?void 0:s.data)==null?void 0:e.length)||0,totalUsers:((o=c.value)==null?void 0:o.total)||0})}catch(c){r("API Test","error",`API call failed: ${c.message}`)}},x=async()=>{try{r("Create User Test","pending","Testing user creation...");const{data:s,error:e}=await P("/admin/users",{method:"POST",body:JSON.stringify({nom_complet:"Test User "+Date.now(),email:`test${Date.now()}@example.com`,password:"password123",password_confirmation:"password123",role:"affiliate",statut:"actif",kyc_statut:"non_requis"})});e.value?r("Create User Test","error",`User creation failed: ${e.value.message||"Unknown error"}`,e.value):r("Create User Test","success","User created successfully!",s.value)}catch(s){r("Create User Test","error",`User creation failed: ${s.message}`)}},I=async()=>{d.value=!0,y();try{await C(),await new Promise(s=>setTimeout(s,1e3)),await V(),await new Promise(s=>setTimeout(s,1e3)),await x()}catch(s){console.error("Test suite error:",s)}finally{d.value=!1}},L=async()=>{await l.logout(),y()};return $(()=>{r("Auth Status",u.value?"success":"error",u.value?"User is authenticated":"User is not authenticated",{user:l.user,token:l.token?l.token.substring(0,20)+"...":null})}),(s,e)=>(m(),A("div",K,[a(z,null,{default:t(()=>[a(D,{class:"d-flex align-center gap-2"},{default:t(()=>[a(k,{icon:"tabler-test-pipe"}),e[0]||(e[0]=n(" Authentication & API Test Suite "))]),_:1,__:[0]}),a(O,null,{default:t(()=>[f("div",Q,[e[2]||(e[2]=f("h3",{class:"mb-2"},"Current Auth Status:",-1)),a(b,{color:i(u)?"success":"error",variant:"tonal",class:"me-2"},{default:t(()=>[n(p(i(u)?"Authenticated":"Not Authenticated"),1)]),_:1},8,["color"]),i(u)&&i(l).user?(m(),v(b,{key:0,color:"info",variant:"tonal",class:"me-2"},{default:t(()=>[n(p(i(l).user.nom_complet),1)]),_:1})):g("",!0),i(u)&&i(U)("admin")?(m(),v(b,{key:1,color:"primary",variant:"tonal"},{default:t(()=>e[1]||(e[1]=[n(" Admin Role ")])),_:1,__:[1]})):g("",!0)]),f("div",W,[a(_,{color:"primary",loading:d.value,onClick:I},{default:t(()=>[a(k,{start:"",icon:"tabler-play"}),e[3]||(e[3]=n(" Run All Tests "))]),_:1,__:[3]},8,["loading"]),a(_,{variant:"outlined",onClick:C,disabled:d.value},{default:t(()=>e[4]||(e[4]=[n(" Test Login ")])),_:1,__:[4]},8,["disabled"]),a(_,{variant:"outlined",onClick:V,disabled:d.value||!i(u)},{default:t(()=>e[5]||(e[5]=[n(" Test API ")])),_:1,__:[5]},8,["disabled"]),a(_,{variant:"outlined",onClick:x,disabled:d.value||!i(u)},{default:t(()=>e[6]||(e[6]=[n(" Test Create User ")])),_:1,__:[6]},8,["disabled"]),i(u)?(m(),v(_,{key:0,color:"error",variant:"outlined",onClick:L,disabled:d.value},{default:t(()=>e[7]||(e[7]=[n(" Logout ")])),_:1,__:[7]},8,["disabled"])):g("",!0),a(_,{variant:"outlined",onClick:y,disabled:d.value},{default:t(()=>e[8]||(e[8]=[n(" Clear Results ")])),_:1,__:[8]},8,["disabled"])]),T.value.length>0?(m(),A("div",X,[e[10]||(e[10]=f("h3",{class:"mb-3"},"Test Results:",-1)),a(F,{density:"compact"},{default:t(()=>[(m(!0),A(B,null,E(T.value,(o,c)=>(m(),v(J,{key:c,"dot-color":o.status==="success"?"success":o.status==="error"?"error":"warning",size:"small"},{default:t(()=>[f("div",Y,[f("strong",null,p(o.name),1),a(b,{color:o.status==="success"?"success":o.status==="error"?"error":"warning",size:"small",variant:"tonal"},{default:t(()=>[n(p(o.status),1)]),_:2},1032,["color"])]),f("p",Z,p(o.message),1),o.data?(m(),v(j,{key:0,variant:"accordion",class:"mb-2"},{default:t(()=>[a(q,null,{default:t(()=>[a(M,null,{default:t(()=>[a(k,{start:"",icon:"tabler-code"}),e[9]||(e[9]=n(" View Data "))]),_:1,__:[9]}),a(G,null,{default:t(()=>[f("pre",ee,p(JSON.stringify(o.data,null,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1032,["dot-color"]))),128))]),_:1})])):g("",!0)]),_:1})]),_:1})]))}}),ge=H(te,[["__scopeId","data-v-7604ff71"]]);export{ge as default};
