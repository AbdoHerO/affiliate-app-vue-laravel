import{b5 as q,r as y,V as A,bd as x,ba as S,d as K,aL as M,o as D,c as G,b as E,f as u,e as l,v as d,n as a,g as r,t as m,az as b,aW as L,h as N,m as $,ac as B}from"./main-DEzoUo6n.js";import{useQuickConfirm as Q}from"./useConfirmAction-lawnJ6WL.js";import{u as W}from"./useNotifications-Bc6GUAmT.js";import{b as F,V as I}from"./VCard-BQBmQiQJ.js";import{V as R}from"./VCardText-DtKfeQ8i.js";import{V as H}from"./VForm-rtEvNB7m.js";import{V as J,a as T}from"./VRow-CCKjjrNU.js";import{V as U}from"./VTextField-BiqUvfe6.js";import{V as P}from"./VAlert--Qma1TSN.js";import{V as X}from"./VChip-BLx6lUDe.js";import{V as Y}from"./VSnackbar-Br3eOTz2.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createSimpleFunctional-DUhC6iZd.js";import"./VAvatar-DcdpS4jo.js";import"./VImg-Dcm3Nb79.js";import"./VField-BrxQSdNw.js";import"./forwardRefs-BYcTBJDs.js";/* empty css              */import"./VOverlay-D7sMErQR.js";import"./lazy-BPEwf1-U.js";const ee=q("ozonSettings",()=>{const g=y({customer_id:null,api_key:null}),o=y(!1),s=y(null),f=y(null),w=async()=>{var n,t;o.value=!0,s.value=null;try{const e=await S("/admin/integrations/ozon/settings",{method:"GET"});console.log("Settings API Response:",e),e.success?g.value=e.data||{customer_id:null,api_key:null}:s.value=e.message||"Failed to fetch settings"}catch(e){s.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||e.message||"Failed to fetch settings",console.error("Error fetching OzonExpress settings:",e)}finally{o.value=!1}},k=async()=>{var n,t;o.value=!0,s.value=null;try{const e=await S("/admin/integrations/ozon/settings/edit",{method:"GET"});return console.log("Settings for edit API Response:",e),e.success?e.data||{customer_id:null,api_key:null}:(s.value=e.message||"Failed to fetch settings for editing",null)}catch(e){return s.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||e.message||"Failed to fetch settings for editing",console.error("Error fetching OzonExpress settings for editing:",e),null}finally{o.value=!1}},v=async n=>{var t,e,h;o.value=!0,s.value=null;try{console.log("Updating settings with data:",n);const c=await S("/admin/integrations/ozon/settings",{method:"PUT",body:n});return console.log("Update settings response:",c),c.success?(g.value=c.data||n,!0):(s.value=c.message||"Failed to update settings",!1)}catch(c){if(console.error("Error updating OzonExpress settings:",c),((t=c.response)==null?void 0:t.status)===422){const O=c.response.data.errors;if(O){const j=Object.values(O).flat();s.value=j.join(", ")}else s.value=c.response.data.message||"Validation failed"}else s.value=((h=(e=c.response)==null?void 0:e.data)==null?void 0:h.message)||c.message||"Failed to update settings";return!1}finally{o.value=!1}},i=async()=>{var n,t;o.value=!0,s.value=null,f.value=null;try{const e=await S("/admin/integrations/ozon/settings/test",{method:"POST"});return f.value=e.data,e.data.success||(s.value=e.data.message),e.data.success}catch(e){const h=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||e.message||"Failed to test connection";return s.value=h,f.value={success:!1,message:h},console.error("Error testing OzonExpress connection:",e),!1}finally{o.value=!1}},p=()=>{s.value=null},_=()=>{f.value=null},C=()=>{g.value={customer_id:null,api_key:null},s.value=null,f.value=null,o.value=!1},z=A(()=>!!(g.value.customer_id&&g.value.api_key)),V=A(()=>z.value);return{settings:x(g),loading:x(o),error:x(s),testResult:x(f),hasCredentials:z,isConfigured:V,fetchSettings:w,fetchSettingsForEdit:k,updateSettings:v,testConnection:i,clearError:p,clearTestResult:_,reset:C}}),se={class:"d-flex justify-space-between align-center mb-6"},te={class:"text-h4 font-weight-bold mb-1"},ae={class:"text-body-1 text-medium-emphasis"},oe={class:"d-flex gap-3 mt-5"},le={class:"d-flex align-center gap-3"},ne={class:"text-body-2 text-medium-emphasis"},re={class:"text-body-2"},ie={class:"mb-3"},ue={class:"mb-3"},de={class:"mb-0"},ce=K({__name:"credentials",setup(g){const{t:o}=M(),s=ee(),{confirmUpdate:f}=Q(),{showSuccess:w,showError:k,snackbar:v}=W(),i=y({customer_id:"",api_key:"",base_url:"https://api.ozonexpress.ma"}),p=y(!1),_=y({});D(async()=>{await s.fetchSettings(),i.value.customer_id=s.settings.customer_id||"",i.value.api_key=s.settings.api_key||""});const C=async()=>{try{console.log("Form data before save:",i.value),await s.updateSettings(i.value)?(w(o("admin_ozon_settings_saved_success")),_.value={}):k(s.error||o("admin_ozon_settings_save_error"))}catch(n){console.error("Error saving settings:",n),k(o("admin_ozon_settings_save_error"))}},z=async()=>{if(p.value)i.value.api_key=s.settings.api_key||"";else{const n=await s.fetchSettingsForEdit();n&&(i.value.api_key=n.api_key||"")}p.value=!p.value},V=n=>{_.value[n]&&delete _.value[n]};return(n,t)=>(E(),G("div",null,[u("div",se,[u("div",null,[u("h1",te,d(a(o)("ozonexpress_settings")),1),u("p",ae,d(a(o)("ozonexpress_settings_desc")),1)])]),l(I,null,{default:r(()=>[l(F,{class:"d-flex align-center"},{default:r(()=>[l(b,{icon:"tabler-settings",class:"me-3"}),m(" "+d(a(o)("api_credentials")),1)]),_:1}),l(R,null,{default:r(()=>[l(H,{onSubmit:L(C,["prevent"])},{default:r(()=>[l(J,null,{default:r(()=>[l(T,{cols:"12",md:"6"},{default:r(()=>[l(U,{modelValue:i.value.customer_id,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value.customer_id=e),label:a(o)("customer_id"),placeholder:a(o)("customer_id_placeholder"),variant:"outlined",required:"","error-messages":_.value.customer_id,onInput:t[1]||(t[1]=e=>V("customer_id"))},null,8,["modelValue","label","placeholder","error-messages"])]),_:1}),l(T,{cols:"12",md:"6"},{default:r(()=>[l(U,{modelValue:i.value.api_key,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.api_key=e),label:p.value?a(o)("api_key"):a(o)("api_key_masked"),type:p.value?"text":"password",placeholder:a(o)("api_key_placeholder"),variant:"outlined",required:"","error-messages":_.value.api_key,onInput:t[3]||(t[3]=e=>V("api_key"))},{"append-inner":r(()=>[l(B,{icon:"",variant:"text",size:"small",onClick:z},{default:r(()=>[l(b,{icon:p.value?"tabler-eye-off":"tabler-eye"},null,8,["icon"])]),_:1})]),_:1},8,["modelValue","label","type","placeholder","error-messages"])]),_:1}),l(T,{cols:"12"},{default:r(()=>[l(U,{modelValue:i.value.base_url,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value.base_url=e),label:a(o)("api_base_url"),placeholder:"https://api.ozonexpress.ma",variant:"outlined",required:"","error-messages":_.value.base_url,onInput:t[5]||(t[5]=e=>V("base_url"))},null,8,["modelValue","label","error-messages"])]),_:1})]),_:1}),a(s).error?(E(),N(P,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":t[6]||(t[6]=e=>a(s).clearError())},{default:r(()=>[m(d(a(s).error),1)]),_:1})):$("",!0),a(s).testResult?(E(),N(P,{key:1,type:a(s).testResult.success?"success":"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":t[7]||(t[7]=e=>a(s).clearTestResult())},{default:r(()=>[m(d(a(s).testResult.message),1)]),_:1},8,["type"])):$("",!0),u("div",oe,[l(B,{type:"submit",color:"primary",loading:a(s).loading,disabled:!i.value.customer_id||!i.value.api_key},{default:r(()=>[l(b,{icon:"tabler-device-floppy",start:""}),m(" "+d(a(o)("admin_ozon_save_button")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1}),l(I,{class:"mt-6"},{default:r(()=>[l(F,{class:"d-flex align-center"},{default:r(()=>[l(b,{icon:"tabler-info-circle",class:"me-3"}),m(" "+d(a(o)("admin_ozon_config_status_title")),1)]),_:1}),l(R,null,{default:r(()=>[u("div",le,[l(X,{color:a(s).isConfigured?"success":"warning",variant:"tonal"},{default:r(()=>[l(b,{icon:a(s).isConfigured?"tabler-check":"tabler-alert-triangle",start:""},null,8,["icon"]),m(" "+d(a(s).isConfigured?a(o)("admin_ozon_configured"):a(o)("admin_ozon_not_configured")),1)]),_:1},8,["color"]),u("span",ne,d(a(s).isConfigured?a(o)("admin_ozon_config_ready_desc"):a(o)("admin_ozon_config_needed_desc")),1)])]),_:1})]),_:1}),l(I,{class:"mt-6"},{default:r(()=>[l(F,{class:"d-flex align-center"},{default:r(()=>[l(b,{icon:"tabler-help",class:"me-3"}),m(" "+d(a(o)("admin_ozon_help_title")),1)]),_:1}),l(R,null,{default:r(()=>[u("div",re,[u("p",ie,[t[9]||(t[9]=u("strong",null,"Customer ID :",-1)),m(" "+d(a(o)("admin_ozon_help_customer_id")),1)]),u("p",ue,[t[10]||(t[10]=u("strong",null,"API Key :",-1)),m(" "+d(a(o)("admin_ozon_help_api_key")),1)]),u("p",de,[t[11]||(t[11]=u("strong",null,"Note :",-1)),m(" "+d(a(o)("admin_ozon_help_note")),1)])])]),_:1})]),_:1}),l(Y,{modelValue:a(v).show,"onUpdate:modelValue":t[8]||(t[8]=e=>a(v).show=e),color:a(v).color,timeout:a(v).timeout,location:"top end"},{default:r(()=>[m(d(a(v).message),1)]),_:1},8,["modelValue","color","timeout"])]))}}),Te=Z(ce,[["__scopeId","data-v-da29a726"]]);export{Te as default};
