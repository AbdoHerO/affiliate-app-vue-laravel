import{d as Qe,k as Ke,aL as Ge,r as c,V as J,o as He,c as w,b as m,f as d,e as t,h as v,m as g,v as s,n as r,g as l,t as _,az as p,ac as k,q as se,F as Je,j as We}from"./main-DEzoUo6n.js";import{u as Xe}from"./preorders-CuT-uy24.js";import{useQuickConfirm as Ye}from"./useConfirmAction-lawnJ6WL.js";import{u as Ze}from"./useNotifications-Bc6GUAmT.js";import{C as ea}from"./ConfirmActionDialog-D3cWAru7.js";import{O as aa}from"./OzonExpressConfirmDialog-Cm_Uy-hj.js";import{V as W}from"./VCardText-DtKfeQ8i.js";import{V as ta,a as S}from"./VRow-CCKjjrNU.js";import{V as X}from"./VTextField-BiqUvfe6.js";import{V as Y}from"./VSelect-DRK_p5uX.js";import{V as E,b as la,c as oa}from"./VCard-BQBmQiQJ.js";import{V as ie}from"./VSpacer-om3XMluz.js";import{V as ra}from"./VDataTableServer-BPywD3NC.js";import{V as Z}from"./VTooltip-CxfTaIey.js";import{V as na}from"./VMenu-CAJpv2vQ.js";import{V as sa,a as z,b as T}from"./VList-PlS4cpk2.js";import{V as ia}from"./VDivider-96JDmIpb.js";import{V as $}from"./VChip-BLx6lUDe.js";import{V as da}from"./VBadge-DW3tg7Gl.js";import{V as de}from"./VCheckbox-BgUxiM5L.js";import{V as ua}from"./VTextarea-BfvN6PTe.js";import{V as ca}from"./VDialog-SdVxorIC.js";import{V as _a}from"./VSnackbar-Br3eOTz2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */import"./VField-BrxQSdNw.js";import"./VImg-Dcm3Nb79.js";import"./forwardRefs-BYcTBJDs.js";import"./dialog-transition-PfMbSZsR.js";import"./VOverlay-D7sMErQR.js";import"./lazy-BPEwf1-U.js";import"./VCheckboxBtn-ispl65Ef.js";import"./VAvatar-DcdpS4jo.js";import"./createSimpleFunctional-DUhC6iZd.js";import"./VDataTable-CY4RDaZO.js";import"./VPagination-BwetZgLf.js";import"./VTable-pKKqnQcU.js";import"./filter-C0NlBkaG.js";import"./ssrBoot-BNMsj90G.js";const ma={class:"d-flex flex-column gap-6"},pa={class:"d-flex justify-space-between align-center mb-6"},fa={class:"text-h4 font-weight-bold mb-1"},va={class:"text-body-1 mb-0"},ga={class:"d-flex align-center gap-4"},ba={class:"text-body-1 font-weight-medium"},ha={class:"font-weight-medium"},ka={class:"text-caption text-medium-emphasis"},ya={key:0,class:"text-caption text-info"},Va={class:"font-weight-medium"},xa={class:"text-caption text-medium-emphasis"},Ca={class:"d-flex flex-wrap gap-1"},wa={class:"font-weight-bold"},Sa={key:1,class:"text-medium-emphasis"},za={key:0,class:"d-flex align-center gap-1"},Ta={class:"text-caption text-success"},La={key:1,class:"text-caption text-medium-emphasis"},Ua={class:"text-body-2"},Da={class:"d-flex gap-1"},Pa={class:"text-center py-8"},qa={class:"text-h6 mb-2"},Fa={class:"text-body-2 text-medium-emphasis"},Oa={class:"mb-4"},Vt=Qe({__name:"index",setup(Aa){const ee=Ke(),f=Xe(),{t:a}=Ge(),{confirm:ue,isDialogVisible:ce,isLoading:_e,dialogTitle:me,dialogText:pe,dialogIcon:fe,dialogColor:ve,confirmButtonText:ge,cancelButtonText:be,handleConfirm:he,handleCancel:ke}=Ye(),{showSuccess:y,showError:x,snackbar:L}=Ze(),U=c(""),D=c(""),R=c(""),Q=c(""),P=c(""),q=c(""),C=c(15),u=c([]),b=c(!1),F=c(!1),V=c(""),j=c(!1),K=c(!1),I=c("single"),O=c(""),A=c(!1),M=c(!1),B=c(""),ye=J(()=>f.isLoading),G=J(()=>f.preorders),ae=J(()=>f.pagination),Ve=[{title:"",key:"select",sortable:!1,width:"50px"},{title:a("table_client"),key:"client",sortable:!1},{title:a("table_city"),key:"city",sortable:!1},{title:a("table_affiliate"),key:"affilie",sortable:!1},{title:a("table_boutique"),key:"boutique",sortable:!1},{title:"SKU",key:"sku_list",sortable:!1,width:"150px"},{title:a("table_type"),key:"type_command",sortable:!0,width:"100px"},{title:a("table_total"),key:"total_ttc",sortable:!0},{title:a("table_no_answer"),key:"no_answer_count",sortable:!0,width:"100px"},{title:a("table_status"),key:"statut",sortable:!0},{title:a("table_shipping"),key:"shipping",sortable:!1,width:"120px"},{title:a("table_date"),key:"created_at",sortable:!0},{title:a("table_actions"),key:"actions",sortable:!1,width:"150px"}],xe=[{title:a("admin_preorders_status_all"),value:""},{title:a("admin_preorders_status_pending"),value:"en_attente"},{title:a("admin_preorders_status_confirmed"),value:"confirmee"},{title:a("admin_preorders_status_unreachable"),value:"injoignable"},{title:a("admin_preorders_status_refused"),value:"refusee"},{title:a("admin_preorders_status_cancelled"),value:"annulee"}],te=async()=>{await f.fetchPreorders({q:U.value||void 0,statut:D.value||void 0,affilie_id:R.value||void 0,boutique_id:Q.value||void 0,from:P.value||void 0,to:q.value||void 0,perPage:C.value})},N=()=>{f.fetchPreorders({page:1,q:U.value||void 0,statut:D.value||void 0,affilie_id:R.value||void 0,boutique_id:Q.value||void 0,from:P.value||void 0,to:q.value||void 0,perPage:C.value})},Ce=n=>{f.fetchPreorders({page:n})},we=n=>{n.length>0&&f.fetchPreorders({sort:n[0].key,dir:n[0].order})},Se=n=>{ee.push({name:"admin-orders-pre-id",params:{id:n.id}})},ze=n=>{switch(n){case"en_attente":return"warning";case"confirmee":return"success";case"injoignable":return"orange";case"refusee":return"error";case"annulee":return"secondary";default:return"default"}},Te=n=>({order_sample:"primary",exchange:"warning"})[n]||"secondary",Le=n=>({order_sample:a("order_type_sample"),exchange:a("order_type_exchange")})[n]||n,le=n=>{switch(n){case"en_attente":return a("admin_preorders_status_pending");case"confirmee":return a("admin_preorders_status_confirmed");case"injoignable":return a("admin_preorders_status_unreachable");case"refusee":return a("admin_preorders_status_refused");case"annulee":return a("admin_preorders_status_cancelled");default:return n}},Ue=n=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD"}).format(n),De=n=>new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Pe=n=>{var o,e;return((o=n.client_final_data)==null?void 0:o.nom_complet)||((e=n.client)==null?void 0:e.nom_complet)||a("admin_preorders_client_na")},qe=n=>{var o,e;return((o=n.client_final_data)==null?void 0:o.telephone)||((e=n.client)==null?void 0:e.telephone)||a("admin_preorders_phone_na")},oe=n=>{var o,e;return((o=n.client_final_data)==null?void 0:o.ville)||((e=n.adresse)==null?void 0:e.ville)||null},re=()=>{U.value="",D.value="",R.value="",Q.value="",P.value="",q.value="",u.value=[],b.value=!1,V.value="",f.resetFilters(),te()},Fe=()=>{b.value?u.value=G.value.map(n=>n.id):u.value=[]},Oe=n=>{const o=u.value.indexOf(n);o>-1?u.value.splice(o,1):u.value.push(n),b.value=u.value.length===G.value.length},Ae=async n=>{if(u.value.length===0)return;if(!await ue({title:a("admin_preorders_bulk_change_title"),text:a("admin_preorders_bulk_change_text",{count:u.value.length}),confirmText:a("admin_preorders_bulk_confirm"),cancelText:a("admin_preorders_bulk_cancel")})){V.value="";return}F.value=!0;try{const e=await f.bulkChangeStatus(u.value,n),i=le(n);y(e.message||a("admin.orders.bulkUpdateSuccess",{count:u.value.length,status:i})),u.value=[],b.value=!1,V.value=""}catch(e){x(e.message||a("admin_preorders_bulk_status_error")),V.value="",console.error("Bulk status change error:",e)}finally{F.value=!1}},Be=async()=>{u.value.length!==0&&(I.value="bulk",j.value=!0)},H=async(n,o)=>{try{const e=await f.changeStatus(n,o);y(e.message)}catch(e){x(e.message)}},Ne=async n=>{try{const o=await f.changeStatus(n,"injoignable",void 0,!0);y(o.message)}catch(o){x(o.message)}},$e=async n=>{O.value=n,I.value="single",j.value=!0},je=async n=>{O.value=n,B.value="",A.value=!0},Ie=async n=>{K.value=!0;try{if(I.value==="bulk"){const o=await f.bulkSendToShipping(u.value,n);if(o.summary){const{total:e,success:i,errors:h}=o.summary;if(h>0)x(a("admin_preorders_ozon_error_bulk",{success:i,total:e,errors:h}));else{const ne=a(ne==="ramassage"?"admin_preorders_ozon_mode_pickup":"admin_preorders_ozon_mode_stock");y(a("admin_preorders_ozon_success_bulk",{count:i,mode:ne}))}}else y(o.message||a("admin_preorders_bulk_send_ozon"));u.value=[],b.value=!1,V.value=""}else{const o=await f.sendToShipping(O.value,n),e=a(n==="ramassage"?"admin_preorders_ozon_mode_pickup":"admin_preorders_ozon_mode_stock");y(a("admin_preorders_ozon_success_single",{mode:e}))}}catch(o){x(o.message||a("admin_preorders_ozon_error")),console.error("OzonExpress shipping error:",o)}finally{K.value=!1}},Me=()=>{},Ee=async()=>{M.value=!0;try{const n=await f.moveToShippingLocal(O.value,B.value||void 0);y(a("admin_preorders_local_shipping_success")),A.value=!1,ee.push({name:"admin-orders-shipping-id",params:{id:O.value}})}catch(n){x(n.message||a("admin_preorders_local_shipping_error"))}finally{M.value=!1}},Re=()=>{A.value=!1,B.value=""};return He(()=>{te()}),(n,o)=>(m(),w("div",ma,[d("div",pa,[d("div",null,[d("h1",fa,s(r(a)("admin_preorders_title")),1),d("p",va,s(r(a)("admin_preorders_description")),1)]),t(k,{color:"primary",variant:"elevated",onClick:re},{default:l(()=>[t(p,{start:"",icon:"tabler-refresh"}),_(" "+s(r(a)("admin_preorders_refresh")),1)]),_:1})]),t(E,{class:"mb-6"},{default:l(()=>[t(W,null,{default:l(()=>[t(ta,null,{default:l(()=>[t(S,{cols:"12",md:"3"},{default:l(()=>[t(X,{modelValue:U.value,"onUpdate:modelValue":o[0]||(o[0]=e=>U.value=e),label:r(a)("admin_preorders_search_label"),placeholder:r(a)("admin_preorders_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:"",onInput:N},null,8,["modelValue","label","placeholder"])]),_:1}),t(S,{cols:"12",md:"2"},{default:l(()=>[t(Y,{modelValue:D.value,"onUpdate:modelValue":[o[1]||(o[1]=e=>D.value=e),N],label:r(a)("admin_preorders_status_label"),items:xe,clearable:""},null,8,["modelValue","label"])]),_:1}),t(S,{cols:"12",md:"2"},{default:l(()=>[t(X,{modelValue:P.value,"onUpdate:modelValue":o[2]||(o[2]=e=>P.value=e),label:r(a)("admin_preorders_date_start"),type:"date",onChange:N},null,8,["modelValue","label"])]),_:1}),t(S,{cols:"12",md:"2"},{default:l(()=>[t(X,{modelValue:q.value,"onUpdate:modelValue":o[3]||(o[3]=e=>q.value=e),label:r(a)("admin_preorders_date_end"),type:"date",onChange:N},null,8,["modelValue","label"])]),_:1}),t(S,{cols:"12",md:"2"},{default:l(()=>[t(Y,{modelValue:C.value,"onUpdate:modelValue":[o[4]||(o[4]=e=>C.value=e),N],label:r(a)("admin_preorders_per_page"),items:[10,15,25,50]},null,8,["modelValue","label"])]),_:1}),t(S,{cols:"12",md:"1"},{default:l(()=>[t(k,{color:"secondary",variant:"outlined",block:"",onClick:re},{default:l(()=>[t(p,{icon:"tabler-filter-off"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u.value.length>0?(m(),v(E,{key:0,class:"mb-4"},{default:l(()=>[t(W,null,{default:l(()=>[d("div",ga,[t(p,{icon:"tabler-check",color:"primary"}),d("span",ba,s(r(a)("admin_preorders_selected_count",{count:u.value.length})),1),t(ie),t(k,{color:"primary",variant:"elevated",loading:F.value,onClick:Be},{default:l(()=>[t(p,{start:"",icon:"tabler-truck"}),_(" "+s(r(a)("admin_preorders_bulk_send_ozon")),1)]),_:1},8,["loading"]),t(Y,{modelValue:V.value,"onUpdate:modelValue":[o[5]||(o[5]=e=>V.value=e),o[6]||(o[6]=e=>e&&Ae(e))],label:r(a)("admin_preorders_bulk_change_status"),placeholder:r(a)("admin_preorders_bulk_select_status"),items:[{title:r(a)("admin_preorders_bulk_confirmed"),value:"confirmee"},{title:r(a)("admin_preorders_bulk_unreachable"),value:"injoignable"},{title:r(a)("admin_preorders_bulk_refused"),value:"refusee"},{title:r(a)("admin_preorders_bulk_cancelled"),value:"annulee"}],style:{"min-width":"180px"},loading:F.value,disabled:F.value,clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","label","placeholder","items","loading","disabled"]),t(k,{color:"error",variant:"outlined",onClick:o[7]||(o[7]=e=>{u.value=[],b.value=!1})},{default:l(()=>[t(p,{icon:"tabler-x"})]),_:1})])]),_:1})]),_:1})):g("",!0),t(E,null,{default:l(()=>[t(ra,{"items-per-page":C.value,"onUpdate:itemsPerPage":o[9]||(o[9]=e=>C.value=e),headers:Ve,items:G.value,"items-length":ae.value.total,loading:ye.value,page:ae.value.current_page,"onUpdate:page":Ce,"onUpdate:sortBy":we},{"header.select":l(()=>[t(de,{modelValue:b.value,"onUpdate:modelValue":[o[8]||(o[8]=e=>b.value=e),Fe]},null,8,["modelValue"])]),"item.select":l(({item:e})=>[t(de,{"model-value":u.value.includes(e.id),"onUpdate:modelValue":i=>Oe(e.id)},null,8,["model-value","onUpdate:modelValue"])]),"item.client":l(({item:e})=>[d("div",null,[d("div",ha,s(Pe(e)),1),d("div",ka,s(qe(e)),1),oe(e)?(m(),w("div",ya,s(oe(e)),1)):g("",!0)])]),"item.city":l(({item:e})=>[d("div",null,[t($,{size:"small",color:"secondary",variant:"tonal"},{default:l(()=>{var i;return[_(s(((i=e.adresse)==null?void 0:i.ville)||r(a)("admin_preorders_city_na")),1)]}),_:2},1024)])]),"item.affilie":l(({item:e})=>{var i,h;return[d("div",null,[d("div",Va,s(((i=e.affiliate)==null?void 0:i.nom_complet)||r(a)("admin_preorders_affiliate_na")),1),d("div",xa,s(((h=e.affiliate)==null?void 0:h.email)||r(a)("admin_preorders_email_na")),1)])]}),"item.boutique":l(({item:e})=>[t($,{size:"small",color:"info",variant:"tonal"},{default:l(()=>[_(s(e.boutique.nom),1)]),_:2},1024)]),"item.sku_list":l(({item:e})=>[d("div",Ca,[(m(!0),w(Je,null,We(e.articles,i=>(m(),v($,{key:i.id,size:"x-small",color:"secondary",variant:"outlined",class:"font-mono"},{default:l(()=>[_(s(i.produit.sku||"N/A"),1)]),_:2},1024))),128))])]),"item.type_command":l(({item:e})=>[t($,{size:"small",color:Te(e.type_command),variant:"tonal"},{default:l(()=>[_(s(Le(e.type_command)),1)]),_:2},1032,["color"])]),"item.total_ttc":l(({item:e})=>[d("div",wa,s(Ue(e.total_ttc)),1)]),"item.no_answer_count":l(({item:e})=>[e.no_answer_count>0?(m(),v(da,{key:0,content:e.no_answer_count,color:"warning",inline:""},{default:l(()=>[t(p,{icon:"tabler-phone-off",size:"20"})]),_:2},1032,["content"])):(m(),w("span",Sa,"0"))]),"item.statut":l(({item:e})=>[t($,{size:"small",color:ze(e.statut),variant:"tonal"},{default:l(()=>[_(s(le(e.statut)),1)]),_:2},1032,["color"])]),"item.shipping":l(({item:e})=>[e.shipping_parcel?(m(),w("div",za,[t(p,{icon:"tabler-truck",color:"success",size:"16"}),t(Z,{activator:"parent",location:"top"},{default:l(()=>[_(s(r(a)("admin_preorders_tracking_tooltip",{tracking:e.shipping_parcel.tracking_number})),1)]),_:2},1024),d("span",Ta,s(r(a)("admin_preorders_shipped")),1)])):(m(),w("div",La,s(r(a)("admin_preorders_not_shipped")),1))]),"item.created_at":l(({item:e})=>[d("div",Ua,s(De(e.created_at)),1)]),"item.actions":l(({item:e})=>[d("div",Da,[t(Z,{location:"top"},{activator:l(({props:i})=>[t(k,se(i,{size:"small",color:"primary",variant:"text",icon:"tabler-eye",onClick:h=>Se(e)}),null,16,["onClick"])]),default:l(()=>[d("span",null,s(r(a)("actions.viewDetails")),1)]),_:2},1024),e.shipping_parcel?g("",!0):(m(),v(na,{key:0},{activator:l(({props:i})=>[t(Z,{location:"top"},{activator:l(({props:h})=>[t(k,se({...i,...h},{size:"small",color:"secondary",variant:"text",icon:"tabler-dots-vertical"}),null,16)]),default:l(()=>[d("span",null,s(r(a)("admin_preorders_quick_actions")),1)]),_:2},1024)]),default:l(()=>[t(sa,null,{default:l(()=>[e.statut!=="confirmee"?(m(),v(z,{key:0,onClick:i=>H(e.id,"confirmee")},{default:l(()=>[t(T,null,{default:l(()=>[t(p,{start:"",icon:"tabler-check",color:"success"}),_(" "+s(r(a)("admin_preorders_action_confirm")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),t(z,{onClick:i=>Ne(e.id)},{default:l(()=>[t(T,null,{default:l(()=>[t(p,{start:"",icon:"tabler-phone-off",color:"warning"}),_(" "+s(r(a)("admin_preorders_action_unreachable")),1)]),_:1})]),_:2},1032,["onClick"]),e.statut!=="refusee"?(m(),v(z,{key:1,onClick:i=>H(e.id,"refusee")},{default:l(()=>[t(T,null,{default:l(()=>[t(p,{start:"",icon:"tabler-x",color:"error"}),_(" "+s(r(a)("admin_preorders_action_refuse")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),e.statut!=="annulee"?(m(),v(z,{key:2,onClick:i=>H(e.id,"annulee")},{default:l(()=>[t(T,null,{default:l(()=>[t(p,{start:"",icon:"tabler-ban",color:"error"}),_(" "+s(r(a)("admin_preorders_action_cancel")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),e.statut==="confirmee"&&!e.shipping_parcel?(m(),v(ia,{key:3})):g("",!0),e.statut==="confirmee"&&!e.shipping_parcel?(m(),v(z,{key:4,onClick:i=>$e(e.id)},{default:l(()=>[t(T,null,{default:l(()=>[t(p,{start:"",icon:"tabler-truck",color:"info"}),_(" "+s(r(a)("admin_preorders_action_send_ozon")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),e.statut==="confirmee"&&!e.shipping_parcel?(m(),v(z,{key:5,onClick:i=>je(e.id)},{default:l(()=>[t(T,null,{default:l(()=>[t(p,{start:"",icon:"tabler-package",color:"warning"}),_(" "+s(r(a)("admin_preorders_action_local_shipping")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024))])]),"no-data":l(()=>[d("div",Pa,[t(p,{icon:"tabler-package-off",size:"64",class:"mb-4",color:"disabled"}),d("h3",qa,s(r(a)("admin_preorders_no_data_title")),1),d("p",Fa,s(r(a)("admin_preorders_no_data_description")),1)])]),_:1},8,["items-per-page","items","items-length","loading","page"])]),_:1}),t(aa,{modelValue:j.value,"onUpdate:modelValue":o[10]||(o[10]=e=>j.value=e),loading:K.value,text:I.value==="bulk"?r(a)("admin_preorders_ozon_bulk_text",{count:u.value.length}):r(a)("admin_preorders_ozon_single_text"),onConfirm:Ie,onCancel:Me},null,8,["modelValue","loading","text"]),t(ca,{modelValue:A.value,"onUpdate:modelValue":o[12]||(o[12]=e=>A.value=e),"max-width":"500",persistent:""},{default:l(()=>[t(E,null,{default:l(()=>[t(la,{class:"text-h6"},{default:l(()=>[t(p,{start:"",icon:"tabler-package",color:"warning"}),_(" "+s(r(a)("admin_preorders_local_shipping_title")),1)]),_:1}),t(W,null,{default:l(()=>[d("p",Oa,s(r(a)("admin_preorders_local_shipping_description")),1),t(ua,{modelValue:B.value,"onUpdate:modelValue":o[11]||(o[11]=e=>B.value=e),label:r(a)("admin_preorders_local_shipping_note_label"),placeholder:r(a)("admin_preorders_local_shipping_note_placeholder"),rows:"3",variant:"outlined"},null,8,["modelValue","label","placeholder"])]),_:1}),t(oa,null,{default:l(()=>[t(ie),t(k,{variant:"text",onClick:Re,disabled:M.value},{default:l(()=>[_(s(r(a)("admin_preorders_local_shipping_cancel")),1)]),_:1},8,["disabled"]),t(k,{color:"warning",variant:"elevated",loading:M.value,onClick:Ee},{default:l(()=>[t(p,{start:"",icon:"tabler-package"}),_(" "+s(r(a)("admin_preorders_local_shipping_confirm")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ea,{"is-dialog-visible":r(ce),"is-loading":r(_e),"dialog-title":r(me),"dialog-text":r(pe),"dialog-icon":r(fe),"dialog-color":r(ve),"confirm-button-text":r(ge),"cancel-button-text":r(be),onConfirm:r(he),onCancel:r(ke)},null,8,["is-dialog-visible","is-loading","dialog-title","dialog-text","dialog-icon","dialog-color","confirm-button-text","cancel-button-text","onConfirm","onCancel"]),t(_a,{modelValue:r(L).show,"onUpdate:modelValue":o[13]||(o[13]=e=>r(L).show=e),color:r(L).color,timeout:r(L).timeout,location:"top end"},{default:l(()=>[_(s(r(L).message),1)]),_:1},8,["modelValue","color","timeout"])]))}});export{Vt as default};
