import{d as Q,u as q,j as G,aL as J,b6 as K,b7 as X,V as I,r as L,D as Y,c as A,o as c,b as o,m as t,e as n,aV as Z,t as s,g as p,l as h,f as e,ac as w,s as f,az as j}from"./main-uLG9IIeX.js";import{u as tt}from"./withdrawals-CIZKjV5q.js";import{_ as et}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-nczKusLe.js";import{_ as at,a as st}from"./WithdrawalActionDialog.vue_vue_type_script_setup_true_lang-CcCqBry-.js";import{A as it}from"./ActionIcon-Cq1cTKuI.js";import{useQuickConfirm as ot}from"./useConfirmAction-C-KKQTYr.js";import{u as nt}from"./useNotifications-DDBS_wPD.js";import{a as u,V as x}from"./VRow-aGfXYx3U.js";import{V as k,b as g}from"./VCard-CB1gT6RB.js";import{V}from"./VCardText-BZtszuIK.js";import{V as lt}from"./VAvatar-bHPDEsYY.js";import{V as dt}from"./VDataTable-DNqSzzrc.js";import{V as rt}from"./VChip-B84WcmDa.js";import"./api-DSi3Suj8.js";import"./index-D-EbNoF1.js";import"./VBreadcrumbs-D7yKQl5l.js";import"./VDialog-DU1pBIct.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VImg-BS6_svHJ.js";import"./dialog-transition-2hF0ajsQ.js";import"./VAlert-TgguXW_5.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VForm-C9FiqBHN.js";import"./VField-CfH1YcVv.js";import"./VTextarea-BuIc6d95.js";import"./VTextField-Dxeq5kx5.js";import"./VFileInput-D1Glyc4K.js";import"./VSpacer-BCNmCEP9.js";/* empty css              */import"./VTooltip-Ce3bfmSx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VPagination-DYW6O4lq.js";import"./VSelect-sWnAtot-.js";import"./VList-uZDByhc2.js";import"./ssrBoot-BPhRU-mF.js";import"./VDivider-UqGR4x4D.js";import"./VMenu-DP1p-55V.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";const ct={key:0,class:"text-center py-8"},mt={class:"mt-4"},_t={key:1},ut={class:"d-flex align-center gap-3 mb-2"},pt={class:"text-h4 font-weight-bold"},ht={class:"text-body-1 text-medium-emphasis"},ft={class:"d-flex gap-2 justify-md-end"},wt={class:"text-caption text-medium-emphasis"},vt={class:"text-h6 font-weight-bold"},bt={class:"text-caption text-medium-emphasis"},yt={class:"text-body-1"},xt={class:"text-caption text-medium-emphasis"},kt={class:"text-body-1"},gt={class:"text-caption text-medium-emphasis"},Vt={class:"text-body-1"},Ct={class:"text-caption text-medium-emphasis"},Dt={class:"text-body-1"},At={class:"text-caption text-medium-emphasis"},St={class:"text-body-1"},zt={class:"text-caption text-medium-emphasis"},Nt={class:"text-body-1 font-family-monospace"},$t={class:"d-flex align-center gap-3 mb-4"},It={class:"text-h6"},jt={class:"text-h6"},Bt={class:"text-body-2 text-medium-emphasis"},Tt={class:"text-caption text-medium-emphasis"},Lt={class:"text-body-1"},Wt={class:"text-caption text-medium-emphasis"},Et={class:"text-body-1 font-family-monospace"},Mt={class:"text-caption text-medium-emphasis"},Rt={class:"text-body-1"},Ft={class:"text-body-2",style:{"white-space":"pre-line"}},Ut={class:"text-body-2"},Ht={key:0,class:"d-flex gap-2"},Ot={class:"text-body-2 font-family-monospace"},Pt={class:"text-body-2 font-family-monospace"},Qt={class:"text-body-2"},qt={class:"text-body-2 font-weight-medium"},Gt={class:"text-body-2"},Jt={class:"text-center py-8"},Kt={class:"text-center py-8"},Xt={key:2,class:"text-center py-8"},Yt={class:"text-h6 mb-2"},Zt={class:"text-body-2 text-medium-emphasis mb-4"},Ue=Q({__name:"index",setup(te){const W=q(),y=G(),{t:a}=J(),z=tt();K();const{confirm:E}=ot(),{showSuccess:N,showError:C}=nt(),{currentWithdrawal:i,loading:M}=X(z),R=I(()=>{const d=W.params.id;return!d||typeof d!="string"||d.trim()===""?(console.error("ðŸš« [Withdrawal Detail] Invalid withdrawal ID:",d),y.push("/admin/withdrawals").catch(console.error),""):d}),v=L([]),b=L({isVisible:!1,withdrawal:null,action:"approve"}),F=I(()=>{var d;return[{title:a("nav_dashboard"),to:"/admin/dashboard"},{title:a("nav_financial_management"),disabled:!0},{title:a("nav_withdrawals"),to:"/admin/withdrawals"},{title:((d=i.value)==null?void 0:d.id.substring(0,8))||a("admin_withdrawals_details"),disabled:!0}]}),U=[{title:a("admin_commissions_title"),key:"commission.id",sortable:!1},{title:a("table_order_id"),key:"commission.commande.id",sortable:!1},{title:a("table_product"),key:"commission.produit.titre",sortable:!1},{title:a("admin_withdrawals_amount"),key:"amount",sortable:!1},{title:a("table_status"),key:"commission.status",sortable:!1},{title:a("table_created"),key:"commission.created_at",sortable:!1},{title:a("table_actions"),key:"actions",sortable:!1}],B=I(()=>{var d,r;return((d=i.value)==null?void 0:d.status)==="pending"||((r=i.value)==null?void 0:r.status)==="approved"}),$=async()=>{try{const d=R.value;if(!d){C(a("invalid_withdrawal_id")),y.push("/admin/withdrawals");return}const r=await z.fetchOne(d);r.success||(C(r.message||a("error_loading_withdrawal")),y.push("/admin/withdrawals"))}catch(d){console.error("Error fetching withdrawal:",d),C(a("error_loading_withdrawal")),y.push("/admin/withdrawals")}},S=d=>{i.value&&(b.value={isVisible:!0,withdrawal:i.value,action:d})},H=async()=>{try{b.value.isVisible=!1,b.value.withdrawal=null,await $(),N(a("action_successful"))}catch(d){console.error("Error handling action success:",d),C(a("error_updating_data"))}},O=async()=>{if(!i.value||v.value.length===0)return;if(await E({title:a("admin_withdrawals_detach_commissions"),text:a("detach_commissions_confirm",{count:v.value.length}),confirmText:a("detach"),color:"error",type:"danger"})){const r=await z.detachCommissions(i.value.id,{commission_ids:v.value});r.success?(N(r.message),v.value=[],$()):C(r.message)}},P=async()=>{i.value&&N(a("export_in_progress"))},T=()=>{y.push("/admin/withdrawals")};return Y(()=>{$()}),(d,r)=>(c(),A("div",null,[o(et,{items:F.value},null,8,["items"]),t(M)?(c(),A("div",ct,[o(Z,{indeterminate:"",size:"64"}),n("p",mt,s(t(a)("loading_data")),1)])):t(i)?(c(),A("div",_t,[o(x,{class:"mb-6"},{default:e(()=>[o(u,{cols:"12",md:"6"},{default:e(()=>[n("div",ut,[o(w,{icon:"tabler-arrow-left",variant:"tonal",size:"small",onClick:T}),n("h1",pt,s(t(a)("nav_withdrawals"))+" "+s(t(i).id.substring(0,8)),1),o(at,{status:t(i).status},null,8,["status"])]),n("p",ht,s(t(a)("admin_withdrawals_details")),1)]),_:1}),o(u,{cols:"12",md:"6",class:"text-md-end"},{default:e(()=>[n("div",ft,[t(i).can_approve?(c(),p(w,{key:0,color:"success",variant:"tonal","prepend-icon":"tabler-check",onClick:r[0]||(r[0]=l=>S("approve"))},{default:e(()=>[f(s(t(a)("admin_withdrawals_approve")),1)]),_:1})):h("",!0),t(i).can_reject?(c(),p(w,{key:1,color:"error",variant:"tonal","prepend-icon":"tabler-x",onClick:r[1]||(r[1]=l=>S("reject"))},{default:e(()=>[f(s(t(a)("admin_withdrawals_reject")),1)]),_:1})):h("",!0),t(i).can_mark_in_payment?(c(),p(w,{key:2,color:"primary",variant:"tonal","prepend-icon":"tabler-clock",onClick:r[2]||(r[2]=l=>S("mark_in_payment"))},{default:e(()=>[f(s(t(a)("admin_withdrawals_mark_in_payment")),1)]),_:1})):h("",!0),t(i).can_mark_paid?(c(),p(w,{key:3,color:"success","prepend-icon":"tabler-credit-card",onClick:r[3]||(r[3]=l=>S("mark_paid"))},{default:e(()=>[f(s(t(a)("admin_withdrawals_mark_paid")),1)]),_:1})):h("",!0),o(w,{variant:"tonal","prepend-icon":"tabler-download",onClick:P},{default:e(()=>[f(s(t(a)("action_download")),1)]),_:1})])]),_:1})]),_:1}),o(x,{class:"mb-6"},{default:e(()=>[o(u,{cols:"12",md:"6"},{default:e(()=>[o(k,null,{default:e(()=>[o(g,null,{default:e(()=>[f(s(t(a)("admin_withdrawals_details")),1)]),_:1}),o(V,null,{default:e(()=>[o(x,null,{default:e(()=>[o(u,{cols:"6"},{default:e(()=>[n("div",wt,s(t(a)("admin_withdrawals_amount")),1),n("div",vt,s(Number(t(i).amount).toFixed(2))+" MAD",1)]),_:1}),o(u,{cols:"6"},{default:e(()=>[n("div",bt,s(t(a)("payment_method")),1),n("div",yt,s(t(i).method==="bank_transfer"?t(a)("bank_transfer"):t(i).method),1)]),_:1}),o(u,{cols:"6"},{default:e(()=>[n("div",xt,s(t(a)("commissions")),1),n("div",kt,s(t(a)("commission_count_text",{count:t(i).commission_count})),1)]),_:1}),o(u,{cols:"6"},{default:e(()=>[n("div",gt,s(t(a)("admin_withdrawals_created_at")),1),n("div",Vt,s(new Date(t(i).created_at).toLocaleString()),1)]),_:1}),t(i).approved_at?(c(),p(u,{key:0,cols:"6"},{default:e(()=>[n("div",Ct,s(t(a)("admin_withdrawals_approved_at")),1),n("div",Dt,s(new Date(t(i).approved_at).toLocaleString()),1)]),_:1})):h("",!0),t(i).paid_at?(c(),p(u,{key:1,cols:"6"},{default:e(()=>[n("div",At,s(t(a)("admin_withdrawals_paid_at")),1),n("div",St,s(new Date(t(i).paid_at).toLocaleString()),1)]),_:1})):h("",!0),t(i).payment_ref?(c(),p(u,{key:2,cols:"12"},{default:e(()=>[n("div",zt,s(t(a)("payment_reference")),1),n("div",Nt,s(t(i).payment_ref),1)]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(u,{cols:"12",md:"6"},{default:e(()=>[o(k,null,{default:e(()=>[o(g,null,{default:e(()=>[f(s(t(a)("admin_withdrawals_affiliate_info")),1)]),_:1}),o(V,null,{default:e(()=>{var l,_;return[n("div",$t,[o(lt,{size:"48",color:"primary"},{default:e(()=>{var m,D;return[n("span",It,s((D=(m=t(i).user)==null?void 0:m.nom_complet)==null?void 0:D.charAt(0)),1)]}),_:1}),n("div",null,[n("div",jt,s((l=t(i).user)==null?void 0:l.nom_complet),1),n("div",Bt,s((_=t(i).user)==null?void 0:_.email),1)])]),o(x,null,{default:e(()=>{var m;return[(m=t(i).user)!=null&&m.telephone?(c(),p(u,{key:0,cols:"12"},{default:e(()=>[n("div",Tt,s(t(a)("phone")),1),n("div",Lt,s(t(i).user.telephone),1)]),_:1})):h("",!0),t(i).iban_rib?(c(),p(u,{key:1,cols:"12"},{default:e(()=>[n("div",Wt,s(t(a)("rib"))+"/IBAN",1),n("div",Et,s(t(i).iban_rib),1)]),_:1})):h("",!0),t(i).bank_type?(c(),p(u,{key:2,cols:"12"},{default:e(()=>[n("div",Mt,s(t(a)("bank_type")),1),n("div",Rt,s(t(i).bank_type),1)]),_:1})):h("",!0)]}),_:1})]}),_:1})]),_:1})]),_:1})]),_:1}),t(i).notes||t(i).admin_reason?(c(),p(x,{key:0,class:"mb-6"},{default:e(()=>[t(i).notes?(c(),p(u,{key:0,cols:"12",md:"6"},{default:e(()=>[o(k,null,{default:e(()=>[o(g,null,{default:e(()=>[f(s(t(a)("notes")),1)]),_:1}),o(V,null,{default:e(()=>[n("div",Ft,s(t(i).notes),1)]),_:1})]),_:1})]),_:1})):h("",!0),t(i).admin_reason?(c(),p(u,{key:1,cols:"12",md:"6"},{default:e(()=>[o(k,{color:"error",variant:"tonal"},{default:e(()=>[o(g,null,{default:e(()=>[f(s(t(a)("rejection_reason")),1)]),_:1}),o(V,null,{default:e(()=>[n("div",Ut,s(t(i).admin_reason),1)]),_:1})]),_:1})]),_:1})):h("",!0)]),_:1})):h("",!0),t(i).evidence_url?(c(),p(x,{key:1,class:"mb-6"},{default:e(()=>[o(u,{cols:"12"},{default:e(()=>[o(k,null,{default:e(()=>[o(g,null,{default:e(()=>[f(s(t(a)("payment_proof")),1)]),_:1}),o(V,null,{default:e(()=>[o(w,{href:t(i).evidence_url,target:"_blank",color:"primary",variant:"tonal","prepend-icon":"tabler-download"},{default:e(()=>[f(s(t(a)("download_proof")),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),o(k,null,{default:e(()=>[o(g,{class:"d-flex justify-space-between align-center"},{default:e(()=>{var l;return[n("span",null,s(t(a)("admin_withdrawals_linked_commissions"))+" ("+s(((l=t(i).items)==null?void 0:l.length)||0)+")",1),B.value&&v.value.length>0?(c(),A("div",Ht,[o(w,{color:"error",variant:"tonal",size:"small","prepend-icon":"tabler-unlink",onClick:O},{default:e(()=>[f(s(t(a)("action_detach"))+" ("+s(v.value.length)+") ",1)]),_:1})])):h("",!0)]}),_:1}),t(i).items&&t(i).items.length>0?(c(),p(dt,{key:0,headers:U,items:t(i).items,"show-select":B.value,modelValue:v.value,"onUpdate:modelValue":r[4]||(r[4]=l=>v.value=l),"item-value":"commission.id","items-per-page":"10"},{"item.commission.id":e(({item:l})=>{var _,m;return[n("div",Ot,s((m=(_=l.commission)==null?void 0:_.id)==null?void 0:m.substring(0,8))+"... ",1)]}),"item.commission.commande.id":e(({item:l})=>{var _,m,D;return[n("div",Pt,s((D=(m=(_=l.commission)==null?void 0:_.commande)==null?void 0:m.id)==null?void 0:D.substring(0,8))+"... ",1)]}),"item.commission.produit.titre":e(({item:l})=>{var _,m;return[n("div",Qt,s(((m=(_=l.commission)==null?void 0:_.produit)==null?void 0:m.titre)||"N/A"),1)]}),"item.amount":e(({item:l})=>[n("div",qt,s(Number(l.amount).toFixed(2))+" MAD ",1)]),"item.commission.status":e(({item:l})=>{var _;return[o(rt,{color:((_=l.commission)==null?void 0:_.status)==="paid"?"success":"info",variant:"tonal",size:"small"},{default:e(()=>{var m;return[f(s(((m=l.commission)==null?void 0:m.status)==="paid"?t(a)("status_paid"):t(a)("status_pending")),1)]}),_:2},1032,["color"])]}),"item.commission.created_at":e(({item:l})=>{var _;return[n("div",Gt,s((_=l.commission)!=null&&_.created_at?new Date(l.commission.created_at).toLocaleDateString():"-"),1)]}),"item.actions":e(({item:l})=>[o(it,{icon:"tabler-eye",label:t(a)("action_view"),tooltip:t(a)("admin_withdrawals_view_commission"),onClick:_=>{var m;return t(y).push(`/admin/commissions/${(m=l.commission)==null?void 0:m.id}`)}},null,8,["label","tooltip","onClick"])]),"no-data":e(()=>[n("div",Jt,[o(j,{icon:"tabler-inbox",size:"48",class:"mb-2"}),n("p",null,s(t(a)("no_commissions_linked")),1)])]),_:1},8,["items","show-select","modelValue"])):(c(),p(V,{key:1},{default:e(()=>[n("div",Kt,[o(j,{icon:"tabler-inbox",size:"48",class:"mb-2"}),n("p",null,s(t(a)("no_commissions_linked")),1)])]),_:1}))]),_:1})])):(c(),A("div",Xt,[o(j,{icon:"tabler-alert-circle",size:"64",color:"error",class:"mb-4"}),n("h3",Yt,s(t(a)("admin_withdrawals_not_found")),1),n("p",Zt,s(t(a)("admin_withdrawals_not_found_description")),1),o(w,{color:"primary",onClick:T},{default:e(()=>[f(s(t(a)("admin_withdrawals_back_to_list")),1)]),_:1})])),o(st,{"is-visible":b.value.isVisible,"onUpdate:isVisible":r[5]||(r[5]=l=>b.value.isVisible=l),withdrawal:b.value.withdrawal,action:b.value.action,onSuccess:H},null,8,["is-visible","withdrawal","action"])]))}});export{Ue as default};
