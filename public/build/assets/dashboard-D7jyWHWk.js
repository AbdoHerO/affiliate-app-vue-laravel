import{S as le,D as ne}from"./StatisticsCard-CV7MjiKv.js";import{u as ie}from"./useAuth-BW6nJ-CV.js";import{b5 as de,r as w,V as h,ba as W,d as ce,aL as ue,o as me,bb as he,w as pe,c as Y,b as A,e as s,f,h as $,m as X,v as u,n,g as o,t as b,az as g,ac as k,F as Z,j as ee,bc as fe,q as ae}from"./main-DnYrbSQO.js";import{u as be}from"./useNotifications-B96M_DMY.js";import{_ as _e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DQ73-MJ6.js";import{V as te}from"./VSelect-CKLjvmQy.js";import{V as se}from"./VAlert-MvsAUjNt.js";import{a as L,V as G}from"./VRow-B-6WkvV7.js";import{V as H,a as ve,b as J,d as ye}from"./VCard-om2cqSxr.js";import{V as ge}from"./VTooltip-iZcEKscW.js";import{V as K}from"./VCardText-ByjN3mlm.js";import{V as re}from"./VDataTable-DKYwtbC2.js";import{V as we}from"./VChip-CjuV2Q4G.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAvatar-BwJp41ss.js";import"./VImg-CrKU03S9.js";import"./VBreadcrumbs-C9tszCP5.js";import"./VTextField-BFgmXL2S.js";import"./VField-CQs8lPb7.js";import"./forwardRefs-CKYzHDJS.js";import"./VList-DOWShsA2.js";import"./ssrBoot-DYjajp4c.js";import"./createSimpleFunctional-D0EIrpo1.js";import"./VDivider-u64Rz-6W.js";import"./dialog-transition-DVo_RrAy.js";import"./VMenu-Bwc3jIko.js";import"./VOverlay-B2NeWL_F.js";import"./lazy-tUmo4pC_.js";import"./VCheckboxBtn-CH3WdWXy.js";/* empty css              */import"./VPagination-08TpqLBG.js";import"./VTable-CrO6KCbh.js";import"./filter-Dgd-zPx5.js";const De=de("adminDashboard",()=>{const T=w(null),a=w({}),V=w({}),t=w({stats:!1,charts:!1,tables:!1}),v=w(null),C=w(null),m=w({dateRange:{start:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]},period:"month",page:1,perPage:15}),S=h(()=>t.value.stats||t.value.charts||t.value.tables),E=h(()=>T.value!==null),U=h(()=>{var e;return((e=T.value)==null?void 0:e.cards)??[]}),D=e=>{const i=U.value.find(c=>c.key===e);return(i==null?void 0:i.value)??0},q=h(()=>D("active_affiliates")),N=h(()=>D("total_orders")),M=h(()=>D("total_revenue")),R=h(()=>D("total_commissions")),z=h(()=>D("pending_payments")),I=h(()=>D("pending_tickets")),O=async e=>{t.value.stats=!0,v.value=null;try{const i={...m.value,...e},c=await W("/admin/dashboard/stats",{method:"GET",params:i});if(c.success)T.value=c.data,C.value=new Date;else throw new Error(c.message||"Failed to fetch dashboard stats")}catch(i){v.value=i instanceof Error?i.message:"An error occurred",console.error("Error fetching admin dashboard stats:",i)}finally{t.value.stats=!1}},j=async(e,i)=>{t.value.charts=!0,v.value=null;try{e?await F(e,i):await Promise.all([F("orders_by_period"),F("monthly_revenue"),F("top_affiliates"),F("top_products")])}catch(c){v.value=c instanceof Error?c.message:"An error occurred",console.error("Error fetching admin dashboard charts:",c)}finally{t.value.charts=!1}},F=async(e,i)=>{const c={...m.value,...i,type:e},p=await W("/admin/dashboard/charts",{method:"GET",params:c});if(p.success)a.value[e]=p.data;else throw new Error(p.message||`Failed to fetch ${e} chart data`)},P=async(e,i)=>{t.value.tables=!0,v.value=null;try{const c={...m.value,...i,type:e},p=await W("/admin/dashboard/tables",{method:"GET",params:c});if(p.success)V.value[e]=p.data;else throw new Error(p.message||"Failed to fetch table data")}catch(c){v.value=c instanceof Error?c.message:"An error occurred",console.error(`Error fetching admin dashboard table data (${e}):`,c)}finally{t.value.tables=!1}},d=e=>{m.value={...m.value,...e}},l=async()=>{await Promise.all([O(),j(),P("recent_payments"),P("monthly_paid_commissions")])},y=()=>{T.value=null,a.value={},V.value={},v.value=null,C.value=null},_=h(()=>{const e=a.value.orders_by_period;if(!e||!e.series||e.series.length===0)return null;const i=e.series[0];return{labels:i.categories,datasets:[{label:"Orders",data:i.data,backgroundColor:"#7367F0",borderColor:"#7367F0",borderWidth:2}]}}),r=h(()=>{const e=a.value.monthly_revenue;if(!e||!e.series||e.series.length===0)return null;const i=e.series[0];return{labels:i.categories,datasets:[{label:"Revenue",data:i.data,backgroundColor:"rgba(40, 199, 111, 0.1)",borderColor:"#28C76F",borderWidth:2,fill:!0}]}}),x=h(()=>{const e=a.value.top_affiliates;if(!e||!e.items||e.items.length===0)return null;const i=e.items.map(p=>p.label),c=e.items.map(p=>p.value);return{labels:i,datasets:[{label:"Top Affiliates",data:c,backgroundColor:"#FF9F43",borderColor:"#FF9F43",borderWidth:2}]}}),B=h(()=>{const e=a.value.top_products;if(!e||!e.items||e.items.length===0)return null;const i=e.items.map(p=>p.label),c=e.items.map(p=>p.value);return{labels:i,datasets:[{label:"Top Products",data:c,backgroundColor:["#7367F0","#FF9F43","#28C76F","#EA5455","#00CFE8"],borderWidth:2}]}}),Q=h(()=>{const e=V.value.recent_payments;return Array.isArray(e)?e:(e==null?void 0:e.rows)||[]}),oe=h(()=>{const e=V.value.monthly_paid_commissions;return Array.isArray(e)?e:(e==null?void 0:e.rows)||[]});return{stats:T,chartData:a,tableData:V,loading:t,error:v,lastUpdated:C,filters:m,isLoading:S,hasData:E,activeAffiliates:q,totalOrders:N,totalRevenue:M,totalCommissions:R,pendingPayments:z,pendingTickets:I,ordersByPeriodChart:_,monthlyRevenueChart:r,topAffiliatesChart:x,topProductsChart:B,recentPayments:Q,monthlyPaidCommissions:oe,fetchStats:O,fetchChartData:j,fetchTableData:P,updateFilters:d,refreshAll:l,clearData:y}}),xe={class:"admin-dashboard"},ke={class:"d-flex align-center justify-space-between mb-6"},Ve={class:"text-h4 font-weight-bold mb-1"},Se={class:"text-body-1 text-medium-emphasis"},Fe={class:"d-flex align-center gap-3"},Ae={class:"d-flex align-center justify-space-between mb-4 flex-wrap gap-4"},Te={class:"text-h5 font-weight-bold"},Pe={class:"text-body-2 text-disabled mb-0"},Ee={class:"d-flex align-center gap-3 flex-wrap dashboard-header-actions"},ze={class:"d-flex align-center gap-2"},Ie={class:"period-selector-wrapper"},Le=ce({__name:"dashboard",setup(T){const{t:a}=ue(),{user:V}=ie(),t=De(),{showSuccess:v,showError:C}=be(),m=w("month"),S=w(null),E=w(!0),U=h(()=>[{title:a("admin_breadcrumb"),disabled:!1,href:"/admin"},{title:a("dashboard"),disabled:!0,href:"/admin/dashboard"}]),D=h(()=>{var d;return(d=t.stats)!=null&&d.cards?t.stats.cards.map(l=>({title:a(l.labelKey),value:typeof l.value=="object"?JSON.stringify(l.value):l.value,icon:q(l.key),color:N(l.key),prefix:["total_revenue","total_commissions","pending_payments"].includes(l.key)?"DH":void 0})):[]}),q=d=>({active_affiliates:"tabler-users",total_orders:"tabler-shopping-cart",total_revenue:"tabler-currency-dollar",total_commissions:"tabler-chart-line",pending_payments:"tabler-clock",pending_tickets:"tabler-ticket"})[d]||"tabler-chart-bar",N=d=>({active_affiliates:"primary",total_orders:"secondary",total_revenue:"success",total_commissions:"info",pending_payments:"warning",pending_tickets:"error"})[d]||"primary",M=h(()=>[{id:"orders_by_period",title:a("dashboard.admin.charts.orders_by_period.series.orders"),type:"bar",data:t.ordersByPeriodChart,cols:{cols:12,md:6},description:a("dashboard.admin.charts.orders_by_period.description")},{id:"monthly_revenue",title:a("dashboard.admin.charts.monthly_revenue.series.revenue"),type:"line",data:t.monthlyRevenueChart,cols:{cols:12,md:6},description:a("dashboard.admin.charts.monthly_revenue.description")},{id:"top_affiliates",title:a("dashboard.admin.charts.top_affiliates.title"),type:"bar",data:t.topAffiliatesChart,cols:{cols:12,md:6},description:a("dashboard.admin.charts.top_affiliates.description")},{id:"top_products",title:a("dashboard.admin.charts.top_products.title"),type:"doughnut",data:t.topProductsChart,cols:{cols:12,md:6},description:a("dashboard.admin.charts.top_products.description")}]),R=[{value:"month",label:a("dashboard.filters.period.month"),icon:"tabler-calendar-month"},{value:"quarter",label:a("dashboard.filters.period.quarter"),icon:"tabler-calendar-stats"},{value:"year",label:a("dashboard.filters.period.year"),icon:"tabler-calendar-year"}],z=async()=>{try{await t.refreshAll(),E.value&&v(a("dashboard_data_refreshed"))}catch{C(a("dashboard_refresh_failed"))}},I=async d=>{m.value=d,console.log("Admin Dashboard - Period changed to:",d);const l=new Date;let y;switch(d){case"month":y=new Date(l.getFullYear(),l.getMonth(),1);break;case"quarter":const r=Math.floor(l.getMonth()/3);y=new Date(l.getFullYear(),r*3,1);break;case"year":y=new Date(l.getFullYear(),0,1);break;default:y=new Date(l.getFullYear(),l.getMonth(),1)}const _={start:y.toISOString().split("T")[0],end:l.toISOString().split("T")[0]};console.log("Admin Dashboard - Date range:",_),t.updateFilters({dateRange:_,period:d}),console.log("Admin Dashboard - Refreshing data..."),await Promise.all([t.fetchStats(),t.fetchChartData("orders_by_period"),t.fetchChartData("monthly_revenue"),t.fetchChartData("top_affiliates"),t.fetchChartData("top_products"),t.fetchTableData("recent_payments"),t.fetchTableData("monthly_paid_commissions")]),console.log("Admin Dashboard - Data refreshed")},O=async()=>{try{await Promise.all([t.fetchChartData("orders_by_period"),t.fetchChartData("monthly_revenue"),t.fetchChartData("top_affiliates"),t.fetchChartData("top_products")]),v(a("dashboard.charts.refresh_success"))}catch{C(a("dashboard.charts.refresh_error"))}},j=()=>{try{const d={timestamp:new Date().toISOString(),period:m.value,stats:t.stats,charts:"standard"},l=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),y=URL.createObjectURL(l),_=document.createElement("a");_.href=y,_.download=`admin-dashboard-${m.value}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(y),v(a("dashboard.export.success"))}catch(d){console.error("Error exporting dashboard:",d),C(a("dashboard.export.error"))}},F=async d=>{try{await t.fetchChartData(d)}catch{C(a("dashboard.charts.load_error"))}},P=()=>{S.value&&clearInterval(S.value),E.value&&(S.value=setInterval(()=>{z()},300*1e3))};return me(async()=>{await z(),P()}),he(()=>{S.value&&clearInterval(S.value)}),pe(E,P),(d,l)=>{var _;const y=ne;return A(),Y("div",xe,[s(_e,{items:U.value},null,8,["items"]),f("div",ke,[f("div",null,[f("h1",Ve,u(n(a)("dashboard.admin.title")),1),f("p",Se,u(n(a)("dashboard.admin.welcome",{name:(_=n(V))==null?void 0:_.nom_complet})),1)]),f("div",Fe,[s(k,{color:"primary",variant:"outlined",loading:n(t).isLoading,onClick:z},{default:o(()=>[s(g,{start:"",icon:"tabler-refresh"}),b(" "+u(n(a)("dashboard.admin.refresh")),1)]),_:1},8,["loading"]),s(k,{color:"secondary",variant:"outlined",onClick:j},{default:o(()=>[s(g,{start:"",icon:"tabler-download"}),b(" "+u(n(a)("dashboard.admin.export")),1)]),_:1}),s(te,{modelValue:m.value,"onUpdate:modelValue":[l[0]||(l[0]=r=>m.value=r),I],items:R,"item-title":"label","item-value":"value",label:n(a)("dashboard.admin.period_filter"),variant:"outlined",density:"compact",style:{"min-width":"150px"}},{"prepend-inner":o(()=>[s(g,{icon:"tabler-calendar",size:"16"})]),_:1},8,["modelValue","label"])])]),n(t).error?(A(),$(se,{key:0,type:"error",variant:"tonal",class:"mb-6",closable:"","onClick:close":l[1]||(l[1]=r=>n(t).error=null)},{default:o(()=>[b(u(n(t).error),1)]),_:1})):X("",!0),s(G,{class:"mb-6"},{default:o(()=>[(A(!0),Y(Z,null,ee(D.value,(r,x)=>(A(),$(L,{key:x,cols:"12",sm:"6",lg:"4",xl:"2"},{default:o(()=>[s(le,{title:r.title,value:r.value,icon:r.icon,color:r.color,prefix:r.prefix,loading:n(t).loading.stats,error:n(t).error||void 0,size:"medium"},null,8,["title","value","icon","color","prefix","loading","error"])]),_:2},1024))),128))]),_:1}),s(G,{class:"mb-6"},{default:o(()=>[s(L,{cols:"12"},{default:o(()=>[f("div",Ae,[f("div",null,[f("h2",Te,u(n(a)("dashboard.admin.charts.title")),1),f("p",Pe,u(n(a)("dashboard.charts.explanation")),1)]),f("div",Ee,[f("div",ze,[s(k,{icon:"tabler-refresh",variant:"outlined",size:"small",loading:n(t).loading.charts,onClick:O},null,8,["loading"])]),f("div",Ie,[s(fe,{modelValue:m.value,"onUpdate:modelValue":[l[2]||(l[2]=r=>m.value=r),I],color:"primary",variant:"outlined",divided:"",mandatory:"",class:"d-none d-md-flex",style:{"border-radius":"6px"}},{default:o(()=>[s(k,{value:"month",size:"small",style:{"min-width":"80px"}},{default:o(()=>[s(g,{icon:"tabler-calendar-month",class:"me-1",size:"16"}),b(" "+u(n(a)("dashboard.filters.period.month")),1)]),_:1}),s(k,{value:"quarter",size:"small",style:{"min-width":"80px"}},{default:o(()=>[s(g,{icon:"tabler-calendar-stats",class:"me-1",size:"16"}),b(" "+u(n(a)("dashboard.filters.period.quarter")),1)]),_:1}),s(k,{value:"year",size:"small",style:{"min-width":"80px"}},{default:o(()=>[s(g,{icon:"tabler-calendar-year",class:"me-1",size:"16"}),b(" "+u(n(a)("dashboard.filters.period.year")),1)]),_:1})]),_:1},8,["modelValue"]),s(te,{modelValue:m.value,"onUpdate:modelValue":[l[3]||(l[3]=r=>m.value=r),I],items:R,"item-title":"label","item-value":"value",variant:"outlined",density:"compact",class:"d-flex d-md-none period-select-mobile",style:{"min-width":"120px","max-width":"140px"},"hide-details":""},{"prepend-inner":o(()=>[s(g,{size:"16",class:"me-1"},{default:o(()=>[b(u(m.value==="month"?"tabler-calendar-month":m.value==="quarter"?"tabler-calendar-stats":"tabler-calendar-year"),1)]),_:1})]),_:1},8,["modelValue"])])])])]),_:1}),(A(!0),Y(Z,null,ee(M.value,r=>(A(),$(L,ae({key:r.id,ref_for:!0},r.cols),{default:o(()=>[s(H,null,{default:o(()=>[s(ve,null,{default:o(()=>[s(J,{class:"d-flex align-center justify-space-between"},{default:o(()=>[f("span",null,u(r.title),1),s(ge,{text:r.description},{activator:o(({props:x})=>[s(g,ae({ref_for:!0},x,{icon:"tabler-info-circle",size:"16",class:"text-medium-emphasis"}),null,16)]),_:2},1032,["text"])]),_:2},1024),s(ye,{class:"text-body-2 text-medium-emphasis"},{default:o(()=>[b(u(r.description),1)]),_:2},1024)]),_:2},1024),s(K,null,{default:o(()=>{var x,B;return[s(y,{type:r.type,data:r.data,loading:n(t).loading.charts,error:n(t).error||void 0,onLoad:Q=>F(r.id)},null,8,["type","data","loading","error","onLoad"]),!r.data||((x=r.data.series)==null?void 0:x.length)===0&&((B=r.data.items)==null?void 0:B.length)===0?(A(),$(se,{key:0,type:"info",variant:"tonal",class:"mt-3"},{prepend:o(()=>[s(g,{icon:"tabler-lightbulb"})]),default:o(()=>[b(" "+u(n(a)("dashboard.charts.explanation")),1)]),_:1})):X("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1040))),128))]),_:1}),s(G,null,{default:o(()=>[s(L,{cols:"12",md:"6"},{default:o(()=>[s(H,null,{default:o(()=>[s(J,{class:"d-flex align-center justify-space-between"},{default:o(()=>[f("span",null,u(n(a)("dashboard.admin.tables.recent_payments")),1),s(k,{variant:"text",size:"small",onClick:l[4]||(l[4]=r=>n(t).fetchTableData("recent_payments"))},{default:o(()=>[s(g,{icon:"tabler-refresh"})]),_:1})]),_:1}),s(K,null,{default:o(()=>[s(re,{items:n(t).recentPayments,headers:[{title:n(a)("dashboard.admin.tables.columns.affiliate"),key:"affiliate"},{title:n(a)("dashboard.admin.tables.columns.amount"),key:"amount"},{title:n(a)("dashboard.admin.tables.columns.status"),key:"status"},{title:n(a)("dashboard.admin.tables.columns.date"),key:"date"}],loading:n(t).loading.tables,density:"compact","hide-default-footer":""},{"item.amount":o(({item:r})=>[b(u(r.amount.toLocaleString())+" DH ",1)]),"item.date":o(({item:r})=>[b(u(new Date(r.date).toLocaleDateString()),1)]),"item.status":o(({item:r})=>[s(we,{color:r.status==="paid"?"success":r.status==="pending"?"warning":"error",size:"small",variant:"tonal"},{default:o(()=>[b(u(r.status),1)]),_:2},1032,["color"])]),_:1},8,["items","headers","loading"])]),_:1})]),_:1})]),_:1}),s(L,{cols:"12",md:"6"},{default:o(()=>[s(H,null,{default:o(()=>[s(J,{class:"d-flex align-center justify-space-between"},{default:o(()=>[f("span",null,u(n(a)("dashboard.admin.tables.monthly_paid_commissions")),1),s(k,{variant:"text",size:"small",onClick:l[5]||(l[5]=r=>n(t).fetchTableData("monthly_paid_commissions"))},{default:o(()=>[s(g,{icon:"tabler-refresh"})]),_:1})]),_:1}),s(K,null,{default:o(()=>[s(re,{items:n(t).monthlyPaidCommissions,headers:[{title:n(a)("dashboard.admin.tables.columns.affiliate"),key:"affiliate"},{title:n(a)("dashboard.admin.tables.columns.amount"),key:"amount"},{title:n(a)("dashboard.admin.tables.columns.date"),key:"date"}],loading:n(t).loading.tables,density:"compact","hide-default-footer":""},{"item.amount":o(({item:r})=>[b(u(r.amount.toLocaleString())+" DH ",1)]),"item.date":o(({item:r})=>[b(u(new Date(r.date).toLocaleDateString()),1)]),_:1},8,["items","headers","loading"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),fa=Ce(Le,[["__scopeId","data-v-2b90a505"]]);export{fa as default};
