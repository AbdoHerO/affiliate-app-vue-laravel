import{d as ne,aL as ce,k as re,b8 as me,b7 as ue,r as de,V as $,w as A,o as _e,c as B,b as v,e as s,g as a,f as c,az as f,v as n,n as l,ac as T,t as u,h as x,m as z,b9 as pe,q as fe}from"./main-BGmfaZsq.js";import{u as ve}from"./commissions-Cql1Cmph.js";import{_ as he}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cd38G7fQ.js";import{useQuickConfirm as ge}from"./useConfirmAction-BkzLltMc.js";import{u as be}from"./useNotifications-TnKci45M.js";import{a as b,V as F}from"./VRow-Jzvhbj9T.js";import{V as k}from"./VCard-hQ_o7lvO.js";import{V as j}from"./VCardText-BzdllyhI.js";import{V as S}from"./VAvatar-CXniQsPN.js";import{V as ye}from"./VTextField-STn8GDXm.js";import{V as xe}from"./VSelect-BYn5Cf2R.js";import{V as ke}from"./VCheckbox-BzyjlTfe.js";import{V as we}from"./VDataTableServer-DSC9TVyZ.js";import{V as Ve}from"./VMenu-C3I-a7hP.js";import{V as Ce,a as D,b as N}from"./VList-DVfzin0E.js";import{V as M}from"./VChip-S_h5DeIW.js";import"./VBreadcrumbs-CXXoPXro.js";/* empty css              */import"./createSimpleFunctional-BjWjRu3X.js";import"./VImg-6pMKiBpi.js";import"./VField-BqE6uwOn.js";import"./forwardRefs-BxxmAO9z.js";import"./dialog-transition-BhMeiVQ2.js";import"./VOverlay-CvSSR2rW.js";import"./lazy-DgLfxsl0.js";import"./VCheckboxBtn-DO9961XV.js";import"./VDataTable-DvhM-cQy.js";import"./VPagination-BC-KRE9H.js";import"./VTable-CCkxOUtW.js";import"./filter-578zAk0s.js";import"./VDivider-oo2GmB8o.js";import"./ssrBoot-A30zOnZp.js";const je={class:"d-flex align-center"},Ae={class:"text-sm text-medium-emphasis mb-0"},Te={class:"text-h6"},ze={class:"text-xs text-success mb-0"},Se={class:"d-flex align-center"},De={class:"text-sm text-medium-emphasis mb-0"},Ne={class:"text-h6"},Me={class:"text-xs text-success mb-0"},Pe={class:"d-flex align-center"},Be={class:"text-sm text-medium-emphasis mb-0"},Ue={class:"text-h6"},$e={class:"text-xs text-success mb-0"},Fe={class:"d-flex align-center"},Re={class:"text-sm text-medium-emphasis mb-0"},Le={class:"text-h6"},Ie={class:"text-xs text-success mb-0"},qe={class:"d-flex align-center justify-space-between"},Ee={class:"d-flex align-center"},Oe={class:"font-weight-medium"},Ke={class:"d-flex gap-2"},Qe={class:"d-flex align-center"},Ge={class:"font-weight-medium"},He={class:"text-caption text-medium-emphasis"},Je={key:1,class:"text-medium-emphasis"},We={class:"font-weight-medium"},Xe={key:0},Ye={class:"font-weight-bold text-success"},Ze={class:"text-caption"},Mt=ne({__name:"index",setup(et){const{t:e}=ce(),R=re(),{showSuccess:w,showError:y}=be(),{confirm:V}=ge(),p=ve(),{commissions:L,loading:I,pagination:P,filters:m,summary:h}=me(p);ue();const d=de([]);$(()=>d.value.length>0);const q=$(()=>[{title:e("dashboard"),to:"/admin/dashboard"},{title:e("admin_commissions_title"),active:!0}]),E=[{value:"",text:e("all_statuses")},{value:"pending_calc",text:e("commission_status_pending_calc")},{value:"calculated",text:e("commission_status_calculated")},{value:"eligible",text:e("commission_status_eligible")},{value:"approved",text:e("commission_status_approved")},{value:"rejected",text:e("commission_status_rejected")},{value:"paid",text:e("commission_status_paid")},{value:"adjusted",text:e("commission_status_adjusted")},{value:"canceled",text:e("commission_status_canceled")}];e("all_types"),e("commission_type_sale"),e("commission_type_referral"),e("commission_type_bonus");const O=[{title:e("table_column_affiliate"),key:"affiliate.nom_complet",sortable:!0},{title:e("table_column_order"),key:"commande_id",sortable:!0},{title:"SKU",key:"sku",sortable:!1,width:"120px"},{title:e("table_column_order_type"),key:"order_type",sortable:!1},{title:e("table_column_type"),key:"type",sortable:!0},{title:e("admin_commissions_base_amount"),key:"base_amount",sortable:!0},{title:e("admin_commissions_rate"),key:"rate",sortable:!1},{title:e("admin_commissions_amount"),key:"amount",sortable:!0},{title:e("table_column_status"),key:"status",sortable:!0},{title:e("table_column_date"),key:"created_at",sortable:!0},{title:e("table_column_actions"),key:"actions",sortable:!1,width:120}],_=async()=>{await p.fetchCommissions(m.value)},K=async(o,r)=>{console.log("🔍 handleView called for commission:",o.id);const t=`/admin/commissions/${o.id}`;console.log("🎯 Navigating to:",t);try{p.clearCurrentCommission(),await R.push(t),console.log("✅ Navigation successful")}catch(i){console.error("❌ Navigation error:",i),y(e("commission_navigation_error"))}},Q=async o=>{if(await V({title:e("commission_approve_title"),text:e("commission_approve_confirm",{amount:o.amount,currency:o.currency}),confirmText:e("action_approve"),color:"success",type:"success"})){const t=await p.approveCommission(o.id);t.success?(w(t.message),await _()):y(t.message)}},G=async o=>{if(await V({title:e("commission_reject_title"),text:e("commission_reject_confirm",{amount:o.amount,currency:o.currency}),confirmText:e("action_reject"),color:"error",type:"error"})){const t=await p.rejectCommission(o.id,e("commission_default_reject_reason"));t.success?(w(t.message),await _()):y(t.message)}},H=async o=>{if(await V({title:e("commission_adjust_title"),text:e("commission_adjust_confirm",{amount:o.amount,currency:o.currency}),confirmText:e("action_adjust"),color:"warning",type:"warning"})){const t=parseFloat(o.amount)*.8,i=await p.adjustCommission(o.id,t,e("administrative_adjustment"));i.success?(w(i.message),await _()):y(i.message)}},J=async o=>{if(await V({title:e("action_mark_as_paid"),text:e("commission_confirm_payment",{amount:o.amount,currency:o.currency}),confirmText:e("action_confirm_payment"),color:"primary",type:"success"})){const t=await p.markAsPaid(o.id);t.success?(w(t.message),await _()):y(t.message)}},W=async()=>{if(d.value.length===0)return;if(await V({title:e("approve_selected_commissions"),text:e("confirm_approve_commissions",{count:d.value.length}),confirmText:e("approve_all"),color:"success",type:"success"})){const r=await p.bulkApprove(d.value);r.success?(w(r.message),d.value=[],await _()):y(r.message)}},X=async()=>{if(d.value.length===0)return;if(await V({title:e("commission_bulk_reject_title"),text:e("commission_bulk_reject_confirm",{count:d.value.length}),confirmText:e("action_reject_all"),color:"error",type:"error"})){const r=await p.bulkReject(d.value,e("commission_bulk_reject_reason"));r.success?(w(r.message),d.value=[],await _()):y(r.message)}},Y=o=>{m.value.page=o,_()},Z=o=>{m.value.per_page=o,m.value.page=1,_()},ee=o=>{m.value.sort===o?m.value.dir=m.value.dir==="asc"?"desc":"asc":(m.value.sort=o,m.value.dir="desc"),_()},C=()=>{m.value.page=1,_()},te=()=>{p.resetFilters(),_()};A(()=>m.value.status,C),A(()=>m.value.type,C),A(()=>m.value.user_id,C),A(()=>m.value.date_from,C),A(()=>m.value.date_to,C);const U=(o,r="MAD")=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:r}).format(o),ae=o=>new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),se=o=>({pending_calc:"secondary",calculated:"info",eligible:"primary",approved:"success",rejected:"error",paid:"success",adjusted:"warning",canceled:"secondary"})[o]||"secondary",oe=o=>({order_sample:"primary",exchange:"warning"})[o]||"secondary",le=o=>({order_sample:"Échantillon",exchange:"Échange"})[o]||o||"N/A",ie=o=>({pending_calc:e("commission_status_pending_calc"),calculated:e("commission_status_calculated"),eligible:e("commission_status_eligible"),approved:e("commission_status_approved"),rejected:e("commission_status_rejected"),paid:e("commission_status_paid"),adjusted:e("commission_status_adjusted"),canceled:e("commission_status_canceled")})[o]||o;return _e(async()=>{await _(),await p.fetchSummary()}),(o,r)=>(v(),B("div",null,[s(he,{items:q.value},null,8,["items"]),s(F,{class:"mb-6"},{default:a(()=>[s(b,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(k,null,{default:a(()=>[s(j,null,{default:a(()=>{var t,i;return[c("div",je,[s(S,{color:"info",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-calculator"})]),_:1}),c("div",null,[c("p",Ae,n(l(e)("commission_status_calculated")),1),c("h6",Te,n(((t=l(h))==null?void 0:t.count_calculated)||0),1),c("p",ze,n(((i=l(h))==null?void 0:i.total_calculated)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1}),s(b,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(k,null,{default:a(()=>[s(j,null,{default:a(()=>{var t,i;return[c("div",Se,[s(S,{color:"primary",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-check"})]),_:1}),c("div",null,[c("p",De,n(l(e)("commission_status_eligible")),1),c("h6",Ne,n(((t=l(h))==null?void 0:t.count_eligible)||0),1),c("p",Me,n(((i=l(h))==null?void 0:i.total_eligible)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1}),s(b,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(k,null,{default:a(()=>[s(j,null,{default:a(()=>{var t,i;return[c("div",Pe,[s(S,{color:"success",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-thumb-up"})]),_:1}),c("div",null,[c("p",Be,n(l(e)("commission_status_approved")),1),c("h6",Ue,n(((t=l(h))==null?void 0:t.count_approved)||0),1),c("p",$e,n(((i=l(h))==null?void 0:i.total_approved)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1}),s(b,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(k,null,{default:a(()=>[s(j,null,{default:a(()=>{var t,i;return[c("div",Fe,[s(S,{color:"success",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-cash"})]),_:1}),c("div",null,[c("p",Re,n(l(e)("commission_status_paid")),1),c("h6",Le,n(((t=l(h))==null?void 0:t.count_paid)||0),1),c("p",Ie,n(((i=l(h))==null?void 0:i.total_paid)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1})]),_:1}),s(k,{class:"mb-6"},{default:a(()=>[s(j,null,{default:a(()=>[s(F,null,{default:a(()=>[s(b,{cols:"12",md:"4"},{default:a(()=>[s(ye,{modelValue:l(m).q,"onUpdate:modelValue":r[0]||(r[0]=t=>l(m).q=t),label:l(e)("action_search"),placeholder:l(e)("filter_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:"","hide-details":""},null,8,["modelValue","label","placeholder"])]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(xe,{modelValue:l(m).status,"onUpdate:modelValue":r[1]||(r[1]=t=>l(m).status=t),items:E,"item-title":"text","item-value":"value",label:l(e)("table_column_status"),multiple:"",chips:"",clearable:"","hide-details":""},null,8,["modelValue","label"])]),_:1}),s(b,{cols:"12",md:"2"},{default:a(()=>[s(ke,{modelValue:l(m).eligible_only,"onUpdate:modelValue":r[2]||(r[2]=t=>l(m).eligible_only=t),label:l(e)("commission_eligible_only"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),s(b,{cols:"12",md:"3",class:"d-flex align-center gap-2"},{default:a(()=>[s(T,{color:"primary",variant:"elevated",onClick:C},{default:a(()=>[u(n(l(e)("action_filter")),1)]),_:1}),s(T,{color:"secondary",variant:"outlined",onClick:te},{default:a(()=>[u(n(l(e)("action_reset")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(pe,null,{default:a(()=>[d.value.length>0?(v(),x(k,{key:0,class:"mb-6",color:"primary",variant:"tonal"},{default:a(()=>[s(j,null,{default:a(()=>[c("div",qe,[c("div",Ee,[s(f,{icon:"tabler-check",class:"me-2"}),c("span",Oe,n(l(e)("commission_selected_count",{count:d.value.length})),1)]),c("div",Ke,[s(T,{color:"success",variant:"elevated",size:"small",onClick:W},{default:a(()=>[u(n(l(e)("action_approve_all")),1)]),_:1}),s(T,{color:"error",variant:"elevated",size:"small",onClick:X},{default:a(()=>[u(n(l(e)("action_reject_all")),1)]),_:1})])])]),_:1})]),_:1})):z("",!0)]),_:1}),s(k,null,{default:a(()=>[s(we,{modelValue:d.value,"onUpdate:modelValue":r[3]||(r[3]=t=>d.value=t),headers:O,items:l(L),loading:l(I),"items-length":l(P).total,"items-per-page":l(P).per_page,page:l(P).current_page,"show-select":"","item-value":"id","onUpdate:page":Y,"onUpdate:itemsPerPage":Z,"onUpdate:sortBy":ee},{"item.affiliate.nom_complet":a(({item:t})=>{var i,g;return[c("div",Qe,[s(S,{size:"32",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-user"})]),_:1}),c("div",null,[c("div",Ge,n(((i=t.affiliate)==null?void 0:i.nom_complet)||l(e)("not_available")),1),c("div",He,n((g=t.affiliate)==null?void 0:g.email),1)])])]}),"item.commande_id":a(({item:t})=>[s(M,{to:`/admin/orders/${t.commande_id}`,color:"primary",variant:"outlined",size:"small"},{default:a(()=>{var i;return[u(n((i=t.commande_id)==null?void 0:i.slice(-8)),1)]}),_:2},1032,["to"])]),"item.sku":a(({item:t})=>{var i,g;return[(g=(i=t.commande_article)==null?void 0:i.produit)!=null&&g.sku?(v(),x(M,{key:0,size:"small",color:"secondary",variant:"outlined",class:"font-mono"},{default:a(()=>[u(n(t.commande_article.produit.sku),1)]),_:2},1024)):(v(),B("span",Je,"—"))]}),"item.order_type":a(({item:t})=>{var i;return[s(M,{size:"small",color:oe((i=t.commande_article)==null?void 0:i.type_command),variant:"tonal"},{default:a(()=>{var g;return[u(n(le((g=t.commande_article)==null?void 0:g.type_command)),1)]}),_:2},1032,["color"])]}),"item.base_amount":a(({item:t})=>[c("span",We,n(U(t.base_amount,t.currency)),1)]),"item.rate":a(({item:t})=>[t.rate?(v(),B("span",Xe,n(t.rate)+"%",1)):(v(),x(M,{key:1,color:"info",variant:"tonal",size:"small"},{default:a(()=>[u(n(l(e)("commission_rate_fixed")),1)]),_:1}))]),"item.amount":a(({item:t})=>[c("span",Ye,n(U(t.amount,t.currency)),1)]),"item.status":a(({item:t})=>[s(M,{color:se(t.status),variant:"tonal",size:"small"},{default:a(()=>[u(n(ie(t.status)),1)]),_:2},1032,["color"])]),"item.created_at":a(({item:t})=>[c("span",Ze,n(ae(t.created_at)),1)]),"item.actions":a(({item:t})=>[s(Ve,null,{activator:a(({props:i})=>[s(T,fe({icon:"tabler-dots-vertical",size:"small",variant:"text"},i),null,16)]),default:a(()=>[s(Ce,null,{default:a(()=>[s(D,{onClick:i=>K(t)},{prepend:a(()=>[s(f,{icon:"tabler-eye",size:"20"})]),default:a(()=>[s(N,null,{default:a(()=>[u(n(l(e)("action_view_details")),1)]),_:1})]),_:2},1032,["onClick"]),t.can_be_approved?(v(),x(D,{key:0,onClick:i=>Q(t)},{prepend:a(()=>[s(f,{icon:"tabler-check",size:"20",color:"success"})]),default:a(()=>[s(N,null,{default:a(()=>[u(n(l(e)("action_approve")),1)]),_:1})]),_:2},1032,["onClick"])):z("",!0),t.can_be_rejected?(v(),x(D,{key:1,onClick:i=>G(t)},{prepend:a(()=>[s(f,{icon:"tabler-x",size:"20",color:"error"})]),default:a(()=>[s(N,null,{default:a(()=>[u(n(l(e)("action_reject")),1)]),_:1})]),_:2},1032,["onClick"])):z("",!0),t.can_be_adjusted?(v(),x(D,{key:2,onClick:i=>H(t)},{prepend:a(()=>[s(f,{icon:"tabler-edit",size:"20",color:"warning"})]),default:a(()=>[s(N,null,{default:a(()=>[u(n(l(e)("action_adjust")),1)]),_:1})]),_:2},1032,["onClick"])):z("",!0),t.status==="approved"&&!t.paid_at?(v(),x(D,{key:3,onClick:i=>J(t)},{prepend:a(()=>[s(f,{icon:"tabler-cash",size:"20",color:"primary"})]),default:a(()=>[s(N,null,{default:a(()=>[u(n(l(e)("action_mark_as_paid")),1)]),_:1})]),_:2},1032,["onClick"])):z("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","items","loading","items-length","items-per-page","page"])]),_:1})]))}});export{Mt as default};
