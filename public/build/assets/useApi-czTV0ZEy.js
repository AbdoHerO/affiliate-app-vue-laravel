import{aL as f,cq as l,b7 as s,k as d,cr as h}from"./main-DEzoUo6n.js";function _(r,e){try{const{t}=f();return e&&r==="error_server_error"?t(r,{status:e}):t(r)}catch{return{error_validation_failed:"Validation failed",error_conflict:"Conflict occurred",error_authentication_required:"Authentication required",error_access_forbidden:"Access forbidden",error_resource_not_found:"Resource not found",error_server_error:`Server error (${e||"unknown"})`,error_generic:"An error occurred"}[r]||"An error occurred"}}function m(r,e=0,t="Error"){const o=r==null?void 0:r.errors;let a=r==null?void 0:r.message;if(!a)if(o&&Object.keys(o).length>0)a=Object.values(o).flat().join(" | ");else{const n=e===422?"error_validation_failed":e===409?"error_conflict":e===401?"error_authentication_required":e===403?"error_access_forbidden":e===404?"error_resource_not_found":e>=500?"error_server_error":"error_generic";a=_(n,e)}return{status:e,message:a,errors:o,raw:r}}async function b(r){const e=r.headers.get("content-type")||"";let t=null;try{r.status===204?t=null:e.includes("application/json")?t=await r.json():t=await r.text()}catch(o){console.warn("Failed to parse response body:",o)}return m(t,r.status,r.statusText)}const g=()=>{const r="https://affiliate.moriny.com/api";return r.trim().length>0?r.trim():"/api"},F=l({baseUrl:g(),fetchOptions:{headers:{Accept:"application/json"},credentials:"include"},options:{refetch:!0,async beforeFetch({url:r,options:e}){var i;const o=s().token||localStorage.getItem("auth_token");e.headers={Accept:"application/json",...e.headers},o&&(e.headers={...e.headers,Authorization:`Bearer ${o}`});const a=(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content");a&&(e.headers={...e.headers,"X-CSRF-TOKEN":a});const n=e.body;if(typeof FormData<"u"&&n instanceof FormData||n&&typeof n=="object"&&typeof n.append=="function"&&typeof n.get=="function"&&(n[Symbol.toStringTag]==="FormData"||Object.prototype.toString.call(n)==="[object FormData]")){if(e.headers["Content-Type"]){const{["Content-Type"]:u,...c}=e.headers;e.headers=c}}else if(!e.headers["Content-Type"])e.headers={...e.headers,"Content-Type":"application/json"};else if(e.headers["Content-Type"]==="application/json"&&n instanceof FormData){const{["Content-Type"]:u,...c}=e.headers;e.headers=c}return{options:e}},async afterFetch(r){const{data:e,response:t}=r;if(t.status===401){s().clearAuth();const n=d();n.currentRoute.value.name!=="login"&&n.push({name:"login"})}let o=null;try{o=h(e)}catch{}return{data:o,response:t}},async onFetchError(r){const{response:e}=r;if((e==null?void 0:e.status)===401&&s().clearAuth(),e){const t=await b(e);r.error=t}return r}}});export{b as n,F as u};
