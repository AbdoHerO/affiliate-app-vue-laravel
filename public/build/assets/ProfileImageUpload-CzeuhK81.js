import{d as S,aL as j,b7 as D,r as f,w as E,V as M,c as o,b as s,m as d,f as c,t as v,v as u,e as h,aU as N,h as L,ac as w,g as V,n as g,F as T,j as q}from"./main-BW7J9dbc.js";import{g as R}from"./imageUtils-BBj2mArv.js";import{V as $}from"./VAvatar-CBx3oh99.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"profile-image-upload"},G={key:0,class:"text-body-2 text-high-emphasis mb-2 d-block"},H={key:0,class:"text-error"},J={class:"d-flex align-center gap-4"},K={class:"position-relative"},Q={key:0,class:"position-absolute top-0 left-0 w-100 h-100 d-flex align-center justify-center",style:{background:"rgba(0,0,0,0.5)","border-radius":"50%"}},X={class:"flex-grow-1"},Y={class:"d-flex gap-2 mb-2"},Z={class:"text-caption text-disabled"},ee={key:0,class:"text-caption text-success mt-1"},ae={key:1,class:"text-error text-caption mt-2"},te=S({__name:"ProfileImageUpload",props:{modelValue:{},label:{default:"Profile Image"},placeholder:{default:"Choose profile image"},errorMessages:{},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(x,{emit:F}){const _=x,b=F,{t:r}=j(),B=D(),m=f(),i=f(null),n=f(""),p=f(!1);E(()=>_.modelValue,e=>{e&&!i.value&&(n.value=e)},{immediate:!0});const C=M(()=>R(n.value)),I=()=>{var e;(e=m.value)==null||e.click()},U=async e=>{var y;const a=(y=e.target.files)==null?void 0:y[0];if(!a)return;if(!a.type.startsWith("image/")){console.error("Please select an image file");return}if(a.size>5*1024*1024){console.error("File size must be less than 5MB");return}i.value=a;const t=new FileReader;t.onload=A=>{var k;n.value=(k=A.target)==null?void 0:k.result},t.readAsDataURL(a),await z(a)},z=async e=>{p.value=!0;try{const l=new FormData;l.append("profile_image",e);const a=await fetch("/api/upload/profile-image",{method:"POST",body:l,headers:{Authorization:`Bearer ${B.token}`,Accept:"application/json"}});if(!a.ok)throw new Error(`Upload failed: ${a.statusText}`);const t=await a.json();if(t.success)b("update:modelValue",t.url),console.log("File uploaded successfully:",e.name);else throw new Error(t.message||r("components_upload_failed"))}catch(l){console.error("Upload failed:",l),i.value=null,n.value=_.modelValue||"",alert(r("components_upload_failed")+": "+(l instanceof Error?l.message:r("components_unknown_error")))}finally{p.value=!1}},P=()=>{i.value=null,n.value="",b("update:modelValue",""),m.value&&(m.value.value="")};return(e,l)=>{var a;return s(),o("div",W,[e.label?(s(),o("label",G,[v(u(e.label)+" ",1),e.required?(s(),o("span",H,"*")):d("",!0)])):d("",!0),c("div",J,[c("div",K,[h($,{size:"80",image:C.value,class:"border"},null,8,["image"]),p.value?(s(),o("div",Q,[h(N,{indeterminate:"",color:"white",size:"24"})])):d("",!0)]),c("div",X,[c("div",Y,[h(w,{size:"small",color:"primary","prepend-icon":"tabler-upload",disabled:e.disabled||p.value,onClick:I},{default:V(()=>[v(u(i.value?g(r)("change_image"):g(r)("upload_image")),1)]),_:1},8,["disabled"]),n.value?(s(),L(w,{key:0,size:"small",variant:"outlined",color:"error","prepend-icon":"tabler-trash",disabled:e.disabled||p.value,onClick:P},{default:V(()=>[v(u(g(r)("remove")),1)]),_:1},8,["disabled"])):d("",!0)]),c("div",Z,u(g(r)("upload_image_hint")),1),i.value?(s(),o("div",ee,u(i.value.name),1)):d("",!0)])]),(a=e.errorMessages)!=null&&a.length?(s(),o("div",ae,[(s(!0),o(T,null,q(e.errorMessages,t=>(s(),o("div",{key:t},u(t),1))),128))])):d("",!0),c("input",{ref_key:"fileInput",ref:m,type:"file",accept:"image/*",style:{display:"none"},onChange:U},null,544)])}}}),ie=O(te,[["__scopeId","data-v-535181fd"]]);export{ie as P};
