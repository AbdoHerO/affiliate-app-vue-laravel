import{b5 as xe,r as m,V as S,b6 as L,d as ie,aL as re,h as N,b as j,g as t,e as a,f as i,az as P,v as o,ac as k,t as h,w as ye,o as Ve,c as we,m as I,n as s,q as O,aW as ke}from"./main-BW7J9dbc.js";import{u as Ce}from"./useNotifications-C-RqLAHj.js";import{V as T,c as G}from"./VCard-BBEboEsQ.js";import{V as R}from"./VCardText-CXwuP4rm.js";import{V as M}from"./VAvatar-CBx3oh99.js";import{V as H}from"./VDialog-BYRvlSU6.js";import{a as E,V as te}from"./VRow-CGHQgNV4.js";import{V as Ae}from"./VTextField-DCEu5f_P.js";import{V as Q}from"./VSelect-BbnjVQGu.js";import{V as Te}from"./VDataTableServer-OmbqW_h9.js";import{V as W}from"./VTooltip-DmGX3M8u.js";import{V as le}from"./VBadge-Dc6I7voy.js";import{V as se}from"./VChip-Dc9HlRo1.js";import{V as oe}from"./VTextarea-Wxm7h69M.js";import"./createSimpleFunctional-468wPgla.js";import"./VImg-NyJdDnCF.js";import"./VOverlay-CpnKYLAB.js";import"./forwardRefs-t39oHzh6.js";import"./lazy-CTr8uHza.js";import"./dialog-transition-C3MiiA6M.js";/* empty css              */import"./VField-ECDxRtcR.js";import"./VList-BrmO1UK3.js";import"./ssrBoot-DTcmQToe.js";import"./VDivider-C4kHsR9g.js";import"./VMenu-DTZ6uDZD.js";import"./VCheckboxBtn-BRmrHq-R.js";import"./VDataTable-Cjf3VvYQ.js";import"./VPagination-D6oKxvR6.js";import"./VTable-CglbVig3.js";import"./filter-BV1I079x.js";const Se=xe("affiliateApplications",()=>{const x=m([]),e=m({pending_approval:0,email_not_verified:0,approved_applications:0,refused_applications:0,recent_signups:0}),n=m(!1),p=m(new Set),y=m(null),C=m({current_page:1,last_page:1,per_page:15,total:0}),b=m({page:1,perPage:15,sort:"created_at",dir:"desc"}),z=S(()=>x.value.length>0),A=S(()=>n.value),V=u=>p.value.has(u),F=async u=>{var g,f;n.value=!0,y.value=null;try{u&&Object.assign(b.value,u);const d=await L.get("admin/affiliate-applications",{params:b.value});if(d.data.success)x.value=d.data.data,C.value=d.data.pagination;else throw new Error(d.data.message||"Failed to fetch applications")}catch(d){y.value=((f=(g=d.response)==null?void 0:g.data)==null?void 0:f.message)||d.message||"Failed to fetch applications",console.error("Error fetching applications:",d)}finally{n.value=!1}},U=async()=>{try{const u=await L.get("/admin/affiliate-applications/stats");u.data.success&&(e.value=u.data.data)}catch(u){console.error("Error fetching stats:",u)}};return{applications:x,stats:e,loading:n,resendingIds:p,error:y,pagination:C,filters:b,hasApplications:z,isLoading:A,isResending:V,fetchApplications:F,fetchStats:U,approveApplication:async(u,g)=>{var f,d;try{const v=await L.post(`/admin/affiliate-applications/${u}/approve`,{reason:g});if(v.data.success){const q=x.value.findIndex(w=>w.id===u);return q!==-1&&(x.value[q].approval_status="approved"),await U(),v.data}else throw new Error(v.data.message||"Failed to approve application")}catch(v){throw new Error(((d=(f=v.response)==null?void 0:f.data)==null?void 0:d.message)||v.message||"Failed to approve application")}},refuseApplication:async(u,g)=>{var f,d;try{const v=await L.post(`/admin/affiliate-applications/${u}/refuse`,{reason:g});if(v.data.success){const q=x.value.findIndex(w=>w.id===u);return q!==-1&&(x.value[q].approval_status="refused",x.value[q].refusal_reason=g),await U(),v.data}else throw new Error(v.data.message||"Failed to refuse application")}catch(v){throw new Error(((d=(f=v.response)==null?void 0:f.data)==null?void 0:d.message)||v.message||"Failed to refuse application")}},resendVerification:async u=>{var g,f;p.value.add(u);try{const d=await L.post(`admin/affiliate-applications/${u}/resend-verification`);if(d.data.success)return d.data;throw new Error(d.data.message||"Failed to resend verification")}catch(d){throw new Error(((f=(g=d.response)==null?void 0:g.data)==null?void 0:f.message)||d.message||"Failed to resend verification")}finally{p.value.delete(u)}},resetFilters:()=>{b.value={page:1,perPage:15,sort:"created_at",dir:"desc"}}}}),ze={class:"text-h5 mb-4"},Fe={class:"text-body-1 mb-6"},Ue=ie({__name:"ConfirmDialog",props:{modelValue:{type:Boolean},title:{default:"Confirmer l'action"},text:{default:"Êtes-vous sûr de vouloir continuer ?"},confirmText:{default:"Confirmer"},cancelText:{default:"Annuler"},color:{default:"primary"},icon:{default:"tabler-alert-circle"},loading:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","cancel"],setup(x,{emit:e}){const{t:n}=re(),p=x,y=e,C=S(()=>p.title||n("dialogs.confirmAction")),b=S(()=>p.text||n("dialogs.confirmMessage")),z=S(()=>p.confirmText||n("actions.confirm")),A=S(()=>p.cancelText||n("actions.cancel")),V=_=>{y("update:modelValue",_)},F=()=>{y("confirm"),V(!1)},U=()=>{y("cancel"),V(!1)};return(_,B)=>(j(),N(H,{"model-value":p.modelValue,"max-width":"500",persistent:"","onUpdate:modelValue":V},{default:t(()=>[a(T,{class:"text-center pa-6"},{default:t(()=>[a(R,null,{default:t(()=>[a(M,{size:"88",color:p.color,variant:"tonal",class:"mb-6"},{default:t(()=>[a(P,{icon:p.icon,size:"48"},null,8,["icon"])]),_:1},8,["color"]),i("h5",ze,o(C.value),1),i("p",Fe,o(b.value),1)]),_:1}),a(G,{class:"justify-center gap-3"},{default:t(()=>[a(k,{color:p.color,variant:"elevated",loading:p.loading,onClick:F},{default:t(()=>[h(o(z.value),1)]),_:1},8,["color","loading"]),a(k,{color:"secondary",variant:"outlined",disabled:p.loading,onClick:U},{default:t(()=>[h(o(A.value),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),De={class:"d-flex flex-column gap-6"},Ee={class:"d-flex justify-space-between align-center mb-6"},Re={class:"text-h4 font-weight-bold mb-1"},$e={class:"text-body-1 mb-0"},qe={class:"text-h4"},Pe={class:"text-body-2"},Be={class:"text-h4"},je={class:"text-body-2"},Le={class:"text-h4"},Ne={class:"text-body-2"},Ie={class:"text-h4"},Me={class:"text-body-2"},Oe={class:"text-h4"},Qe={class:"text-body-2"},We={class:"d-flex align-center gap-3"},Ge={class:"font-weight-medium"},He={class:"text-caption text-medium-emphasis"},Je={class:"text-body-2"},Ke={class:"text-body-2"},Xe={class:"d-flex gap-1"},Ye={class:"text-center py-8"},Ze={class:"text-h6 mb-2"},ea={class:"text-body-2 text-medium-emphasis"},aa={class:"text-h5 mb-4"},ta={class:"text-body-1 mb-6"},la={class:"text-medium-emphasis"},sa={class:"text-h5 mb-4"},oa={class:"text-body-1 mb-6"},ia={class:"text-medium-emphasis"},Ba=ie({__name:"affiliates",setup(x){const{t:e}=re(),n=Se(),{showSuccess:p,showError:y}=Ce(),C=m(""),b=m(""),z=m(""),A=m(15),V=m(!1),F=m(!1),U=m(!1),_=m(null),B=m(""),$=m(""),J=S(()=>n.isLoading),u=S(()=>n.applications),g=S(()=>n.pagination),f=S(()=>n.stats),d=[{title:e("table_column_user"),key:"user",sortable:!1},{title:e("table_column_email"),key:"email",sortable:!0},{title:e("table_column_phone"),key:"telephone",sortable:!1},{title:e("table_column_bank"),key:"bank_type",sortable:!1},{title:e("table_column_email_verified"),key:"email_verified",sortable:!0},{title:e("table_column_approval_status"),key:"approval_status",sortable:!0},{title:e("table_column_created_at"),key:"created_at",sortable:!0},{title:e("table_column_actions"),key:"actions",sortable:!1}],v=[{title:e("filter_all"),value:""},{title:e("affiliate_status_pending_approval"),value:"pending_approval"},{title:e("affiliate_status_approved"),value:"approved"},{title:e("affiliate_status_refused"),value:"refused"}],q=[{title:e("filter_all"),value:""},{title:e("email_verified"),value:"true"},{title:e("email_not_verified"),value:"false"}],w=async()=>{await n.fetchApplications({q:C.value||void 0,approval_status:b.value||void 0,email_verified:z.value||void 0,perPage:A.value})};let K;const ne=()=>{clearTimeout(K),K=setTimeout(()=>{n.filters.page=1,w()},300)};ye([C,b,z,A],()=>{ne()},{deep:!0});const ce=c=>{n.filters.page=c,w()},de=c=>{c.length>0&&(n.filters.sort=c[0].key,n.filters.dir=c[0].order,w())},ue=c=>{_.value=c,B.value="",V.value=!0},pe=c=>{_.value=c,$.value="",F.value=!0},fe=async()=>{if(_.value)try{await n.approveApplication(_.value.id,B.value),p(e("affiliate_approved_success")),V.value=!1,w()}catch(c){y(c.message||e("error_during_approval"))}},_e=async()=>{if(!(!_.value||!$.value.trim()))try{await n.refuseApplication(_.value.id,$.value),p(e("affiliate_refused_success")),F.value=!1,w()}catch(c){y(c.message||e("error_during_refusal"))}},me=c=>{_.value=c,U.value=!0},ve=async()=>{if(_.value)try{await n.resendVerification(_.value.id),p(e("verification_email_sent_success"))}catch(c){y(c.message||e("error_sending_email"))}},X=c=>{switch(c){case"approved":return"success";case"pending_approval":return"warning";case"refused":return"error";default:return"default"}},ge=c=>{switch(c){case"approved":return e("affiliate_status_approved");case"pending_approval":return e("affiliate_status_pending_approval_short");case"refused":return e("affiliate_status_refused");default:return c}},be=c=>{switch(c){case"approved":return"✓";case"pending_approval":return"⏳";case"refused":return"✗";default:return"?"}},he=c=>new Date(c).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),Y=()=>{C.value="",b.value="",z.value="",n.resetFilters(),w()};return Ve(async()=>{await n.fetchStats(),await w()}),(c,r)=>{var Z,ee;return j(),we("div",De,[i("div",Ee,[i("div",null,[i("h1",Re,o(s(e)("affiliate_approval_queue_title")),1),i("p",$e,o(s(e)("affiliate_approval_queue_description")),1)]),a(k,{color:"primary",variant:"elevated",onClick:Y},{default:t(()=>[a(P,{start:"",icon:"tabler-refresh"}),h(" "+o(s(e)("refresh")),1)]),_:1})]),f.value?(j(),N(te,{key:0,class:"mb-6"},{default:t(()=>[a(E,{cols:"12",md:"2"},{default:t(()=>[a(T,{variant:"tonal",color:"warning"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>[i("div",qe,o(f.value.pending_approval||0),1),i("div",Pe,o(s(e)("affiliate_status_pending_approval_short")),1)]),_:1})]),_:1})]),_:1}),a(E,{cols:"12",md:"2"},{default:t(()=>[a(T,{variant:"tonal",color:"info"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>[i("div",Be,o(f.value.email_not_verified||0),1),i("div",je,o(s(e)("email_not_verified")),1)]),_:1})]),_:1})]),_:1}),a(E,{cols:"12",md:"2"},{default:t(()=>[a(T,{variant:"tonal",color:"success"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>[i("div",Le,o(f.value.approved_applications||0),1),i("div",Ne,o(s(e)("affiliate_status_approved")),1)]),_:1})]),_:1})]),_:1}),a(E,{cols:"12",md:"2"},{default:t(()=>[a(T,{variant:"tonal",color:"error"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>[i("div",Ie,o(f.value.refused_applications||0),1),i("div",Me,o(s(e)("affiliate_status_refused")),1)]),_:1})]),_:1})]),_:1}),a(E,{cols:"12",md:"2"},{default:t(()=>[a(T,{variant:"tonal",color:"primary"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>[i("div",Oe,o(f.value.recent_signups||0),1),i("div",Qe,o(s(e)("last_7_days")),1)]),_:1})]),_:1})]),_:1})]),_:1})):I("",!0),a(T,{class:"mb-6"},{default:t(()=>[a(R,null,{default:t(()=>[a(te,{class:"align-center"},{default:t(()=>[a(E,{cols:"12",md:"4"},{default:t(()=>[a(Ae,{modelValue:C.value,"onUpdate:modelValue":r[0]||(r[0]=l=>C.value=l),label:s(e)("action_search"),placeholder:s(e)("search_placeholder_name_email_phone"),"prepend-inner-icon":"tabler-search",clearable:"",density:"compact"},null,8,["modelValue","label","placeholder"])]),_:1}),a(E,{cols:"12",md:"3"},{default:t(()=>[a(Q,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=l=>b.value=l),label:s(e)("table_column_approval_status"),items:v,clearable:"",density:"compact"},null,8,["modelValue","label"])]),_:1}),a(E,{cols:"12",md:"3"},{default:t(()=>[a(Q,{modelValue:z.value,"onUpdate:modelValue":r[2]||(r[2]=l=>z.value=l),label:s(e)("table_column_email_verified"),items:q,clearable:"",density:"compact"},null,8,["modelValue","label"])]),_:1}),a(E,{cols:"12",md:"2",class:"d-flex gap-2"},{default:t(()=>[a(Q,{modelValue:A.value,"onUpdate:modelValue":r[3]||(r[3]=l=>A.value=l),label:s(e)("items_per_page"),items:[10,15,25,50],density:"compact"},null,8,["modelValue","label"]),a(k,{color:"secondary",variant:"outlined",icon:"tabler-filter-off",onClick:Y})]),_:1})]),_:1})]),_:1})]),_:1}),a(T,null,{default:t(()=>[a(Te,{"items-per-page":A.value,"onUpdate:itemsPerPage":r[4]||(r[4]=l=>A.value=l),headers:d,items:u.value,"items-length":g.value.total,loading:J.value,page:g.value.current_page,"onUpdate:page":ce,"onUpdate:sortBy":de},{"item.user":t(({item:l})=>[i("div",We,[a(M,{size:"40",color:"primary",variant:"tonal"},{default:t(()=>[a(P,{icon:"tabler-user"})]),_:1}),i("div",null,[i("div",Ge,o(l.nom_complet),1),i("div",He," ID: "+o(l.id.slice(0,8)),1)])])]),"item.bank_type":t(({item:l})=>[i("div",Je,[a(P,{icon:"tabler-building-bank",size:"16",class:"me-2"}),h(" "+o(l.bank_type||s(e)("admin_affiliates_bank_not_provided")),1)])]),"item.email_verified":t(({item:l})=>[a(le,{color:l.email_verified_at?"success":"warning",content:l.email_verified_at?"✓":"!",inline:""},{default:t(()=>[a(se,{size:"small",color:l.email_verified_at?"success":"warning",variant:"tonal"},{default:t(()=>[h(o(l.email_verified_at?s(e)("admin_affiliates_email_verified"):s(e)("admin_affiliates_email_not_verified")),1)]),_:2},1032,["color"])]),_:2},1032,["color","content"])]),"item.approval_status":t(({item:l})=>[a(le,{color:X(l.approval_status),content:be(l.approval_status),inline:""},{default:t(()=>[a(se,{size:"small",color:X(l.approval_status),variant:"tonal"},{default:t(()=>[h(o(ge(l.approval_status)),1)]),_:2},1032,["color"])]),_:2},1032,["color","content"])]),"item.created_at":t(({item:l})=>[i("div",Ke,o(he(l.created_at)),1)]),"item.actions":t(({item:l})=>[i("div",Xe,[l.email_verified_at?I("",!0):(j(),N(W,{key:0,text:s(e)("admin_affiliates_resend_verification_tooltip")},{activator:t(({props:D})=>[a(k,O(D,{size:"small",color:"info",variant:"text",icon:"tabler-mail",loading:s(n).isResending(l.id),disabled:s(n).isResending(l.id),onClick:ke(ae=>me(l),["stop"])}),null,16,["loading","disabled","onClick"])]),_:2},1032,["text"])),l.approval_status==="pending_approval"?(j(),N(W,{key:1,text:s(e)("approve_request")},{activator:t(({props:D})=>[a(k,O(D,{size:"small",color:"success",variant:"text",icon:"tabler-check",onClick:ae=>ue(l)}),null,16,["onClick"])]),_:2},1032,["text"])):I("",!0),l.approval_status==="pending_approval"?(j(),N(W,{key:2,text:s(e)("refuse_request")},{activator:t(({props:D})=>[a(k,O(D,{size:"small",color:"error",variant:"text",icon:"tabler-x",onClick:ae=>pe(l)}),null,16,["onClick"])]),_:2},1032,["text"])):I("",!0)])]),"no-data":t(()=>[i("div",Ye,[a(P,{icon:"tabler-users-off",size:"64",class:"mb-4",color:"disabled"}),i("h3",Ze,o(s(e)("no_users_found")),1),i("p",ea,o(s(e)("no_users_match_criteria")),1)])]),_:1},8,["items-per-page","items","items-length","loading","page"])]),_:1}),a(H,{modelValue:V.value,"onUpdate:modelValue":r[7]||(r[7]=l=>V.value=l),"max-width":"600",persistent:""},{default:t(()=>[a(T,{class:"pa-6"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>{var l;return[a(M,{size:"88",color:"success",variant:"tonal",class:"mb-6"},{default:t(()=>[a(P,{icon:"tabler-check",size:"48"})]),_:1}),i("h5",aa,o(s(e)("approve_affiliation_request")),1),i("p",ta,[h(o(s(e)("approve_affiliate_confirm",{name:(l=_.value)==null?void 0:l.nom_complet}))+" ",1),r[12]||(r[12]=i("br",null,null,-1)),i("small",la,o(s(e)("user_account_created_automatically")),1)]),a(oe,{modelValue:B.value,"onUpdate:modelValue":r[5]||(r[5]=D=>B.value=D),label:s(e)("reason_optional"),placeholder:s(e)("approval_reason_placeholder"),rows:"3",variant:"outlined",class:"mb-4"},null,8,["modelValue","label","placeholder"])]}),_:1}),a(G,{class:"justify-center gap-3"},{default:t(()=>[a(k,{color:"success",variant:"elevated",onClick:fe},{default:t(()=>[h(o(s(e)("action_approve")),1)]),_:1}),a(k,{color:"secondary",variant:"outlined",onClick:r[6]||(r[6]=l=>V.value=!1)},{default:t(()=>[h(o(s(e)("action_cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(H,{modelValue:F.value,"onUpdate:modelValue":r[10]||(r[10]=l=>F.value=l),"max-width":"600",persistent:""},{default:t(()=>[a(T,{class:"pa-6"},{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>{var l;return[a(M,{size:"88",color:"error",variant:"tonal",class:"mb-6"},{default:t(()=>[a(P,{icon:"tabler-x",size:"48"})]),_:1}),i("h5",sa,o(s(e)("refuse_affiliation_request")),1),i("p",oa,[h(o(s(e)("refuse_affiliate_confirm",{name:(l=_.value)==null?void 0:l.nom_complet}))+" ",1),r[13]||(r[13]=i("br",null,null,-1)),i("small",ia,o(s(e)("action_requires_justification")),1)]),a(oe,{modelValue:$.value,"onUpdate:modelValue":r[8]||(r[8]=D=>$.value=D),label:s(e)("refusal_reason_required"),placeholder:s(e)("refusal_reason_placeholder"),variant:"outlined",rows:"3",error:!$.value.trim(),class:"mb-4"},null,8,["modelValue","label","placeholder","error"])]}),_:1}),a(G,{class:"justify-center gap-3"},{default:t(()=>[a(k,{color:"error",variant:"elevated",disabled:!$.value.trim(),onClick:_e},{default:t(()=>[h(o(s(e)("action_refuse")),1)]),_:1},8,["disabled"]),a(k,{color:"secondary",variant:"outlined",onClick:r[9]||(r[9]=l=>F.value=!1)},{default:t(()=>[h(o(s(e)("action_cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Ue,{modelValue:U.value,"onUpdate:modelValue":r[11]||(r[11]=l=>U.value=l),title:s(e)("resend_verification_email"),text:s(e)("resend_verification_confirm",{email:(Z=_.value)==null?void 0:Z.email}),"confirm-text":s(e)("action_resend"),"cancel-text":s(e)("action_cancel"),color:"info",icon:"tabler-mail",loading:s(n).isResending(((ee=_.value)==null?void 0:ee.id)||""),onConfirm:ve},null,8,["modelValue","title","text","confirm-text","cancel-text","loading"])])}}});export{Ba as default};
