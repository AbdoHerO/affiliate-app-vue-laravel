import{aY as h}from"./main-uLG9IIeX.js";function f(e,t=0){if(e==null)return{value:t,isValid:!1,original:e};const r=Number(e);return isNaN(r)||!isFinite(r)?{value:t,isValid:!1,original:e}:{value:r,isValid:!0,original:e}}function y(e,t=0){if(!Array.isArray(e))return[t];const r=e.map(n=>f(n,t).value);return r.every(n=>n===t)&&r.length>1?[t]:r.length>0?r:[t]}function v(e){if(!e||typeof e!="object")return{labels:["No Data"],datasets:[{label:"No Data",data:[0]}],isEmpty:!0};let t=[],r=[];if(e.labels&&e.datasets)t=Array.isArray(e.labels)?e.labels.map(String):["No Data"],r=Array.isArray(e.datasets)?e.datasets:[];else if(e.labels&&e.data)t=Array.isArray(e.labels)?e.labels.map(String):["No Data"],r=[{label:e.label||"Data",data:y(e.data),borderColor:e.borderColor,backgroundColor:e.backgroundColor,fill:e.fill}];else if(Array.isArray(e)){const o=y(e);t=o.map((s,l)=>`Item ${l+1}`),r=[{label:"Data",data:o}]}else t=["No Data"],r=[{label:"No Data",data:[0]}];const n=r.map(o=>({label:String(o.label||"Data"),data:y(o.data||[]),borderColor:o.borderColor,backgroundColor:o.backgroundColor,fill:o.fill})),a=n.some(o=>o.data.some(s=>s!==0));return{labels:t,datasets:n,isEmpty:!a}}function S(e){if(!e||typeof e!="object")return{value:0,delta:null,isValid:!1};const t=f(e.value||e.amount||e.total),r=e.delta!==void 0?f(e.delta).value:null;return{value:t.value,delta:r,currency:e.currency,unit:e.unit,isValid:t.isValid}}function w(e){return Array.isArray(e)?e.map(t=>{if(!t||typeof t!="object")return{};const r={};for(const[n,a]of Object.entries(t))typeof a=="number"||typeof a=="string"&&!isNaN(Number(a))?r[n]=f(a).value:r[n]=a;return r}):[]}function F(e,t={}){const{currency:r,unit:n,decimals:a=0,locale:o="en-US"}=t,s=f(e).value;if(r)return new Intl.NumberFormat(o,{style:"currency",currency:r==="MAD"?"USD":r,minimumFractionDigits:a,maximumFractionDigits:a}).format(s).replace("$",r==="MAD"?"MAD ":"$");const l=new Intl.NumberFormat(o,{minimumFractionDigits:a,maximumFractionDigits:a}).format(s);return n?`${l} ${n}`:l}function E(e){if(e==null)return{icon:"tabler-minus",color:"secondary",text:"N/A"};const t=f(e).value;return t>0?{icon:"tabler-trending-up",color:"success",text:`+${Math.abs(t).toFixed(1)}%`}:t<0?{icon:"tabler-trending-down",color:"error",text:`-${Math.abs(t).toFixed(1)}%`}:{icon:"tabler-minus",color:"secondary",text:"0%"}}function M(e,t,r,n,a,o="success"){return{title:String(t||""),subtitle:String(r||""),value:String(n||"0"),growth:String(a||"+0%"),chartData:Array.isArray(e)?e.map(f).map(s=>s.value):[0],color:String(o||"success")}}function _(e,t,r){const n=f(e).value,a=f(t).value,o=n+a;return{verified:n,pending:a,centerMetric:o>0?Math.round(n/o*100):0,centerLabel:String(r||"Rate")}}function D(e,t={}){const{columns:r,includeHeaders:n=!0,delimiter:a=",",dateFormat:o="YYYY-MM-DD HH:mm:ss"}=t;if(!e||e.length===0)return"";const s=r||Object.keys(e[0]).map(i=>({key:i,title:i.charAt(0).toUpperCase()+i.slice(1).replace(/_/g," ")})),l=[];if(n){const i=s.map(c=>p(c.title));l.push(i.join(a))}return e.forEach(i=>{const c=s.map(m=>{const b=i[m.key];return m.formatter?p(m.formatter(b)):p(u(b,t))});l.push(c.join(a))}),l.join(`
`)}function u(e,t){var r,n,a,o;return e==null?"":e instanceof Date?e.toISOString().split("T")[0]+" "+e.toTimeString().split(" ")[0]:typeof e=="number"?(r=t.numberFormat)!=null&&r.currency?new Intl.NumberFormat(t.numberFormat.locale||"en-US",{style:"currency",currency:t.numberFormat.currency==="MAD"?"USD":t.numberFormat.currency,minimumFractionDigits:t.numberFormat.decimals||2,maximumFractionDigits:t.numberFormat.decimals||2}).format(e).replace("$",t.numberFormat.currency==="MAD"?"MAD ":"$"):new Intl.NumberFormat(((n=t.numberFormat)==null?void 0:n.locale)||"en-US",{minimumFractionDigits:((a=t.numberFormat)==null?void 0:a.decimals)||0,maximumFractionDigits:((o=t.numberFormat)==null?void 0:o.decimals)||2}).format(e):typeof e=="boolean"?e?"Yes":"No":typeof e=="object"?JSON.stringify(e):String(e)}function p(e){return typeof e!="string"&&(e=String(e)),e.includes(",")||e.includes('"')||e.includes(`
`)||e.includes("\r")?'"'+e.replace(/"/g,'""')+'"':e}function d(e,t={}){const{filename:r="export.csv"}=t,n=D(e,t),a="\uFEFF",o=new Blob([a+n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(o);s.setAttribute("href",l),s.setAttribute("download",r.endsWith(".csv")?r:`${r}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function N(e,t){const r=[{key:"order_ref",title:"Order Reference"},{key:"date",title:"Date"},{key:"affiliate_name",title:"Affiliate"},{key:"customer_name",title:"Customer"},{key:"status",title:"Status"},{key:"items_count",title:"Items Count"},{key:"total",title:"Total (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:2}})},{key:"commission",title:"Commission (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:2}})}];d(e,{filename:t||`sales-orders-${new Date().toISOString().split("T")[0]}.csv`,columns:r})}function R(e,t){const r=[{key:"name",title:"Affiliate Name"},{key:"email",title:"Email"},{key:"orders_count",title:"Orders Count"},{key:"delivered_rate",title:"Delivered Rate (%)",formatter:n=>`${n}%`},{key:"total_sales",title:"Total Sales (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})},{key:"total_commission",title:"Total Commission (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})},{key:"total_payouts",title:"Total Payouts (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})},{key:"avg_order_value",title:"Average Order Value (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})},{key:"return_rate",title:"Return Rate (%)",formatter:n=>`${n}%`}];d(e,{filename:t||`affiliate-leaderboard-${new Date().toISOString().split("T")[0]}.csv`,columns:r})}function O(e,t){const r=[{key:"affiliate_name",title:"Affiliate Name"},{key:"order_ref",title:"Order Reference"},{key:"product_name",title:"Product Name"},{key:"type",title:"Commission Type"},{key:"base_amount",title:"Base Amount (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:2}})},{key:"rate",title:"Rate (%)",formatter:n=>`${n}%`},{key:"commission",title:"Commission (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:2}})},{key:"status",title:"Status"},{key:"rule_code",title:"Rule Code"},{key:"date",title:"Date"}];d(e,{filename:t||`commission-ledger-${new Date().toISOString().split("T")[0]}.csv`,columns:r})}function $(e,t){const r=[{key:"name",title:"Product Name"},{key:"orders_count",title:"Orders Count"},{key:"total_quantity",title:"Total Quantity Sold"},{key:"total_revenue",title:"Total Revenue (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})}];d(e,{filename:t||`top-products-${new Date().toISOString().split("T")[0]}.csv`,columns:r})}function T(e,t){const r=[{key:"name",title:"Affiliate Name"},{key:"email",title:"Email"},{key:"orders_count",title:"Orders Count"},{key:"delivered_rate",title:"Delivered Rate (%)",formatter:n=>`${n}%`},{key:"total_sales",title:"Total Sales (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})},{key:"total_commission",title:"Total Commission (MAD)",formatter:n=>u(n,{numberFormat:{currency:"MAD",decimals:0}})}];d(e,{filename:t||`top-affiliates-${new Date().toISOString().split("T")[0]}.csv`,columns:r})}async function x(e,t={}){const{filename:r="chart.png",width:n,height:a,backgroundColor:o="#ffffff",scale:s=2}=t;try{let l;try{const c=await h(()=>import("./html2canvas.esm-CBrSDip1.js"),[]);l=c.default||c}catch{console.warn("html2canvas not available, falling back to alternative method"),await A(e,r);return}(await l(e,{width:n,height:a,backgroundColor:o,scale:s,useCORS:!0,allowTaint:!0,logging:!1,onclone:c=>{const m=c.querySelector("[data-export]");m&&(m.style.fontFamily="inherit")}})).toBlob(c=>{if(c){const m=URL.createObjectURL(c);g(m,r),URL.revokeObjectURL(m)}else throw new Error("Failed to create blob from canvas")},"image/png",.95)}catch(l){throw console.error("Error exporting element as image:",l),new Error(`Failed to export image: ${l instanceof Error?l.message:"Unknown error"}`)}}async function A(e,t){try{if("getDisplayMedia"in navigator.mediaDevices)throw console.info("Using screen capture API as fallback"),new Error("Screen capture requires user interaction - please install html2canvas for automatic export");const r=e.textContent||e.innerText||"Chart content",n=new Blob([`Chart Export - ${new Date().toISOString()}

${r}`],{type:"text/plain"}),a=URL.createObjectURL(n);g(a,t.replace(".png",".txt")),URL.revokeObjectURL(a),console.warn("Exported as text file - install html2canvas for image export")}catch{throw new Error("Export failed: html2canvas package is required for image export. Please run: npm install html2canvas")}}function g(e,t){const r=document.createElement("a");r.href=e,r.download=t.endsWith(".png")?t:`${t}.png`,r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}async function k(e,t={}){const{filename:r="charts.png",layout:n="vertical",spacing:a=20,backgroundColor:o="#ffffff",title:s}=t;try{const l=e.map(c=>document.querySelector(c)).filter(Boolean);if(l.length===0)throw new Error("No chart elements found");const i=document.createElement("div");if(i.style.position="absolute",i.style.top="-9999px",i.style.left="-9999px",i.style.backgroundColor=o,i.style.padding="20px",n==="horizontal"?(i.style.display="flex",i.style.flexDirection="row",i.style.gap=`${a}px`):n==="vertical"?(i.style.display="flex",i.style.flexDirection="column",i.style.gap=`${a}px`):(i.style.display="grid",i.style.gridTemplateColumns="repeat(2, 1fr)",i.style.gap=`${a}px`),s){const c=document.createElement("h2");c.textContent=s,c.style.margin="0 0 20px 0",c.style.textAlign="center",c.style.fontSize="24px",c.style.fontWeight="bold",i.appendChild(c)}l.forEach(c=>{const m=c.cloneNode(!0);m.style.margin="0",i.appendChild(m)}),document.body.appendChild(i),await x(i,{...t,filename:r}),document.body.removeChild(i)}catch(l){throw console.error("Error exporting multiple charts:",l),l}}async function U(e={}){const{filename:t="dashboard-summary.png",includeKPIs:r=!0,includeCharts:n=!0,title:a="Dashboard Summary"}=e,o=[];if(r&&document.querySelector('[data-export="kpi-cards"]')&&o.push('[data-export="kpi-cards"]'),n&&document.querySelectorAll('[data-export="chart"]').forEach((l,i)=>{o.push(`[data-export="chart"]:nth-child(${i+1})`)}),o.length===0)throw new Error("No exportable elements found. Make sure to add data-export attributes to your components.");return k(o,{...e,filename:t,title:a,layout:"vertical"})}function I(){return typeof window>"u"?{available:!1,reason:"Not in browser environment"}:!document.createElement||!URL.createObjectURL?{available:!1,reason:"Required browser APIs not available"}:{available:!0}}function V(e){const t=e.message.toLowerCase();return t.includes("html2canvas")?"Image export requires the html2canvas library. Please contact your administrator.":t.includes("network")||t.includes("cors")?"Export failed due to network restrictions. Please try again.":t.includes("permission")||t.includes("security")?"Export failed due to security restrictions. Please check your browser settings.":t.includes("memory")||t.includes("size")?"Export failed due to image size. Try reducing the export dimensions.":"Export failed. Please try again or contact support if the problem persists."}export{M as a,w as b,O as c,U as d,R as e,F as f,E as g,V as h,I as i,v as j,_ as k,N as l,T as m,$ as n,S as s};
