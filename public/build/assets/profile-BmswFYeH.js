import{u as ce}from"./useAuth-CSUeXPIW.js";import{d as K,aL as G,V as A,w as _e,h as x,m as j,b as u,g as t,f as s,e as o,az as d,v as n,t as y,c as w,n as r,F as O,j as J,x as X,r as I,o as oe,ac as S,aW as de,b9 as ie,b2 as he,aU as fe,k as ge,cw as re}from"./main-BW7J9dbc.js";import{V as D,b as se}from"./VCard-BBEboEsQ.js";import{V as F}from"./VCardText-CXwuP4rm.js";import{V as me}from"./VAvatar-CBx3oh99.js";import{V as te}from"./VImg-NyJdDnCF.js";import{V as H}from"./VChip-Dc9HlRo1.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ue}from"./useNotifications-C-RqLAHj.js";import{V as pe}from"./VForm-CCkDJA8t.js";import{V as W,a as M}from"./VRow-CGHQgNV4.js";import{V as Z}from"./VTextField-DCEu5f_P.js";import{V as be}from"./VTextarea-Wxm7h69M.js";import{V as ae}from"./VAlert-C-u8vegp.js";import{u as ye}from"./useApi-C5OI9_Dc.js";import{V as we}from"./VDialog-BYRvlSU6.js";import{V as ke}from"./VSelect-BbnjVQGu.js";import{V as $e}from"./VFileInput-Dsp3Fy5B.js";import{a as Ve,V as ze}from"./VTabs-GSMjEVVu.js";import{V as ne,a as xe}from"./VWindowItem-BSLJcrS4.js";import"./createSimpleFunctional-468wPgla.js";import"./VField-ECDxRtcR.js";import"./forwardRefs-t39oHzh6.js";/* empty css              */import"./VOverlay-CpnKYLAB.js";import"./lazy-CTr8uHza.js";import"./dialog-transition-C3MiiA6M.js";import"./VList-BrmO1UK3.js";import"./ssrBoot-DTcmQToe.js";import"./VDivider-C4kHsR9g.js";import"./VMenu-DTZ6uDZD.js";import"./VCheckboxBtn-BRmrHq-R.js";const Ue={class:"avatar-section"},Ce={class:"avatar-container"},Ie={class:"status-indicator"},Ae={class:"user-info-section"},je={class:"name-status-row"},Pe={class:"name-container"},Se={class:"user-name"},De={class:"contact-grid"},Fe={key:0,class:"contact-item"},Te={class:"contact-icon"},Ne={class:"contact-content"},Ee={class:"contact-label"},Le={class:"contact-value"},Me={key:1,class:"contact-item"},Be={class:"contact-icon"},Re={class:"contact-content"},qe={class:"contact-label"},Ze={class:"contact-value"},Oe=K({__name:"UserProfileHeader",props:{user:{}},setup(q){const e=q,{t:l}=G(),U=A(()=>{var c;return((c=e.user)==null?void 0:c.nom_complet)||"User"}),$=A(()=>{var c;return((c=e.user)==null?void 0:c.email)||""}),g=A(()=>{var c;return(c=e.user)!=null&&c.created_at?new Date(e.user.created_at).toLocaleDateString("fr-FR",{year:"numeric",month:"long"}):""}),V=A(()=>{var c;return(c=e.user)!=null&&c.roles&&Array.isArray(e.user.roles)?e.user.roles.join(", "):""}),m=A(()=>{var a;const c=(a=e.user)==null?void 0:a.statut;return l(c==="actif"?"active":c==="inactif"?"inactive":"blocked")}),i=A(()=>{var a;const c=(a=e.user)==null?void 0:a.statut;return c==="actif"?"success":c==="inactif"?"warning":"error"}),p=A(()=>{var a;if((a=e.user)!=null&&a.photo_profil)return console.log("ðŸ–¼ï¸ User has profile image:",e.user.photo_profil),e.user.photo_profil;const c=`https://ui-avatars.com/api/?name=${encodeURIComponent(U.value)}&background=7367f0&color=fff&size=140`;return console.log("ðŸ–¼ï¸ Using fallback avatar:",c),c});return _e(()=>e.user,c=>{c&&(console.log("ðŸ‘¤ UserProfileHeader received user data:",c),console.log("ðŸ–¼ï¸ Photo URL:",c.photo_profil),console.log("ðŸ  Address:",c.adresse),console.log("ðŸ†” CIN:",c.cin))},{immediate:!0}),A(()=>{var a;const c=((a=e.user)==null?void 0:a.photo_profil)||p.value;return console.log("ðŸ–¼ï¸ Display image URL:",c),c}),(c,a)=>e.user?(u(),x(D,{key:0,class:"profile-header-card"},{default:t(()=>[a[1]||(a[1]=s("div",{class:"profile-cover"},[s("div",{class:"cover-overlay"}),s("div",{class:"cover-pattern"})],-1)),o(F,{class:"profile-content"},{default:t(()=>{var P;return[s("div",Ue,[s("div",Ce,[o(me,{rounded:"",size:"140",class:"user-profile-avatar"},{default:t(()=>{var T;return[(T=e.user)!=null&&T.photo_profil?(u(),x(te,{key:0,src:e.user.photo_profil,alt:U.value,cover:"",onError:a[0]||(a[0]=L=>{var R;return console.error("Failed to load profile image in header:",(R=e.user)==null?void 0:R.photo_profil)})},null,8,["src","alt"])):(u(),x(te,{key:1,src:p.value,alt:U.value,cover:""},null,8,["src","alt"]))]}),_:1}),s("div",Ie,[o(d,{icon:"tabler-circle-filled",size:"16",class:"text-success"})])])]),s("div",Ae,[s("div",je,[s("div",Pe,[s("h2",Se,n(U.value),1),((P=e.user)==null?void 0:P.statut)!=="bloque"?(u(),x(H,{key:0,color:i.value,size:"small",variant:"flat",class:"status-chip"},{default:t(()=>[o(d,{start:"",icon:i.value==="success"?"tabler-check":i.value==="warning"?"tabler-clock":"tabler-x",size:"14"},null,8,["icon"]),y(" "+n(m.value),1)]),_:1},8,["color"])):j("",!0)]),V.value?(u(),x(H,{key:0,color:"primary",variant:"tonal","prepend-icon":"tabler-shield-check",class:"role-chip"},{default:t(()=>[y(n(V.value),1)]),_:1})):j("",!0)]),s("div",De,[$.value?(u(),w("div",Fe,[s("div",Te,[o(d,{icon:"tabler-mail",size:"20"})]),s("div",Ne,[s("span",Ee,n(r(l)("email")),1),s("span",Le,n($.value),1)])])):j("",!0),g.value?(u(),w("div",Me,[s("div",Be,[o(d,{icon:"tabler-calendar",size:"20"})]),s("div",Re,[s("span",qe,n(r(l)("member_since")),1),s("span",Ze,n(g.value),1)])])):j("",!0)])])]}),_:1})]),_:1,__:[1]})):j("",!0)}}),Je=Y(Oe,[["__scopeId","data-v-1a383846"]]),We={class:"profile-about"},He={class:"section-header"},Ke={class:"section-title"},Ge={class:"info-list"},Qe={class:"info-icon"},Xe={class:"info-content"},Ye={class:"info-label"},eo={class:"info-value"},oo={class:"section-header"},so={class:"section-title"},to={class:"info-list"},ao={class:"info-content"},lo={class:"info-label"},ro={key:1,class:"info-value"},no={class:"section-header"},io={class:"section-title"},co={class:"info-list"},uo={class:"info-icon"},po={class:"info-content"},_o={class:"info-label"},fo={class:"info-value"},mo={class:"section-header"},vo={class:"section-title"},ho={class:"info-list"},go={class:"info-icon"},bo={class:"info-content"},yo={class:"info-label"},wo=K({__name:"ProfileAbout",setup(q){const{t:e}=G(),{user:l}=ce(),U=A(()=>l?[{property:e("form_full_name"),value:l.nom_complet||e("not_provided"),icon:"tabler-user"},{property:e("form_email"),value:l.email||e("not_provided"),icon:"tabler-mail"},{property:e("form_phone"),value:l.telephone||e("not_provided"),icon:"tabler-phone"},{property:e("form_address"),value:l.adresse||e("not_provided"),icon:"tabler-map-pin"},{property:e("cin_number"),value:l.cin||e("not_provided"),icon:"tabler-id"}].filter(p=>p.value!==e("not_provided")):[]),$=A(()=>{if(!l)return[];const p=[];return p.push({property:e("status"),value:l.statut==="actif"?e("active"):l.statut==="inactif"?e("inactive"):e("blocked"),icon:"tabler-circle-check",color:l.statut==="actif"?"success":l.statut==="inactif"?"warning":"error"}),p.push({property:e("email_verification"),value:l.email_verifie?e("verified"):e("not_verified"),icon:l.email_verifie?"tabler-shield-check":"tabler-shield-x",color:l.email_verifie?"success":"warning"}),l.kyc_statut&&l.kyc_statut!==null&&l.kyc_statut!==void 0&&p.push({property:e("kyc_status"),value:m(l.kyc_statut),icon:"tabler-file-certificate",color:i(l.kyc_statut)}),p}),g=A(()=>{if(!l)return[];const p=[];return l.rib&&p.push({property:e("rib"),value:l.rib,icon:"tabler-credit-card"}),l.bank_type&&p.push({property:e("bank_type"),value:l.bank_type,icon:"tabler-building-bank"}),p}),V=A(()=>l!=null&&l.roles?[{property:e("roles"),value:Array.isArray(l.roles)?l.roles.join(", "):l.roles,icon:"tabler-shield"}]:[]),m=p=>({non_requis:e("not_required"),en_attente:e("pending"),valide:e("validated"),refuse:e("rejected")})[p]||p,i=p=>({non_requis:"info",en_attente:"warning",valide:"success",refuse:"error"})[p]||"default";return(p,c)=>(u(),w("div",We,[U.value.length?(u(),x(D,{key:0,class:"about-card mb-6"},{default:t(()=>[o(F,{class:"about-content"},{default:t(()=>[s("div",He,[o(d,{icon:"tabler-user-circle",size:"24",class:"section-icon"}),s("h5",Ke,n(r(e)("about").toUpperCase()),1)]),s("div",Ge,[(u(!0),w(O,null,J(U.value,a=>(u(),w("div",{key:a.property,class:"info-item"},[s("div",Qe,[o(d,{icon:a.icon,size:"20"},null,8,["icon"])]),s("div",Xe,[s("span",Ye,n(a.property),1),s("span",eo,n(a.value),1)])]))),128))])]),_:1})]),_:1})):j("",!0),$.value.length?(u(),x(D,{key:1,class:"account-card mb-6"},{default:t(()=>[o(F,{class:"account-content"},{default:t(()=>[s("div",oo,[o(d,{icon:"tabler-settings",size:"24",class:"section-icon"}),s("h5",so,n(r(e)("account_information").toUpperCase()),1)]),s("div",to,[(u(!0),w(O,null,J($.value,a=>(u(),w("div",{key:a.property,class:"info-item"},[s("div",{class:X(["info-icon",a.color?`info-icon--${a.color}`:""])},[o(d,{icon:a.icon,size:"20",color:a.color},null,8,["icon","color"])],2),s("div",ao,[s("span",lo,n(a.property),1),a.color?(u(),x(H,{key:0,color:a.color,size:"small",variant:"flat",class:"info-chip"},{default:t(()=>[y(n(a.value),1)]),_:2},1032,["color"])):(u(),w("span",ro,n(a.value),1))])]))),128))])]),_:1})]),_:1})):j("",!0),g.value.length?(u(),x(D,{key:2,class:"banking-card mb-6"},{default:t(()=>[o(F,{class:"banking-content"},{default:t(()=>[s("div",no,[o(d,{icon:"tabler-building-bank",size:"24",class:"section-icon"}),s("h5",io,n(r(e)("banking_information").toUpperCase()),1)]),s("div",co,[(u(!0),w(O,null,J(g.value,a=>(u(),w("div",{key:a.property,class:"info-item"},[s("div",uo,[o(d,{icon:a.icon,size:"20"},null,8,["icon"])]),s("div",po,[s("span",_o,n(a.property),1),s("span",fo,n(a.value),1)])]))),128))])]),_:1})]),_:1})):j("",!0),V.value.length?(u(),x(D,{key:3,class:"roles-card"},{default:t(()=>[o(F,{class:"roles-content"},{default:t(()=>[s("div",mo,[o(d,{icon:"tabler-shield",size:"24",class:"section-icon"}),s("h5",vo,n(r(e)("roles_permissions").toUpperCase()),1)]),s("div",ho,[(u(!0),w(O,null,J(V.value,a=>(u(),w("div",{key:a.property,class:"info-item"},[s("div",go,[o(d,{icon:a.icon,size:"20"},null,8,["icon"])]),s("div",bo,[s("span",yo,n(a.property),1),o(H,{color:"primary",size:"small",variant:"tonal",class:"info-chip"},{default:t(()=>[y(n(a.value),1)]),_:2},1024)])]))),128))])]),_:1})]),_:1})):j("",!0)]))}}),ko=Y(wo,[["__scopeId","data-v-9582fdf6"]]),$o={class:"title-content"},Vo={class:"title-text"},zo={class:"title-subtitle"},xo={class:"form-section"},Uo={class:"section-title"},Co={class:"form-section"},Io={class:"section-title"},Ao={class:"readonly-field-container"},jo={class:"readonly-field-label"},Po={key:0,class:"form-section"},So={class:"section-title"},Do={class:"image-upload-section"},Fo={class:"current-image"},To={class:"text-caption mt-2"},No={class:"image-actions"},Eo={key:0,class:"action-section"},Lo={class:"action-buttons"},Mo={key:0,class:"changes-indicator"},Bo={class:"changes-text"},Ro=K({__name:"ProfileInformation",props:{user:{}},setup(q){const e=q,{t:l}=G(),{fetchUser:U}=ce(),{showSuccess:$,showError:g}=ue(),V=I(!1),m=I(!1),i=I(!1),p=I(!1),c=I(),a=I({nom_complet:"",email:"",telephone:"",adresse:"",cin:"",photo_profil:""}),P=I({}),T=()=>{e.user?(a.value={nom_complet:e.user.nom_complet||"",email:e.user.email||"",telephone:e.user.telephone||"",adresse:e.user.adresse||"",cin:e.user.cin||"",photo_profil:e.user.photo_profil||""},console.log("ðŸ”„ Form initialized with user data:",a.value),console.log("ðŸ‘¤ Current user data:",e.user),console.log("ðŸ–¼ï¸ Profile image URL:",e.user.photo_profil),console.log("ðŸ†” CIN value:",e.user.cin),console.log("ðŸ  Address value:",e.user.adresse)):console.log("âš ï¸ No user data available to initialize form")},L=A(()=>a.value.photo_profil?a.value.photo_profil:`https://ui-avatars.com/api/?name=${encodeURIComponent(a.value.nom_complet||"User")}&background=7367f0&color=fff&size=140`),R=async h=>{var E;const k=(E=h.target.files)==null?void 0:E[0];if(k){if(!k.type.startsWith("image/")){g("Please select a valid image file");return}if(k.size>2*1024*1024){g("Image size must be less than 2MB");return}try{i.value=!0;const B=new FormData;B.append("profile_image",k);const le=await fetch("/api/upload/profile-image",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"},body:B});if(!le.ok){const ve=await le.json();g(ve.message||l("image_upload_failed"));return}const ee=await le.json();ee.success&&(a.value.photo_profil=ee.url,await b(ee.url),$(ee.message||l("image_upload_success")))}catch(B){g(B.message||l("image_upload_failed"))}finally{i.value=!1}}},C=()=>{var h;(h=c.value)==null||h.click()},b=async h=>{try{const f={photo_profil:h};if(!(await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"},body:JSON.stringify(f)})).ok)throw new Error("Failed to save image to profile")}catch(f){console.error("Failed to save image to profile:",f)}},_=async()=>{try{p.value=!0;const h=await fetch("/api/profile/remove-image",{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"}});if(!h.ok){const k=await h.json();g(k.message||"Failed to remove image");return}const f=await h.json();f.success&&(a.value.photo_profil="",$(f.message||"Profile image removed successfully"))}catch(h){g(h.message||"Failed to remove image")}finally{p.value=!1}},v=()=>{T(),P.value={},m.value=!1},z=async()=>{try{V.value=!0,P.value={};const h={nom_complet:a.value.nom_complet,telephone:a.value.telephone,adresse:a.value.adresse,cin:a.value.cin,photo_profil:a.value.photo_profil},f=await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"},body:JSON.stringify(h)});if(!f.ok){const E=await f.json();f.status===422&&E.errors?P.value=E.errors:g(E.message||l("profile_update_failed"));return}const k=await f.json();k.success&&($(k.message||l("profile_updated_successfully")),await U(),m.value=!1)}catch(h){g(h.message||l("profile_update_failed"))}finally{V.value=!1}},N=A(()=>e.user?a.value.nom_complet!==(e.user.nom_complet||"")||a.value.telephone!==(e.user.telephone||"")||a.value.adresse!==(e.user.adresse||"")||a.value.cin!==(e.user.cin||"")||a.value.photo_profil!==(e.user.photo_profil||""):!1),Q=A(()=>N.value&&a.value.nom_complet.trim());return _e(()=>e.user,h=>{h&&(console.log("ðŸ‘¤ User data changed, reinitializing form:",h),console.log("ðŸ” New User CIN:",h.cin),console.log("ðŸ” New User Address:",h.adresse),console.log("ðŸ” New User Photo:",h.photo_profil),T())},{immediate:!0}),oe(()=>{console.log("ðŸ”„ ProfileInformation component mounted"),e.user?(console.log("ðŸ‘¤ Initial user data:",e.user),T()):console.log("âš ï¸ No user data available on mount")}),(h,f)=>(u(),x(D,{class:"profile-info-card"},{default:t(()=>[o(se,{class:"profile-info-title"},{default:t(()=>[s("div",$o,[o(d,{icon:"tabler-user-edit",size:"28",class:"title-icon"}),s("div",null,[s("h3",Vo,n(r(l)("profile_information")),1),s("p",zo,n(r(l)("manage_your_personal_information")),1)])]),m.value?j("",!0):(u(),x(S,{key:0,color:"primary",variant:"tonal",size:"small",class:"edit-btn",onClick:f[0]||(f[0]=k=>m.value=!0)},{default:t(()=>[o(d,{start:"",icon:"tabler-edit"}),y(" "+n(r(l)("edit")),1)]),_:1}))]),_:1}),o(F,{class:"profile-info-content"},{default:t(()=>[o(pe,{onSubmit:de(z,["prevent"]),class:"profile-form"},{default:t(()=>[s("div",xo,[s("h6",Uo,[o(d,{icon:"tabler-user",size:"20"}),y(" "+n(r(l)("personal_information")),1)]),o(W,null,{default:t(()=>[o(M,{cols:"12",md:"6"},{default:t(()=>[o(Z,{modelValue:a.value.nom_complet,"onUpdate:modelValue":f[1]||(f[1]=k=>a.value.nom_complet=k),label:r(l)("form_full_name"),placeholder:r(l)("enter_full_name"),readonly:!m.value,"error-messages":P.value.nom_complet,required:"",variant:"outlined",class:"form-field"},{"prepend-inner":t(()=>[o(d,{icon:"tabler-user",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","readonly","error-messages"])]),_:1}),o(M,{cols:"12",md:"6"},{default:t(()=>[o(Z,{modelValue:a.value.cin,"onUpdate:modelValue":f[2]||(f[2]=k=>a.value.cin=k),label:r(l)("cin_number"),placeholder:r(l)("enter_cin"),readonly:!m.value,"error-messages":P.value.cin,variant:"outlined",class:"form-field"},{"prepend-inner":t(()=>[o(d,{icon:"tabler-id",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","readonly","error-messages"])]),_:1})]),_:1})]),s("div",Co,[s("h6",Io,[o(d,{icon:"tabler-address-book",size:"20"}),y(" "+n(r(l)("contact_information")),1)]),o(W,null,{default:t(()=>[o(M,{cols:"12",md:"6"},{default:t(()=>[s("div",Ao,[s("span",jo,n(r(l)("form_email")),1),o(Z,{modelValue:a.value.email,"onUpdate:modelValue":f[3]||(f[3]=k=>a.value.email=k),placeholder:r(l)("email_readonly_notice"),readonly:"",disabled:"","hide-details":"",variant:"plain",class:"readonly-field-input"},null,8,["modelValue","placeholder"])])]),_:1}),o(M,{cols:"12",md:"6"},{default:t(()=>[o(Z,{modelValue:a.value.telephone,"onUpdate:modelValue":f[4]||(f[4]=k=>a.value.telephone=k),label:r(l)("form_phone"),placeholder:r(l)("enter_phone"),readonly:!m.value,"error-messages":P.value.telephone,variant:"outlined",class:"form-field"},{"prepend-inner":t(()=>[o(d,{icon:"tabler-phone",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","readonly","error-messages"])]),_:1}),o(M,{cols:"12"},{default:t(()=>[o(be,{modelValue:a.value.adresse,"onUpdate:modelValue":f[5]||(f[5]=k=>a.value.adresse=k),label:r(l)("form_address"),placeholder:r(l)("enter_address"),readonly:!m.value,"error-messages":P.value.adresse,variant:"outlined",rows:"3",class:"form-field"},{"prepend-inner":t(()=>[o(d,{icon:"tabler-map-pin",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","readonly","error-messages"])]),_:1})]),_:1})]),m.value?(u(),w("div",Po,[s("h6",So,[o(d,{icon:"tabler-photo",size:"20"}),y(" "+n(r(l)("profile_image")),1)]),o(W,null,{default:t(()=>[o(M,{cols:"12"},{default:t(()=>[s("div",Do,[s("div",Fo,[o(me,{size:"120",class:"profile-avatar"},{default:t(()=>[a.value.photo_profil?(u(),x(te,{key:0,src:a.value.photo_profil,alt:r(l)("profile_image"),cover:"",onError:f[6]||(f[6]=k=>console.error("Failed to load profile image in form:",a.value.photo_profil))},null,8,["src","alt"])):(u(),x(te,{key:1,src:L.value,alt:r(l)("profile_image"),cover:""},null,8,["src","alt"]))]),_:1}),s("p",To,n(a.value.photo_profil?r(l)("current_image"):r(l)("no_image_uploaded")),1)]),s("div",No,[o(S,{color:"primary",variant:"tonal",class:"upload-btn",onClick:C,loading:i.value},{default:t(()=>[o(d,{start:"",icon:"tabler-upload"}),y(" "+n(r(l)("upload_profile_image")),1)]),_:1},8,["loading"]),a.value.photo_profil?(u(),x(S,{key:0,color:"error",variant:"outlined",class:"remove-btn",onClick:_,loading:p.value},{default:t(()=>[o(d,{start:"",icon:"tabler-trash"}),y(" "+n(r(l)("remove_profile_image")),1)]),_:1},8,["loading"])):j("",!0)])]),s("input",{ref_key:"imageInput",ref:c,type:"file",accept:"image/*",style:{display:"none"},onChange:R},null,544)]),_:1})]),_:1})])):j("",!0),o(ie,null,{default:t(()=>[m.value?(u(),w("div",Eo,[s("div",Lo,[o(S,{type:"submit",color:"primary",size:"large",loading:V.value,disabled:!Q.value,class:"action-btn primary-btn"},{default:t(()=>[o(d,{start:"",icon:"tabler-check"}),y(" "+n(r(l)("save_changes")),1)]),_:1},8,["loading","disabled"]),o(S,{color:"secondary",variant:"outlined",size:"large",disabled:V.value,class:"action-btn secondary-btn",onClick:v},{default:t(()=>[o(d,{start:"",icon:"tabler-x"}),y(" "+n(r(l)("cancel_changes")),1)]),_:1},8,["disabled"])]),N.value?(u(),w("div",Mo,[o(d,{icon:"tabler-circle-dot",size:"12",class:"changes-dot"}),s("span",Bo,n(r(l)("unsaved_changes")),1)])):j("",!0)])):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}}),qo=Y(Ro,[["__scopeId","data-v-5ba34962"]]),Zo={class:"title-content"},Oo={class:"title-text"},Jo={class:"title-subtitle"},Wo={class:"alert-content"},Ho={class:"alert-title"},Ko={class:"alert-text"},Go={class:"form-sections"},Qo={class:"form-section"},Xo={class:"section-title"},Yo={class:"form-section"},es={class:"section-title"},os={key:0,class:"password-strength"},ss={class:"strength-header"},ts={class:"strength-label"},as={class:"strength-tips"},ls={class:"tips-grid"},rs={class:"action-section"},ns={class:"action-buttons"},is=K({__name:"ChangePassword",setup(q){const{t:e}=G(),{showSuccess:l,showError:U}=ue(),$=I(!1),g=I(!1),V=I(!1),m=I(!1),i=I({current_password:"",password:"",password_confirmation:""}),p=I({}),c=()=>{i.value={current_password:"",password:"",password_confirmation:""},p.value={}},a=async()=>{try{$.value=!0,p.value={};const C=await fetch("/api/profile/password",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"},body:JSON.stringify(i.value)});if(!C.ok){const _=await C.json();C.status===422&&_.errors?p.value=_.errors:U(_.message||e("password_update_failed"));return}const b=await C.json();b.success&&(l(b.message||e("password_updated_successfully")),c())}catch(C){U(C.message||e("password_update_failed"))}finally{$.value=!1}},P=A(()=>i.value.current_password.trim()&&i.value.password.trim()&&i.value.password_confirmation.trim()&&i.value.password===i.value.password_confirmation&&i.value.password.length>=8),T=A(()=>i.value.password_confirmation?i.value.password===i.value.password_confirmation:!0),L=A(()=>{const C=i.value.password;if(!C)return{score:0,text:"",color:""};let b=0;C.length>=8&&b++,/[a-z]/.test(C)&&b++,/[A-Z]/.test(C)&&b++,/[0-9]/.test(C)&&b++,/[^A-Za-z0-9]/.test(C)&&b++;const _=[{text:e("password_very_weak"),color:"error"},{text:e("password_weak"),color:"warning"},{text:e("password_fair"),color:"info"},{text:e("password_good"),color:"success"},{text:e("password_strong"),color:"success"}];return{score:b,..._[Math.min(b,4)]}}),R=C=>["tabler-shield-x","tabler-shield-exclamation","tabler-shield-half-filled","tabler-shield-check","tabler-shield-star"][Math.min(C,4)];return(C,b)=>(u(),x(D,{class:"password-card"},{default:t(()=>[o(se,{class:"password-card-title"},{default:t(()=>[s("div",Zo,[o(d,{icon:"tabler-shield-lock",size:"28",class:"title-icon"}),s("div",null,[s("h3",Oo,n(r(e)("change_password")),1),s("p",Jo,n(r(e)("update_your_password_securely")),1)])])]),_:1}),o(F,{class:"password-card-content"},{default:t(()=>[o(ae,{type:"info",variant:"tonal",class:"security-alert",border:"start","border-color":"info"},{prepend:t(()=>[o(d,{icon:"tabler-info-circle"})]),default:t(()=>[s("div",Wo,[s("h6",Ho,n(r(e)("security_notice")),1),s("p",Ko,n(r(e)("password_change_info")),1)])]),_:1}),o(pe,{onSubmit:de(a,["prevent"]),class:"password-form"},{default:t(()=>[s("div",Go,[s("div",Qo,[s("h6",Xo,n(r(e)("current_password_section")),1),o(Z,{modelValue:i.value.current_password,"onUpdate:modelValue":b[0]||(b[0]=_=>i.value.current_password=_),label:r(e)("current_password"),placeholder:r(e)("enter_current_password"),type:g.value?"text":"password","append-inner-icon":g.value?"tabler-eye-off":"tabler-eye","error-messages":p.value.current_password,variant:"outlined",class:"password-field",required:"","onClick:appendInner":b[1]||(b[1]=_=>g.value=!g.value)},{"prepend-inner":t(()=>[o(d,{icon:"tabler-lock",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","type","append-inner-icon","error-messages"])]),s("div",Yo,[s("h6",es,n(r(e)("new_password_section")),1),o(Z,{modelValue:i.value.password,"onUpdate:modelValue":b[2]||(b[2]=_=>i.value.password=_),label:r(e)("new_password"),placeholder:r(e)("enter_new_password"),type:V.value?"text":"password","append-inner-icon":V.value?"tabler-eye-off":"tabler-eye","error-messages":p.value.password,variant:"outlined",class:"password-field",required:"","onClick:appendInner":b[3]||(b[3]=_=>V.value=!V.value)},{"prepend-inner":t(()=>[o(d,{icon:"tabler-key",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","type","append-inner-icon","error-messages"]),o(ie,null,{default:t(()=>[i.value.password?(u(),w("div",os,[s("div",ss,[s("span",ts,n(r(e)("password_strength"))+":",1),o(H,{color:L.value.color,size:"small",variant:"flat",class:"strength-chip"},{default:t(()=>[o(d,{start:"",icon:R(L.value.score),size:"14"},null,8,["icon"]),y(" "+n(L.value.text),1)]),_:1},8,["color"])]),o(he,{"model-value":L.value.score/5*100,color:L.value.color,height:"6",rounded:"",class:"strength-progress"},null,8,["model-value","color"]),s("div",as,[s("div",ls,[s("div",{class:X(["tip-item",{"tip-valid":i.value.password.length>=8}])},[o(d,{icon:i.value.password.length>=8?"tabler-check":"tabler-x",size:"16",color:i.value.password.length>=8?"success":"error"},null,8,["icon","color"]),s("span",null,n(r(e)("password_min_8_chars")),1)],2),s("div",{class:X(["tip-item",{"tip-valid":/[a-z]/.test(i.value.password)&&/[A-Z]/.test(i.value.password)}])},[o(d,{icon:/[a-z]/.test(i.value.password)&&/[A-Z]/.test(i.value.password)?"tabler-check":"tabler-x",size:"16",color:/[a-z]/.test(i.value.password)&&/[A-Z]/.test(i.value.password)?"success":"error"},null,8,["icon","color"]),s("span",null,n(r(e)("password_mix_case")),1)],2),s("div",{class:X(["tip-item",{"tip-valid":/[0-9]/.test(i.value.password)}])},[o(d,{icon:/[0-9]/.test(i.value.password)?"tabler-check":"tabler-x",size:"16",color:/[0-9]/.test(i.value.password)?"success":"error"},null,8,["icon","color"]),s("span",null,n(r(e)("password_include_numbers")),1)],2),s("div",{class:X(["tip-item",{"tip-valid":/[^A-Za-z0-9]/.test(i.value.password)}])},[o(d,{icon:/[^A-Za-z0-9]/.test(i.value.password)?"tabler-check":"tabler-x",size:"16",color:/[^A-Za-z0-9]/.test(i.value.password)?"success":"error"},null,8,["icon","color"]),s("span",null,n(r(e)("password_include_symbols")),1)],2)])])])):j("",!0)]),_:1}),o(Z,{modelValue:i.value.password_confirmation,"onUpdate:modelValue":b[4]||(b[4]=_=>i.value.password_confirmation=_),label:r(e)("confirm_new_password"),placeholder:r(e)("confirm_new_password"),type:m.value?"text":"password","append-inner-icon":m.value?"tabler-eye-off":"tabler-eye","error-messages":p.value.password_confirmation,error:!T.value,variant:"outlined",class:"password-field mt-4",required:"","onClick:appendInner":b[5]||(b[5]=_=>m.value=!m.value)},{"prepend-inner":t(()=>[o(d,{icon:"tabler-shield-check",size:"20",class:"field-icon"})]),_:1},8,["modelValue","label","placeholder","type","append-inner-icon","error-messages","error"]),o(ie,null,{default:t(()=>[i.value.password_confirmation&&!T.value?(u(),x(ae,{key:0,type:"error",variant:"tonal",density:"compact",class:"mt-2"},{default:t(()=>[o(d,{start:"",icon:"tabler-alert-circle"}),y(" "+n(r(e)("passwords_do_not_match")),1)]),_:1})):j("",!0)]),_:1})])]),s("div",rs,[s("div",ns,[o(S,{type:"submit",color:"primary",size:"large",loading:$.value,disabled:!P.value,class:"action-btn primary-btn"},{default:t(()=>[o(d,{start:"",icon:"tabler-check"}),y(" "+n(r(e)("update_password")),1)]),_:1},8,["loading","disabled"]),o(S,{color:"secondary",variant:"outlined",size:"large",disabled:$.value,class:"action-btn secondary-btn",onClick:c},{default:t(()=>[o(d,{start:"",icon:"tabler-refresh"}),y(" "+n(r(e)("reset_form")),1)]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1}))}}),cs=Y(is,[["__scopeId","data-v-8f6a5b6f"]]),ds={key:0},us={class:"d-flex align-center justify-space-between mb-3"},ps={class:"text-h6 mb-2"},_s={class:"text-caption text-medium-emphasis mb-3"},fs={key:0,class:"mb-3"},ms={class:"text-caption"},vs={class:"d-flex gap-2"},hs={key:1,class:"text-center py-8"},gs={class:"mt-4"},bs={key:2,class:"text-center py-8"},ys={class:"text-h6 mb-2"},ws={class:"text-body-2 text-medium-emphasis mb-4"},ks={class:"d-flex gap-3"},$s=K({__name:"KycDocuments",setup(q){const{t:e}=G(),{showSuccess:l,showError:U}=ue(),$=I(!1),g=I([]),V=I(!1),m=I({type_doc:"cni",fichier:null}),i=I({}),p=[{title:e("document_cni"),value:"cni"},{title:e("document_passport"),value:"passport"},{title:e("document_rib"),value:"rib"},{title:e("document_contract"),value:"contrat"}],c=async()=>{var _;try{$.value=!0;const{data:v,error:z}=await ye("/profile/kyc-documents");if(z.value){U(z.value.message||e("failed_to_load_documents"));return}(_=v.value)!=null&&_.success&&(g.value=v.value.documents)}catch(v){U(v.message||e("failed_to_load_documents"))}finally{$.value=!1}},a=async()=>{if(m.value.fichier)try{$.value=!0,i.value={};const _=new FormData;_.append("type_doc",m.value.type_doc),_.append("fichier",m.value.fichier);const N=await fetch("https://tujjar.shop/api/profile/kyc-documents",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Accept:"application/json"},body:_});if(!N.ok){const h=await N.json();N.status===422&&h.errors?i.value=h.errors:U(h.message||e("document_upload_failed"));return}const Q=await N.json();V.value=!1,C(),await c(),l(Q.message||e("document_uploaded_successfully"))}catch(_){U(_.message||e("document_upload_failed"))}finally{$.value=!1}},P=async _=>{try{const z=`https://tujjar.shop/api/profile/kyc-documents/${_.id}/download`,N=await fetch(z,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!N.ok)throw new Error("Download failed");const Q=await N.blob(),h=N.headers.get("Content-Disposition");let f=`${T(_.type_doc)}_document`;if(h){const B=h.match(/filename="([^"]+)"/);B&&(f=B[1])}else{const B=_.url_fichier.split(".").pop()||"pdf";f+=`.${B}`}const k=window.URL.createObjectURL(Q),E=document.createElement("a");E.href=k,E.download=f,document.body.appendChild(E),E.click(),document.body.removeChild(E),window.URL.revokeObjectURL(k)}catch(v){U(v.message||e("download_failed"))}},T=_=>({cni:e("document_cni"),passport:e("document_passport"),rib:e("document_rib"),contrat:e("document_contract")})[_]||_,L=_=>({en_attente:"warning",valide:"success",refuse:"error"})[_]||"default",R=_=>({en_attente:e("document_pending"),valide:e("document_validated"),refuse:e("document_rejected")})[_]||_,C=()=>{m.value={type_doc:"cni",fichier:null},i.value={}},b=_=>{const v=_.target;v.files&&v.files.length>0&&(m.value.fichier=v.files[0])};return oe(()=>{c()}),(_,v)=>(u(),x(D,null,{default:t(()=>[o(se,{class:"d-flex justify-space-between align-center"},{default:t(()=>[s("span",null,[o(d,{start:"",icon:"tabler-file-certificate"}),y(" "+n(r(e)("kyc_documents")),1)]),o(S,{color:"primary",onClick:v[0]||(v[0]=z=>V.value=!0)},{default:t(()=>[o(d,{start:"",icon:"tabler-upload"}),y(" "+n(r(e)("upload_document")),1)]),_:1})]),_:1}),o(F,null,{default:t(()=>[!$.value&&g.value.length?(u(),w("div",ds,[o(W,null,{default:t(()=>[(u(!0),w(O,null,J(g.value,z=>(u(),x(M,{key:z.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[o(D,{variant:"outlined",class:"h-100"},{default:t(()=>[o(F,null,{default:t(()=>[s("div",us,[o(H,{color:L(z.statut),size:"small"},{default:t(()=>[y(n(R(z.statut)),1)]),_:2},1032,["color"]),o(d,{icon:"tabler-file",size:"24"})]),s("h6",ps,n(T(z.type_doc)),1),s("p",_s,n(r(e)("uploaded"))+": "+n(new Date(z.created_at).toLocaleDateString()),1),z.motif_refus?(u(),w("div",fs,[o(ae,{type:"error",variant:"tonal",density:"compact"},{default:t(()=>[s("div",ms,[s("strong",null,n(r(e)("admin_comment"))+":",1),v[5]||(v[5]=s("br",null,null,-1)),y(" "+n(z.motif_refus),1)])]),_:2},1024)])):j("",!0),s("div",vs,[o(S,{size:"small",color:"primary",variant:"outlined",onClick:N=>P(z)},{default:t(()=>[o(d,{start:"",icon:"tabler-download"}),y(" "+n(r(e)("download")),1)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):$.value?(u(),w("div",hs,[o(fe,{indeterminate:"",color:"primary"}),s("p",gs,n(r(e)("loading"))+"...",1)])):(u(),w("div",bs,[o(d,{icon:"tabler-file-x",size:"64",class:"text-medium-emphasis mb-4"}),s("h6",ys,n(r(e)("no_documents_uploaded")),1),s("p",ws,n(r(e)("upload_first_document")),1),o(S,{color:"primary",onClick:v[1]||(v[1]=z=>V.value=!0)},{default:t(()=>[o(d,{start:"",icon:"tabler-upload"}),y(" "+n(r(e)("upload_document")),1)]),_:1})]))]),_:1}),o(we,{modelValue:V.value,"onUpdate:modelValue":v[4]||(v[4]=z=>V.value=z),"max-width":"500"},{default:t(()=>[o(D,null,{default:t(()=>[o(se,null,{default:t(()=>[y(n(r(e)("upload_kyc_document")),1)]),_:1}),o(F,null,{default:t(()=>[o(pe,{onSubmit:de(a,["prevent"])},{default:t(()=>[o(ke,{modelValue:m.value.type_doc,"onUpdate:modelValue":v[2]||(v[2]=z=>m.value.type_doc=z),items:p,label:r(e)("select_document_type"),"error-messages":i.value.type_doc,variant:"outlined",required:"",class:"mb-4"},null,8,["modelValue","label","error-messages"]),o($e,{label:r(e)("select_file"),accept:".pdf,.jpg,.jpeg,.png","error-messages":i.value.fichier,variant:"outlined",required:"",onChange:b,class:"mb-4"},null,8,["label","error-messages"]),o(ae,{type:"info",variant:"tonal",density:"compact",class:"mb-4"},{default:t(()=>[y(n(r(e)("allowed_file_types")),1)]),_:1}),s("div",ks,[o(S,{type:"submit",color:"primary",loading:$.value,disabled:!m.value.fichier},{default:t(()=>[o(d,{start:"",icon:"tabler-upload"}),y(" "+n(r(e)("upload")),1)]),_:1},8,["loading","disabled"]),o(S,{color:"secondary",variant:"outlined",onClick:v[3]||(v[3]=z=>V.value=!1)},{default:t(()=>[y(n(r(e)("cancel")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Vs={class:"profile-container"},zs={key:0,class:"loading-container"},xs={class:"loading-content"},Us={class:"text-h5 mt-4 text-medium-emphasis"},Cs={class:"text-body-2 text-disabled mt-2"},Is={key:1,class:"profile-content"},As={class:"tab-content"},js={class:"tab-title"},Ps={class:"sticky-sidebar"},Ss={key:2,class:"error-container"},Ds={class:"text-h4 mb-2"},Fs={class:"text-body-1 text-medium-emphasis mb-6"},Ts=K({__name:"profile",setup(q){const{t:e}=G(),{user:l,isLoading:U,fetchUser:$}=ce();ge();const g=I("profile");oe(async()=>{console.log("ðŸ”„ Profile page mounted, fetching fresh user data...");try{if(await $(),console.log("âœ… User data refreshed successfully:",l),l){console.log("ðŸ” User CIN:",l.cin),console.log("ðŸ” User Address:",l.adresse),console.log("ðŸ” User Photo:",l.photo_profil);const i="https://tujjar.shop/api",p=localStorage.getItem("auth_token");if(p)try{const a=await(await fetch(`${i}/auth/user`,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json",Accept:"application/json"}})).json();console.log("ðŸŒ Direct API response:",a),a.user&&(console.log("ðŸŒ API User CIN:",a.user.cin),console.log("ðŸŒ API User Address:",a.user.adresse),console.log("ðŸŒ API User Photo:",a.user.photo_profil))}catch(c){console.error("âŒ Direct API call failed:",c)}}}catch(i){console.error("âŒ Failed to refresh user data:",i)}});const V=A(()=>[{icon:"tabler-user-check",title:e("profile_tab"),value:"profile"},{icon:"tabler-shield-lock",title:e("password_tab"),value:"password"},{icon:"tabler-file-certificate",title:e("documents_tab"),value:"documents"}]);I(!1);const m=()=>{window.location.reload()};return oe(()=>{}),(i,p)=>(u(),w("div",Vs,[r(U)?(u(),w("div",zs,[o(D,{class:"loading-card",elevation:"0"},{default:t(()=>[o(F,{class:"text-center py-16"},{default:t(()=>[s("div",xs,[o(fe,{indeterminate:"",color:"primary",size:"56",width:"4"}),s("h5",Us,n(r(e)("loading_profile")),1),s("p",Cs,n(r(e)("please_wait")),1)])]),_:1})]),_:1})])):r(l)?(u(),w("div",Is,[r(l)?(u(),x(Je,{key:0,user:r(l),class:"profile-header-enhanced"},null,8,["user"])):j("",!0),o(D,{class:"navigation-card mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[o(F,{class:"pa-0"},{default:t(()=>[o(Ve,{modelValue:g.value,"onUpdate:modelValue":p[0]||(p[0]=c=>g.value=c),class:"profile-tabs",color:"primary",height:"80","show-arrows":"","slider-color":"primary"},{default:t(()=>[(u(!0),w(O,null,J(V.value,c=>(u(),x(ze,{key:c.value,value:c.value,class:"profile-tab"},{default:t(()=>[s("div",As,[o(d,{size:"24",icon:c.icon,class:"tab-icon"},null,8,["icon"]),s("span",js,n(c.title),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(xe,{modelValue:g.value,"onUpdate:modelValue":p[1]||(p[1]=c=>g.value=c),class:"profile-window"},{default:t(()=>[o(ne,{value:"profile",class:"window-item"},{default:t(()=>[o(re,{mode:"out-in"},{default:t(()=>[o(W,null,{default:t(()=>[o(M,{cols:"12",lg:"4",order:"2","order-lg":"1"},{default:t(()=>[s("div",Ps,[o(ko)])]),_:1}),o(M,{cols:"12",lg:"8",order:"1","order-lg":"2"},{default:t(()=>[r(l)?(u(),x(qo,{key:0,user:r(l)},null,8,["user"])):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(ne,{value:"password",class:"window-item"},{default:t(()=>[o(re,{mode:"out-in"},{default:t(()=>[o(W,{justify:"center"},{default:t(()=>[o(M,{cols:"12",md:"10",lg:"8",xl:"6"},{default:t(()=>[o(cs)]),_:1})]),_:1})]),_:1})]),_:1}),o(ne,{value:"documents",class:"window-item"},{default:t(()=>[o(re,{mode:"out-in"},{default:t(()=>[o($s)]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(u(),w("div",Ss,[o(D,{class:"error-card",elevation:"0"},{default:t(()=>[o(F,{class:"text-center py-16"},{default:t(()=>[o(d,{icon:"tabler-alert-circle",size:"64",class:"text-error mb-4"}),s("h4",Ds,n(r(e)("error_loading_profile")),1),s("p",Fs,n(r(e)("profile_error_description")),1),o(S,{color:"primary",variant:"outlined",onClick:m},{default:t(()=>[o(d,{start:"",icon:"tabler-refresh"}),y(" "+n(r(e)("retry")),1)]),_:1})]),_:1})]),_:1})]))]))}}),mt=Y(Ts,[["__scopeId","data-v-5795bcc0"]]);export{mt as default};
