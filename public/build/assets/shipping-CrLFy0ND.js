import{b4 as w,r as c,V as h,b5 as l}from"./main-uLG9IIeX.js";const L=w("shipping",()=>{const p=c([]),u=c(null),g=c([]),n=c(!1),o=c(null),v=c({current_page:1,last_page:1,per_page:15,total:0}),i=c({page:1,perPage:15,sort:"updated_at",dir:"desc"}),f=h(()=>p.value.length>0),m=h(()=>n.value),y=h(()=>g.value.length>0),d=async t=>{var a,r;n.value=!0,o.value=null;try{t&&Object.assign(i.value,t);const e=await l.get("/admin/shipping/orders",{params:i.value});if(e.data.success)p.value=e.data.data,v.value=e.data.pagination;else throw new Error(e.data.message||"Failed to fetch shipping orders")}catch(e){o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to fetch shipping orders",console.error("Error fetching shipping orders:",e)}finally{n.value=!1}};return{shippingOrders:p,currentShippingOrder:u,cities:g,loading:n,error:o,pagination:v,filters:i,hasShippingOrders:f,isLoading:m,hasCities:y,fetchShippingOrders:d,fetchShippingOrder:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.get(`admin/shipping/orders/${t}`);if(e.data.success)u.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch shipping order")}catch(e){o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to fetch shipping order",console.error("Error fetching shipping order:",e)}finally{n.value=!1}},addParcel:async(t,a)=>{var r,e;n.value=!0,o.value=null;try{const s=await l.post("admin/shipping/ozon/parcels",{commande_id:t,tracking_number:a});if(s.data.success)return s.data.data;throw new Error(s.data.message||"Failed to create parcel")}catch(s){throw o.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to create parcel",console.error("Error creating parcel:",s),s}finally{n.value=!1}},getTracking:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.post("admin/shipping/ozon/track",{tracking_number:t});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get tracking")}catch(e){throw o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get tracking",console.error("Error getting tracking:",e),e}finally{n.value=!1}},getParcelInfo:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.post("admin/shipping/ozon/parcel-info",{tracking_number:t});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get parcel info")}catch(e){throw o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get parcel info",console.error("Error getting parcel info:",e),e}finally{n.value=!1}},resendToOzon:async(t,a="ramassage")=>{var r,e;n.value=!0,o.value=null;try{const s=await l.post("admin/shipping/ozon/resend",{commande_id:t,mode:a});if(s.data.success)return await d(i.value),s.data.data;throw new Error(s.data.message||"Failed to resend to OzonExpress")}catch(s){throw o.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to resend to OzonExpress",console.error("Error resending to OzonExpress:",s),s}finally{n.value=!1}},trackParcel:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.post("admin/shipping/ozon/track",{tracking_number:t});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to track parcel")}catch(e){throw o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to track parcel",console.error("Error tracking parcel:",e),e}finally{n.value=!1}},getParcelInfoNew:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.post("/admin/shipping/ozon/parcel-info",{tracking_number:t});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get parcel info")}catch(e){throw o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get parcel info",console.error("Error getting parcel info:",e),e}finally{n.value=!1}},createDeliveryNote:async()=>{var t,a;n.value=!0,o.value=null;try{const r=await l.post("admin/shipping/ozon/dn/create");if(r.data.success)return r.data.data.ref;throw new Error(r.data.message||"Failed to create delivery note")}catch(r){throw o.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||r.message||"Failed to create delivery note",console.error("Error creating delivery note:",r),r}finally{n.value=!1}},addParcelsToDeliveryNote:async(t,a)=>{var r,e;n.value=!0,o.value=null;try{const s=await l.post("admin/shipping/ozon/dn/add-parcels",{ref:t,codes:a});if(s.data.success)return s.data.data;throw new Error(s.data.message||"Failed to add parcels to delivery note")}catch(s){throw o.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to add parcels to delivery note",console.error("Error adding parcels to delivery note:",s),s}finally{n.value=!1}},saveDeliveryNote:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.post("admin/shipping/ozon/dn/save",{ref:t});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to save delivery note")}catch(e){throw o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to save delivery note",console.error("Error saving delivery note:",e),e}finally{n.value=!1}},getDeliveryNotePdf:async t=>{var a,r;n.value=!0,o.value=null;try{const e=await l.get("admin/shipping/ozon/dn/pdf",{params:{ref:t}});if(e.data.success)return e.data.data;throw new Error(e.data.message||"Failed to get PDF links")}catch(e){throw o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to get PDF links",console.error("Error getting PDF links:",e),e}finally{n.value=!1}},fetchCities:async(t=!1)=>{var a,r;n.value=!0,o.value=null;try{const e=await l.get("admin/shipping/ozon/cities",{params:{refresh:t}});if(e.data.success)g.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch cities")}catch(e){o.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.message)||e.message||"Failed to fetch cities",console.error("Error fetching cities:",e)}finally{n.value=!1}},resetFilters:()=>{i.value={page:1,perPage:15,sort:"updated_at",dir:"desc"}},clearCurrentShippingOrder:()=>{u.value=null},refreshTracking:async t=>{try{const a=await l.post("admin/shipping/orders/refresh-tracking",{tracking_number:t});return a.data.success&&await d(i.value),a.data}catch(a){throw console.error("Error refreshing tracking:",a),a}},refreshTrackingBulk:async t=>{try{const a=await l.post("admin/shipping/orders/refresh-tracking-bulk",{tracking_numbers:t});return a.data.success&&await d(i.value),a.data}catch(a){throw console.error("Error refreshing tracking bulk:",a),a}},updateShippingStatus:async(t,a)=>{var r,e;n.value=!0,o.value=null;try{const s=await l.post(`admin/shipping/orders/${t}/status`,a);if(s.data.success)return s.data;throw new Error(s.data.message||"Failed to update shipping status")}catch(s){throw o.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"Failed to update shipping status",console.error("Error updating shipping status:",s),new Error(o.value||"Failed to update shipping status")}finally{n.value=!1}}}});export{L as u};
