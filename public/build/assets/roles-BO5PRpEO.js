import{d as fe,aL as pe,r as y,D as _e,c as _,o as d,b as l,f as r,e as i,t as n,m as s,ac as v,s as p,aV as ve,F as D,i as U,g as S,l as ye,az as F,aU as j}from"./main-uLG9IIeX.js";import{u as be}from"./useAuth-CtoFjAb0.js";import{u as ge}from"./useNotifications-DDBS_wPD.js";import{useQuickConfirm as he}from"./useConfirmAction-C-KKQTYr.js";import{u as b}from"./useApi-Bt_X5NBj.js";import{u as le}from"./useFormErrors-XAfRt52c.js";import{V as g}from"./VCardText-BZtszuIK.js";import{V as h,b as B,c as O}from"./VCard-CB1gT6RB.js";import{a as L,V as oe}from"./VRow-aGfXYx3U.js";import{V as Ve}from"./VChip-B84WcmDa.js";import{V as q}from"./VForm-C9FiqBHN.js";import{V as A}from"./VTextField-Dxeq5kx5.js";import{V as re}from"./VCheckbox-BPY3LPcF.js";import{V as J}from"./VSpacer-BCNmCEP9.js";import{V as I}from"./VDialog-DU1pBIct.js";import{V as xe}from"./VSnackbar-BT89hKev.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VAvatar-bHPDEsYY.js";import"./VImg-BS6_svHJ.js";/* empty css              */import"./VField-CfH1YcVv.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VCheckboxBtn-CogF2AUK.js";import"./dialog-transition-2hF0ajsQ.js";const we={class:"d-flex justify-space-between align-center"},Ce={class:"text-h4 mb-2"},ke={class:"text-body-1 mb-0"},Ee={class:"d-flex gap-2"},Pe={class:"text-h5 mb-4"},Re={key:0,class:"text-center py-8"},De={class:"mt-4"},Ue={key:1},Se={class:"d-flex justify-space-between align-start mb-3"},Te={class:"text-h6 mb-1"},$e={class:"text-body-2 mb-0"},Fe={class:"d-flex gap-1"},Ne={class:"d-flex flex-wrap gap-1"},ze={key:2,class:"text-center py-8"},Me={class:"text-h6 mb-2"},je={class:"text-body-2"},Be={class:"text-h5 mb-4"},Oe={key:0},Le={class:"text-body-2"},qe={key:1,class:"text-center py-4"},Ae={class:"text-body-2"},Je={class:"text-h6 mb-3"},Ie={class:"d-flex flex-wrap gap-2"},Qe={class:"text-h6 mb-3"},Ge={class:"d-flex flex-wrap gap-2"},ha=fe({__name:"roles",setup(He){const{hasPermission:Q}=be(),{t:o}=pe(),{showSuccess:x,showError:f,snackbar:w}=ge(),{confirmCreate:G,confirmUpdate:se,confirmDelete:H}=he(),T=y([]),V=y([]),m=y(!1),N=y(null),C=y(!1),k=y(!1),E=y(!1),P=y(null),c=y({name:"",permissions:[]}),R=y({name:""}),{errors:K,set:W,clear:X}=le(),{errors:te,set:ne,clear:ie}=le(),$=async()=>{try{m.value=!0,N.value=null;const{data:t,error:a}=await b("/admin/roles");if(a.value){const e=a.value.message||o("failed_to_load_roles");N.value=e,f(e),console.error("Roles fetch error:",a.value)}else t.value&&(T.value=t.value.data||t.value.roles||[],console.log("✅ Roles loaded successfully:",T.value.length))}catch(t){N.value=t.message||o("failed_to_load_roles"),f(o("failed_to_load_roles")),console.error("Roles fetch error:",t)}finally{m.value=!1}},z=async()=>{try{const{data:t,error:a}=await b("/admin/permissions");if(a.value){const e=a.value.message||o("failed_to_load_permissions");f(e),console.error("Permissions fetch error:",a.value)}else t.value&&(V.value=t.value.data||t.value.permissions||[],console.log("✅ Permissions loaded successfully:",V.value.length))}catch(t){const a=t.message||o("failed_to_load_permissions");f(a),console.error("Permissions fetch error:",t)}},Y=async()=>{if(await G(o("role")))try{m.value=!0;const{data:a,error:e}=await b("/admin/roles",{method:"POST",body:JSON.stringify({name:c.value.name,permissions:c.value.permissions}),headers:{"Content-Type":"application/json"}});e.value?(W(e.value.errors),f(e.value.message),console.error("Create role error:",e.value)):a.value&&(X(),C.value=!1,ae(),await $(),x(o("role_created_successfully",{name:c.value.name})))}catch(a){f(a.message||o("failed_to_create_role")),console.error("Create role error:",a)}finally{m.value=!1}},Z=async()=>{if(!(!P.value||!await se(o("role"),P.value.name)))try{m.value=!0;const{data:a,error:e}=await b(`/admin/roles/${P.value.id}`,{method:"PUT",body:JSON.stringify({name:c.value.name,permissions:c.value.permissions}),headers:{"Content-Type":"application/json"}});e.value?(W(e.value.errors),f(e.value.message),console.error("Update role error:",e.value)):a.value&&(X(),k.value=!1,ae(),await $(),x(o("role_updated_successfully",{name:c.value.name})))}catch(a){f(a.message||o("failed_to_update_role")),console.error("Update role error:",a)}finally{m.value=!1}},ue=async t=>{if(await H(o("role"),t.name))try{m.value=!0;const{data:e,error:u}=await b(`/admin/roles/${t.id}`,{method:"DELETE"});if(u.value){let M=u.value.message||o("failed_to_delete_role");f(M),console.error("Delete role error:",u.value)}else e.value&&(await $(),x(o("role_deleted_successfully",{name:t.name})))}catch(e){f(e.message||o("failed_to_delete_role")),console.error("Delete role error:",e)}finally{m.value=!1}},ee=async()=>{if(await G(o("permission")))try{m.value=!0;const{data:a,error:e}=await b("/admin/permissions",{method:"POST",body:JSON.stringify({name:R.value.name}),headers:{"Content-Type":"application/json"}});e.value?(ne(e.value.errors),f(e.value.message),console.error("Create permission error:",e.value)):a.value&&(ie(),E.value=!1,me(),await z(),x(o("permission_created_successfully",{name:R.value.name})))}catch(a){f(a.message||o("failed_to_create_permission")),console.error("Create permission error:",a)}finally{m.value=!1}},de=async t=>{if(await H(o("permission"),t.name))try{m.value=!0;const{data:e,error:u}=await b(`/admin/permissions/${t.id}`,{method:"DELETE"});if(u.value){let M=u.value.message||o("failed_to_delete_permission");f(M),console.error("Delete permission error:",u.value)}else e.value&&(await z(),x(o("permission_deleted_successfully",{name:t.name})))}catch(e){f(e.message||o("failed_to_delete_permission")),console.error("Delete permission error:",e)}finally{m.value=!1}},ae=()=>{c.value={name:"",permissions:[]},P.value=null},me=()=>{R.value={name:""}},ce=t=>{P.value=t,c.value={name:t.name,permissions:t.permissions||[]},k.value=!0};return _e(async()=>{await Promise.all([$(),z()])}),(t,a)=>(d(),_("div",null,[l(h,{class:"mb-6"},{default:r(()=>[l(g,null,{default:r(()=>[i("div",we,[i("div",null,[i("h2",Ce,n(s(o)("roles_and_permissions")),1),i("p",ke,n(s(o)("manage_system_roles_permissions")),1)]),i("div",Ee,[l(v,{color:"secondary","prepend-icon":"tabler-plus",variant:"outlined",disabled:!s(Q)("manage users"),onClick:a[0]||(a[0]=e=>E.value=!0)},{default:r(()=>[p(n(s(o)("add_permission")),1)]),_:1},8,["disabled"]),l(v,{color:"primary","prepend-icon":"tabler-plus",disabled:!s(Q)("manage users"),onClick:a[1]||(a[1]=e=>C.value=!0)},{default:r(()=>[p(n(s(o)("add_role")),1)]),_:1},8,["disabled"])])])]),_:1})]),_:1}),l(oe,null,{default:r(()=>[l(L,{cols:"12",md:"8"},{default:r(()=>[l(h,null,{default:r(()=>[l(g,null,{default:r(()=>[i("h5",Pe,n(s(o)("roles")),1),m.value?(d(),_("div",Re,[l(ve,{indeterminate:"",color:"primary"}),i("p",De,n(s(o)("loading_roles")),1)])):T.value.length?(d(),_("div",Ue,[l(oe,null,{default:r(()=>[(d(!0),_(D,null,U(T.value,e=>(d(),S(L,{key:e.id,cols:"12",md:"6"},{default:r(()=>[l(h,{variant:"outlined"},{default:r(()=>[l(g,null,{default:r(()=>[i("div",Se,[i("div",null,[i("h6",Te,n(e.name),1),i("p",$e,n(s(o)("users_count",{count:e.users_count})),1)]),i("div",Fe,[l(v,{icon:"",size:"small",color:"primary",variant:"text",onClick:u=>ce(e)},{default:r(()=>[l(F,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),["admin","affiliate"].includes(e.name)?ye("",!0):(d(),S(v,{key:0,icon:"",size:"small",color:"error",variant:"text",onClick:u=>ue(e)},{default:r(()=>[l(F,{icon:"tabler-trash"})]),_:2},1032,["onClick"]))])]),i("div",Ne,[(d(!0),_(D,null,U(e.permissions,u=>(d(),S(Ve,{key:u,size:"small",color:"primary",variant:"tonal"},{default:r(()=>[p(n(u),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(d(),_("div",ze,[l(F,{icon:"tabler-shield",size:"64",class:"mb-4",color:"disabled"}),i("h6",Me,n(s(o)("no_roles_found")),1),i("p",je,n(s(o)("create_first_role")),1)]))]),_:1})]),_:1})]),_:1}),l(L,{cols:"12",md:"4"},{default:r(()=>[l(h,null,{default:r(()=>[l(g,null,{default:r(()=>[i("h5",Be,n(s(o)("permissions")),1),V.value.length?(d(),_("div",Oe,[(d(!0),_(D,null,U(V.value,e=>(d(),_("div",{key:e.id,class:"d-flex justify-space-between align-center mb-2 pa-2 rounded",style:{border:"1px solid rgba(var(--v-border-color), var(--v-border-opacity))"}},[i("span",Le,n(e.name),1),l(v,{icon:"",size:"small",color:"error",variant:"text",onClick:u=>de(e)},{default:r(()=>[l(F,{icon:"tabler-trash",size:"16"})]),_:2},1032,["onClick"])]))),128))])):(d(),_("div",qe,[i("p",Ae,n(s(o)("no_permissions_found")),1)]))]),_:1})]),_:1})]),_:1})]),_:1}),l(I,{modelValue:C.value,"onUpdate:modelValue":a[5]||(a[5]=e=>C.value=e),"max-width":"600"},{default:r(()=>[l(h,null,{default:r(()=>[l(B,null,{default:r(()=>[p(n(s(o)("create_new_role")),1)]),_:1}),l(g,null,{default:r(()=>[l(q,{onSubmit:j(Y,["prevent"])},{default:r(()=>[l(A,{modelValue:c.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value.name=e),label:s(o)("role_name"),placeholder:s(o)("enter_role_name"),"error-messages":s(K).name,required:"",class:"mb-4"},null,8,["modelValue","label","placeholder","error-messages"]),i("h6",Je,n(s(o)("permissions")),1),i("div",Ie,[(d(!0),_(D,null,U(V.value,e=>(d(),S(re,{key:e.id,modelValue:c.value.permissions,"onUpdate:modelValue":a[3]||(a[3]=u=>c.value.permissions=u),value:e.name,label:e.name,density:"compact"},null,8,["modelValue","value","label"]))),128))])]),_:1})]),_:1}),l(O,null,{default:r(()=>[l(J),l(v,{variant:"outlined",type:"button",onClick:a[4]||(a[4]=e=>C.value=!1)},{default:r(()=>[p(n(s(o)("action_cancel")),1)]),_:1}),l(v,{color:"primary",type:"button",loading:m.value,onClick:Y},{default:r(()=>[p(n(s(o)("create_role")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{modelValue:k.value,"onUpdate:modelValue":a[9]||(a[9]=e=>k.value=e),"max-width":"600"},{default:r(()=>[l(h,null,{default:r(()=>[l(B,null,{default:r(()=>[p(n(s(o)("edit_role")),1)]),_:1}),l(g,null,{default:r(()=>[l(q,{onSubmit:j(Z,["prevent"])},{default:r(()=>[l(A,{modelValue:c.value.name,"onUpdate:modelValue":a[6]||(a[6]=e=>c.value.name=e),label:s(o)("role_name"),placeholder:s(o)("enter_role_name"),"error-messages":s(K).name,required:"",class:"mb-4"},null,8,["modelValue","label","placeholder","error-messages"]),i("h6",Qe,n(s(o)("permissions")),1),i("div",Ge,[(d(!0),_(D,null,U(V.value,e=>(d(),S(re,{key:e.id,modelValue:c.value.permissions,"onUpdate:modelValue":a[7]||(a[7]=u=>c.value.permissions=u),value:e.name,label:e.name,density:"compact"},null,8,["modelValue","value","label"]))),128))])]),_:1})]),_:1}),l(O,null,{default:r(()=>[l(J),l(v,{variant:"outlined",type:"button",onClick:a[8]||(a[8]=e=>k.value=!1)},{default:r(()=>[p(n(s(o)("action_cancel")),1)]),_:1}),l(v,{color:"primary",type:"button",loading:m.value,onClick:Z},{default:r(()=>[p(n(s(o)("update_role")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{modelValue:E.value,"onUpdate:modelValue":a[12]||(a[12]=e=>E.value=e),"max-width":"400"},{default:r(()=>[l(h,null,{default:r(()=>[l(B,null,{default:r(()=>[p(n(s(o)("create_new_permission")),1)]),_:1}),l(g,null,{default:r(()=>[l(q,{onSubmit:j(ee,["prevent"])},{default:r(()=>[l(A,{modelValue:R.value.name,"onUpdate:modelValue":a[10]||(a[10]=e=>R.value.name=e),label:s(o)("permission_name"),placeholder:s(o)("enter_permission_name"),"error-messages":s(te).name,required:""},null,8,["modelValue","label","placeholder","error-messages"])]),_:1})]),_:1}),l(O,null,{default:r(()=>[l(J),l(v,{variant:"outlined",type:"button",onClick:a[11]||(a[11]=e=>E.value=!1)},{default:r(()=>[p(n(s(o)("action_cancel")),1)]),_:1}),l(v,{color:"primary",type:"button",loading:m.value,onClick:ee},{default:r(()=>[p(n(s(o)("create_permission")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(xe,{modelValue:s(w).show,"onUpdate:modelValue":a[13]||(a[13]=e=>s(w).show=e),color:s(w).color,timeout:s(w).timeout,location:"top end"},{default:r(()=>[p(n(s(w).message),1)]),_:1},8,["modelValue","color","timeout"])]))}});export{ha as default};
