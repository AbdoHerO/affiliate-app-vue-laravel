import{d as le,aL as ie,j as ce,b7 as ne,b6 as re,r as me,V as $,w as j,D as ue,c as F,o as h,b as s,f as a,e as i,az as f,t as c,m as o,ac as A,s as _,g as w,l as T,b8 as de,p as _e}from"./main-uLG9IIeX.js";import{u as pe}from"./commissions-DTaPuG2K.js";import{_ as fe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-nczKusLe.js";import{useQuickConfirm as ve}from"./useConfirmAction-C-KKQTYr.js";import{u as he}from"./useNotifications-DDBS_wPD.js";import{a as g,V as R}from"./VRow-aGfXYx3U.js";import{V as x}from"./VCard-CB1gT6RB.js";import{V as C}from"./VCardText-BZtszuIK.js";import{V as z}from"./VAvatar-bHPDEsYY.js";import{V as ge}from"./VTextField-Dxeq5kx5.js";import{V as be}from"./VSelect-sWnAtot-.js";import{V as xe}from"./VCheckbox-BPY3LPcF.js";import{V as ye}from"./VDataTableServer-DfLBg0lg.js";import{V as ke}from"./VMenu-DP1p-55V.js";import{V as Ve,a as S,b as D}from"./VList-uZDByhc2.js";import{V as N}from"./VChip-B84WcmDa.js";import"./VBreadcrumbs-D7yKQl5l.js";/* empty css              */import"./createSimpleFunctional-DugzUcbB.js";import"./VImg-BS6_svHJ.js";import"./VField-CfH1YcVv.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./dialog-transition-2hF0ajsQ.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VDataTable-DNqSzzrc.js";import"./VPagination-DYW6O4lq.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";import"./VDivider-UqGR4x4D.js";import"./ssrBoot-BPhRU-mF.js";const we={class:"d-flex align-center"},Ce={class:"text-sm text-medium-emphasis mb-0"},je={class:"text-h6"},Ae={class:"text-xs text-success mb-0"},Te={class:"d-flex align-center"},ze={class:"text-sm text-medium-emphasis mb-0"},Se={class:"text-h6"},De={class:"text-xs text-success mb-0"},Me={class:"d-flex align-center"},Ne={class:"text-sm text-medium-emphasis mb-0"},Pe={class:"text-h6"},Be={class:"text-xs text-success mb-0"},$e={class:"d-flex align-center"},Fe={class:"text-sm text-medium-emphasis mb-0"},Re={class:"text-h6"},Ue={class:"text-xs text-success mb-0"},Ie={class:"d-flex align-center justify-space-between"},Le={class:"d-flex align-center"},Ee={class:"font-weight-medium"},qe={class:"d-flex gap-2"},Oe={class:"d-flex align-center"},Qe={class:"font-weight-medium"},Ge={class:"text-caption text-medium-emphasis"},He={class:"font-weight-medium"},Je={key:0},Ke={class:"font-weight-bold text-success"},We={class:"text-caption"},zt=le({__name:"index",setup(Xe){const{t:e}=ie(),U=ce(),{showSuccess:y,showError:b}=he(),{confirm:k}=ve(),p=pe(),{commissions:I,loading:L,pagination:M,filters:m,summary:v}=ne(p);re();const u=me([]);$(()=>u.value.length>0);const E=$(()=>[{title:e("dashboard"),to:"/admin/dashboard"},{title:e("admin_commissions_title"),active:!0}]),q=[{value:"",text:e("all_statuses")},{value:"pending_calc",text:e("commission_status_pending_calc")},{value:"calculated",text:e("commission_status_calculated")},{value:"eligible",text:e("commission_status_eligible")},{value:"approved",text:e("commission_status_approved")},{value:"rejected",text:e("commission_status_rejected")},{value:"paid",text:e("commission_status_paid")},{value:"adjusted",text:e("commission_status_adjusted")},{value:"canceled",text:e("commission_status_canceled")}];e("all_types"),e("commission_type_sale"),e("commission_type_referral"),e("commission_type_bonus");const O=[{title:e("table_column_affiliate"),key:"affiliate.nom_complet",sortable:!0},{title:e("table_column_order"),key:"commande_id",sortable:!0},{title:e("table_column_type"),key:"type",sortable:!0},{title:e("admin_commissions_base_amount"),key:"base_amount",sortable:!0},{title:e("admin_commissions_rate"),key:"rate",sortable:!1},{title:e("admin_commissions_amount"),key:"amount",sortable:!0},{title:e("table_column_status"),key:"status",sortable:!0},{title:e("table_column_date"),key:"created_at",sortable:!0},{title:e("table_column_actions"),key:"actions",sortable:!1,width:120}],d=async()=>{await p.fetchCommissions(m.value)},Q=async(l,r)=>{console.log("🔍 handleView called for commission:",l.id);const t=`/admin/commissions/${l.id}`;console.log("🎯 Navigating to:",t);try{p.clearCurrentCommission(),await U.push(t),console.log("✅ Navigation successful")}catch(n){console.error("❌ Navigation error:",n),b(e("commission_navigation_error"))}},G=async l=>{if(await k({title:e("commission_approve_title"),text:e("commission_approve_confirm",{amount:l.amount,currency:l.currency}),confirmText:e("action_approve"),color:"success",type:"success"})){const t=await p.approveCommission(l.id);t.success?(y(t.message),await d()):b(t.message)}},H=async l=>{if(await k({title:e("commission_reject_title"),text:e("commission_reject_confirm",{amount:l.amount,currency:l.currency}),confirmText:e("action_reject"),color:"error",type:"error"})){const t=await p.rejectCommission(l.id,e("commission_default_reject_reason"));t.success?(y(t.message),await d()):b(t.message)}},J=async l=>{if(await k({title:e("commission_adjust_title"),text:e("commission_adjust_confirm",{amount:l.amount,currency:l.currency}),confirmText:e("action_adjust"),color:"warning",type:"warning"})){const t=parseFloat(l.amount)*.8,n=await p.adjustCommission(l.id,t,e("administrative_adjustment"));n.success?(y(n.message),await d()):b(n.message)}},K=async l=>{if(await k({title:e("action_mark_as_paid"),text:e("commission_confirm_payment",{amount:l.amount,currency:l.currency}),confirmText:e("action_confirm_payment"),color:"primary",type:"success"})){const t=await p.markAsPaid(l.id);t.success?(y(t.message),await d()):b(t.message)}},W=async()=>{if(u.value.length===0)return;if(await k({title:e("approve_selected_commissions"),text:e("confirm_approve_commissions",{count:u.value.length}),confirmText:e("approve_all"),color:"success",type:"success"})){const r=await p.bulkApprove(u.value);r.success?(y(r.message),u.value=[],await d()):b(r.message)}},X=async()=>{if(u.value.length===0)return;if(await k({title:e("commission_bulk_reject_title"),text:e("commission_bulk_reject_confirm",{count:u.value.length}),confirmText:e("action_reject_all"),color:"error",type:"error"})){const r=await p.bulkReject(u.value,e("commission_bulk_reject_reason"));r.success?(y(r.message),u.value=[],await d()):b(r.message)}},Y=l=>{m.value.page=l,d()},Z=l=>{m.value.per_page=l,m.value.page=1,d()},ee=l=>{m.value.sort===l?m.value.dir=m.value.dir==="asc"?"desc":"asc":(m.value.sort=l,m.value.dir="desc"),d()},V=()=>{m.value.page=1,d()},te=()=>{p.resetFilters(),d()};j(()=>m.value.status,V),j(()=>m.value.type,V),j(()=>m.value.user_id,V),j(()=>m.value.date_from,V),j(()=>m.value.date_to,V);const P=(l,r="MAD")=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:r}).format(l),ae=l=>new Date(l).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),se=l=>({pending_calc:"secondary",calculated:"info",eligible:"primary",approved:"success",rejected:"error",paid:"success",adjusted:"warning",canceled:"secondary"})[l]||"secondary",oe=l=>({pending_calc:e("commission_status_pending_calc"),calculated:e("commission_status_calculated"),eligible:e("commission_status_eligible"),approved:e("commission_status_approved"),rejected:e("commission_status_rejected"),paid:e("commission_status_paid"),adjusted:e("commission_status_adjusted"),canceled:e("commission_status_canceled")})[l]||l;return ue(async()=>{await d(),await p.fetchSummary()}),(l,r)=>(h(),F("div",null,[s(fe,{items:E.value},null,8,["items"]),s(R,{class:"mb-6"},{default:a(()=>[s(g,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(x,null,{default:a(()=>[s(C,null,{default:a(()=>{var t,n;return[i("div",we,[s(z,{color:"info",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-calculator"})]),_:1}),i("div",null,[i("p",Ce,c(o(e)("commission_status_calculated")),1),i("h6",je,c(((t=o(v))==null?void 0:t.count_calculated)||0),1),i("p",Ae,c(((n=o(v))==null?void 0:n.total_calculated)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1}),s(g,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(x,null,{default:a(()=>[s(C,null,{default:a(()=>{var t,n;return[i("div",Te,[s(z,{color:"primary",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-check"})]),_:1}),i("div",null,[i("p",ze,c(o(e)("commission_status_eligible")),1),i("h6",Se,c(((t=o(v))==null?void 0:t.count_eligible)||0),1),i("p",De,c(((n=o(v))==null?void 0:n.total_eligible)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1}),s(g,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(x,null,{default:a(()=>[s(C,null,{default:a(()=>{var t,n;return[i("div",Me,[s(z,{color:"success",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-thumb-up"})]),_:1}),i("div",null,[i("p",Ne,c(o(e)("commission_status_approved")),1),i("h6",Pe,c(((t=o(v))==null?void 0:t.count_approved)||0),1),i("p",Be,c(((n=o(v))==null?void 0:n.total_approved)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1}),s(g,{cols:"12",sm:"6",md:"3"},{default:a(()=>[s(x,null,{default:a(()=>[s(C,null,{default:a(()=>{var t,n;return[i("div",$e,[s(z,{color:"success",variant:"tonal",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-cash"})]),_:1}),i("div",null,[i("p",Fe,c(o(e)("commission_status_paid")),1),i("h6",Re,c(((t=o(v))==null?void 0:t.count_paid)||0),1),i("p",Ue,c(((n=o(v))==null?void 0:n.total_paid)||0)+" MAD",1)])])]}),_:1})]),_:1})]),_:1})]),_:1}),s(x,{class:"mb-6"},{default:a(()=>[s(C,null,{default:a(()=>[s(R,null,{default:a(()=>[s(g,{cols:"12",md:"4"},{default:a(()=>[s(ge,{modelValue:o(m).q,"onUpdate:modelValue":r[0]||(r[0]=t=>o(m).q=t),label:o(e)("action_search"),placeholder:o(e)("filter_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:"","hide-details":""},null,8,["modelValue","label","placeholder"])]),_:1}),s(g,{cols:"12",md:"3"},{default:a(()=>[s(be,{modelValue:o(m).status,"onUpdate:modelValue":r[1]||(r[1]=t=>o(m).status=t),items:q,"item-title":"text","item-value":"value",label:o(e)("table_column_status"),multiple:"",chips:"",clearable:"","hide-details":""},null,8,["modelValue","label"])]),_:1}),s(g,{cols:"12",md:"2"},{default:a(()=>[s(xe,{modelValue:o(m).eligible_only,"onUpdate:modelValue":r[2]||(r[2]=t=>o(m).eligible_only=t),label:o(e)("commission_eligible_only"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),s(g,{cols:"12",md:"3",class:"d-flex align-center gap-2"},{default:a(()=>[s(A,{color:"primary",variant:"elevated",onClick:V},{default:a(()=>[_(c(o(e)("action_filter")),1)]),_:1}),s(A,{color:"secondary",variant:"outlined",onClick:te},{default:a(()=>[_(c(o(e)("action_reset")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(de,null,{default:a(()=>[u.value.length>0?(h(),w(x,{key:0,class:"mb-6",color:"primary",variant:"tonal"},{default:a(()=>[s(C,null,{default:a(()=>[i("div",Ie,[i("div",Le,[s(f,{icon:"tabler-check",class:"me-2"}),i("span",Ee,c(o(e)("commission_selected_count",{count:u.value.length})),1)]),i("div",qe,[s(A,{color:"success",variant:"elevated",size:"small",onClick:W},{default:a(()=>[_(c(o(e)("action_approve_all")),1)]),_:1}),s(A,{color:"error",variant:"elevated",size:"small",onClick:X},{default:a(()=>[_(c(o(e)("action_reject_all")),1)]),_:1})])])]),_:1})]),_:1})):T("",!0)]),_:1}),s(x,null,{default:a(()=>[s(ye,{modelValue:u.value,"onUpdate:modelValue":r[3]||(r[3]=t=>u.value=t),headers:O,items:o(I),loading:o(L),"items-length":o(M).total,"items-per-page":o(M).per_page,page:o(M).current_page,"show-select":"","item-value":"id","onUpdate:page":Y,"onUpdate:itemsPerPage":Z,"onUpdate:sortBy":ee},{"item.affiliate.nom_complet":a(({item:t})=>{var n,B;return[i("div",Oe,[s(z,{size:"32",class:"me-3"},{default:a(()=>[s(f,{icon:"tabler-user"})]),_:1}),i("div",null,[i("div",Qe,c(((n=t.affiliate)==null?void 0:n.nom_complet)||o(e)("not_available")),1),i("div",Ge,c((B=t.affiliate)==null?void 0:B.email),1)])])]}),"item.commande_id":a(({item:t})=>[s(N,{to:`/admin/orders/${t.commande_id}`,color:"primary",variant:"outlined",size:"small"},{default:a(()=>{var n;return[_(c((n=t.commande_id)==null?void 0:n.slice(-8)),1)]}),_:2},1032,["to"])]),"item.base_amount":a(({item:t})=>[i("span",He,c(P(t.base_amount,t.currency)),1)]),"item.rate":a(({item:t})=>[t.rate?(h(),F("span",Je,c(t.rate)+"%",1)):(h(),w(N,{key:1,color:"info",variant:"tonal",size:"small"},{default:a(()=>[_(c(o(e)("commission_rate_fixed")),1)]),_:1}))]),"item.amount":a(({item:t})=>[i("span",Ke,c(P(t.amount,t.currency)),1)]),"item.status":a(({item:t})=>[s(N,{color:se(t.status),variant:"tonal",size:"small"},{default:a(()=>[_(c(oe(t.status)),1)]),_:2},1032,["color"])]),"item.created_at":a(({item:t})=>[i("span",We,c(ae(t.created_at)),1)]),"item.actions":a(({item:t})=>[s(ke,null,{activator:a(({props:n})=>[s(A,_e({icon:"tabler-dots-vertical",size:"small",variant:"text"},n),null,16)]),default:a(()=>[s(Ve,null,{default:a(()=>[s(S,{onClick:n=>Q(t)},{prepend:a(()=>[s(f,{icon:"tabler-eye",size:"20"})]),default:a(()=>[s(D,null,{default:a(()=>[_(c(o(e)("action_view_details")),1)]),_:1})]),_:2},1032,["onClick"]),t.can_be_approved?(h(),w(S,{key:0,onClick:n=>G(t)},{prepend:a(()=>[s(f,{icon:"tabler-check",size:"20",color:"success"})]),default:a(()=>[s(D,null,{default:a(()=>[_(c(o(e)("action_approve")),1)]),_:1})]),_:2},1032,["onClick"])):T("",!0),t.can_be_rejected?(h(),w(S,{key:1,onClick:n=>H(t)},{prepend:a(()=>[s(f,{icon:"tabler-x",size:"20",color:"error"})]),default:a(()=>[s(D,null,{default:a(()=>[_(c(o(e)("action_reject")),1)]),_:1})]),_:2},1032,["onClick"])):T("",!0),t.can_be_adjusted?(h(),w(S,{key:2,onClick:n=>J(t)},{prepend:a(()=>[s(f,{icon:"tabler-edit",size:"20",color:"warning"})]),default:a(()=>[s(D,null,{default:a(()=>[_(c(o(e)("action_adjust")),1)]),_:1})]),_:2},1032,["onClick"])):T("",!0),t.status==="approved"&&!t.paid_at?(h(),w(S,{key:3,onClick:n=>K(t)},{prepend:a(()=>[s(f,{icon:"tabler-cash",size:"20",color:"primary"})]),default:a(()=>[s(D,null,{default:a(()=>[_(c(o(e)("action_mark_as_paid")),1)]),_:1})]),_:2},1032,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","items","loading","items-length","items-per-page","page"])]),_:1})]))}});export{zt as default};
