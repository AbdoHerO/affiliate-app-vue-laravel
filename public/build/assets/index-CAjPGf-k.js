import{d as Z,aL as ee,j as te,b7 as ae,r as f,V as le,w as ie,D as oe,c as se,o as re,b as e,e as m,t as r,m as o,f as a,s as d,ac as _,cD as ue,az as w,aU as ce}from"./main-uLG9IIeX.js";import{u as ne}from"./tickets-C9TttlTK.js";import{u as me}from"./useNotifications-DDBS_wPD.js";import{_ as de}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-nczKusLe.js";import{V as B}from"./VCardText-BZtszuIK.js";import{V as R,a as n}from"./VRow-aGfXYx3U.js";import{V as U}from"./VTextField-Dxeq5kx5.js";import{V as v}from"./VSelect-sWnAtot-.js";import{V as S,b as fe,c as _e}from"./VCard-CB1gT6RB.js";import{V as pe}from"./VDataTableServer-DfLBg0lg.js";import{V as T}from"./VChip-B84WcmDa.js";import{V as ge}from"./VForm-C9FiqBHN.js";import{V as ve}from"./VTextarea-BuIc6d95.js";import{V as ye}from"./VFileInput-D1Glyc4K.js";import{V as be}from"./VSpacer-BCNmCEP9.js";import{V as ke}from"./VDialog-DU1pBIct.js";import"./api-DSi3Suj8.js";import"./index-D-EbNoF1.js";import"./VBreadcrumbs-D7yKQl5l.js";/* empty css              */import"./VField-CfH1YcVv.js";import"./VImg-BS6_svHJ.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VList-uZDByhc2.js";import"./ssrBoot-BPhRU-mF.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VAvatar-bHPDEsYY.js";import"./VDivider-UqGR4x4D.js";import"./dialog-transition-2hF0ajsQ.js";import"./VMenu-DP1p-55V.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VDataTable-DNqSzzrc.js";import"./VPagination-DYW6O4lq.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";const Ve={class:"d-flex justify-space-between align-center mb-6"},he={class:"text-h4 font-weight-bold mb-1"},Ce={class:"text-body-1 text-medium-emphasis"},xe={class:"font-weight-medium"},we={class:"text-body-2"},Ue={class:"text-center py-8"},Se={class:"text-h6 mb-2"},Te={class:"text-body-2 text-medium-emphasis"},Fe={class:"text-caption text-medium-emphasis mt-1"},_t=Z({__name:"index",setup(je){const{t}=ee(),$=te(),{showSuccess:A,showError:C}=me(),u=ne(),{tickets:I,loading:F,pagination:x,filters:De,error:O}=ae(u),y=f(""),b=f([]),k=f([]),V=f([]),h=f(""),j=f(""),g=f(!1),c=f({subject:"",category:"general",priority:"normal",message:"",attachments:[]}),K=le(()=>[{title:t("nav.dashboard"),to:{name:"affiliate-dashboard"}},{title:t("affiliate_tickets_title"),active:!0}]),M=[{value:"open",title:t("affiliate_tickets_status_open"),color:"info"},{value:"pending",title:t("affiliate_tickets_status_pending"),color:"warning"},{value:"waiting_user",title:t("affiliate_tickets_status_waiting_user"),color:"orange"},{value:"resolved",title:t("affiliate_tickets_status_resolved"),color:"success"},{value:"closed",title:t("affiliate_tickets_status_closed"),color:"secondary"}],D=[{value:"low",title:t("affiliate_tickets_priority_low"),color:"success"},{value:"normal",title:t("affiliate_tickets_priority_normal"),color:"info"},{value:"high",title:t("affiliate_tickets_priority_high"),color:"warning"},{value:"urgent",title:t("affiliate_tickets_priority_urgent"),color:"error"}],q=[{value:"general",title:t("affiliate_tickets_category_general")},{value:"orders",title:t("affiliate_tickets_category_orders")},{value:"payments",title:t("affiliate_tickets_category_payments")},{value:"commissions",title:t("affiliate_tickets_category_commissions")},{value:"kyc",title:t("affiliate_tickets_category_kyc")},{value:"technical",title:t("affiliate_tickets_category_technical")},{value:"other",title:t("affiliate_tickets_category_other")}],E=[{title:t("table.reference"),key:"id",sortable:!1},{title:t("affiliate_tickets_subject"),key:"subject",sortable:!0},{title:t("table.category"),key:"category",sortable:!0},{title:t("affiliate_tickets_priority"),key:"priority",sortable:!0},{title:t("table.status"),key:"status",sortable:!0},{title:t("affiliate_tickets_last_activity"),key:"last_activity_at",sortable:!0},{title:t("table.actions"),key:"actions",sortable:!1}],z=()=>{u.updateFilters({q:y.value,status:b.value,priority:k.value,category:V.value,date_from:h.value,date_to:j.value}),p()},Q=()=>{y.value="",b.value=[],k.value=[],V.value=[],h.value="",j.value="",u.resetFilters(),p()},p=async(s=1)=>{try{await u.fetchTickets(s)}catch{C(t("affiliate_tickets_error_loading"))}},G=s=>{p(s)},H=s=>{u.updateFilters({per_page:s}),p()},J=s=>{if(s.length>0){const{key:i,order:l}=s[0];u.updateFilters({sort:i,dir:l}),p()}},P=s=>{$.push({name:"affiliate-tickets-id",params:{id:s.id}})},L=()=>{c.value={subject:"",category:"general",priority:"normal",message:"",attachments:[]},g.value=!0},W=s=>{const i=s.target;i.files&&(c.value.attachments=Array.from(i.files))},N=async()=>{try{await u.createTicket(c.value),A(t("affiliate_tickets_created_success")),g.value=!1,p()}catch(s){C(s.message||t("affiliate_tickets_error_creating"))}},X=s=>new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return ie(O,s=>{s&&C(s)}),oe(()=>{p()}),(s,i)=>(re(),se("div",null,[e(de,{items:K.value},null,8,["items"]),m("div",Ve,[m("div",null,[m("h1",he,r(o(t)("support")),1),m("p",Ce,r(o(t)("affiliate_tickets_description")),1)]),e(_,{color:"primary","prepend-icon":"tabler-plus",onClick:L},{default:a(()=>i[11]||(i[11]=[d(" Nouveau ticket ")])),_:1,__:[11]})]),e(S,{class:"mb-6"},{default:a(()=>[e(B,null,{default:a(()=>[e(R,null,{default:a(()=>[e(n,{cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[e(U,{modelValue:y.value,"onUpdate:modelValue":i[0]||(i[0]=l=>y.value=l),label:o(t)("affiliate_tickets_search_label"),placeholder:o(t)("affiliate_tickets_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:"",onKeyup:ue(z,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[e(v,{modelValue:b.value,"onUpdate:modelValue":i[1]||(i[1]=l=>b.value=l),items:M,label:o(t)("affiliate_tickets_status_label"),multiple:"",chips:"",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue","label"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[e(v,{modelValue:k.value,"onUpdate:modelValue":i[2]||(i[2]=l=>k.value=l),items:D,label:o(t)("affiliate_tickets_priority_label"),multiple:"",chips:"",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue","label"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[e(v,{modelValue:V.value,"onUpdate:modelValue":i[3]||(i[3]=l=>V.value=l),items:q,label:o(t)("affiliate_tickets_category_label"),multiple:"",chips:"",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue","label"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[e(U,{modelValue:h.value,"onUpdate:modelValue":i[4]||(i[4]=l=>h.value=l),label:o(t)("affiliate_tickets_date_start"),type:"date"},null,8,["modelValue","label"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4",lg:"1",class:"d-flex align-center gap-2"},{default:a(()=>[e(_,{color:"primary",size:"small",onClick:z},{default:a(()=>[e(w,{icon:"tabler-search"})]),_:1}),e(_,{variant:"outlined",size:"small",onClick:Q},{default:a(()=>[e(w,{icon:"tabler-refresh"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(S,null,{default:a(()=>[e(pe,{headers:E,items:o(I),loading:o(F).list,"items-length":o(x).total,"items-per-page":o(x).per_page,page:o(x).current_page,"item-value":"id","onUpdate:page":G,"onUpdate:itemsPerPage":H,"onUpdate:sortBy":J},{"item.id":a(({item:l})=>[e(_,{variant:"text",size:"small",color:"primary",onClick:Y=>P(l)},{default:a(()=>[d(" #"+r(l.id.toString().slice(-8)),1)]),_:2},1032,["onClick"])]),"item.subject":a(({item:l})=>[m("div",xe,r(l.subject),1)]),"item.category":a(({item:l})=>[e(T,{size:"small",variant:"tonal",color:"info"},{default:a(()=>[d(r(o(u).getCategoryLabel(l.category)),1)]),_:2},1024)]),"item.priority":a(({item:l})=>[e(T,{color:o(u).getPriorityColor(l.priority),size:"small",variant:"tonal"},{default:a(()=>[d(r(o(u).getPriorityLabel(l.priority)),1)]),_:2},1032,["color"])]),"item.status":a(({item:l})=>[e(T,{color:o(u).getStatusColor(l.status),size:"small",variant:"tonal"},{default:a(()=>[d(r(o(u).getStatusLabel(l.status)),1)]),_:2},1032,["color"])]),"item.last_activity_at":a(({item:l})=>[m("span",we,r(X(l.last_activity_at)),1)]),"item.actions":a(({item:l})=>[e(_,{icon:"tabler-eye",size:"small",variant:"text",color:"primary",onClick:Y=>P(l)},null,8,["onClick"])]),"no-data":a(()=>[m("div",Ue,[e(w,{icon:"tabler-ticket-off",size:"64",class:"text-disabled mb-4"}),m("h3",Se,r(o(t)("affiliate_tickets_no_tickets_found")),1),m("p",Te,r(o(t)("affiliate_tickets_no_tickets_description")),1),e(_,{color:"primary",class:"mt-4",onClick:L},{default:a(()=>i[12]||(i[12]=[d(" Créer votre premier ticket ")])),_:1,__:[12]})])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),_:1}),e(ke,{modelValue:g.value,"onUpdate:modelValue":i[10]||(i[10]=l=>g.value=l),"max-width":"600"},{default:a(()=>[e(S,null,{default:a(()=>[e(fe,null,{default:a(()=>i[13]||(i[13]=[d("Créer un nouveau ticket")])),_:1,__:[13]}),e(B,null,{default:a(()=>[e(ge,{onSubmit:ce(N,["prevent"])},{default:a(()=>[e(R,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(U,{modelValue:c.value.subject,"onUpdate:modelValue":i[5]||(i[5]=l=>c.value.subject=l),label:o(t)("affiliate_tickets_subject_required"),placeholder:o(t)("affiliate_tickets_subject_placeholder"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(n,{cols:"12",md:"6"},{default:a(()=>[e(v,{modelValue:c.value.category,"onUpdate:modelValue":i[6]||(i[6]=l=>c.value.category=l),items:q,label:o(t)("affiliate_tickets_category_required"),"item-title":"title","item-value":"value",required:""},null,8,["modelValue","label"])]),_:1}),e(n,{cols:"12",md:"6"},{default:a(()=>[e(v,{modelValue:c.value.priority,"onUpdate:modelValue":i[7]||(i[7]=l=>c.value.priority=l),items:D,label:o(t)("affiliate_tickets_priority_required"),"item-title":"title","item-value":"value",required:""},null,8,["modelValue","label"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(ve,{modelValue:c.value.message,"onUpdate:modelValue":i[8]||(i[8]=l=>c.value.message=l),label:o(t)("affiliate_tickets_message_required"),placeholder:o(t)("affiliate_tickets_message_placeholder"),rows:"5",counter:"5000",maxlength:"5000",required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(ye,{label:o(t)("affiliate_tickets_attachments_optional"),multiple:"",accept:"image/*,.pdf,.doc,.docx,.txt","prepend-icon":"tabler-paperclip",onChange:W},null,8,["label"]),m("p",Fe,r(o(t)("affiliate_tickets_file_formats")),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(_e,null,{default:a(()=>[e(be),e(_,{variant:"outlined",onClick:i[9]||(i[9]=l=>g.value=!1)},{default:a(()=>[d(r(o(t)("affiliate_tickets_cancel")),1)]),_:1}),e(_,{color:"primary",loading:o(F).create,onClick:N},{default:a(()=>[d(r(o(t)("affiliate_tickets_create_button")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{_t as default};
