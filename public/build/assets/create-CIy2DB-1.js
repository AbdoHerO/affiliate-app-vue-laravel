import{d as pe,aL as fe,r as $,V as I,w as J,c as F,b as P,e as t,h as X,m as M,g as l,n as o,ac as O,t as p,v as r,f as m,aU as xe,az as se,F as he,j as Se,x as Ce,ai as ke,Z as Q,aj as te,bt as Ie,a2 as ae,aB as re,ak as Ae,cx as Pe,H as We,ao as $e,bR as Te,cy as Be,bx as K,N as Ee,as as Le,q as oe,bB as Ue,ct as De,c9 as Re,cJ as Fe,bU as ne,aD as Ne,bT as ze,cv as Me,cp as je,k as Ge,at as Oe,cT as He,aW as qe,b0 as Je,b1 as Ze,ba as Ke}from"./main-DnYrbSQO.js";import{u as be}from"./withdrawals-BegLyicb.js";import{u as we}from"./useNotifications-B96M_DMY.js";import{u as Qe}from"./useFormErrors-5_BWdK5_.js";import{u as Xe}from"./useSafeNavigation-DCbvf85L.js";import{_ as Ye}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DQ73-MJ6.js";import{V as j,a as _}from"./VRow-B-6WkvV7.js";import{V as et,a as ue}from"./VRadioGroup-DqkkILNL.js";import{V as de}from"./VTextField-BFgmXL2S.js";import{V as Y,b as tt}from"./VCard-om2cqSxr.js";import{V as ee}from"./VCardText-ByjN3mlm.js";import{V as ce}from"./VCheckbox-DIYvbVuP.js";import{V as ge}from"./VDivider-u64Rz-6W.js";import{V as at}from"./VChip-CjuV2Q4G.js";import{c as lt}from"./createSimpleFunctional-D0EIrpo1.js";import{V as Ve}from"./VAvatar-BwJp41ss.js";import{a as me,m as st,V as ve,b as ot}from"./VWindowItem-Co6Rem7Z.js";import{V as _e,m as it}from"./VSheet-C8x8PiSp.js";import{V as rt}from"./VForm-CBmw6Dgd.js";import{V as nt}from"./VAutocomplete-Czj-J9K1.js";import{a as ut,b as dt,d as ct}from"./VList-DOWShsA2.js";import{V as mt}from"./VSelect-CKLjvmQy.js";import{V as vt}from"./VTextarea-Dcb-AMDz.js";import{V as _t}from"./VAlert-MvsAUjNt.js";import"./VBreadcrumbs-C9tszCP5.js";/* empty css              */import"./VCheckboxBtn-CH3WdWXy.js";import"./VField-CQs8lPb7.js";import"./VImg-CrKU03S9.js";import"./forwardRefs-CKYzHDJS.js";import"./lazy-tUmo4pC_.js";import"./ssrBoot-DYjajp4c.js";import"./filter-Dgd-zPx5.js";import"./VMenu-Bwc3jIko.js";import"./VOverlay-B2NeWL_F.js";import"./dialog-transition-DVo_RrAy.js";const pt={class:"commission-selector"},ft={key:1},ht={key:0,class:"text-center py-4"},bt={class:"mt-2"},wt={key:1,class:"text-center py-4"},gt={key:2},Vt={class:"commission-list",style:{"max-height":"400px","overflow-y":"auto"}},yt={class:"text-body-2"},xt={class:"text-caption text-medium-emphasis"},St={class:"text-body-2"},Ct={class:"text-caption text-medium-emphasis"},kt={class:"text-body-2 font-weight-medium"},It={class:"text-caption"},At={class:"text-h6"},Pt={class:"text-h6"},Wt=pe({__name:"CommissionSelector",props:{userId:{},selectedCommissions:{default:()=>[]},mode:{default:"manual"},targetAmount:{default:0}},emits:["update:selectedCommissions","update:targetAmount","update:mode"],setup(a,{emit:L}){const{t:e}=fe(),n=a,g=L,V=be(),{showError:S}=we(),C=$([]),T=$(!1),h=$(""),s=$([...n.selectedCommissions]),y=$(n.mode),w=$(n.targetAmount),U=$(!1),W=I(()=>h.value?C.value.filter(i=>{var v,d,E;return i.id.toLowerCase().includes(h.value.toLowerCase())||((v=i.commande)==null?void 0:v.id.toLowerCase().includes(h.value.toLowerCase()))||((E=(d=i.produit)==null?void 0:d.titre)==null?void 0:E.toLowerCase().includes(h.value.toLowerCase()))}):C.value),R=I(()=>C.value.filter(i=>s.value.includes(i.id))),N=I(()=>R.value.reduce((i,v)=>{const d=Number(v.amount)||0;return i+d},0)),D=I(()=>W.value.length>0&&W.value.every(i=>s.value.includes(i.id))),z=I(()=>s.value.length>0&&!D.value);J(()=>n.selectedCommissions,i=>{console.log("📥 Received prop change:",i),U.value=!0,s.value=[...i],ke(()=>{U.value=!1,console.log("✅ Prop update complete, local changes allowed")})},{deep:!0}),J(()=>n.mode,i=>{y.value=i}),J(()=>n.targetAmount,i=>{w.value=i}),J(s,i=>{U.value?console.log("🔄 Skipping emit - updating from props"):(console.log("📤 Emitting selection change to parent:",i),g("update:selectedCommissions",i))},{deep:!0}),J(y,i=>{g("update:mode",i)}),J(w,i=>{g("update:targetAmount",i)});const B=async()=>{if(n.userId){T.value=!0;try{const i=await V.fetchEligibleCommissions(n.userId);i.success&&i.data?C.value=i.data.data||[]:S(i.message||e("admin_commission_load_error"))}catch{S(e("admin_commission_load_error"))}finally{T.value=!1}}},H=i=>{const v=s.value.indexOf(i);v>-1?s.value.splice(v,1):s.value.push(i)},b=()=>{D.value?W.value.forEach(i=>{const v=s.value.indexOf(i.id);v>-1&&s.value.splice(v,1)}):W.value.forEach(i=>{s.value.includes(i.id)||s.value.push(i.id)})},G=()=>{if(!w.value||w.value<=0)return;s.value=[];let i=0;const v=[...C.value].sort((d,E)=>new Date(d.created_at).getTime()-new Date(E.created_at).getTime());for(const d of v){if(i>=w.value)break;s.value.push(d.id),i+=d.amount}},q=()=>{s.value=[]};return J(()=>n.userId,B,{immediate:!0}),(i,v)=>(P(),F("div",pt,[t(j,{class:"mb-4"},{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[t(et,{modelValue:y.value,"onUpdate:modelValue":v[0]||(v[0]=d=>y.value=d),inline:"",class:"mb-4"},{default:l(()=>[t(ue,{label:o(e)("admin_commission_manual_selection"),value:"manual"},null,8,["label"]),t(ue,{label:o(e)("admin_commission_auto_selection"),value:"auto"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),y.value==="auto"?(P(),X(j,{key:0,class:"mb-4"},{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(de,{modelValue:w.value,"onUpdate:modelValue":v[1]||(v[1]=d=>w.value=d),modelModifiers:{number:!0},label:o(e)("admin_commission_target_amount"),type:"number",min:"0",step:"0.01",suffix:"MAD",onBlur:G},null,8,["modelValue","label"])]),_:1}),t(_,{cols:"12",md:"6",class:"d-flex align-center"},{default:l(()=>[t(O,{color:"primary",variant:"tonal",onClick:G},{default:l(()=>[p(r(o(e)("admin_commission_auto_select_button")),1)]),_:1})]),_:1})]),_:1})):M("",!0),y.value==="manual"?(P(),F("div",ft,[t(j,{class:"mb-4"},{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(de,{modelValue:h.value,"onUpdate:modelValue":v[2]||(v[2]=d=>h.value=d),label:o(e)("admin_commission_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:""},null,8,["modelValue","label"])]),_:1}),t(_,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:l(()=>[t(O,{variant:"tonal",size:"small",onClick:b},{default:l(()=>[p(r(D.value?o(e)("admin_commission_deselect_all"):o(e)("admin_commission_select_all")),1)]),_:1}),t(O,{variant:"tonal",color:"error",size:"small",onClick:q},{default:l(()=>[p(r(o(e)("admin_commission_clear")),1)]),_:1})]),_:1})]),_:1}),t(Y,null,{default:l(()=>[t(ee,null,{default:l(()=>[T.value?(P(),F("div",ht,[t(xe,{indeterminate:""}),m("p",bt,r(o(e)("admin_commission_loading")),1)])):W.value.length===0?(P(),F("div",wt,[t(se,{icon:"tabler-inbox",size:"48",class:"mb-2"}),m("p",null,r(o(e)("admin_commission_no_eligible")),1)])):(P(),F("div",gt,[t(j,{class:"mb-2 font-weight-medium"},{default:l(()=>[t(_,{cols:"1"},{default:l(()=>[t(ce,{"model-value":D.value,indeterminate:z.value,"onUpdate:modelValue":b},null,8,["model-value","indeterminate"])]),_:1}),t(_,{cols:"3"},{default:l(()=>[p(r(o(e)("admin_commission_header_commission")),1)]),_:1}),t(_,{cols:"3"},{default:l(()=>[p(r(o(e)("admin_commission_header_order")),1)]),_:1}),t(_,{cols:"2"},{default:l(()=>[p(r(o(e)("admin_commission_header_amount")),1)]),_:1}),t(_,{cols:"2"},{default:l(()=>[p(r(o(e)("admin_commission_header_status")),1)]),_:1}),t(_,{cols:"1"},{default:l(()=>[p(r(o(e)("admin_commission_header_date")),1)]),_:1})]),_:1}),t(ge,{class:"mb-2"}),m("div",Vt,[(P(!0),F(he,null,Se(W.value,d=>(P(),X(j,{key:d.id,class:Ce(["mb-1 align-center",{"bg-primary-lighten-5":s.value.includes(d.id)}])},{default:l(()=>[t(_,{cols:"1"},{default:l(()=>[t(ce,{"model-value":s.value.includes(d.id),onClick:E=>H(d.id)},null,8,["model-value","onClick"])]),_:2},1024),t(_,{cols:"3"},{default:l(()=>[m("div",yt,r(d.id.substring(0,8))+"...",1),m("div",xt,r(d.type),1)]),_:2},1024),t(_,{cols:"3"},{default:l(()=>{var E,Z;return[m("div",St,r((E=d.commande)==null?void 0:E.id.substring(0,8))+"...",1),m("div",Ct,r((Z=d.produit)==null?void 0:Z.titre),1)]}),_:2},1024),t(_,{cols:"2"},{default:l(()=>[m("div",kt,r(Number(d.amount).toFixed(2))+" MAD",1)]),_:2},1024),t(_,{cols:"2"},{default:l(()=>[t(at,{color:d.status==="approved"?"success":"info",variant:"tonal",size:"small"},{default:l(()=>[p(r(d.status),1)]),_:2},1032,["color"])]),_:2},1024),t(_,{cols:"1"},{default:l(()=>[m("div",It,r(new Date(d.created_at).toLocaleDateString()),1)]),_:2},1024)]),_:2},1032,["class"]))),128))])]))]),_:1})]),_:1})])):M("",!0),s.value.length>0?(P(),X(Y,{key:2,class:"mt-4",color:"primary",variant:"tonal"},{default:l(()=>[t(ee,null,{default:l(()=>[t(j,null,{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[m("div",At,r(o(e)("admin_commission_selected_count",{count:s.value.length})),1)]),_:1}),t(_,{cols:"12",md:"6",class:"text-md-end"},{default:l(()=>[m("div",Pt,r(o(e)("admin_commission_total"))+": "+r(Number(N.value).toFixed(2))+" MAD",1)]),_:1})]),_:1})]),_:1})]),_:1})):M("",!0)]))}}),ie=Symbol.for("vuetify:v-stepper"),ye=Q({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),$t=te()({name:"VStepperActions",props:ye(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(a,L){let{emit:e,slots:n}=L;const{t:g}=Ie();function V(){e("click:prev")}function S(){e("click:next")}return ae(()=>{const C={onClick:V},T={onClick:S};return t("div",{class:"v-stepper-actions"},[t(re,{defaults:{VBtn:{disabled:["prev",!0].includes(a.disabled),text:g(a.prevText),variant:"text"}}},{default:()=>{var h;return[((h=n.prev)==null?void 0:h.call(n,{props:C}))??t(O,C,null)]}}),t(re,{defaults:{VBtn:{color:a.color,disabled:["next",!0].includes(a.disabled),text:g(a.nextText),variant:"tonal"}}},{default:()=>{var h;return[((h=n.next)==null?void 0:h.call(n,{props:T}))??t(O,T,null)]}})])}),{}}}),Tt=lt("v-stepper-header"),Bt=Q({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:K,default:"$complete"},editable:Boolean,editIcon:{type:K,default:"$edit"},error:Boolean,errorIcon:{type:K,default:"$error"},icon:K,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),Et=Q({...Bt(),...Be()},"VStepperItem"),Lt=te()({name:"VStepperItem",directives:{Ripple:Ae},props:Et(),emits:{"group:selected":a=>!0},setup(a,L){let{slots:e}=L;const n=Pe(a,ie,!0),g=I(()=>(n==null?void 0:n.value.value)??a.value),V=I(()=>a.rules.every(w=>w()===!0)),S=I(()=>!a.disabled&&a.editable),C=I(()=>!a.disabled&&a.editable),T=I(()=>a.error||!V.value),h=I(()=>a.complete||a.rules.length>0&&V.value),s=I(()=>T.value?a.errorIcon:h.value?a.completeIcon:n.isSelected.value&&a.editable?a.editIcon:a.icon),y=I(()=>({canEdit:C.value,hasError:T.value,hasCompleted:h.value,title:a.title,subtitle:a.subtitle,step:g.value,value:a.value}));return ae(()=>{var N,D,z;const w=(!n||n.isSelected.value||h.value||C.value)&&!T.value&&!a.disabled,U=!!(a.title!=null||e.title),W=!!(a.subtitle!=null||e.subtitle);function R(){n==null||n.toggle()}return We(t("button",{class:["v-stepper-item",{"v-stepper-item--complete":h.value,"v-stepper-item--disabled":a.disabled,"v-stepper-item--error":T.value},n==null?void 0:n.selectedClass.value],disabled:!a.editable,type:"button",onClick:R},[S.value&&Te(!0,"v-stepper-item"),t(Ve,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:w?a.color:void 0,size:24},{default:()=>{var B;return[((B=e.icon)==null?void 0:B.call(e,y.value))??(s.value?t(se,{icon:s.value},null):g.value)]}}),t("div",{class:"v-stepper-item__content"},[U&&t("div",{key:"title",class:"v-stepper-item__title"},[((N=e.title)==null?void 0:N.call(e,y.value))??a.title]),W&&t("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[((D=e.subtitle)==null?void 0:D.call(e,y.value))??a.subtitle]),(z=e.default)==null?void 0:z.call(e,y.value)])]),[[$e("ripple"),a.ripple&&a.editable,null]])}),{}}}),Ut=Q({...Ue(st(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),Dt=te()({name:"VStepperWindow",props:Ut(),emits:{"update:modelValue":a=>!0},setup(a,L){let{slots:e}=L;const n=Ee(ie,null),g=Le(a,"modelValue"),V=I({get(){var S;return g.value!=null||!n?g.value:(S=n.items.value.find(C=>n.selected.value.includes(C.id)))==null?void 0:S.value},set(S){g.value=S}});return ae(()=>{const S=me.filterProps(a);return t(me,oe({_as:"VStepperWindow"},S,{modelValue:V.value,"onUpdate:modelValue":C=>V.value=C,class:["v-stepper-window",a.class],style:a.style,mandatory:!1,touch:!1}),e)}),{}}}),Rt=Q({...ot()},"VStepperWindowItem"),Ft=te()({name:"VStepperWindowItem",props:Rt(),setup(a,L){let{slots:e}=L;return ae(()=>{const n=ve.filterProps(a);return t(ve,oe({_as:"VStepperWindowItem"},n,{class:["v-stepper-window-item",a.class],style:a.style}),e)}),{}}}),Nt=Q({altLabels:Boolean,bgColor:String,completeIcon:K,editIcon:K,editable:Boolean,errorIcon:K,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...je()},"Stepper"),zt=Q({...Nt(),...Me({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...it(),...ze(ye(),["prevText","nextText"])},"VStepper"),Mt=te()({name:"VStepper",props:zt(),emits:{"update:modelValue":a=>!0},setup(a,L){let{slots:e}=L;const{items:n,next:g,prev:V,selected:S}=De(a,ie),{displayClasses:C,mobile:T}=Re(a),{completeIcon:h,editIcon:s,errorIcon:y,color:w,editable:U,prevText:W,nextText:R}=Fe(a),N=I(()=>a.items.map((B,H)=>{const b=ne(B,a.itemTitle,B),G=ne(B,a.itemValue,H+1);return{title:b,value:G,raw:B}})),D=I(()=>n.value.findIndex(B=>S.value.includes(B.id))),z=I(()=>a.disabled?a.disabled:D.value===0?"prev":D.value===n.value.length-1?"next":!1);return Ne({VStepperItem:{editable:U,errorIcon:y,completeIcon:h,editIcon:s,prevText:W,nextText:R},VStepperActions:{color:w,disabled:z,prevText:W,nextText:R}}),ae(()=>{const B=_e.filterProps(a),H=!!(e.header||a.items.length),b=a.items.length>0,G=!a.hideActions&&!!(b||e.actions);return t(_e,oe(B,{color:a.bgColor,class:["v-stepper",{"v-stepper--alt-labels":a.altLabels,"v-stepper--flat":a.flat,"v-stepper--non-linear":a.nonLinear,"v-stepper--mobile":T.value},C.value,a.class],style:a.style}),{default:()=>{var q,i;return[H&&t(Tt,{key:"stepper-header"},{default:()=>[N.value.map((v,d)=>{let{raw:E,...Z}=v;return t(he,null,[!!d&&t(ge,null,null),t(Lt,Z,{default:e[`header-item.${Z.value}`]??e.header,icon:e.icon,title:e.title,subtitle:e.subtitle})])})]}),b&&t(Dt,{key:"stepper-window"},{default:()=>[N.value.map(v=>t(Ft,{value:v.value},{default:()=>{var d,E;return((d=e[`item.${v.value}`])==null?void 0:d.call(e,v))??((E=e.item)==null?void 0:E.call(e,v))}}))]}),(q=e.default)==null?void 0:q.call(e,{prev:V,next:g}),G&&(((i=e.actions)==null?void 0:i.call(e,{next:g,prev:V}))??t($t,{key:"stepper-actions","onClick:prev":V,"onClick:next":g},e))]}})}),{prev:V,next:g}}}),jt={class:"text-h4 font-weight-bold"},Gt={class:"text-body-1 text-medium-emphasis"},Ot={key:0},Ht={class:"text-h6 mb-6"},qt={class:"text-caption"},Jt={key:1},Zt={class:"text-h6 mb-4"},Kt={key:2},Qt={class:"text-h6 mb-4"},Xt={class:"mb-2"},Yt={class:"mb-2"},ea={class:"mb-2"},ta={class:"mb-2"},aa={key:0,class:"mb-2"},la={class:"mb-2"},sa={key:1,class:"mb-2"},oa={class:"d-flex justify-space-between"},ia={class:"d-flex gap-2"},le=3,ja=pe({__name:"create",setup(a){const L=Ge(),{t:e}=fe(),n=be(),{showSuccess:g,showError:V}=we(),{errors:S,set:C,clear:T}=Qe(),{safePush:h}=Xe(),s=$({user_id:"",amount:null,method:"bank_transfer",notes:"",commission_ids:[]}),y=$("manual"),w=$(0),U=$(!1),W=$([]),R=$(!1),N=$([]),D=$(!1),z=$(),B=I(()=>[{title:e("dashboard"),to:"/admin/dashboard"},{title:e("finance"),disabled:!0},{title:e("admin_withdrawals_title"),to:"/admin/withdrawals"},{title:e("admin_withdrawals_create"),disabled:!0}]),H=I(()=>{if(b.value!==le||!s.value.user_id)return!1;const f=s.value.commission_ids.length>0,c=w.value>0&&y.value==="auto";return f||c}),b=$(1),G=f=>{var c,u;return((c=S.value)==null?void 0:c[f])&&((u=S.value[f])==null?void 0:u.length)>0},q=f=>{var c;return((c=S.value)==null?void 0:c[f])||[]},i=async f=>{var c,u;R.value=!0;try{const k=new URLSearchParams;f&&k.append("q",f),k.append("per_page","50"),k.append("role","affiliate");const x=`/admin/users${k.toString()?`?${k.toString()}`:""}`;console.log("🔍 [Create Withdrawal] Fetching users from:",x);const A=await Ke(x);console.log("📥 [Create Withdrawal] API Response:",A),A!=null&&A.users||(c=A==null?void 0:A.data)!=null&&c.users?(W.value=A.users||((u=A.data)==null?void 0:u.users)||[],console.log("✅ [Create Withdrawal] Users loaded:",W.value.length)):(console.error("❌ [Create Withdrawal] API returned error:",A),V((A==null?void 0:A.message)||e("errors.users_loading_error")))}catch(k){console.error("🚫 [Create Withdrawal] Error fetching users:",k),V(e("errors.users_loading_error"))}finally{R.value=!1}},v=async()=>{if(b.value<le){if(z.value){const{valid:f}=await z.value.validate();if(!f)return}b.value++}},d=()=>{b.value>1&&b.value--},E=async()=>{var c,u,k;if(!H.value)return;const{valid:f}=await((c=z.value)==null?void 0:c.validate());if(f){U.value=!0,T();try{const x={user_id:s.value.user_id,method:s.value.method,notes:s.value.notes||void 0};y.value==="auto"&&w.value>0?(x.amount=w.value,x.mode="auto"):s.value.commission_ids.length>0&&(x.commission_ids=s.value.commission_ids,x.mode="manual"),console.log("🔄 [Create Withdrawal] Submitting:",x);const A=await n.create(x);A.success?(g(A.message||e("admin_withdrawals_create_success")),await h(`/admin/withdrawals/${(u=A.data)==null?void 0:u.id}`)):V(A.message||e("admin_withdrawals_create_error"))}catch(x){console.error("🚫 [Create Withdrawal] Error:",x),(k=x.data)!=null&&k.errors?C(x.data.errors):V(e("admin_withdrawals_create_error_general"))}finally{U.value=!1}}},Z=async()=>{console.log("🔄 [Create Withdrawal] Cancelling, navigating to withdrawals list");try{await h("/admin/withdrawals")}catch(f){console.error("🚫 [Create Withdrawal] Error during cancel navigation:",f),L.push("/admin/withdrawals").catch(console.error)}};return Oe(()=>{console.log("🧹 [Create Withdrawal] Component unmounting"),U.value=!1,R.value=!1}),J(()=>s.value.user_id,async f=>{var c;if(s.value.commission_ids=[],w.value=0,!f){N.value=[];return}D.value=!0;try{const u=await n.fetchEligibleCommissions(f),k=Array.isArray((c=u==null?void 0:u.data)==null?void 0:c.data)?u.data.data:Array.isArray(u==null?void 0:u.data)?u.data:[];N.value=k,console.log("✅ [Create Withdrawal] Loaded eligible commissions:",N.value.length)}catch(u){console.error("❌ [Create Withdrawal] Error loading commissions:",u),V(e("errors.commissions_loading_error"))}finally{D.value=!1}},{immediate:!0}),He((f,c,u)=>{console.log("🔄 [Create Withdrawal] Leaving component, navigating to:",f==null?void 0:f.path),U.value=!1,R.value=!1,u()}),i(),(f,c)=>(P(),F("div",null,[t(Ye,{items:B.value},null,8,["items"]),t(j,{class:"mb-6"},{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[m("h1",jt,r(o(e)("admin_withdrawals_create_new")),1),m("p",Gt,r(o(e)("admin_withdrawals_create_description")),1)]),_:1})]),_:1}),t(Y,{class:"mb-6"},{default:l(()=>[t(ee,null,{default:l(()=>[t(Mt,{modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=u=>b.value=u),items:[{title:o(e)("admin_withdrawals_step_select_affiliate"),subtitle:o(e)("admin_withdrawals_step_select_affiliate_subtitle")},{title:o(e)("admin_withdrawals_step_select_commissions"),subtitle:o(e)("admin_withdrawals_step_select_commissions_subtitle")},{title:o(e)("admin_withdrawals_step_confirmation"),subtitle:o(e)("admin_withdrawals_step_confirmation_subtitle")}],flat:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(Y,null,{default:l(()=>[t(ee,null,{default:l(()=>[t(rt,{ref_key:"formRef",ref:z,onSubmit:qe(E,["prevent"])},{default:l(()=>[b.value===1?(P(),F("div",Ot,[m("h3",Ht,r(o(e)("admin_withdrawals_select_affiliate_title")),1),t(j,null,{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[t(nt,{modelValue:s.value.user_id,"onUpdate:modelValue":c[1]||(c[1]=u=>s.value.user_id=u),items:W.value,loading:R.value,"item-title":"nom_complet","item-value":"id",label:o(e)("admin_withdrawals_select_affiliate_label"),placeholder:o(e)("admin_withdrawals_search_affiliate_placeholder"),clearable:"",error:G("user_id"),"error-messages":q("user_id"),"onUpdate:search":i,"onClick:control":i,class:"mb-4"},{item:l(({props:u,item:k})=>[t(ut,Je(Ze(u)),{prepend:l(()=>[t(Ve,{size:"32",color:"primary"},{default:l(()=>{var x;return[m("span",qt,r((x=k.raw.nom_complet)==null?void 0:x.charAt(0)),1)]}),_:2},1024)]),default:l(()=>[t(dt,null,{default:l(()=>[p(r(k.raw.nom_complet),1)]),_:2},1024),t(ct,null,{default:l(()=>[p(r(k.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","label","placeholder","error","error-messages"])]),_:1})]),_:1}),t(j,null,{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(mt,{modelValue:s.value.method,"onUpdate:modelValue":c[2]||(c[2]=u=>s.value.method=u),items:[{title:o(e)("admin_withdrawals_bank_transfer"),value:"bank_transfer"}],label:o(e)("admin_withdrawals_method"),error:G("method"),"error-messages":q("method")},null,8,["modelValue","items","label","error","error-messages"])]),_:1}),t(_,{cols:"12",md:"6"},{default:l(()=>[t(vt,{modelValue:s.value.notes,"onUpdate:modelValue":c[3]||(c[3]=u=>s.value.notes=u),label:o(e)("admin_withdrawals_notes_optional"),placeholder:o(e)("admin_withdrawals_notes_placeholder"),rows:"3",error:G("notes"),"error-messages":q("notes")},null,8,["modelValue","label","placeholder","error","error-messages"])]),_:1})]),_:1})])):M("",!0),b.value===2&&s.value.user_id?(P(),F("div",Jt,[m("h3",Zt,r(o(e)("admin_withdrawals_commission_selection")),1),t(Wt,{"user-id":s.value.user_id,"selected-commissions":s.value.commission_ids,"onUpdate:selectedCommissions":c[4]||(c[4]=u=>s.value.commission_ids=u),mode:y.value,"onUpdate:mode":c[5]||(c[5]=u=>y.value=u),"target-amount":w.value,"onUpdate:targetAmount":c[6]||(c[6]=u=>w.value=u)},null,8,["user-id","selected-commissions","mode","target-amount"])])):M("",!0),b.value===3?(P(),F("div",Kt,[m("h3",Qt,r(o(e)("confirmation")),1),t(_t,{color:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[t(se,{icon:"tabler-info-circle",class:"me-2"}),p(" "+r(o(e)("verify_before_creating_withdrawal")),1)]),_:1}),t(j,null,{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(Y,{variant:"tonal"},{default:l(()=>[t(tt,null,{default:l(()=>[p(r(o(e)("withdrawal_information")),1)]),_:1}),t(ee,null,{default:l(()=>{var u,k;return[m("div",Xt,[m("strong",null,r(o(e)("affiliate"))+":",1),p(" "+r((u=W.value.find(x=>x.id===s.value.user_id))==null?void 0:u.nom_complet),1)]),m("div",Yt,[m("strong",null,r(o(e)("email"))+":",1),p(" "+r((k=W.value.find(x=>x.id===s.value.user_id))==null?void 0:k.email),1)]),m("div",ea,[m("strong",null,r(o(e)("method"))+":",1),p(" "+r(s.value.method==="bank_transfer"?o(e)("bank_transfer"):s.value.method),1)]),m("div",ta,[m("strong",null,r(o(e)("selection_mode"))+":",1),p(" "+r(y.value==="auto"?o(e)("automatic"):o(e)("manual")),1)]),y.value==="auto"?(P(),F("div",aa,[m("strong",null,r(o(e)("target_amount"))+":",1),p(" "+r(Number(w.value).toFixed(2))+" MAD ",1)])):M("",!0),m("div",la,[m("strong",null,r(o(e)("selected_commissions"))+":",1),p(" "+r(s.value.commission_ids.length),1)]),s.value.notes?(P(),F("div",sa,[m("strong",null,r(o(e)("notes"))+":",1),p(" "+r(s.value.notes),1)])):M("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])):M("",!0),t(j,{class:"mt-6"},{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[m("div",oa,[m("div",null,[b.value>1?(P(),X(O,{key:0,variant:"tonal",onClick:d},{default:l(()=>[p(r(o(e)("actions.previous")),1)]),_:1})):M("",!0)]),m("div",ia,[t(O,{variant:"tonal",onClick:Z},{default:l(()=>[p(r(o(e)("actions.cancel")),1)]),_:1}),b.value<le?(P(),X(O,{key:0,color:"primary",disabled:b.value===1&&!s.value.user_id,onClick:v},{default:l(()=>[p(r(o(e)("actions.next")),1)]),_:1},8,["disabled"])):M("",!0),b.value===le?(P(),X(O,{key:1,color:"primary",loading:U.value,disabled:!H.value,type:"submit"},{default:l(()=>[p(r(o(e)("admin_withdrawals_create_withdrawal")),1)]),_:1},8,["loading","disabled"])):M("",!0)])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]))}});export{ja as default};
