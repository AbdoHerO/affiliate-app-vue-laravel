import{d as ue,k as _e,aL as me,b7 as pe,b8 as ve,r as S,V as I,w as fe,o as he,c as Z,b as _,e as a,h as g,m as v,g as l,f as i,v as n,n as s,ac as $,t as x,az as N}from"./main-3LuWNv9W.js";import{u as be}from"./withdrawals-zZ_iengp.js";import{_ as we}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-BJ6JYbX8.js";import{_ as ge,a as ye}from"./WithdrawalActionDialog.vue_vue_type_script_setup_true_lang-UdcHhcw8.js";import{A as B}from"./ActionIcon-DKcf4fGC.js";import{useQuickConfirm as xe}from"./useConfirmAction-CUN-9iuP.js";import{u as ke}from"./useNotifications-B3v5F4dH.js";import{a as f,V as L}from"./VRow-aVZbYr4A.js";import{V as z}from"./VCard-QqgF9aMj.js";import{V as F}from"./VCardText-Dqaeyxp0.js";import{V as q}from"./VTextField-CsO1UfXI.js";import{V as ee}from"./VSelect-V4QjM3w5.js";import{V as E}from"./VChip-D2hyzrT3.js";import{V as Ve}from"./VAlert-cTzgSexk.js";import{V as Ce}from"./VCheckbox-CCw81tQf.js";import{V as Ae}from"./VDataTable-Dz5dOo4J.js";import"./VBreadcrumbs-Cjt6xYOm.js";import"./VDialog-DuTMUR2U.js";import"./VOverlay-DHKe6cTP.js";import"./forwardRefs-BZg6tG7B.js";import"./lazy-vcHGEOxt.js";import"./VImg-DjZhnPY1.js";import"./dialog-transition-TWAYErkS.js";import"./VForm-BMJZijf-.js";import"./VField-CzoZXYxi.js";import"./VTextarea-BxOghhaY.js";import"./VFileInput-kvKLuAqf.js";import"./VSpacer-Ckvg-9-2.js";/* empty css              */import"./createSimpleFunctional-CbZg_Do-.js";import"./VTooltip-DeQJuQst.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAvatar-CH3JpKwD.js";import"./VList-DWKF8cD-.js";import"./ssrBoot-DPE17Lki.js";import"./VDivider-D28qXVrs.js";import"./VMenu-cCaIVuKn.js";import"./VCheckboxBtn-BQUGQfLA.js";import"./VPagination-C9G78dYZ.js";import"./VTable-Dyn4MLHa.js";import"./filter-DJ4i-HET.js";const Se={class:"text-h4 font-weight-bold"},De={class:"text-body-1 text-medium-emphasis"},Fe={class:"d-flex justify-space-between align-center"},Te={class:"text-h6"},je={class:"text-body-2"},ze={class:"text-caption mt-2"},Ue={class:"d-flex justify-space-between align-center"},$e={class:"text-h6"},Ne={class:"text-body-2"},Be={class:"text-caption mt-2"},Ee={class:"d-flex justify-space-between align-center"},Me={class:"text-h6"},We={class:"text-body-2"},Ie={class:"text-caption mt-2"},Le={class:"d-flex justify-space-between align-center"},Oe={class:"text-h6"},Re={class:"text-body-2"},Pe={class:"text-caption mt-2"},qe={class:"d-flex align-center gap-2 flex-wrap"},Qe={class:"d-flex justify-space-between align-center"},He={class:"d-flex gap-2"},Ge={class:"d-flex align-center gap-2"},Je={class:"text-body-2"},Ke={class:"d-flex gap-2"},Xe={class:"text-body-2 font-family-monospace"},Ye={class:"text-body-2 font-weight-medium"},Ze={class:"text-caption text-medium-emphasis"},et={class:"text-body-2 font-weight-medium"},tt={class:"text-center"},at={class:"text-body-2"},lt={class:"text-caption text-medium-emphasis"},st={key:0,class:"d-flex gap-1"},ot={class:"text-center py-8"},it={class:"text-h6 mb-2"},nt={class:"text-body-2 text-medium-emphasis mb-4"},rt="created_at",dt="desc",ea=ue({__name:"index",setup(ct){const Q=_e(),{t}=me(),M=be();pe();const{confirm:ut}=xe(),{showSuccess:H,showError:O}=ke(),{withdrawals:U,summary:k,loading:G,pagination:h,filters:J}=ve(M),m=S(""),p=S([]),D=S(""),V=S(""),C=S(""),A=S(""),b=S([]),y=S({isVisible:!1,withdrawal:null,action:"approve"}),te=r=>Object.fromEntries(Object.entries(r).filter(([o,c])=>!(c===""||c===null||c===void 0||Array.isArray(c)&&c.length===0))),ae=I(()=>[{title:t("dashboard"),to:"/admin/dashboard"},{title:t("finance"),disabled:!0},{title:t("admin_withdrawals_title"),disabled:!0}]),le=[{title:t("admin_withdrawals_pending"),value:"pending"},{title:t("admin_withdrawals_approved"),value:"approved"},{title:t("admin_withdrawals_mark_in_payment"),value:"in_payment"},{title:t("admin_withdrawals_paid"),value:"paid"},{title:t("admin_withdrawals_rejected"),value:"rejected"},{title:t("status_canceled"),value:"canceled"}],se=[{title:t("payment_method_bank_transfer"),value:"bank_transfer"}],oe=[{title:t("table_column_reference"),key:"id",sortable:!0},{title:t("table_column_affiliate"),key:"user.nom_complet",sortable:!0},{title:t("admin_withdrawals_amount"),key:"amount",sortable:!0},{title:t("table_column_method"),key:"method",sortable:!1},{title:t("table_column_status"),key:"status",sortable:!0},{title:t("table_column_commissions"),key:"commission_count",sortable:!1},{title:t("admin_withdrawals_created_at"),key:"created_at",sortable:!0},{title:t("table_column_actions"),key:"actions",sortable:!1}],R=I(()=>{var r;return!!((r=m.value)!=null&&r.trim()||p.value.length>0||D.value||V.value||C.value||A.value)}),P=I(()=>{const r=U.value||[];if(!r.length)return!1;const o=new Set((b.value||[]).filter(Boolean));return r.every(c=>c&&c.id&&o.has(c.id))}),ie=I(()=>{const r=U.value||[],o=new Set((b.value||[]).filter(Boolean));return!r.length||!o.size?!1:!P.value}),T=async()=>{var c,e;const r={page:h.value.current_page,per_page:h.value.per_page,sort:((c=J.value)==null?void 0:c.sort)||rt,dir:((e=J.value)==null?void 0:e.dir)||dt,q:m.value,status:p.value,user_id:D.value,method:V.value,date_from:C.value,date_to:A.value},o=te(r);console.log("ðŸ” Fetching withdrawals with filters:",o);try{await M.fetchList(o),console.log("âœ… Withdrawals fetched successfully:",U.value.length,"items")}catch(d){console.error("âŒ Error fetching withdrawals:",d)}},ne=async()=>{j&&(clearTimeout(j),j=void 0),m.value="",p.value=[],D.value="",V.value="",C.value="",A.value="",b.value=[],h.value.current_page=1,h.value.per_page=h.value.per_page||10,M.resetFilters(),await T()},re=()=>{const r=(U.value||[]).filter(o=>o&&o.id);if(!r.length){b.value=[];return}P.value?b.value=[]:b.value=r.map(o=>o.id)},de=r=>{if(!(r!=null&&r.id)){O(t("error_invalid_withdrawal_id"));return}Q.push(`/admin/withdrawals/${r.id}`)},W=(r,o)=>{if(!r){console.error("Cannot open action dialog: withdrawal is null");return}y.value={isVisible:!0,withdrawal:{...r},action:o}},K=()=>{y.value={isVisible:!1,withdrawal:null,action:"approve"}},ce=async()=>{try{K(),b.value=[],await T(),H(t("action_success"))}catch(r){console.error("Error handling action success:",r),O(t("error_updating_data"))}},X=async()=>{const r={};m.value&&(r.q=m.value),p.value.length>0&&(r.status=p.value),D.value&&(r.user_id=D.value),V.value&&(r.method=V.value),C.value&&(r.date_from=C.value),A.value&&(r.date_to=A.value);const o=await M.exportCsv(r);o.success?H(o.message||t("export_success")):O(o.message||t("export_error"))},Y=()=>{Q.push("/admin/withdrawals/create")};let j;return fe([m,p,D,V,C,A],()=>{j&&clearTimeout(j),j=window.setTimeout(()=>{h.value.current_page=1,T()},300)},{deep:!0}),he(()=>{T()}),(r,o)=>{var c;return _(),Z("div",null,[a(we,{items:ae.value},null,8,["items"]),a(L,{class:"mb-6"},{default:l(()=>[a(f,{cols:"12",md:"6"},{default:l(()=>[i("h1",Se,n(s(t)("admin_withdrawals_title")),1),i("p",De,n(s(t)("admin_withdrawals_subtitle")),1)]),_:1}),a(f,{cols:"12",md:"6",class:"text-md-end"},{default:l(()=>[a($,{color:"primary","prepend-icon":"tabler-plus",onClick:Y},{default:l(()=>[x(n(s(t)("admin_withdrawals_create")),1)]),_:1})]),_:1})]),_:1}),s(k)?(_(),g(L,{key:0,class:"mb-6"},{default:l(()=>[a(f,{cols:"12",sm:"6",md:"3"},{default:l(()=>[a(z,{color:"warning",variant:"tonal"},{default:l(()=>[a(F,null,{default:l(()=>{var e,d,u,w;return[i("div",Fe,[i("div",null,[i("div",Te,n(((d=(e=s(k))==null?void 0:e.pending)==null?void 0:d.count)||0),1),i("div",je,n(s(t)("admin_withdrawals_pending")),1)]),a(N,{icon:"tabler-clock",size:"32"})]),i("div",ze,n(Number(((w=(u=s(k))==null?void 0:u.pending)==null?void 0:w.amount)||0).toFixed(2))+" MAD",1)]}),_:1})]),_:1})]),_:1}),a(f,{cols:"12",sm:"6",md:"3"},{default:l(()=>[a(z,{color:"info",variant:"tonal"},{default:l(()=>[a(F,null,{default:l(()=>{var e,d,u,w;return[i("div",Ue,[i("div",null,[i("div",$e,n(((d=(e=s(k))==null?void 0:e.approved)==null?void 0:d.count)||0),1),i("div",Ne,n(s(t)("admin_withdrawals_approved")),1)]),a(N,{icon:"tabler-check",size:"32"})]),i("div",Be,n(Number(((w=(u=s(k))==null?void 0:u.approved)==null?void 0:w.amount)||0).toFixed(2))+" MAD",1)]}),_:1})]),_:1})]),_:1}),a(f,{cols:"12",sm:"6",md:"3"},{default:l(()=>[a(z,{color:"primary",variant:"tonal"},{default:l(()=>[a(F,null,{default:l(()=>{var e,d,u,w;return[i("div",Ee,[i("div",null,[i("div",Me,n(((d=(e=s(k))==null?void 0:e.in_payment)==null?void 0:d.count)||0),1),i("div",We,n(s(t)("status_in_payment")),1)]),a(N,{icon:"tabler-credit-card",size:"32"})]),i("div",Ie,n(Number(((w=(u=s(k))==null?void 0:u.in_payment)==null?void 0:w.amount)||0).toFixed(2))+" MAD",1)]}),_:1})]),_:1})]),_:1}),a(f,{cols:"12",sm:"6",md:"3"},{default:l(()=>[a(z,{color:"success",variant:"tonal"},{default:l(()=>[a(F,null,{default:l(()=>{var e,d,u,w;return[i("div",Le,[i("div",null,[i("div",Oe,n(((d=(e=s(k))==null?void 0:e.paid)==null?void 0:d.count)||0),1),i("div",Re,n(s(t)("admin_withdrawals_paid")),1)]),a(N,{icon:"tabler-check-circle",size:"32"})]),i("div",Pe,n(Number(((w=(u=s(k))==null?void 0:u.paid)==null?void 0:w.amount)||0).toFixed(2))+" MAD",1)]}),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),a(z,{class:"mb-6"},{default:l(()=>[a(F,null,{default:l(()=>[a(L,null,{default:l(()=>[a(f,{cols:"12",md:"3"},{default:l(()=>[a(q,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),label:s(t)("search_withdrawals_placeholder"),"prepend-inner-icon":"tabler-search",loading:s(G),clearable:"",hint:s(t)("search_withdrawals_hint"),"persistent-hint":""},null,8,["modelValue","label","loading","hint"])]),_:1}),a(f,{cols:"12",md:"3"},{default:l(()=>[a(ee,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),items:le,label:s(t)("table_column_status"),multiple:"",chips:"",clearable:""},null,8,["modelValue","label"])]),_:1}),a(f,{cols:"12",md:"2"},{default:l(()=>[a(ee,{modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=e=>V.value=e),items:se,label:s(t)("table_column_method"),clearable:""},null,8,["modelValue","label"])]),_:1}),a(f,{cols:"12",md:"2"},{default:l(()=>[a(q,{modelValue:C.value,"onUpdate:modelValue":o[3]||(o[3]=e=>C.value=e),label:s(t)("filter_date_from"),type:"date"},null,8,["modelValue","label"])]),_:1}),a(f,{cols:"12",md:"2"},{default:l(()=>[a(q,{modelValue:A.value,"onUpdate:modelValue":o[4]||(o[4]=e=>A.value=e),label:s(t)("filter_date_to"),type:"date"},null,8,["modelValue","label"])]),_:1})]),_:1}),R.value?(_(),g(L,{key:0,class:"mt-4"},{default:l(()=>[a(f,{cols:"12"},{default:l(()=>{var e;return[i("div",qe,[a(E,{color:"primary",variant:"tonal",size:"small"},{default:l(()=>{var d;return[x(n(Object.values({search:(d=m.value)==null?void 0:d.trim(),statuses:p.value.length,user:D.value,method:V.value,dateFrom:C.value,dateTo:A.value}).filter(Boolean).length)+" "+n(s(t)("filters_active")),1)]}),_:1}),(e=m.value)!=null&&e.trim()?(_(),g(E,{key:0,color:"info",variant:"outlined",size:"small",closable:"","onClick:close":o[5]||(o[5]=d=>m.value="")},{default:l(()=>[x(n(s(t)("filter_search"))+': "'+n(m.value.trim())+'" ',1)]),_:1})):v("",!0),p.value.length>0?(_(),g(E,{key:1,color:"info",variant:"outlined",size:"small",closable:"","onClick:close":o[6]||(o[6]=d=>p.value=[])},{default:l(()=>[x(n(s(t)("table_column_status"))+": "+n(p.value.length),1)]),_:1})):v("",!0),a($,{variant:"tonal",color:"error",size:"small","prepend-icon":"tabler-filter-x",onClick:ne},{default:l(()=>[x(n(s(t)("clear_all_filters")),1)]),_:1})])]}),_:1})]),_:1})):v("",!0)]),_:1})]),_:1}),a(z,null,{default:l(()=>[b.value.length>0?(_(),g(F,{key:0,class:"pb-0"},{default:l(()=>[a(Ve,{color:"info",variant:"tonal"},{default:l(()=>[i("div",Qe,[i("span",null,n(b.value.length)+" "+n(s(t)("selected_withdrawals")),1),i("div",He,[a($,{variant:"tonal",size:"small",onClick:X},{default:l(()=>[x(n(s(t)("export_selection")),1)]),_:1})])])]),_:1})]),_:1})):v("",!0),a(F,{class:"d-flex justify-space-between align-center"},{default:l(()=>[i("div",Ge,[a(Ce,{"model-value":P.value,indeterminate:ie.value,onClick:re},null,8,["model-value","indeterminate"]),i("span",Je,n(s(t)("select_all")),1)]),i("div",Ke,[a($,{variant:"tonal","prepend-icon":"tabler-download",onClick:X},{default:l(()=>[x(n(s(t)("action_export")),1)]),_:1})])]),_:1}),a(Ae,{headers:oe,items:s(U),loading:s(G),"items-per-page":s(h).per_page,page:s(h).current_page,"items-length":s(h).total,"show-select":"",modelValue:b.value,"onUpdate:modelValue":o[7]||(o[7]=e=>b.value=e),"item-value":"id","onUpdate:page":o[8]||(o[8]=e=>{s(h).current_page=e,T()}),"onUpdate:itemsPerPage":o[9]||(o[9]=e=>{s(h).per_page=e,T()})},{"item.id":l(({item:e})=>[i("div",Xe,n(e!=null&&e.id?e.id.slice(0,8)+"...":"â€”"),1)]),"item.user.nom_complet":l(({item:e})=>{var d,u;return[i("div",null,[i("div",Ye,n(((d=e==null?void 0:e.user)==null?void 0:d.nom_complet)||"â€”"),1),i("div",Ze,n(((u=e==null?void 0:e.user)==null?void 0:u.email)||""),1)])]}),"item.amount":l(({item:e})=>[i("div",et,n(Number((e==null?void 0:e.amount)||0).toFixed(2))+" MAD ",1)]),"item.method":l(({item:e})=>[a(E,{variant:"tonal",size:"small"},{default:l(()=>[x(n((e==null?void 0:e.method)==="bank_transfer"?s(t)("payment_method_bank_transfer"):(e==null?void 0:e.method)||"â€”"),1)]),_:2},1024)]),"item.status":l(({item:e})=>[a(ge,{status:(e==null?void 0:e.status)||"pending"},null,8,["status"])]),"item.commission_count":l(({item:e})=>[i("div",tt,[a(E,{variant:"tonal",color:"primary",size:"small"},{default:l(()=>[x(n((e==null?void 0:e.commission_count)??0),1)]),_:2},1024)])]),"item.created_at":l(({item:e})=>[i("div",at,n(e!=null&&e.created_at?new Date(e.created_at).toLocaleDateString():"â€”"),1),i("div",lt,n(e!=null&&e.created_at?new Date(e.created_at).toLocaleTimeString():""),1)]),"item.actions":l(({item:e})=>[e&&e.id?(_(),Z("div",st,[a(B,{icon:"tabler-eye",label:s(t)("action_view_details"),onClick:d=>de(e)},null,8,["label","onClick"]),e.can_approve?(_(),g(B,{key:0,icon:"tabler-check",label:s(t)("admin_withdrawals_approve"),variant:"success",onClick:d=>W(e,"approve")},null,8,["label","onClick"])):v("",!0),e.can_reject?(_(),g(B,{key:1,icon:"tabler-x",label:s(t)("admin_withdrawals_reject"),variant:"danger",onClick:d=>W(e,"reject")},null,8,["label","onClick"])):v("",!0),e.can_mark_in_payment?(_(),g(B,{key:2,icon:"tabler-clock",label:s(t)("admin_withdrawals_mark_in_payment"),variant:"primary",onClick:d=>W(e,"mark_in_payment")},null,8,["label","onClick"])):v("",!0),e.can_mark_paid?(_(),g(B,{key:3,icon:"tabler-credit-card",label:s(t)("admin_withdrawals_mark_paid"),variant:"success",onClick:d=>W(e,"mark_paid")},null,8,["label","onClick"])):v("",!0)])):v("",!0)]),"no-data":l(()=>[i("div",ot,[a(N,{icon:"tabler-inbox",size:"64",class:"mb-4"}),i("h3",it,n(s(t)("no_withdrawals_found")),1),i("p",nt,n(R.value?s(t)("no_withdrawals_match_filters"):s(t)("no_withdrawals_created")),1),R.value?v("",!0):(_(),g($,{key:0,color:"primary",onClick:Y},{default:l(()=>[x(n(s(t)("create_first_withdrawal")),1)]),_:1}))])]),_:1},8,["items","loading","items-per-page","page","items-length","modelValue"])]),_:1}),y.value.isVisible&&y.value.withdrawal?(_(),g(ye,{key:(((c=y.value.withdrawal)==null?void 0:c.id)||"new")+"-"+y.value.action,"is-visible":y.value.isVisible,"onUpdate:isVisible":o[10]||(o[10]=e=>y.value.isVisible=e),withdrawal:y.value.withdrawal,action:y.value.action,onSuccess:ce,onClosed:K},null,8,["is-visible","withdrawal","action"])):v("",!0)])}}});export{ea as default};
