import{d as ee,aL as te,k as ae,b8 as le,r as f,V as ie,w as oe,o as se,c as re,b as ce,e as t,f as m,v as r,n as i,g as a,t as d,ac as _,cG as ue,az as w,aW as ne}from"./main-0h7RfoM1.js";import{u as me}from"./tickets-BtUO1hAJ.js";import{u as de}from"./useNotifications-QM5aCJtM.js";import{u as fe}from"./useTicketBadge-BSA3ZVZk.js";import{_ as _e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-pmQ-bLAs.js";import{V as N}from"./VCardText-DBDe3l6V.js";import{V as R,a as n}from"./VRow-CwTmyELD.js";import{V as T}from"./VTextField-CB8SxAnl.js";import{V as v}from"./VSelect-E3I5xPtI.js";import{V as S,b as pe,c as ge}from"./VCard-BJO62jXa.js";import{V as ve}from"./VDataTableServer-S93ZGevF.js";import{V as U}from"./VChip-Cb1gcZbV.js";import{V as ye}from"./VForm-BfVpbreJ.js";import{V as ke}from"./VTextarea-DdmtxOZ7.js";import{V as be}from"./VFileInput-DG52I9ci.js";import{V as Ve}from"./VSpacer-CFtTO3F2.js";import{V as he}from"./VDialog-rW2Q1SF0.js";import"./useAuth-Gxh1X3Vv.js";import"./VBreadcrumbs-C5bXM6fl.js";/* empty css              */import"./VField-ThiSfLeE.js";import"./VImg-D8VstP0L.js";import"./forwardRefs-DtnMMuBS.js";import"./VList-D8OGLl9W.js";import"./ssrBoot-_8LWlSSM.js";import"./createSimpleFunctional-CRjW3p8V.js";import"./VAvatar-BcyggOHV.js";import"./VDivider-CF-VI2ua.js";import"./dialog-transition--QLlkKWU.js";import"./VMenu-BRSAgo5d.js";import"./VOverlay-cV5WKNuZ.js";import"./lazy-DAn2yZiW.js";import"./VCheckboxBtn-DNqYvCTV.js";import"./VDataTable-CrgqCoMT.js";import"./VPagination-CjKu94po.js";import"./VTable-BHYHnEIv.js";import"./filter-BbUs5nlv.js";const Ce={class:"d-flex justify-space-between align-center mb-6"},xe={class:"text-h4 font-weight-bold mb-1"},we={class:"text-body-1 text-medium-emphasis"},Te={class:"font-weight-medium"},Se={class:"text-body-2"},Ue={class:"text-center py-8"},Fe={class:"text-h6 mb-2"},je={class:"text-body-2 text-medium-emphasis"},qe={class:"text-caption text-medium-emphasis mt-1"},vt=ee({__name:"index",setup(ze){const{t:e}=te(),$=ae(),{showSuccess:A,showError:C}=de(),{refresh:I}=fe(),c=me(),{tickets:O,loading:F,pagination:x,filters:De,error:K}=le(c),y=f(""),k=f([]),b=f([]),V=f([]),h=f(""),j=f(""),g=f(!1),u=f({subject:"",category:"general",priority:"normal",message:"",attachments:[]}),M=ie(()=>[{title:e("nav.dashboard"),to:"/affiliate/dashboard"},{title:e("affiliate_tickets_title"),active:!0}]),E=[{value:"open",title:e("affiliate_tickets_status_open"),color:"info"},{value:"pending",title:e("affiliate_tickets_status_pending"),color:"warning"},{value:"waiting_user",title:e("affiliate_tickets_status_waiting_user"),color:"orange"},{value:"resolved",title:e("affiliate_tickets_status_resolved"),color:"success"},{value:"closed",title:e("affiliate_tickets_status_closed"),color:"secondary"}],q=[{value:"low",title:e("affiliate_tickets_priority_low"),color:"success"},{value:"normal",title:e("affiliate_tickets_priority_normal"),color:"info"},{value:"high",title:e("affiliate_tickets_priority_high"),color:"warning"},{value:"urgent",title:e("affiliate_tickets_priority_urgent"),color:"error"}],z=[{value:"general",title:e("affiliate_tickets_category_general")},{value:"orders",title:e("affiliate_tickets_category_orders")},{value:"payments",title:e("affiliate_tickets_category_payments")},{value:"commissions",title:e("affiliate_tickets_category_commissions")},{value:"kyc",title:e("affiliate_tickets_category_kyc")},{value:"technical",title:e("affiliate_tickets_category_technical")},{value:"other",title:e("affiliate_tickets_category_other")}],G=[{title:e("table.reference"),key:"id",sortable:!1},{title:e("affiliate_tickets_subject"),key:"subject",sortable:!0},{title:e("table.category"),key:"category",sortable:!0},{title:e("affiliate_tickets_priority"),key:"priority",sortable:!0},{title:e("table.status"),key:"status",sortable:!0},{title:e("affiliate_tickets_last_activity"),key:"last_activity_at",sortable:!0},{title:e("table.actions"),key:"actions",sortable:!1}],D=()=>{c.updateFilters({q:y.value,status:k.value,priority:b.value,category:V.value,date_from:h.value,date_to:j.value}),p()},Q=()=>{y.value="",k.value=[],b.value=[],V.value=[],h.value="",j.value="",c.resetFilters(),p()},p=async(s=1)=>{try{await c.fetchTickets(s),I()}catch{C(e("affiliate_tickets_error_loading"))}},W=s=>{p(s)},H=s=>{c.updateFilters({per_page:s}),p()},J=s=>{if(s.length>0){const{key:o,order:l}=s[0];c.updateFilters({sort:o,dir:l}),p()}},P=s=>{$.push({name:"affiliate-tickets-id",params:{id:s.id}})},B=()=>{u.value={subject:"",category:"general",priority:"normal",message:"",attachments:[]},g.value=!0},X=s=>{const o=s.target;o.files&&(u.value.attachments=Array.from(o.files))},L=async()=>{try{await c.createTicket(u.value),A(e("affiliate_tickets_created_success")),g.value=!1,p()}catch(s){C(s.message||e("affiliate_tickets_error_creating"))}},Y=s=>new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return oe(K,s=>{s&&C(s)}),se(()=>{p()}),(s,o)=>(ce(),re("div",null,[t(_e,{items:M.value},null,8,["items"]),m("div",Ce,[m("div",null,[m("h1",xe,r(i(e)("support")),1),m("p",we,r(i(e)("affiliate_tickets_description")),1)]),t(_,{color:"primary","prepend-icon":"tabler-plus",onClick:B},{default:a(()=>[d(r(i(e)("new_ticket")),1)]),_:1})]),t(S,{class:"mb-6"},{default:a(()=>[t(N,null,{default:a(()=>[t(R,null,{default:a(()=>[t(n,{cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[t(T,{modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=l=>y.value=l),label:i(e)("affiliate_tickets_search_label"),placeholder:i(e)("affiliate_tickets_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:"",onKeyup:ue(D,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[t(v,{modelValue:k.value,"onUpdate:modelValue":o[1]||(o[1]=l=>k.value=l),items:E,label:i(e)("affiliate_tickets_status_label"),multiple:"",chips:"",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue","label"])]),_:1}),t(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[t(v,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=l=>b.value=l),items:q,label:i(e)("affiliate_tickets_priority_label"),multiple:"",chips:"",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue","label"])]),_:1}),t(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[t(v,{modelValue:V.value,"onUpdate:modelValue":o[3]||(o[3]=l=>V.value=l),items:z,label:i(e)("affiliate_tickets_category_label"),multiple:"",chips:"",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue","label"])]),_:1}),t(n,{cols:"12",sm:"6",md:"4",lg:"2"},{default:a(()=>[t(T,{modelValue:h.value,"onUpdate:modelValue":o[4]||(o[4]=l=>h.value=l),label:i(e)("affiliate_tickets_date_start"),type:"date"},null,8,["modelValue","label"])]),_:1}),t(n,{cols:"12",sm:"6",md:"4",lg:"1",class:"d-flex align-center gap-2"},{default:a(()=>[t(_,{color:"primary",size:"small",onClick:D},{default:a(()=>[t(w,{icon:"tabler-search"})]),_:1}),t(_,{variant:"outlined",size:"small",onClick:Q},{default:a(()=>[t(w,{icon:"tabler-refresh"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(S,null,{default:a(()=>[t(ve,{headers:G,items:i(O),loading:i(F).list,"items-length":i(x).total,"items-per-page":i(x).per_page,page:i(x).current_page,"item-value":"id","onUpdate:page":W,"onUpdate:itemsPerPage":H,"onUpdate:sortBy":J},{"item.id":a(({item:l})=>[t(_,{variant:"text",size:"small",color:"primary",onClick:Z=>P(l)},{default:a(()=>[d(" #"+r(l.id.toString().slice(-8)),1)]),_:2},1032,["onClick"])]),"item.subject":a(({item:l})=>[m("div",Te,r(l.subject),1)]),"item.category":a(({item:l})=>[t(U,{size:"small",variant:"tonal",color:"info"},{default:a(()=>[d(r(i(c).getCategoryLabel(l.category)),1)]),_:2},1024)]),"item.priority":a(({item:l})=>[t(U,{color:i(c).getPriorityColor(l.priority),size:"small",variant:"tonal"},{default:a(()=>[d(r(i(c).getPriorityLabel(l.priority)),1)]),_:2},1032,["color"])]),"item.status":a(({item:l})=>[t(U,{color:i(c).getStatusColor(l.status),size:"small",variant:"tonal"},{default:a(()=>[d(r(i(c).getStatusLabel(l.status)),1)]),_:2},1032,["color"])]),"item.last_activity_at":a(({item:l})=>[m("span",Se,r(Y(l.last_activity_at)),1)]),"item.actions":a(({item:l})=>[t(_,{icon:"tabler-eye",size:"small",variant:"text",color:"primary",onClick:Z=>P(l)},null,8,["onClick"])]),"no-data":a(()=>[m("div",Ue,[t(w,{icon:"tabler-ticket-off",size:"64",class:"text-disabled mb-4"}),m("h3",Fe,r(i(e)("affiliate_tickets_no_tickets_found")),1),m("p",je,r(i(e)("affiliate_tickets_no_tickets_description")),1),t(_,{color:"primary",class:"mt-4",onClick:B},{default:a(()=>o[11]||(o[11]=[d(" CrÃ©er votre premier ticket ")])),_:1,__:[11]})])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),_:1}),t(he,{modelValue:g.value,"onUpdate:modelValue":o[10]||(o[10]=l=>g.value=l),"max-width":"600"},{default:a(()=>[t(S,null,{default:a(()=>[t(pe,null,{default:a(()=>[d(r(i(e)("create_new_ticket")),1)]),_:1}),t(N,null,{default:a(()=>[t(ye,{onSubmit:ne(L,["prevent"])},{default:a(()=>[t(R,null,{default:a(()=>[t(n,{cols:"12"},{default:a(()=>[t(T,{modelValue:u.value.subject,"onUpdate:modelValue":o[5]||(o[5]=l=>u.value.subject=l),label:i(e)("affiliate_tickets_subject_required"),placeholder:i(e)("affiliate_tickets_subject_placeholder"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),t(n,{cols:"12",md:"6"},{default:a(()=>[t(v,{modelValue:u.value.category,"onUpdate:modelValue":o[6]||(o[6]=l=>u.value.category=l),items:z,label:i(e)("affiliate_tickets_category_required"),"item-title":"title","item-value":"value",required:""},null,8,["modelValue","label"])]),_:1}),t(n,{cols:"12",md:"6"},{default:a(()=>[t(v,{modelValue:u.value.priority,"onUpdate:modelValue":o[7]||(o[7]=l=>u.value.priority=l),items:q,label:i(e)("affiliate_tickets_priority_required"),"item-title":"title","item-value":"value",required:""},null,8,["modelValue","label"])]),_:1}),t(n,{cols:"12"},{default:a(()=>[t(ke,{modelValue:u.value.message,"onUpdate:modelValue":o[8]||(o[8]=l=>u.value.message=l),label:i(e)("affiliate_tickets_message_required"),placeholder:i(e)("affiliate_tickets_message_placeholder"),rows:"5",counter:"5000",maxlength:"5000",required:""},null,8,["modelValue","label","placeholder"])]),_:1}),t(n,{cols:"12"},{default:a(()=>[t(be,{label:i(e)("affiliate_tickets_attachments_optional"),multiple:"",accept:"image/*,.pdf,.doc,.docx,.txt","prepend-icon":"tabler-paperclip",onChange:X},null,8,["label"]),m("p",qe,r(i(e)("affiliate_tickets_file_formats")),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(ge,null,{default:a(()=>[t(Ve),t(_,{variant:"outlined",onClick:o[9]||(o[9]=l=>g.value=!1)},{default:a(()=>[d(r(i(e)("affiliate_tickets_cancel")),1)]),_:1}),t(_,{color:"primary",loading:i(F).create,onClick:L},{default:a(()=>[d(r(i(e)("affiliate_tickets_create_button")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{vt as default};
