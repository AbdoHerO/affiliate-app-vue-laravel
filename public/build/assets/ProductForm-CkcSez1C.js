import{d as Gt,j as Zt,u as ea,aL as ta,b7 as Ae,r as w,c7 as Ve,V as L,w as ue,D as aa,ai as he,c as p,o as i,b as a,f as l,e as s,l as $,t as m,m as f,s as c,az as h,aU as qe,cS as lt,ac as P,g as k,F as Fe,i as Ce,aV as oa,v as Ie}from"./main-uLG9IIeX.js";import{u as la}from"./produits-CdRrgA5L.js";import{u as ra}from"./boutiques-DkUXecMM.js";import{u as sa}from"./categories-DABDmOP1.js";import{u as ia}from"./useNotifications-DDBS_wPD.js";import{u as na}from"./useFormErrors-XAfRt52c.js";import{useQuickConfirm as da}from"./useConfirmAction-C-KKQTYr.js";import{u as x}from"./useApi-Bt_X5NBj.js";import{b as H,V as z,c as De}from"./VCard-CB1gT6RB.js";import{V as I,b as ua}from"./VChip-B84WcmDa.js";import{a as ca,V as G,b as ma,c as Z}from"./VTabs-BkhoRyPL.js";import{V as Me}from"./VForm-C9FiqBHN.js";import{V as J,a as b}from"./VRow-aGfXYx3U.js";import{V as ee}from"./VSelect-sWnAtot-.js";import{V as U}from"./VTextField-Dxeq5kx5.js";import{V as Le}from"./VTextarea-BuIc6d95.js";import{V as va}from"./VField-CfH1YcVv.js";import{V as pa}from"./VDivider-UqGR4x4D.js";import{V as rt}from"./VSwitch-D1bWLDQ4.js";import{V as fa}from"./VRating-CAqbAPLl.js";import{V as Re}from"./VFileInput-D1Glyc4K.js";import{V as Se}from"./VImg-BS6_svHJ.js";import{V as Ne}from"./VSpacer-BCNmCEP9.js";import{V as R}from"./VAlert-TgguXW_5.js";import{V as ga,a as ba,b as _a,d as ya}from"./VList-uZDByhc2.js";import{V as te}from"./VCardText-BZtszuIK.js";import{V as st}from"./VDataTable-DNqSzzrc.js";import{V as ka}from"./VTable-0U-NvIH3.js";import{V as Va}from"./VSnackbar-BT89hKev.js";import{_ as ha}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xa={class:"product-form"},wa={class:"text-h4 font-weight-bold"},Pa={key:0,class:"text-body-1 text-medium-emphasis mt-1"},Fa={class:"copywriting-field"},Ca={class:"rich-text-editor"},Sa={class:"editor-toolbar"},Ea={class:"text-caption text-medium-emphasis mt-1"},$a={key:0,class:"text-error text-caption mt-1"},za={class:"d-flex align-center justify-space-between"},Ta={class:"text-h6 text-success"},Ua={class:"text-caption"},Aa={class:"d-flex justify-space-between"},qa={class:"d-flex justify-space-between"},Ia={class:"mb-6"},Da={class:"text-h6 mb-2"},Ma={class:"text-body-2 text-medium-emphasis"},La={class:"mb-4"},Ra={class:"text-subtitle-2 mb-2 d-block"},Na={key:0,class:"mb-3"},Oa={key:1,class:"mb-3"},ja={key:2,class:"text-center py-4"},Ba={key:0,class:"text-center py-12"},Wa={key:1},Ya={key:0,class:"text-center py-12"},Ha={key:1},Ja={class:"mb-6"},Xa={key:0,class:"mb-6"},Ka={key:1,class:"mb-6"},Qa={key:2},Ga={key:0,class:"text-center py-12"},Za={key:1},eo={class:"d-flex align-center gap-4"},to={key:0},ao={class:"font-weight-medium"},oo={key:0,class:"text-caption text-medium-emphasis"},lo={class:"font-weight-medium"},ro={key:0,class:"text-caption text-medium-emphasis"},so={class:"d-flex align-center gap-2"},io={key:1,class:"text-caption text-medium-emphasis"},no={key:0,class:"text-center py-12"},uo={key:1},co={class:"d-flex justify-space-between align-center"},mo={class:"d-flex gap-2"},vo={key:0,class:"text-center py-8"},po={key:1,class:"text-center py-8"},fo={key:2},go={class:"d-flex justify-space-between align-center"},bo={key:0,class:"d-flex align-center"},_o={key:1,class:"text-medium-emphasis"},yo={key:0,class:"font-weight-medium"},ko={key:1,class:"text-medium-emphasis"},Vo={class:"text-medium-emphasis"},ho={class:"font-weight-medium"},xo={colspan:"2",class:"font-weight-bold"},wo={class:"font-weight-bold"},Po={class:"font-weight-bold"},Fo={key:0,class:"text-center py-12"},Co={key:1},So={class:"mb-2"},Eo={key:0,class:"mt-2"},$o={key:1,class:"mt-2"},zo={key:0,class:"text-center py-12"},To={key:1},Uo={key:0},Ao={key:1,class:"text-medium-emphasis"},qo=Gt({__name:"ProductForm",props:{mode:{},id:{}},emits:["created","updated"],setup(it,{emit:nt}){const j=it,Oe=nt,je=Zt(),dt=ea(),{t:ce}=ta(),{showSuccess:C,showError:v,snackbar:me}=ia(),{confirmCreate:ie,confirmUpdate:Be,confirmDelete:ve}=da(),pe=la(),We=ra(),Ye=sa(),{items:ut}=Ae(We),{categories:ct}=Ae(Ye),{currentProduit:B,images:X,videos:ae,variantes:S}=Ae(pe),fe=w(dt.query.tab||"details"),oe=w(!1),xe=w(!1),u=w(j.mode==="edit"&&j.id||null);w(!0);const ne=w(!1);w(null);const d=w({boutique_id:"",categorie_id:null,titre:"",description:"",copywriting:"",prix_achat:null,prix_vente:null,quantite_min:1,notes_admin:"",actif:!0,rating_value:null,stock_total:null}),{errors:D,set:mt,clear:He}=na(),le=w([]),T=Ve({titre:"",description:"",type:""}),K=w([]),E=Ve({variante_id:null,motif:"",started_at:"",expected_restock_at:""}),Q=Ve({variante_id:[],motif:[],started_at:[],expected_restock_at:[]}),re=w("url"),we=w(""),ge=w(""),y=Ve({attribut_id:"",valeur_id:"",valeur_ids:[],nom:"",valeur:"",prix_vente_variante:null}),Pe=w(!1),Je=w([]),be=w([]),Xe=w(!1),Ke=w(!1),g=Ve({stock_total:0,allocations:[],warehouse_id:null}),W=w([]),F=w([]),Ee=w(!1),$e=w(!1),N=L(()=>F.value.reduce((o,e)=>o+(e.qty||0),0)),Qe=L(()=>F.value.reduce((o,e)=>o+(e.reserved||0),0)),vt=L(()=>N.value-Qe.value),Ge=L(()=>g.stock_total!==N.value),Y=L(()=>N.value>g.stock_total);L(()=>!Y.value&&g.stock_total>0&&N.value>0);const A=L(()=>!!u.value),_e=L(()=>j.mode==="edit"),pt=L(()=>_e.value?"Edit Product":"Create Product"),Ze=L(()=>!d.value.prix_vente||!d.value.prix_achat?0:Math.max(0,d.value.prix_vente-d.value.prix_achat));L(()=>Ze.value);const ft=o=>{if(console.debug("[ProductForm] getVariantDisplayName called with:",o),console.debug("[ProductForm] Available variants:",S.value),!o)return"All variants";const e=S.value.find(t=>t.id===o);return console.debug("[ProductForm] Found variant:",e),e?`${e.nom||"Unknown"}: ${e.valeur||"Unknown"}`:"Unknown variant"},gt=async()=>{await Promise.all([We.fetchBoutiques(),Ye.fetchCategories()])},bt=async()=>{if(j.mode==="edit"&&j.id){oe.value=!0;try{if(await pe.fetchProduit(j.id),B.value){const o=B.value;console.log("[ProductForm] Loading product data:",{id:o.id,titre:o.titre,stock_total:o.stock_total,quantite_min:o.quantite_min,notes_admin:o.notes_admin}),d.value={boutique_id:o.boutique_id,categorie_id:o.categorie_id,titre:o.titre,description:o.description||"",copywriting:o.copywriting||"",prix_achat:o.prix_achat,prix_vente:o.prix_vente,quantite_min:o.quantite_min||1,notes_admin:o.notes_admin||"",actif:o.actif,rating_value:o.rating_value||null,stock_total:o.stock_total||null},console.log("[ProductForm] Form data after loading:",{stock_total:d.value.stock_total,quantite_min:d.value.quantite_min}),he(()=>{Lt()}),u.value=o.id,console.debug("[ProductForm] Edit mode - variants loaded:",S.value.map(e=>({id:e.id,nom:e.nom,valeur:e.valeur,image_url:e.image_url}))),await tt(),await xt(),await Jt(),await he(),ne.value=!1}}catch(o){v("Failed to load product"),console.error("Error loading product:",o)}finally{oe.value=!1}}},et=async()=>{if(console.debug("[ProductForm] saveProduct called, mode:",j.mode,"localId:",u.value),xe.value){console.debug("[ProductForm] Save already in progress, ignoring");return}if(!d.value.titre.trim()){v("Product title is required");return}if(!d.value.boutique_id){v("Boutique selection is required");return}try{console.debug("[ProductForm] Showing confirm dialog...");const o=j.mode==="create"&&!u.value?await ie("product"):await Be("product",d.value.titre);if(console.debug("[ProductForm] Confirm dialog result:",o),!o)return}catch(o){console.error("[ProductForm] Error in confirm dialog:",o);return}xe.value=!0;try{if(console.debug("[ProductForm] Form data before save:",d.value),j.mode==="create"&&!u.value){console.debug("[ProductForm] Creating new product");const o=await pe.createProduit(d.value);u.value=o.id,console.debug("[ProductForm] Created product with ID:",o.id),await pe.fetchProduit(o.id),console.debug("[ProductForm] Fetched product data, images:",X.value.length,"videos:",ae.value.length,"variants:",S.value.length),console.debug("[ProductForm] Variants with images:",S.value.map(e=>({id:e.id,nom:e.nom,valeur:e.valeur,image_url:e.image_url}))),Oe("created",o),fe.value="images",je.replace(`/admin/produits/${o.id}/edit?tab=images`),He(),C("Product created successfully")}else if(u.value){console.debug("[ProductForm] Updating product with ID:",u.value);const o=await pe.updateProduit(u.value,d.value);Oe("updated",o),He(),C("Product updated successfully"),ne.value=!1,await Rt()}else console.error("[ProductForm] Invalid state: create mode but no localId and no create action"),v("Invalid form state")}catch(o){o.errors?(mt(o.errors),v(o.message||"Validation failed"),console.error("Product validation error:",o)):(v(o.message||"Failed to save product"),console.error("Error saving product:",o))}finally{xe.value=!1}},_t=()=>{je.push({name:"admin-produits"})},yt=()=>{d.value.rating_value!==null&&d.value.rating_value!==void 0&&(d.value.rating_value=Math.max(0,Math.min(5,Number(d.value.rating_value))),d.value.rating_value=Math.round(d.value.rating_value*10)/10)},O=w();ue(()=>d.value.copywriting,async o=>{await he(),O.value&&O.value.innerHTML!==o&&(O.value.innerHTML=o||"")},{immediate:!0}),ue(()=>g.warehouse_id,o=>{o&&A.value&&ye()});const de=o=>{var e;document.execCommand(o,!1,""),(e=O.value)==null||e.focus()},ze=o=>document.queryCommandState(o),Te=o=>{var r;const e={small:"12px",normal:"14px",large:"18px"};document.execCommand("fontSize",!1,"7");const t=document.getElementsByTagName("font");for(let n=0;n<t.length;n++)t[n].size==="7"&&(t[n].removeAttribute("size"),t[n].style.fontSize=e[o]);(r=O.value)==null||r.focus()},kt=o=>{const e=o.target;d.value.copywriting=e.innerHTML,oe.value||(ne.value=!0)},tt=async()=>{await he(),O.value&&(O.value.innerHTML=d.value.copywriting||"")},Vt=o=>{o.ctrlKey&&o.key==="b"&&(o.preventDefault(),de("bold")),o.ctrlKey&&o.key==="i"&&(o.preventDefault(),de("italic")),o.ctrlKey&&o.key==="u"&&(o.preventDefault(),de("underline"))},ht=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),xt=async()=>{if(u.value)try{const{data:o,error:e}=await x(`/admin/produits/${u.value}/propositions`);if(!e.value&&o.value){const t=o.value;t.success&&(le.value=t.data)}}catch(o){console.error("Error loading propositions:",o)}},wt=async o=>{if(!u.value){console.warn("[ProductForm] Cannot upload images: no product ID");return}console.debug("[ProductForm] [productId] add-image:",u.value);const e=Array.from(o);for(const t of e){const r=new FormData;r.append("file",t);try{const{data:n,error:_}=await x(`/admin/produits/${u.value}/images/upload`,{method:"POST",body:r});if(_.value)console.error("Image upload error details:",_.value),v(_.value.message||"Failed to upload image"),console.error("Image upload error:",_.value);else if(n.value){const V=n.value;V.success&&(X.value.push(V.data),console.debug("[ProductForm] Image uploaded successfully, total images:",X.value.length))}}catch(n){console.error("Error uploading image:",n),v(n.message||"Failed to upload image")}}},Pt=async o=>{if(!(!u.value||!await ve("image","cette image")))try{const{error:t}=await x(`/admin/produits/${u.value}/images/${o}`,{method:"DELETE"});if(t.value)v(t.value.message||"Failed to delete image"),console.error("Delete image error:",t.value);else{const r=X.value.findIndex(n=>n.id===o);r>-1&&(X.value.splice(r,1),C("Image deleted successfully"))}}catch(t){console.error("Error deleting image:",t),v(t.message||"Failed to delete image")}},Ft=async()=>{if(!u.value||!ge.value){console.warn("[ProductForm] Cannot add video URL: missing product ID or URL");return}if(await ie("vidÃ©o")){console.debug("[ProductForm] [productId] add-video-url:",u.value);try{const{data:e,error:t}=await x(`/admin/produits/${u.value}/videos`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:ge.value,titre:we.value})});if(t.value)v(t.value.message||"Failed to add video"),console.error("Add video URL error:",t.value);else if(e.value){const r=e.value;r.success&&(ae.value.push(r.data),ge.value="",we.value="",C("Video added successfully"))}}catch(e){console.error("Error adding video URL:",e),v(e.message||"Failed to add video")}}},Ct=async o=>{if(!u.value){console.warn("[ProductForm] Cannot upload videos: no product ID");return}console.debug("[ProductForm] [productId] add-video-upload:",u.value);const e=Array.from(o);for(const t of e){const r=new FormData;r.append("file",t);try{const{data:n,error:_}=await x(`/admin/produits/${u.value}/videos/upload`,{method:"POST",body:r});if(_.value)v(_.value.message||"Failed to upload video"),console.error("Video upload error:",_.value);else if(n.value){const V=n.value;V.success&&(ae.value.push(V.data),C("Video uploaded successfully"))}}catch(n){console.error("Error uploading video:",n),v(n.message||"Failed to upload video")}}},St=async o=>{if(!(!u.value||!await ve("vidÃ©o","cette vidÃ©o")))try{const{error:t}=await x(`/admin/produits/${u.value}/videos/${o}`,{method:"DELETE"});if(t.value)v(t.value.message||"Failed to delete video"),console.error("Delete video error:",t.value);else{const r=ae.value.findIndex(n=>n.id===o);r>-1&&(ae.value.splice(r,1),C("Video deleted successfully"))}}catch(t){console.error("Error deleting video:",t),v(t.message||"Failed to delete video")}},Et=async()=>{try{Xe.value=!0;const{data:o,error:e}=await x("/admin/variant-attributs?actif=1");if(!e.value&&o.value){const t=o.value;t.success&&(Je.value=t.data)}}catch(o){console.error("Error fetching variant attributes:",o)}finally{Xe.value=!1}},$t=async o=>{try{Ke.value=!0;const{data:e,error:t}=await x(`/admin/variant-attributs/${o}/valeurs?actif=1`);if(!t.value&&e.value){const r=e.value;r.success&&(be.value=r.data)}}catch(e){console.error("Error fetching variant values:",e)}finally{Ke.value=!1}},zt=()=>{y.valeur_id="",y.valeur_ids=[],be.value=[],y.attribut_id&&$t(y.attribut_id)},Tt=async()=>{if(!u.value||!y.attribut_id||!y.valeur_id){console.warn("[ProductForm] Cannot add variant: missing product ID, attribute, or value");return}if(await ie("variante")){console.debug("[ProductForm] [productId] add-variant:",u.value);try{const{data:e,error:t}=await x(`/admin/produits/${u.value}/variantes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attribut_id:y.attribut_id,valeur_id:y.valeur_id,prix_vente_variante:y.prix_vente_variante,actif:!0})});if(t.value)v(t.value.message||"Failed to add variant"),console.error("Add variant error:",t.value);else if(e.value){const r=e.value;r.success&&(S.value.push(r.data),at(),C("Variant added successfully"))}}catch(e){console.error("Error adding variant:",e),v(e.message||"Failed to add variant")}}},Ut=async()=>{if(!u.value||!y.attribut_id||!y.valeur_ids.length){console.warn("[ProductForm] Cannot add variants: missing product ID, attribute, or values");return}if(await ie(`${y.valeur_ids.length} variantes`)){console.debug("[ProductForm] [productId] add-variants-bulk:",u.value,y.valeur_ids);try{const{data:e,error:t}=await x(`/admin/produits/${u.value}/variantes/bulk`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attribut_id:y.attribut_id,valeur_ids:y.valeur_ids,prix_vente_variante:y.prix_vente_variante,actif:!0})});if(t.value)v(t.value.message||"Failed to add variants"),console.error("Add variants bulk error:",t.value);else if(e.value){const r=e.value;r.success&&(r.data.created&&S.value.push(...r.data.created),at(),C(r.message||"Variants added successfully"),r.data.skipped&&r.data.skipped.length>0&&console.info("Skipped variants:",r.data.skipped))}}catch(e){console.error("Error adding variants bulk:",e),v(e.message||"Failed to add variants")}}},at=()=>{Object.assign(y,{attribut_id:"",valeur_id:"",valeur_ids:[],nom:"",valeur:"",prix_vente_variante:null}),be.value=[]},At=async o=>{if(!(!u.value||!await ve("variante","cette variante")))try{const{error:t}=await x(`/admin/produits/${u.value}/variantes/${o}`,{method:"DELETE"});if(t.value)v(t.value.message||"Failed to delete variant"),console.error("Delete variant error:",t.value);else{const r=S.value.findIndex(n=>n.id===o);r>-1&&(S.value.splice(r,1),C("Variant deleted successfully"))}}catch(t){console.error("Error deleting variant:",t),v(t.message||"Failed to delete variant")}},qt=async(o,e)=>{if(!u.value||!e){console.warn("[ProductForm] Cannot upload variant image: missing product ID or file",{localId:u.value,file:e});return}console.debug("[ProductForm] [productId] upload-variant-image:",u.value,o,"file:",e.name,"size:",e.size);const t=new FormData;t.append("file",e);try{const{data:r,error:n}=await x(`/admin/produits/${u.value}/variantes/${o}/image`,{method:"POST",body:t});if(console.debug("[ProductForm] Upload response:",{data:r.value,error:n.value}),!n.value&&r.value){const _=r.value;if(_.success){const V=S.value.find(M=>M.id===o);V&&(V.image_url=_.data.image_url,console.debug("[ProductForm] Variant image updated:",V.image_url),C("Variant image uploaded successfully"))}else console.error("[ProductForm] Upload failed:",_.message),v(_.message||"Failed to upload variant image")}else console.error("[ProductForm] API error:",n.value),v("Failed to upload variant image")}catch(r){console.error("Error uploading variant image:",r),v("Failed to upload variant image")}},ot=async()=>{try{const o=d.value.boutique_id?`?boutique_id=${d.value.boutique_id}`:"",{data:e,error:t}=await x(`/admin/warehouses${o}`);if(t.value){console.error("Failed to load warehouses:",t.value),v("Failed to load warehouses");return}const r=e.value;if(r!=null&&r.success){if(W.value=r.data,console.log("[ProductForm] Loaded warehouses for boutique:",d.value.boutique_id),console.log("[ProductForm] Warehouses:",W.value.map(n=>({id:n.id,name:n.name,boutique:n.boutique}))),!g.warehouse_id&&W.value.length>0){const n=W.value.find(_=>_.is_default)||W.value[0];g.warehouse_id=n.id,console.log("Set default warehouse:",n.id)}}else console.error("Invalid warehouse response:",r),v("Invalid warehouse data received")}catch(o){console.error("Exception loading warehouses:",o),v("Error loading warehouses")}},ye=async()=>{var o;if(u.value){Ee.value=!0;try{const e=g.warehouse_id?`?warehouse_id=${g.warehouse_id}`:"",{data:t,error:r}=await x(`/admin/produits/${u.value}/stock/matrix${e}`);if(r.value){if(console.error("Stock matrix API error:",r.value),(o=r.value.message)!=null&&o.includes("Warehouse not found")){if(console.log("Warehouse not found, trying to load warehouses and retry..."),await ot(),g.warehouse_id){const _=`?warehouse_id=${g.warehouse_id}`,{data:V,error:M}=await x(`/admin/produits/${u.value}/stock/matrix${_}`);if(!M.value&&V.value){const se=V.value;if(se!=null&&se.success){F.value=se.data.matrix||[],console.log("Stock matrix loaded successfully on retry");return}}}v("Warehouse not found. Please check warehouse configuration.")}else v("Failed to load stock matrix: "+(r.value.message||"Unknown error"));F.value=[];return}const n=t.value;n!=null&&n.success?(F.value=n.data.matrix||[],console.log("Stock matrix loaded:",F.value.length,"items"),n.data.warehouse&&!g.warehouse_id&&(g.warehouse_id=n.data.warehouse.id,console.log("Updated warehouse from response:",n.data.warehouse.id))):(console.error("Invalid stock matrix response:",n),F.value=[])}catch(e){console.error("Exception loading stock matrix:",e),F.value=[],v("Error loading stock matrix")}finally{Ee.value=!1}}},It=(o,e)=>{const t=F.value.find(r=>r.variante_id===o);t&&(t.qty=Number(e)||0,t.available=Math.max(0,t.qty-t.reserved))},Dt=()=>{if(!g.stock_total||!F.value.length)return;const o=Math.floor(g.stock_total/F.value.length),e=g.stock_total%F.value.length;F.value.forEach((t,r)=>{const n=o+(r===0?e:0);t.qty=n,t.available=Math.max(0,n-t.reserved)}),C("Stock distributed across variant combinations")},Mt=async()=>{if(u.value){$e.value=!0;try{const{data:o,error:e}=await x(`/admin/produits/${u.value}/stock/generate-combinations`,{method:"POST"}),t=o.value;t!=null&&t.success?(C(`${t.data.created} combinaisons crÃ©Ã©es avec succÃ¨s`),await ye()):e.value&&v("Erreur lors de la gÃ©nÃ©ration des combinaisons")}catch(o){console.error("Failed to generate combinations:",o),v("Erreur inattendue lors de la gÃ©nÃ©ration des combinaisons")}finally{$e.value=!1}}},Lt=async()=>{console.log("[ProductForm] Initializing stock form with stock_total:",d.value.stock_total),console.log("[ProductForm] Current stockForm.stock_total before sync:",g.stock_total),g.stock_total=d.value.stock_total||0,console.log("[ProductForm] stockForm.stock_total after sync:",g.stock_total),await ot(),await ye()},Rt=async()=>{var t,r,n,_;if(!u.value)return;const o=g.stock_total!==(d.value.stock_total||0),e=F.value.some(V=>V.qty>0);if(!o&&!e){console.log("No stock changes detected, skipping allocation");return}if(Y.value){v(`Impossible de sauvegarder : La somme des variantes (${N.value}) dÃ©passe le stock total (${g.stock_total})`);return}if(!(Ge.value&&!Y.value&&!await Be("DiffÃ©rence de stock dÃ©tectÃ©e",`Le stock total (${g.stock_total}) ne correspond pas Ã  la somme des variantes (${N.value}). Voulez-vous continuer quand mÃªme ?`)))try{const V=new Map;F.value.filter(q=>q.variante_id&&q.qty>0).forEach(q=>{const Ue=V.get(q.variante_id)||0;V.set(q.variante_id,Ue+q.qty)});const M=Array.from(V.entries()).map(([q,Ue])=>({variante_id:q,qty:Ue}));console.log("Stock allocation data:",{stock_total:g.stock_total,allocations_count:M.length,warehouse_id:g.warehouse_id});const{data:se,error:ke}=await x(`/admin/produits/${u.value}/stock/allocate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock_total:g.stock_total,allocations:M,warehouse_id:g.warehouse_id})});if(ke.value){let q="Erreur lors de l'allocation du stock";(t=ke.value.message)!=null&&t.includes("No warehouse found")?q=ce("product.stock.error_no_warehouse"):(r=ke.value.message)!=null&&r.includes("Some variant IDs are invalid")?q=ce("product.stock.error_invalid_variants"):((n=ke.value.message)!=null&&n.includes("SQLSTATE")||(_=ke.value.message)!=null&&_.includes("Column not found"))&&(q=ce("product.stock.error_database")),v(q)}else se.value&&se.value.success&&(C(ce("product.stock.save_success")),d.value.stock_total=g.stock_total,await ye())}catch{v("Erreur inattendue lors de l'allocation du stock")}},Nt=async o=>{if(u.value)try{const{data:e,error:t}=await x(`/admin/produits/${u.value}/propositions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(t.value)v(t.value.message||"Failed to add proposition"),console.error("Add proposition error:",t.value);else if(e.value){const r=e.value;if(r.success)return le.value.push(r.data),C("Proposition added successfully"),r.data}}catch(e){console.error("Error adding proposition:",e),v(e.message||"Failed to add proposition")}},Ot=async o=>{if(u.value)try{const{error:e}=await x(`/admin/produits/${u.value}/propositions/${o}`,{method:"DELETE"});if(!e.value){const t=le.value.findIndex(r=>r.id===o);t>-1&&(le.value.splice(t,1),C("Proposition deleted successfully"))}}catch(e){console.error("Error deleting proposition:",e),v("Failed to delete proposition")}},jt=async(o,e)=>{if(!u.value||!e){console.warn("[ProductForm] Cannot upload proposition image: missing product ID or file",{localId:u.value,file:e});return}console.debug("[ProductForm] [productId] upload-proposition-image:",u.value,o,"file:",e.name,"size:",e.size);const t=new FormData;t.append("file",e);try{const{data:r,error:n}=await x(`/admin/produits/${u.value}/propositions/${o}/image`,{method:"POST",body:t});if(console.debug("[ProductForm] Proposition upload response:",{data:r.value,error:n.value}),!n.value&&r.value){const _=r.value;if(_.success){const V=le.value.find(M=>M.id===o);V&&(V.image_url=_.data.image_url,console.debug("[ProductForm] Proposition image updated:",V.image_url),C("Proposition image uploaded successfully"))}else console.error("[ProductForm] Proposition upload failed:",_.message),v(_.message||"Failed to upload proposition image")}else console.error("[ProductForm] Proposition API error:",n.value),v("Failed to upload proposition image")}catch(r){console.error("Error uploading proposition image:",r),v("Failed to upload proposition image")}},Bt=async()=>{if(!T.titre||!T.description||!T.type||!await ie("proposition"))return;await Nt(T)&&Object.assign(T,{titre:"",description:"",type:""})},Wt=async o=>{await ve("proposition","cette proposition")&&await Ot(o)},Yt=o=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=async t=>{var n;const r=(n=t.target.files)==null?void 0:n[0];r&&await jt(o,r)},e.click()},Ht=o=>{switch(o){case"en_attente":return"warning";case"approuve":return"success";case"refuse":return"error";default:return"grey"}},Jt=async()=>{if(u.value)try{const{data:o,error:e}=await x(`/admin/produits/${u.value}/ruptures`);if(!e.value&&o.value){const t=o.value;t.success&&(console.debug("[ProductForm] Loaded ruptures:",t.data),K.value=t.data)}}catch(o){console.error("Error loading ruptures:",o)}},Xt=async()=>{if(!u.value){console.warn("[ProductForm] Cannot add rupture: no product ID");return}if(await ie("rupture de stock")){if(Object.keys(Q).forEach(e=>{Q[e]=[]}),!E.motif){Q.motif=["Reason is required"];return}if(!E.started_at){Q.started_at=["Started date is required"];return}if(S.value.length>0&&!E.variante_id){Q.variante_id=["Variant selection is required when product has variants"];return}console.debug("[ProductForm] [productId] add-rupture:",u.value,{hasVariants:S.value.length>0,selectedVariant:E.variante_id});try{const{data:e,error:t}=await x(`/admin/produits/${u.value}/ruptures`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(t.value){t.value.errors&&Object.keys(t.value.errors).forEach(r=>{r in Q&&(Q[r]=t.value.errors[r])}),v(t.value.message||"Failed to report stock issue"),console.error("Add rupture error:",t.value);return}if(e.value){const r=e.value;r.success&&(console.debug("[ProductForm] Added rupture response:",r.data),K.value.push(r.data),Object.assign(E,{variante_id:null,motif:"",started_at:"",expected_restock_at:""}),C("Stock issue reported successfully"))}}catch(e){console.error("Error adding rupture:",e),v(e.message||"Failed to report stock issue")}}},Kt=async o=>{if(u.value)try{const{data:e,error:t}=await x(`/admin/produits/${u.value}/ruptures/${o}/resolve`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.value&&e.value){const r=e.value;if(r.success){const n=K.value.findIndex(_=>_.id===o);n>-1&&(K.value[n]=r.data),C("Stock issue resolved successfully")}}}catch(e){console.error("Error resolving rupture:",e),v("Failed to resolve stock issue")}},Qt=async o=>{if(!(!u.value||!await ve("rupture de stock","cette rupture de stock")))try{const{error:t}=await x(`/admin/produits/${u.value}/ruptures/${o}`,{method:"DELETE"});if(!t.value){const r=K.value.findIndex(n=>n.id===o);r>-1&&(K.value.splice(r,1),C("Stock issue deleted successfully"))}}catch(t){console.error("Error deleting rupture:",t),v("Failed to delete stock issue")}};return ue(d,()=>{oe.value||(ne.value=!0)},{deep:!0}),ue(()=>d.value.copywriting,()=>{oe.value||(ne.value=!0)}),ue(()=>d.value.stock_total,o=>{!oe.value&&o!==g.stock_total&&(console.log("Syncing stock_total from main form to stock form:",o),g.stock_total=o||0)}),ue(()=>g.stock_total,o=>{!oe.value&&o!==d.value.stock_total&&(console.log("Syncing stock_total from stock form to main form:",o),d.value.stock_total=o,ne.value=!0)}),aa(async()=>{await gt(),await bt(),await Et(),await he(),O.value&&d.value.copywriting&&(O.value.innerHTML=d.value.copywriting)}),(o,e)=>(i(),p("div",xa,[a(z,{class:"mb-6"},{default:l(()=>[a(H,{class:"d-flex align-center justify-space-between pa-6"},{default:l(()=>[s("div",null,[s("h1",wa,m(pt.value),1),_e.value&&f(B)?(i(),p("p",Pa,m(f(B).titre),1)):$("",!0)]),a(I,{color:_e.value?"primary":"success",variant:"tonal",size:"large"},{default:l(()=>[c(m(_e.value?"Edit Mode":"Create Mode"),1)]),_:1},8,["color"])]),_:1})]),_:1}),a(z,null,{default:l(()=>[a(ca,{modelValue:fe.value,"onUpdate:modelValue":e[0]||(e[0]=t=>fe.value=t),"bg-color":"grey-lighten-4",color:"primary",grow:""},{default:l(()=>[a(G,{value:"details"},{default:l(()=>[a(h,{icon:"tabler-info-circle",class:"me-2"}),e[39]||(e[39]=c(" Details "))]),_:1,__:[39]}),a(G,{value:"notation"},{default:l(()=>[a(h,{icon:"tabler-star",class:"me-2"}),c(" "+m(o.$t("products.rating.tab")),1)]),_:1}),a(G,{disabled:!A.value,value:"images"},{default:l(()=>[a(h,{icon:"tabler-photo",class:"me-2"}),e[40]||(e[40]=c(" Images "))]),_:1,__:[40]},8,["disabled"]),a(G,{disabled:!A.value,value:"videos"},{default:l(()=>[a(h,{icon:"tabler-video",class:"me-2"}),e[41]||(e[41]=c(" Videos "))]),_:1,__:[41]},8,["disabled"]),a(G,{disabled:!A.value,value:"variants"},{default:l(()=>[a(h,{icon:"tabler-versions",class:"me-2"}),e[42]||(e[42]=c(" Variants "))]),_:1,__:[42]},8,["disabled"]),a(G,{disabled:!A.value,value:"stock"},{default:l(()=>[a(h,{icon:"tabler-package",class:"me-2"}),c(" "+m(o.$t("product.tabs.stock")),1)]),_:1},8,["disabled"]),a(G,{disabled:!A.value,value:"propositions"},{default:l(()=>[a(h,{icon:"tabler-list-details",class:"me-2"}),e[43]||(e[43]=c(" Propositions "))]),_:1,__:[43]},8,["disabled"]),a(G,{disabled:!A.value,value:"ruptures"},{default:l(()=>[a(h,{icon:"tabler-alert-triangle",class:"me-2"}),e[44]||(e[44]=c(" Stock Issues "))]),_:1,__:[44]},8,["disabled"])]),_:1},8,["modelValue"]),a(Me,{onSubmit:qe(et,["prevent"])},{default:l(()=>[a(ma,{modelValue:fe.value,"onUpdate:modelValue":e[37]||(e[37]=t=>fe.value=t),class:"pa-6"},{default:l(()=>[a(Z,{value:"details"},{default:l(()=>[a(J,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(ee,{modelValue:d.value.boutique_id,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.boutique_id=t),items:f(ut),"item-title":"nom","item-value":"id",label:"Boutique",variant:"outlined",required:"","error-messages":f(D).boutique_id},null,8,["modelValue","items","error-messages"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(ee,{modelValue:d.value.categorie_id,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.categorie_id=t),items:f(ct),"item-title":"nom","item-value":"id",label:"Categorie",variant:"outlined",clearable:"","error-messages":f(D).categorie_id},null,8,["modelValue","items","error-messages"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(U,{modelValue:d.value.titre,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.titre=t),label:"Product Title",variant:"outlined",required:"","error-messages":f(D).titre},null,8,["modelValue","error-messages"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(Le,{modelValue:d.value.description,"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.description=t),label:"Description",variant:"outlined",rows:"4","error-messages":f(D).description},null,8,["modelValue","error-messages"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[s("div",Fa,[a(va,{class:"mb-2"},{default:l(()=>e[45]||(e[45]=[c("Copywriting (Marketing Text with Rich Formatting)")])),_:1,__:[45]}),s("div",Ca,[s("div",Sa,[a(lt,{variant:"outlined",size:"small",class:"mb-2"},{default:l(()=>[a(P,{onClick:e[5]||(e[5]=t=>de("bold")),color:ze("bold")?"primary":"default",icon:"tabler-bold",size:"small"},null,8,["color"]),a(P,{onClick:e[6]||(e[6]=t=>de("italic")),color:ze("italic")?"primary":"default",icon:"tabler-italic",size:"small"},null,8,["color"]),a(P,{onClick:e[7]||(e[7]=t=>de("underline")),color:ze("underline")?"primary":"default",icon:"tabler-underline",size:"small"},null,8,["color"])]),_:1}),a(lt,{variant:"outlined",size:"small",class:"mb-2 ms-2"},{default:l(()=>[a(P,{onClick:e[8]||(e[8]=t=>Te("small")),size:"small",text:"A",style:{"font-size":"12px"}}),a(P,{onClick:e[9]||(e[9]=t=>Te("normal")),size:"small",text:"A",style:{"font-size":"14px"}}),a(P,{onClick:e[10]||(e[10]=t=>Te("large")),size:"small",text:"A",style:{"font-size":"16px"}})]),_:1})]),s("div",{ref_key:"richTextEditor",ref:O,class:"rich-text-content",contenteditable:"true",onInput:kt,onKeydown:Vt,onFocus:tt,placeholder:`ðŸŒ¸ Ø¬Ø¯ÙŠØ¯ Ø¹Ù†Ø¯Ù†Ø§ ðŸŒ¸

ÙƒØ³ÙˆØ© ØµÙŠÙÙŠØ© Ø¨Ù†Ù‚Ø´Ø© Ù…Ù…ÙŠØ²Ø© ÙˆØ±Ø§Ø­Ø© Ù„Ø§ Ù…Ø«ÙŠÙ„ Ù„Ù‡Ø§

âœ… Ø§Ù„Ù‚Ù…Ø§Ø´: ØªÙˆØ¨ Ù„ÙˆÙ„Ø§Ù†
âœ… Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª: L / XL / XXL / XXXL
ðŸ’° Ø§Ù„Ø«Ù…Ù†: ØºÙŠØ± Ø¨Ù€130 Ø¯Ø±Ù‡Ù…ðŸ˜

Ø®Ù„ÙŠ Ø§Ù„Ø£Ù†Ø§Ù‚Ø© Ø¯ÙŠØ§Ù„Ùƒ ØªØ¨Ø¯Ø§ Ù…Ù† Ù‡Ù†Ø§ ðŸ’ƒ`},m(d.value.copywriting),545)]),s("div",Ea,[a(h,{icon:"tabler-info-circle",size:"14",class:"me-1"}),e[46]||(e[46]=c(" Rich text editor with bold, italic, underline, and font size controls. Supports emojis and line breaks. "))]),f(D).copywriting?(i(),p("div",$a,m(f(D).copywriting),1)):$("",!0)])]),_:1}),a(b,{cols:"12",md:"4"},{default:l(()=>[a(U,{modelValue:d.value.prix_achat,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value.prix_achat=t),modelModifiers:{number:!0},label:"Purchase Price",type:"number",variant:"outlined",step:"0.01",suffix:"MAD","error-messages":f(D).prix_achat},null,8,["modelValue","error-messages"])]),_:1}),a(b,{cols:"12",md:"4"},{default:l(()=>[a(U,{modelValue:d.value.prix_vente,"onUpdate:modelValue":e[12]||(e[12]=t=>d.value.prix_vente=t),modelModifiers:{number:!0},label:"Sale Price",type:"number",variant:"outlined",step:"0.01",suffix:"MAD",required:"","error-messages":f(D).prix_vente},null,8,["modelValue","error-messages"])]),_:1}),a(b,{cols:"12",md:"4"},{default:l(()=>[a(z,{variant:"outlined",class:"pa-4"},{default:l(()=>[e[50]||(e[50]=s("div",{class:"text-subtitle-2 mb-2"},"Commission EstimÃ©e",-1)),s("div",za,[s("div",null,[s("div",Ta,m(Ze.value.toFixed(2))+" MAD",1),e[47]||(e[47]=s("div",{class:"text-caption text-medium-emphasis"}," Prix de vente - Prix d'achat ",-1))]),a(h,{icon:"tabler-calculator",color:"success",size:"24"})]),a(pa,{class:"my-3"}),s("div",Ua,[s("div",Aa,[e[48]||(e[48]=s("span",null,"Prix de vente:",-1)),s("span",null,m(d.value.prix_vente||0)+" MAD",1)]),s("div",qa,[e[49]||(e[49]=s("span",null,"Prix d'achat:",-1)),s("span",null,m(d.value.prix_achat||0)+" MAD",1)])])]),_:1,__:[50]})]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:d.value.quantite_min,"onUpdate:modelValue":e[13]||(e[13]=t=>d.value.quantite_min=t),modelModifiers:{number:!0},label:"Minimum Quantity",type:"number",variant:"outlined",min:"1","error-messages":f(D).quantite_min},null,8,["modelValue","error-messages"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(rt,{modelValue:d.value.actif,"onUpdate:modelValue":e[14]||(e[14]=t=>d.value.actif=t),label:"Active",color:"success"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(Le,{modelValue:d.value.notes_admin,"onUpdate:modelValue":e[15]||(e[15]=t=>d.value.notes_admin=t),label:"Admin Notes",variant:"outlined",rows:"3","error-messages":f(D).notes_admin},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),a(Z,{value:"notation"},{default:l(()=>[s("div",Ia,[s("h3",Da,m(o.$t("products.rating.tab")),1),s("p",Ma,m(o.$t("products.rating.help")),1)]),a(J,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(z,{variant:"outlined",class:"pa-4"},{default:l(()=>[s("div",La,[s("label",Ra,m(o.$t("products.rating.value")),1),a(fa,{"model-value":d.value.rating_value||0,"onUpdate:modelValue":e[16]||(e[16]=t=>d.value.rating_value=Number(t)||null),"half-increments":"",length:"5",color:"warning","background-color":"grey-lighten-2",size:"large",class:"mb-3"},null,8,["model-value"]),a(U,{modelValue:d.value.rating_value,"onUpdate:modelValue":e[17]||(e[17]=t=>d.value.rating_value=t),modelModifiers:{number:!0},type:"number",min:"0",max:"5",step:"0.1",variant:"outlined",density:"compact",label:o.$t("products.rating.value"),"error-messages":f(D).rating_value,onBlur:yt},null,8,["modelValue","label","error-messages"])])]),_:1})]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(z,{variant:"outlined",class:"pa-4"},{default:l(()=>{var t,r,n,_,V,M;return[e[52]||(e[52]=s("h4",{class:"text-subtitle-1 mb-3"},"Metadata",-1)),(r=(t=f(B))==null?void 0:t.rating)!=null&&r.updated_at?(i(),p("div",Na,[a(I,{size:"small",color:"info",variant:"tonal","prepend-icon":"tabler-clock"},{default:l(()=>[c(m(o.$t("products.rating.last_update"))+": "+m(ht(f(B).rating.updated_at)),1)]),_:1})])):$("",!0),(_=(n=f(B))==null?void 0:n.rating)!=null&&_.updated_by?(i(),p("div",Oa,[a(I,{size:"small",color:"primary",variant:"tonal","prepend-icon":"tabler-user"},{default:l(()=>[c(m(o.$t("products.rating.updated_by"))+": "+m(f(B).rating.updated_by),1)]),_:1})])):$("",!0),(M=(V=f(B))==null?void 0:V.rating)!=null&&M.updated_at?$("",!0):(i(),p("div",ja,[a(h,{icon:"tabler-star-off",size:"48",color:"grey-lighten-1",class:"mb-2"}),e[51]||(e[51]=s("p",{class:"text-body-2 text-medium-emphasis"}," Aucune note dÃ©finie ",-1))]))]}),_:1,__:[52]})]),_:1})]),_:1})]),_:1}),a(Z,{value:"images"},{default:l(()=>[A.value?(i(),p("div",Wa,[e[56]||(e[56]=s("div",{class:"mb-6"},[s("h3",{class:"text-h6 mb-2"},"Product Images"),s("p",{class:"text-body-2 text-medium-emphasis"}," Upload multiple images for this product. Drag and drop or click to select files. ")],-1)),a(Re,{multiple:"","show-size":"",label:"Upload Images",accept:"image/*",variant:"outlined","prepend-icon":"tabler-upload",onChange:e[18]||(e[18]=t=>{var r;return wt(((r=t.target)==null?void 0:r.files)||t)})}),f(X).length?(i(),k(J,{key:0,class:"mt-6"},{default:l(()=>[(i(!0),p(Fe,null,Ce(f(X),t=>(i(),k(b,{key:t.id,cols:"6",md:"3",lg:"2"},{default:l(()=>[a(z,null,{default:l(()=>[a(Se,{src:t.url,"aspect-ratio":"1",cover:""},null,8,["src"]),a(De,null,{default:l(()=>[a(Ne),a(P,{icon:"tabler-trash",size:"small",color:"error",variant:"text",onClick:r=>Pt(t.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):$("",!0),f(X).length?$("",!0):(i(),k(R,{key:1,type:"info",variant:"tonal",class:"mt-6"},{default:l(()=>e[55]||(e[55]=[c(" No images uploaded yet. Add some images to showcase your product. ")])),_:1,__:[55]}))])):(i(),p("div",Ba,[a(h,{icon:"tabler-photo-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),e[53]||(e[53]=s("h3",{class:"text-h6 mb-2"},"Save Product First",-1)),e[54]||(e[54]=s("p",{class:"text-body-2 text-medium-emphasis"}," You need to save the product details before adding images. ",-1))]))]),_:1}),a(Z,{value:"videos"},{default:l(()=>[A.value?(i(),p("div",Ha,[e[64]||(e[64]=s("div",{class:"mb-6"},[s("h3",{class:"text-h6 mb-2"},"Product Videos"),s("p",{class:"text-body-2 text-medium-emphasis"}," Add videos by URL (YouTube, Vimeo) or upload video files directly. ")],-1)),s("div",Ja,[a(ua,{modelValue:re.value,"onUpdate:modelValue":e[19]||(e[19]=t=>re.value=t),"selected-class":"text-primary",mandatory:"",class:"mb-4"},{default:l(()=>[a(I,{value:"url",size:"large","prepend-icon":"tabler-link",color:re.value==="url"?"primary":"default",variant:re.value==="url"?"flat":"outlined",class:"me-2"},{default:l(()=>e[59]||(e[59]=[c(" Add by URL ")])),_:1,__:[59]},8,["color","variant"]),a(I,{value:"upload",size:"large","prepend-icon":"tabler-upload",color:re.value==="upload"?"primary":"default",variant:re.value==="upload"?"flat":"outlined"},{default:l(()=>e[60]||(e[60]=[c(" Upload Files ")])),_:1,__:[60]},8,["color","variant"])]),_:1},8,["modelValue"])]),re.value==="url"?(i(),p("div",Xa,[a(J,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:we.value,"onUpdate:modelValue":e[20]||(e[20]=t=>we.value=t),label:"Video Title",variant:"outlined",placeholder:"Enter video title"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:ge.value,"onUpdate:modelValue":e[21]||(e[21]=t=>ge.value=t),label:"Video URL",variant:"outlined",placeholder:"https://youtube.com/watch?v=..."},null,8,["modelValue"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(P,{color:"primary","prepend-icon":"tabler-plus",onClick:Ft},{default:l(()=>e[61]||(e[61]=[c(" Add Video URL ")])),_:1,__:[61]})]),_:1})]),_:1})])):(i(),p("div",Ka,[a(Re,{multiple:"","show-size":"",label:"Upload Videos",accept:"video/*",variant:"outlined","prepend-icon":"tabler-upload",onChange:e[22]||(e[22]=t=>{var r;return Ct(((r=t.target)==null?void 0:r.files)||t)})})])),f(ae).length?(i(),p("div",Qa,[e[62]||(e[62]=s("h4",{class:"text-subtitle-1 mb-4"},"Uploaded Videos",-1)),a(ga,null,{default:l(()=>[(i(!0),p(Fe,null,Ce(f(ae),t=>(i(),k(ba,{key:t.id},{append:l(()=>[a(P,{icon:"tabler-trash",size:"small",color:"error",variant:"text",onClick:r=>St(t.id)},null,8,["onClick"])]),default:l(()=>[a(_a,null,{default:l(()=>[c(m(t.titre||"Untitled Video"),1)]),_:2},1024),a(ya,null,{default:l(()=>[c(m(t.url),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(i(),k(R,{key:3,type:"info",variant:"tonal"},{default:l(()=>e[63]||(e[63]=[c(" No videos added yet. Add some videos to showcase your product in action. ")])),_:1,__:[63]}))])):(i(),p("div",Ya,[a(h,{icon:"tabler-video-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),e[57]||(e[57]=s("h3",{class:"text-h6 mb-2"},"Save Product First",-1)),e[58]||(e[58]=s("p",{class:"text-body-2 text-medium-emphasis"}," You need to save the product details before adding videos. ",-1))]))]),_:1}),a(Z,{value:"variants"},{default:l(()=>[A.value?(i(),p("div",Za,[e[72]||(e[72]=s("div",{class:"mb-6"},[s("h3",{class:"text-h6 mb-2"},"Product Variants"),s("p",{class:"text-body-2 text-medium-emphasis"}," Create different variants of your product (size, color, etc.) with optional images. ")],-1)),a(z,{variant:"outlined",class:"mb-6"},{default:l(()=>[a(H,{class:"d-flex justify-space-between align-center"},{default:l(()=>[s("div",eo,[e[67]||(e[67]=s("span",null,"Add New Variant",-1)),a(rt,{modelValue:Pe.value,"onUpdate:modelValue":e[23]||(e[23]=t=>Pe.value=t),label:"Multi-select",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),a(P,{variant:"text",size:"small",color:"primary","prepend-icon":"tabler-settings",to:"/admin/variants/attributs",target:"_blank"},{default:l(()=>e[68]||(e[68]=[c(" Manage Catalog ")])),_:1,__:[68]})]),_:1}),a(te,null,{default:l(()=>[a(J,null,{default:l(()=>[a(b,{cols:"12",md:"3"},{default:l(()=>[a(ee,{modelValue:y.attribut_id,"onUpdate:modelValue":[e[24]||(e[24]=t=>y.attribut_id=t),zt],label:"Attribute",variant:"outlined",items:Je.value,"item-title":"nom","item-value":"id",placeholder:"Select attribute"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"12",md:"3"},{default:l(()=>[Pe.value?(i(),k(ee,{key:1,modelValue:y.valeur_ids,"onUpdate:modelValue":e[26]||(e[26]=t=>y.valeur_ids=t),label:"Values",variant:"outlined",items:be.value,"item-title":"libelle","item-value":"id",placeholder:"Select multiple values",disabled:!y.attribut_id,multiple:"",chips:"","closable-chips":""},null,8,["modelValue","items","disabled"])):(i(),k(ee,{key:0,modelValue:y.valeur_id,"onUpdate:modelValue":e[25]||(e[25]=t=>y.valeur_id=t),label:"Value",variant:"outlined",items:be.value,"item-title":"libelle","item-value":"id",placeholder:"Select value",disabled:!y.attribut_id},null,8,["modelValue","items","disabled"]))]),_:1}),a(b,{cols:"12",md:"3"},{default:l(()=>[a(U,{modelValue:y.prix_vente_variante,"onUpdate:modelValue":e[27]||(e[27]=t=>y.prix_vente_variante=t),modelModifiers:{number:!0},label:"Price Override",type:"number",variant:"outlined",step:"0.01",suffix:"MAD",placeholder:"Optional"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"3",class:"d-flex align-end"},{default:l(()=>[Pe.value?(i(),k(P,{key:1,color:"primary",block:"",disabled:!y.attribut_id||!y.valeur_ids.length,onClick:Ut},{default:l(()=>[c(" Add "+m(y.valeur_ids.length||0)+" Variants ",1)]),_:1},8,["disabled"])):(i(),k(P,{key:0,color:"primary",block:"",disabled:!y.attribut_id||!y.valeur_id,onClick:Tt},{default:l(()=>e[69]||(e[69]=[c(" Add Variant ")])),_:1,__:[69]},8,["disabled"]))]),_:1})]),_:1})]),_:1})]),_:1}),f(S).length?(i(),p("div",to,[e[70]||(e[70]=s("h4",{class:"text-subtitle-1 mb-4"},"Product Variants",-1)),a(st,{headers:[{title:"Attribute",key:"attribut"},{title:"Value",key:"valeur"},{title:"Price",key:"prix_vente_variante"},{title:"Image",key:"image",sortable:!1},{title:"Actions",key:"actions",sortable:!1}],items:f(S),class:"elevation-1"},{"item.attribut":l(({item:t})=>{var r;return[s("div",null,[s("div",ao,m(((r=t.attribut)==null?void 0:r.nom)||t.nom),1),t.attribut?(i(),p("div",oo,m(t.attribut.code),1)):$("",!0)])]}),"item.valeur":l(({item:t})=>{var r;return[s("div",null,[s("div",lo,m(((r=t.valeur)==null?void 0:r.libelle)||t.valeur),1),t.valeur?(i(),p("div",ro,m(t.valeur.code),1)):$("",!0)])]}),"item.prix_vente_variante":l(({item:t})=>[c(m(t.prix_vente_variante?`${t.prix_vente_variante} MAD`:"Default"),1)]),"item.image":l(({item:t})=>[s("div",so,[t.image_url?(i(),k(Se,{key:0,src:t.image_url,width:"40",height:"40",cover:"",class:"rounded",alt:`Variant ${t.nom} ${t.valeur}`},null,8,["src","alt"])):(i(),p("span",io,"No image")),a(Re,{density:"compact","hide-details":"",accept:"image/*",variant:"plain",onChange:r=>{var n,_;return((_=(n=r.target)==null?void 0:n.files)==null?void 0:_[0])&&qt(t.id,r.target.files[0])}},null,8,["onChange"])])]),"item.actions":l(({item:t})=>[a(P,{icon:"tabler-trash",size:"small",color:"error",variant:"text",onClick:r=>At(t.id)},null,8,["onClick"])]),_:1},8,["items"])])):(i(),k(R,{key:1,type:"info",variant:"tonal"},{default:l(()=>e[71]||(e[71]=[c(" No variants created yet. Add variants to offer different options for your product. ")])),_:1,__:[71]}))])):(i(),p("div",Ga,[a(h,{icon:"tabler-versions-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),e[65]||(e[65]=s("h3",{class:"text-h6 mb-2"},"Save Product First",-1)),e[66]||(e[66]=s("p",{class:"text-body-2 text-medium-emphasis"}," You need to save the product details before adding variants. ",-1))]))]),_:1}),a(Z,{value:"stock"},{default:l(()=>[A.value?(i(),p("div",uo,[a(z,{variant:"outlined",class:"mb-6"},{default:l(()=>[a(H,{class:"d-flex justify-space-between align-center"},{default:l(()=>[s("span",null,m(o.$t("product.stock.global")),1),W.value.length>1?(i(),k(ee,{key:0,modelValue:g.warehouse_id,"onUpdate:modelValue":[e[28]||(e[28]=t=>g.warehouse_id=t),ye],items:W.value,"item-title":"name","item-value":"id",label:o.$t("product.stock.warehouse"),variant:"outlined",density:"compact",style:{"max-width":"300px"}},null,8,["modelValue","items","label"])):W.value.length===1?(i(),k(I,{key:1,color:"primary",variant:"tonal"},{default:l(()=>[c(m(W.value[0].name),1)]),_:1})):$("",!0)]),_:1}),a(te,null,{default:l(()=>[a(J,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:g.stock_total,"onUpdate:modelValue":e[29]||(e[29]=t=>g.stock_total=t),modelModifiers:{number:!0},label:o.$t("product.stock.total"),type:"number",variant:"outlined",min:"0",suffix:"unitÃ©s",error:Y.value,"error-messages":Y.value?`Total insuffisant (${N.value} allouÃ©s)`:[]},null,8,["modelValue","label","error","error-messages"])]),_:1}),a(b,{cols:"12",md:"6",class:"d-flex align-end"},{default:l(()=>[a(P,{color:"primary",variant:"outlined",disabled:!F.value.length||!g.stock_total,onClick:Dt},{default:l(()=>[a(h,{icon:"tabler-arrows-split",start:""}),c(" "+m(o.$t("product.stock.distribute")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),a(z,{variant:"outlined",class:"mb-6"},{default:l(()=>[a(H,null,{default:l(()=>[s("div",co,[e[77]||(e[77]=s("span",null,"Stock par combinaison (Taille Ã— Couleur)",-1)),s("div",mo,[F.value.some(t=>t.is_combination)?(i(),k(I,{key:0,color:"success",variant:"tonal",size:"small"},{default:l(()=>e[75]||(e[75]=[c(" Combinaisons crÃ©Ã©es ")])),_:1,__:[75]})):F.value.some(t=>t.is_virtual)?(i(),k(I,{key:1,color:"warning",variant:"tonal",size:"small"},{default:l(()=>e[76]||(e[76]=[c(" Combinaisons virtuelles ")])),_:1,__:[76]})):$("",!0)])])]),_:1}),a(te,null,{default:l(()=>[Ee.value?(i(),p("div",vo,[a(oa,{indeterminate:"",color:"primary"}),e[78]||(e[78]=s("p",{class:"text-body-2 text-medium-emphasis mt-2"},"Chargement de la matrice...",-1))])):F.value.length?(i(),p("div",fo,[F.value.some(t=>t.is_virtual)?(i(),k(R,{key:0,type:"warning",variant:"tonal",class:"mb-4"},{default:l(()=>[s("div",go,[s("div",null,[a(h,{icon:"tabler-alert-triangle",start:""}),e[80]||(e[80]=s("strong",null,"Combinaisons virtuelles dÃ©tectÃ©es :",-1)),e[81]||(e[81]=c(" Vous avez des variantes de taille et couleur sÃ©parÃ©es. GÃ©nÃ©rez les combinaisons pour gÃ©rer le stock par taille Ã— couleur. "))]),a(P,{color:"warning",variant:"outlined",size:"small",onClick:Mt,loading:$e.value},{default:l(()=>[a(h,{icon:"tabler-plus",start:""}),e[82]||(e[82]=c(" GÃ©nÃ©rer combinaisons "))]),_:1,__:[82]},8,["loading"])])]),_:1})):F.value.some(t=>t.is_combination)?(i(),k(R,{key:1,type:"success",variant:"tonal",class:"mb-4"},{default:l(()=>[a(h,{icon:"tabler-check-circle",start:""}),e[83]||(e[83]=s("strong",null,"Combinaisons Taille Ã— Couleur :",-1)),e[84]||(e[84]=c(" Le stock est gÃ©rÃ© individuellement pour chaque combinaison de taille et couleur. "))]),_:1,__:[83,84]})):$("",!0),a(ka,{density:"compact"},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",null,m(o.$t("product.stock.matrix.color")),1),s("th",null,m(o.$t("product.stock.matrix.size")),1),s("th",null,m(o.$t("product.stock.matrix.qty")),1),s("th",null,m(o.$t("product.stock.matrix.reserved")),1),s("th",null,m(o.$t("product.stock.matrix.available")),1)])]),s("tbody",null,[(i(!0),p(Fe,null,Ce(F.value,(t,r)=>(i(),p("tr",{key:r},[s("td",null,[t.color?(i(),p("div",bo,[t.color_image?(i(),k(Se,{key:0,src:t.color_image,width:"24",height:"24",cover:"",class:"rounded me-2"},null,8,["src"])):$("",!0),s("span",null,m(t.color),1)])):(i(),p("span",_o,"-"))]),s("td",null,[t.size?(i(),p("span",yo,m(t.size),1)):(i(),p("span",ko,"-"))]),s("td",null,[t.is_virtual?(i(),k(I,{key:1,color:"warning",variant:"tonal",size:"small"},{default:l(()=>e[85]||(e[85]=[c(" Virtuel ")])),_:1,__:[85]})):(i(),k(U,{key:0,"model-value":t.qty,type:"number",variant:"outlined",density:"compact",min:"0",style:{width:"100px"},"hide-details":"","onUpdate:modelValue":n=>It(t.variante_id,n)},null,8,["model-value","onUpdate:modelValue"]))]),s("td",Vo,m(t.reserved||0),1),s("td",ho,m(t.available||0),1)]))),128))]),s("tfoot",null,[s("tr",{class:Ie(Y.value?"bg-red-lighten-4":"bg-grey-lighten-4")},[s("td",xo,m(f(ce)("admin_total")),1),s("td",{class:Ie(Y.value?"font-weight-bold text-red":"font-weight-bold")},[c(m(N.value)+" ",1),Y.value?(i(),k(h,{key:0,icon:"tabler-alert-circle",size:"small",color:"red",class:"ml-1"})):$("",!0)],2),s("td",wo,m(Qe.value),1),s("td",Po,m(vt.value),1)],2)])]),_:1}),Y.value?(i(),k(R,{key:2,type:"error",variant:"tonal",class:"mt-4"},{default:l(()=>[a(h,{icon:"tabler-alert-circle",start:""}),e[86]||(e[86]=s("strong",null,"âŒ Erreur : Stock dÃ©passÃ© !",-1)),e[87]||(e[87]=s("br",null,null,-1)),c(" La somme des variantes ("+m(N.value)+") dÃ©passe le stock total ("+m(g.stock_total)+"). ",1),e[88]||(e[88]=s("br",null,null,-1)),e[89]||(e[89]=s("small",{class:"text-medium-emphasis"}," RÃ©duisez les quantitÃ©s des variantes ou augmentez le stock total. ",-1))]),_:1,__:[86,87,88,89]})):Ge.value?(i(),k(R,{key:3,type:"warning",variant:"tonal",class:"mt-4"},{default:l(()=>[a(h,{icon:"tabler-alert-triangle",start:""}),c(" "+m(o.$t("product.stock.mismatch_warning"))+" ",1),e[90]||(e[90]=s("br",null,null,-1)),s("strong",null,"Stock total: "+m(g.stock_total),1),e[91]||(e[91]=c(" | ")),s("strong",null,"Somme variantes: "+m(N.value),1),e[92]||(e[92]=s("br",null,null,-1)),e[93]||(e[93]=s("small",{class:"text-medium-emphasis"},' Utilisez le bouton "RÃ©partir sur variantes" pour Ã©quilibrer automatiquement. ',-1))]),_:1,__:[90,91,92,93]})):$("",!0)])):(i(),p("div",po,[a(h,{icon:"tabler-versions-off",size:"48",color:"grey-lighten-1",class:"mb-4"}),e[79]||(e[79]=s("p",{class:"text-body-2 text-medium-emphasis"}," Aucune variante trouvÃ©e. CrÃ©ez des variantes de taille et/ou couleur d'abord. ",-1))]))]),_:1})]),_:1})])):(i(),p("div",no,[a(h,{icon:"tabler-package-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),e[73]||(e[73]=s("h3",{class:"text-h6 mb-2"},"Save Product First",-1)),e[74]||(e[74]=s("p",{class:"text-body-2 text-medium-emphasis"}," You need to save the product details before managing stock. ",-1))]))]),_:1}),a(Z,{value:"propositions"},{default:l(()=>[A.value?(i(),p("div",Co,[e[102]||(e[102]=s("div",{class:"mb-6"},[s("h3",{class:"text-h6 mb-2"},"Product Propositions"),s("p",{class:"text-body-2 text-medium-emphasis"}," Create marketing propositions and selling points for your product. ")],-1)),a(z,{class:"mb-6"},{default:l(()=>[a(H,null,{default:l(()=>e[96]||(e[96]=[c("Add New Proposition")])),_:1,__:[96]}),a(te,null,{default:l(()=>[a(Me,{onSubmit:qe(Bt,["prevent"])},{default:l(()=>[a(J,null,{default:l(()=>[a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:T.titre,"onUpdate:modelValue":e[30]||(e[30]=t=>T.titre=t),label:"Title",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(ee,{modelValue:T.type,"onUpdate:modelValue":e[31]||(e[31]=t=>T.type=t),items:[{title:"New",value:"nouveau"},{title:"Modification",value:"modification"},{title:"Deletion",value:"suppression"}],label:"Type",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(Le,{modelValue:T.description,"onUpdate:modelValue":e[32]||(e[32]=t=>T.description=t),label:"Description",variant:"outlined",rows:"3",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(P,{type:"submit",color:"primary",disabled:!T.titre||!T.description||!T.type},{default:l(()=>e[97]||(e[97]=[c(" Add Proposition ")])),_:1,__:[97]},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),le.value.length>0?(i(),k(z,{key:0},{default:l(()=>[a(H,null,{default:l(()=>e[98]||(e[98]=[c("Existing Propositions")])),_:1,__:[98]}),a(te,null,{default:l(()=>[a(J,null,{default:l(()=>[(i(!0),p(Fe,null,Ce(le.value,t=>(i(),k(b,{key:t.id,cols:"12",md:"6"},{default:l(()=>[a(z,{variant:"outlined",class:"h-100"},{default:l(()=>[a(H,{class:"d-flex align-center justify-space-between"},{default:l(()=>[s("span",null,m(t.titre),1),a(I,{color:Ht(t.statut),size:"small"},{default:l(()=>[c(m(t.statut),1)]),_:2},1032,["color"])]),_:2},1024),a(te,null,{default:l(()=>[s("p",So,m(t.description),1),a(I,{size:"small",variant:"outlined",class:"mb-2"},{default:l(()=>[c(m(t.type),1)]),_:2},1024),t.image_url?(i(),p("div",Eo,[a(Se,{src:t.image_url,height:"100",class:"rounded",alt:`Proposition ${t.titre||"image"}`,cover:""},null,8,["src","alt"])])):(i(),p("div",$o,[a(R,{type:"info",variant:"tonal",density:"compact"},{default:l(()=>e[99]||(e[99]=[c(" No image uploaded ")])),_:1,__:[99]})]))]),_:2},1024),a(De,null,{default:l(()=>[a(P,{size:"small",variant:"outlined",disabled:!t.id,onClick:r=>t.id&&Yt(t.id)},{default:l(()=>[c(m(t.image_url?"Change Image":"Add Image"),1)]),_:2},1032,["disabled","onClick"]),a(Ne),a(P,{size:"small",color:"error",variant:"outlined",disabled:!t.id,onClick:r=>t.id&&Wt(t.id)},{default:l(()=>e[100]||(e[100]=[c(" Delete ")])),_:2,__:[100]},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):(i(),k(R,{key:1,type:"info",variant:"tonal"},{default:l(()=>e[101]||(e[101]=[c(" No propositions created yet. Add propositions to create compelling selling points for your product. ")])),_:1,__:[101]}))])):(i(),p("div",Fo,[a(h,{icon:"tabler-list-details-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),e[94]||(e[94]=s("h3",{class:"text-h6 mb-2"},"Save Product First",-1)),e[95]||(e[95]=s("p",{class:"text-body-2 text-medium-emphasis"}," You need to save the product details before adding propositions. ",-1))]))]),_:1}),a(Z,{value:"ruptures"},{default:l(()=>[A.value?(i(),p("div",To,[e[112]||(e[112]=s("div",{class:"mb-6"},[s("h3",{class:"text-h6 mb-2"},"Stock Issues (Ruptures)"),s("p",{class:"text-body-2 text-medium-emphasis"}," Manage stock shortages and expected restock dates for this product. ")],-1)),a(z,{class:"mb-6"},{default:l(()=>[a(H,null,{default:l(()=>e[105]||(e[105]=[c("Report Stock Issue")])),_:1,__:[105]}),a(te,null,{default:l(()=>[a(Me,{onSubmit:qe(Xt,["prevent"])},{default:l(()=>[a(J,null,{default:l(()=>[f(S).length>0?(i(),k(b,{key:0,cols:"12",md:"6"},{default:l(()=>[a(ee,{modelValue:E.variante_id,"onUpdate:modelValue":e[33]||(e[33]=t=>E.variante_id=t),items:[{title:"Product-level issue (all variants)",value:null},...f(S).map(t=>(console.debug("[ProductForm] Variant for select:",t),{title:`${t.nom||"Unknown"}: ${t.valeur||"Unknown"}`,value:t.id}))],label:f(S).length>0?"Variant (Required)":"Variant (Optional)",variant:"outlined",required:f(S).length>0,"error-messages":Q.variante_id},null,8,["modelValue","items","label","required","error-messages"])]),_:1})):(i(),k(b,{key:1,cols:"12",md:"6"},{default:l(()=>[a(R,{type:"info",variant:"tonal",class:"mb-0"},{default:l(()=>e[106]||(e[106]=[c(" This product has no variants. The stock issue will apply to the entire product. ")])),_:1,__:[106]})]),_:1})),a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:E.motif,"onUpdate:modelValue":e[34]||(e[34]=t=>E.motif=t),label:"Reason",variant:"outlined",placeholder:"e.g., Supplier delay, High demand",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:E.started_at,"onUpdate:modelValue":e[35]||(e[35]=t=>E.started_at=t),label:"Started At",type:"datetime-local",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",md:"6"},{default:l(()=>[a(U,{modelValue:E.expected_restock_at,"onUpdate:modelValue":e[36]||(e[36]=t=>E.expected_restock_at=t),label:"Expected Restock (Optional)",type:"datetime-local",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12"},{default:l(()=>[a(P,{type:"submit",color:"primary",disabled:!E.motif||!E.started_at},{default:l(()=>e[107]||(e[107]=[c(" Report Issue ")])),_:1,__:[107]},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),K.value.length>0?(i(),k(z,{key:0},{default:l(()=>[a(H,null,{default:l(()=>e[108]||(e[108]=[c("Current Stock Issues")])),_:1,__:[108]}),a(te,null,{default:l(()=>[a(st,{items:K.value,headers:[{title:"Variant",key:"variante_id"},{title:"Reason",key:"motif"},{title:"Started",key:"started_at"},{title:"Expected Restock",key:"expected_restock_at"},{title:"Status",key:"active"},{title:"Actions",key:"actions",sortable:!1}],class:"elevation-1"},{"item.variante_id":l(({item:t})=>[s("span",{class:Ie(t.variante_id?"":"text-medium-emphasis")},m(ft(t.variante_id)),3)]),"item.started_at":l(({item:t})=>[c(m(new Date(t.started_at).toLocaleDateString()),1)]),"item.expected_restock_at":l(({item:t})=>[t.expected_restock_at?(i(),p("span",Uo,m(new Date(t.expected_restock_at).toLocaleDateString()),1)):(i(),p("span",Ao,"Not set"))]),"item.active":l(({item:t})=>[a(I,{color:t.active?"error":"success",size:"small"},{default:l(()=>[c(m(t.active?"Active":"Resolved"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:t})=>[t.active?(i(),k(P,{key:0,size:"small",color:"success",variant:"outlined",onClick:r=>Kt(t.id)},{default:l(()=>e[109]||(e[109]=[c(" Resolve ")])),_:2,__:[109]},1032,["onClick"])):$("",!0),a(P,{size:"small",color:"error",variant:"outlined",class:"ml-2",onClick:r=>Qt(t.id)},{default:l(()=>e[110]||(e[110]=[c(" Delete ")])),_:2,__:[110]},1032,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1})):(i(),k(R,{key:1,type:"info",variant:"tonal"},{default:l(()=>e[111]||(e[111]=[c(" No stock issues reported yet. Report issues when products are out of stock or delayed. ")])),_:1,__:[111]}))])):(i(),p("div",zo,[a(h,{icon:"tabler-alert-triangle-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),e[103]||(e[103]=s("h3",{class:"text-h6 mb-2"},"Save Product First",-1)),e[104]||(e[104]=s("p",{class:"text-body-2 text-medium-emphasis"}," You need to save the product details before managing stock issues. ",-1))]))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(z,{class:"sticky-footer mt-6"},{default:l(()=>[a(De,{class:"pa-6"},{default:l(()=>[a(Ne),a(P,{variant:"outlined",size:"large",onClick:_t},{default:l(()=>e[113]||(e[113]=[c(" Cancel ")])),_:1,__:[113]}),a(P,{color:"primary",size:"large",type:"button",loading:xe.value,onClick:et},{default:l(()=>[c(m(_e.value?"Update Product":"Create Product"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),a(Va,{modelValue:f(me).show,"onUpdate:modelValue":e[38]||(e[38]=t=>f(me).show=t),color:f(me).color,timeout:f(me).timeout,location:"top end"},{default:l(()=>[c(m(f(me).message),1)]),_:1},8,["modelValue","color","timeout"])]))}}),ml=ha(qo,[["__scopeId","data-v-1b3a98fc"]]);export{ml as P};
