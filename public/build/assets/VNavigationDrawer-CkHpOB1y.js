import{b4 as ae,r as B,V as E,_ as A,a0 as oe,D as Q,w as R,bb as G,bX as re,bi as L,bl as ne,bY as se,aj as le,Z as ie,ae as ue,b2 as ce,bg as ve,ar as z,al as de,c6 as me,aq as fe,c8 as he,as as ge,cl as ye,W as Y,bj as we,bd as pe,aD as be,a2 as Ee,b as k,p as Z,aB as Se,T as Ce,F as _e,b3 as ke,aZ as Te,ah as Pe,bk as Me,ag as De,cm as Ie,a4 as xe,bh as Ve,ai as Be}from"./main-uLG9IIeX.js";import{u as M}from"./useApi-Bt_X5NBj.js";import{u as Ae}from"./useNotifications-DDBS_wPD.js";import{u as Oe,e as Ne,h as Re}from"./forwardRefs-Dv_T9a_w.js";import{u as He}from"./ssrBoot-BPhRU-mF.js";import{V as Le}from"./VImg-BS6_svHJ.js";const et=ae("affiliate-cart",()=>{const e=B([]),u=B({items_count:0,total_amount:0,estimated_commission:0}),c=B(!1),g=B(null),{showSuccess:r,showError:s}=Ae(),i=E(()=>u.value.items_count),y=E(()=>e.value.reduce((n,a)=>n+a.qty,0)),S=E(()=>u.value.total_amount),p=E(()=>u.value.estimated_commission),h=E(()=>e.value.length>0),d=(n,a)=>e.value.filter(t=>{const o=t.variante_id||void 0;return t.produit_id===n&&o===a}).reduce((t,o)=>t+o.qty,0),m=(n,a,t,o)=>{const l=d(n,o),f=l+t;return{canAdd:f>=a,currentQty:l,totalAfterAdd:f}},v=async()=>{c.value=!0,g.value=null,console.log("🔄 [Cart Store] Fetching cart...");try{const{data:n,error:a}=await M("affiliate/cart/summary",{method:"GET"});if(console.log("📡 [Cart Store] Fetch cart response:",{data:n.value,error:a.value}),a.value)throw a.value;if(n.value){const t=n.value;e.value=t.items||[],u.value={items_count:t.items_count||0,total_amount:t.total_amount||0,estimated_commission:t.estimated_commission||0},console.log("✅ [Cart Store] Cart updated:",{itemsCount:e.value.length,summaryCount:u.value.items_count,totalAmount:u.value.total_amount})}}catch(n){g.value=n.message||"Erreur lors du chargement du panier",console.error("❌ [Cart Store] Fetch cart error:",n),s(g.value||"Erreur lors du chargement du panier")}finally{c.value=!1}};return{items:e,summary:u,loading:c,error:g,count:i,totalQty:y,subtotal:S,estimatedCommission:p,hasItems:h,getProductQuantityInCart:d,canAddQuantity:m,fetchCart:v,addItem:async n=>{console.log("🔄 [Cart Store] Adding item:",n);try{const{data:a,error:t}=await M("affiliate/cart/add",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});if(console.log("📡 [Cart Store] API response:",{data:a.value,error:t.value}),t.value)if(t.value.status===422){const o=t.value.message||"Stock insuffisant ou données invalides";throw s(o),new Error(o)}else if(t.value.status===404){const o=t.value.message||"Produit non trouvé";throw s(o),new Error(o)}else if(t.value.status===400){const o=t.value.message||"Stock insuffisant";throw s(o),new Error(o)}else throw t.value;return r("Ajouté au panier"),console.log("✅ [Cart Store] Item added successfully, refreshing cart..."),await v(),console.log("🔄 [Cart Store] Cart refreshed, new count:",e.value.length),a.value}catch(a){console.error("❌ [Cart Store] Add item error:",a);const t=a.message||"Erreur lors de l'ajout au panier";throw a.message||s(t),a}},updateItem:async(n,a)=>{try{const{data:t,error:o}=await M("affiliate/cart/items",{method:"PATCH",body:JSON.stringify({item_key:n,...a}),headers:{"Content-Type":"application/json"}});if(o.value)if(o.value.status===422){const l=o.value.message||"Données invalides";throw s(l),new Error(l)}else if(o.value.status===404){const l=o.value.message||"Article non trouvé";throw s(l),new Error(l)}else throw o.value;return r("Panier mis à jour"),await v(),t.value}catch(t){const o=t.message||"Erreur lors de la mise à jour";throw t.message||s(o),t}},removeItem:async n=>{try{const{data:a,error:t}=await M("affiliate/cart/items",{method:"DELETE",body:JSON.stringify({item_key:n}),headers:{"Content-Type":"application/json"}});if(t.value)if(t.value.status===422){const o=t.value.message||"Impossible de retirer ce produit";throw s(o),new Error(o)}else if(t.value.status===404){const o=t.value.message||"Produit non trouvé dans le panier";throw s(o),new Error(o)}else throw t.value;return r("Produit retiré du panier"),await v(),a.value}catch(a){const t=a.message||"Erreur lors de la suppression";throw a.message||s(t),a}},clear:async()=>{try{const{data:n,error:a}=await M("affiliate/cart/clear",{method:"DELETE"});if(a.value)throw a.value;return r("Panier vidé"),e.value=[],u.value={items_count:0,total_amount:0,estimated_commission:0},n.value}catch(n){const a=n.message||"Erreur lors du vidage du panier";throw s(a),n}},preview:async()=>{try{const{data:n,error:a}=await M("/affiliate/cart/preview",{method:"POST"});if(a.value)throw a.value;return n.value}catch(n){const a=n.message||"Erreur lors de l'aperçu";throw s(a),n}},checkout:async n=>{c.value=!0,g.value=null;try{const{data:a,error:t}=await M("affiliate/checkout",{method:"POST",body:JSON.stringify({receiver_name:n.nom_complet,receiver_phone:n.telephone,city_id:n.city_id,address_line:n.adresse,note:n.note||""}),headers:{"Content-Type":"application/json"}});if(t.value)throw t.value;const o=a.value;return o!=null&&o.success&&(r(o.message||"Commande créée avec succès"),e.value=[],u.value={items_count:0,total_amount:0,estimated_commission:0}),a.value}catch(a){throw g.value=a.message||"Erreur lors de la validation de la commande",s(g.value||"Erreur lors de la validation de la commande"),a}finally{c.value=!1}},fetchCities:async n=>{var a;try{const t=new URLSearchParams;n&&t.append("q",n),t.append("per_page","100");const{data:o,error:l}=await M(`affiliate/ozon/cities?${t.toString()}`,{method:"GET"});if(l.value)throw l.value;return(((a=o.value)==null?void 0:a.data)||[]).map(T=>({city_id:T.city_id,name:T.name}))}catch(t){return console.error("❌ [Cart Store] Fetch cities error:",t),s("Erreur lors du chargement des villes"),[]}}}}),N=B(!1);function tt(){return{cartDrawerOpen:N,openCartDrawer:()=>{N.value=!0},closeCartDrawer:()=>{N.value=!1},toggleCartDrawer:()=>{N.value=!N.value}}}function Ye(e){let{rootEl:u,isSticky:c,layoutItemStyles:g}=e;const r=A(!1),s=A(0),i=E(()=>{const p=typeof r.value=="boolean"?"top":r.value;return[c.value?{top:"auto",bottom:"auto",height:void 0}:void 0,r.value?{[p]:oe(s.value)}:{top:g.value.top}]});Q(()=>{R(c,p=>{p?window.addEventListener("scroll",S,{passive:!0}):window.removeEventListener("scroll",S)},{immediate:!0})}),G(()=>{window.removeEventListener("scroll",S)});let y=0;function S(){const p=y>window.scrollY?"up":"down",h=u.value.getBoundingClientRect(),d=parseFloat(g.value.top??0),m=window.scrollY-Math.max(0,s.value-d),v=h.height+Math.max(s.value,d)-window.scrollY-window.innerHeight,b=parseFloat(getComputedStyle(u.value).getPropertyValue("--v-body-scroll-y"))||0;h.height<window.innerHeight-d?(r.value="top",s.value=d):p==="up"&&r.value==="bottom"||p==="down"&&r.value==="top"?(s.value=window.scrollY+h.top-b,r.value=!0):p==="down"&&v<=0?(s.value=0,r.value="bottom"):p==="up"&&m<=0&&(b?r.value!=="top"&&(s.value=-m+b+d,r.value="top"):(s.value=h.top+m,r.value="top")),y=window.scrollY}return{isStuck:r,stickyStyles:i}}const Fe=100,We=20;function J(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function U(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let u=0;for(let c=e.length-1;c>0;c--){if(e[c].t===e[c-1].t)continue;const g=J(u),r=(e[c].d-e[c-1].d)/(e[c].t-e[c-1].t);u+=(r-g)*Math.abs(r),c===e.length-1&&(u*=.5)}return J(u)*1e3}function je(){const e={};function u(r){Array.from(r.changedTouches).forEach(s=>{(e[s.identifier]??(e[s.identifier]=new re(We))).push([r.timeStamp,s])})}function c(r){Array.from(r.changedTouches).forEach(s=>{delete e[s.identifier]})}function g(r){var p;const s=(p=e[r])==null?void 0:p.values().reverse();if(!s)throw new Error(`No samples for touch id ${r}`);const i=s[0],y=[],S=[];for(const h of s){if(i[0]-h[0]>Fe)break;y.push({t:h[0],d:h[1].clientX}),S.push({t:h[0],d:h[1].clientY})}return{x:U(y),y:U(S),get direction(){const{x:h,y:d}=this,[m,v]=[Math.abs(h),Math.abs(d)];return m>v&&h>=0?"right":m>v&&h<=0?"left":v>m&&d>=0?"down":v>m&&d<=0?"up":Xe()}}}return{addMovement:u,endTouch:c,getVelocity:g}}function Xe(){throw new Error}function $e(e){let{el:u,isActive:c,isTemporary:g,width:r,touchless:s,position:i}=e;Q(()=>{window.addEventListener("touchstart",D,{passive:!0}),window.addEventListener("touchmove",P,{passive:!1}),window.addEventListener("touchend",O,{passive:!0})}),G(()=>{window.removeEventListener("touchstart",D),window.removeEventListener("touchmove",P),window.removeEventListener("touchend",O)});const y=E(()=>["left","right"].includes(i.value)),{addMovement:S,endTouch:p,getVelocity:h}=je();let d=!1;const m=A(!1),v=A(0),b=A(0);let C;function I(a,t){return(i.value==="left"?a:i.value==="right"?document.documentElement.clientWidth-a:i.value==="top"?a:i.value==="bottom"?document.documentElement.clientHeight-a:V())-(t?r.value:0)}function x(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const o=i.value==="left"?(a-b.value)/r.value:i.value==="right"?(document.documentElement.clientWidth-a-b.value)/r.value:i.value==="top"?(a-b.value)/r.value:i.value==="bottom"?(document.documentElement.clientHeight-a-b.value)/r.value:V();return t?Math.max(0,Math.min(1,o)):o}function D(a){if(s.value)return;const t=a.changedTouches[0].clientX,o=a.changedTouches[0].clientY,l=25,f=i.value==="left"?t<l:i.value==="right"?t>document.documentElement.clientWidth-l:i.value==="top"?o<l:i.value==="bottom"?o>document.documentElement.clientHeight-l:V(),w=c.value&&(i.value==="left"?t<r.value:i.value==="right"?t>document.documentElement.clientWidth-r.value:i.value==="top"?o<r.value:i.value==="bottom"?o>document.documentElement.clientHeight-r.value:V());(f||w||c.value&&g.value)&&(C=[t,o],b.value=I(y.value?t:o,c.value),v.value=x(y.value?t:o),d=b.value>-20&&b.value<80,p(a),S(a))}function P(a){const t=a.changedTouches[0].clientX,o=a.changedTouches[0].clientY;if(d){if(!a.cancelable){d=!1;return}const f=Math.abs(t-C[0]),w=Math.abs(o-C[1]);(y.value?f>w&&f>3:w>f&&w>3)?(m.value=!0,d=!1):(y.value?w:f)>3&&(d=!1)}if(!m.value)return;a.preventDefault(),S(a);const l=x(y.value?t:o,!1);v.value=Math.max(0,Math.min(1,l)),l>1?b.value=I(y.value?t:o,!0):l<0&&(b.value=I(y.value?t:o,!1))}function O(a){if(d=!1,!m.value)return;S(a),m.value=!1;const t=h(a.changedTouches[0].identifier),o=Math.abs(t.x),l=Math.abs(t.y);(y.value?o>l&&o>400:l>o&&l>3)?c.value=t.direction===({left:"right",right:"left",top:"down",bottom:"up"}[i.value]||V()):c.value=v.value>.5}const n=E(()=>m.value?{transform:i.value==="left"?`translateX(calc(-100% + ${v.value*r.value}px))`:i.value==="right"?`translateX(calc(100% - ${v.value*r.value}px))`:i.value==="top"?`translateY(calc(-100% + ${v.value*r.value}px))`:i.value==="bottom"?`translateY(calc(100% - ${v.value*r.value}px))`:V(),transition:"none"}:void 0);return L(m,()=>{var o,l;const a=((o=u.value)==null?void 0:o.style.transform)??null,t=((l=u.value)==null?void 0:l.style.transition)??null;ne(()=>{var f,w,T,H;(w=u.value)==null||w.style.setProperty("transform",((f=n.value)==null?void 0:f.transform)||"none"),(H=u.value)==null||H.style.setProperty("transition",((T=n.value)==null?void 0:T.transition)||null)}),se(()=>{var f,w;(f=u.value)==null||f.style.setProperty("transform",a),(w=u.value)==null||w.style.setProperty("transition",t)})}),{isDragging:m,dragProgress:v,dragStyles:n}}function V(){throw new Error}const qe=["start","end","left","right","top","bottom"],ze=ie({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>qe.includes(e)},sticky:Boolean,...Ve(),...xe(),...Re(),...Ie({mobile:null}),...De(),...Me(),...Pe(),...Te({tag:"nav"}),...ke()},"VNavigationDrawer"),at=le()({name:"VNavigationDrawer",props:ze(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,u){let{attrs:c,emit:g,slots:r}=u;const{isRtl:s}=ue(),{themeClasses:i}=ce(e),{borderClasses:y}=ve(e),{backgroundColorClasses:S,backgroundColorStyles:p}=z(()=>e.color),{elevationClasses:h}=de(e),{displayClasses:d,mobile:m}=me(e),{roundedClasses:v}=fe(e),b=he(),C=ge(e,"modelValue",null,_=>!!_),{ssrBootStyles:I}=He(),{scopeId:x}=Oe(),D=B(),P=A(!1),{runOpenDelay:O,runCloseDelay:n}=Ne(e,_=>{P.value=_}),a=E(()=>e.rail&&e.expandOnHover&&P.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),t=E(()=>ye(e.location,s.value)),o=Y(()=>e.persistent),l=E(()=>!e.permanent&&(m.value||e.temporary)),f=E(()=>e.sticky&&!l.value&&t.value!=="bottom");L(()=>e.expandOnHover&&e.rail!=null,()=>{R(P,_=>g("update:rail",!_))}),L(()=>!e.disableResizeWatcher,()=>{R(l,_=>!e.permanent&&Be(()=>C.value=!_))}),L(()=>!e.disableRouteWatcher&&!!b,()=>{R(b.currentRoute,()=>l.value&&(C.value=!1))}),R(()=>e.permanent,_=>{_&&(C.value=!0)}),e.modelValue==null&&!l.value&&(C.value=e.permanent||!m.value);const{isDragging:w,dragProgress:T}=$e({el:D,isActive:C,isTemporary:l,width:a,touchless:Y(()=>e.touchless),position:t}),H=E(()=>{const _=l.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):a.value;return w.value?_*T.value:_}),{layoutItemStyles:F,layoutItemScrimStyles:K}=we({id:e.name,order:E(()=>parseInt(e.order,10)),position:t,layoutSize:H,elementSize:a,active:pe(C),disableTransitions:Y(()=>w.value),absolute:E(()=>e.absolute||f.value&&typeof W.value!="string")}),{isStuck:W,stickyStyles:ee}=Ye({rootEl:D,isSticky:f,layoutItemStyles:F}),j=z(()=>typeof e.scrim=="string"?e.scrim:null),te=E(()=>({...w.value?{opacity:T.value*.2,transition:"none"}:void 0,...K.value}));return be({VList:{bgColor:"transparent"}}),Ee(()=>{const _=r.image||e.image;return k(_e,null,[k(e.tag,Z({ref:D,onMouseenter:O,onMouseleave:n,class:["v-navigation-drawer",`v-navigation-drawer--${t.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":P.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":l.value,"v-navigation-drawer--persistent":o.value,"v-navigation-drawer--active":C.value,"v-navigation-drawer--sticky":f.value},i.value,S.value,y.value,d.value,h.value,v.value,e.class],style:[p.value,F.value,I.value,ee.value,e.style]},x,c),{default:()=>{var X,$,q;return[_&&k("div",{key:"image",class:"v-navigation-drawer__img"},[r.image?k(Se,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:e.image}}},r.image):k(Le,{key:"image-img",alt:"",cover:!0,height:"inherit",src:e.image},null)]),r.prepend&&k("div",{class:"v-navigation-drawer__prepend"},[(X=r.prepend)==null?void 0:X.call(r)]),k("div",{class:"v-navigation-drawer__content"},[($=r.default)==null?void 0:$.call(r)]),r.append&&k("div",{class:"v-navigation-drawer__append"},[(q=r.append)==null?void 0:q.call(r)])]}}),k(Ce,{name:"fade-transition"},{default:()=>[l.value&&(w.value||C.value)&&!!e.scrim&&k("div",Z({class:["v-navigation-drawer__scrim",j.backgroundColorClasses.value],style:[te.value,j.backgroundColorStyles.value],onClick:()=>{o.value||(C.value=!1)}},x),null)]})])}),{isStuck:W}}});export{at as V,tt as a,et as u};
