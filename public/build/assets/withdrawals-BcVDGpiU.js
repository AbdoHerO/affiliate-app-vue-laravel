import{b5 as P,r as v,V as W,ba as m}from"./main-0h7RfoM1.js";const z=P("withdrawals",()=>{const n=v([]),d=v(null),w=v(null),i=v(!1),s=v(null),p=v({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),h=v({page:1,per_page:15,sort:"created_at",dir:"desc"}),_=W(()=>n.value.length>0),$=W(()=>i.value),j=u=>Object.fromEntries(Object.entries(u).filter(([l,r])=>!(r===""||r===null||r===void 0||Array.isArray(r)&&r.length===0))),b=async u=>{var l;try{i.value=!0,s.value=null,u&&(h.value={...u});const r=j(h.value),t=new URLSearchParams;Object.entries(r).forEach(([o,c])=>{c!=null&&c!==""&&(Array.isArray(c)?c.forEach(f=>t.append(`${o}[]`,f.toString())):t.append(o,c.toString()))});const e=`/admin/withdrawals${t.toString()?`?${t.toString()}`:""}`;console.log("ðŸ”„ [Withdrawals Store] Fetching:",e),console.log("ðŸ“‹ [Withdrawals Store] Applied filters:",h.value);const a=await m(e);console.log("ðŸ“¥ [Withdrawals Store] Raw response:",a),a!=null&&a.success?(n.value=a.data||[],a.pagination&&Object.assign(p.value,a.pagination),a.summary&&w.value&&Object.assign(w.value,a.summary),console.log("âœ… [Withdrawals Store] Data loaded:",n.value.length,"withdrawals"),console.log("ðŸ“„ [Withdrawals Store] Pagination:",p.value),console.log("ðŸ“Š [Withdrawals Store] Summary:",w.value)):s.value=(a==null?void 0:a.message)||"Erreur lors du chargement des retraits"}catch(r){s.value=((l=r.data)==null?void 0:l.message)||r.message||"Erreur lors du chargement des retraits",console.error("ðŸš« [Withdrawals Store] Error fetching withdrawals:",r)}finally{i.value=!1}},E=async u=>{var l,r;try{i.value=!0,s.value=null,console.log("ðŸ”„ [Withdrawals Store] Fetching withdrawal:",u);const t=await m(`/admin/withdrawals/${u}`);return t!=null&&t.success?(d.value=t.data,console.log("âœ… [Withdrawals Store] Withdrawal loaded:",(l=t.data)==null?void 0:l.id),{success:!0,data:t.data}):(s.value=(t==null?void 0:t.message)||"Erreur lors du chargement du retrait",{success:!1,message:s.value})}catch(t){return s.value=((r=t.data)==null?void 0:r.message)||t.message||"Erreur lors du chargement du retrait",console.error("ðŸš« [Withdrawals Store] Error fetching withdrawal:",t),{success:!1,message:s.value}}finally{i.value=!1}};return{withdrawals:n,currentWithdrawal:d,summary:w,loading:i,error:s,pagination:p,filters:h,hasWithdrawals:_,isLoading:$,fetchList:b,fetchOne:E,create:async u=>{var l;try{i.value=!0,s.value=null;const r=await m("/admin/withdrawals",{method:"POST",body:u});return r!=null&&r.success?(await b(),{success:!0,data:r.data,message:r.message}):(s.value=(r==null?void 0:r.message)||"Erreur lors de la crÃ©ation du retrait",{success:!1,message:s.value})}catch(r){return s.value=((l=r.data)==null?void 0:l.message)||r.message||"Erreur lors de la crÃ©ation du retrait",console.error("ðŸš« [Withdrawals Store] Error creating withdrawal:",r),{success:!1,message:s.value}}finally{i.value=!1}},attachCommissions:async(u,l)=>{var r,t;try{i.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${u}/attach-commissions`,{method:"POST",body:l});return e!=null&&e.success?(((r=d.value)==null?void 0:r.id)===u&&await E(u),{success:!0,data:e.data.data,message:e.message}):(s.value=(e==null?void 0:e.message)||"Erreur lors de l'attachement des commissions",{success:!1,message:s.value})}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors de l'attachement des commissions",console.error("ðŸš« [Withdrawals Store] Error attaching commissions:",e),{success:!1,message:s.value}}finally{i.value=!1}},detachCommissions:async(u,l)=>{var r,t;try{i.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${u}/detach-commissions`,{method:"POST",body:l});return e!=null&&e.success?(((r=d.value)==null?void 0:r.id)===u&&await E(u),{success:!0,data:e.data.data,message:e.message}):(s.value=(e==null?void 0:e.message)||"Erreur lors du dÃ©tachement des commissions",{success:!1,message:s.value})}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors du dÃ©tachement des commissions",console.error("ðŸš« [Withdrawals Store] Error detaching commissions:",e),{success:!1,message:s.value}}finally{i.value=!1}},approve:async(u,l)=>{var r,t;try{i.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${u}/approve`,{method:"POST",body:l||{}});if(e!=null&&e.success){const a=n.value.findIndex(o=>o.id===u);return a!==-1&&(n.value[a]=e.data.data),((r=d.value)==null?void 0:r.id)===u&&(d.value=e.data.data),{success:!0,data:e.data.data,message:e.message}}else return s.value=(e==null?void 0:e.message)||"Erreur lors de l'approbation du retrait",{success:!1,message:s.value}}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors de l'approbation du retrait",console.error("ðŸš« [Withdrawals Store] Error approving withdrawal:",e),{success:!1,message:s.value}}finally{i.value=!1}},reject:async(u,l)=>{var r,t,e;try{i.value=!0,s.value=null;const a=await m(`/admin/withdrawals/${u}/reject`,{method:"POST",body:l});if(a!=null&&a.success){const o=n.value.findIndex(c=>c.id===u);return o!==-1&&(n.value[o]=a.data.data),((r=d.value)==null?void 0:r.id)===u&&(d.value=a.data.data),{success:!0,data:a.data.data,message:a.data.message}}else return s.value=a.data.message||"Erreur lors du rejet du retrait",{success:!1,message:s.value}}catch(a){return s.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Erreur lors du rejet du retrait",console.error("Error rejecting withdrawal:",a),{success:!1,message:s.value}}finally{i.value=!1}},markInPayment:async(u,l)=>{var r,t;try{i.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${u}/mark-in-payment`,{method:"POST",body:l||{}});if(e!=null&&e.success){const a=n.value.findIndex(o=>o.id===u);return a!==-1&&(n.value[a]=e.data),((r=d.value)==null?void 0:r.id)===u&&(d.value=e.data),{success:!0,data:e.data,message:e.message}}else return s.value=(e==null?void 0:e.message)||"Erreur lors du marquage en cours de paiement",{success:!1,message:s.value}}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors du marquage en cours de paiement",console.error("ðŸš« [Withdrawals Store] Error marking withdrawal in payment:",e),{success:!1,message:s.value}}finally{i.value=!1}},markPaid:async(u,l)=>{var r,t;try{i.value=!0,s.value=null;const e=new FormData;l!=null&&l.payment_ref&&e.append("payment_ref",l.payment_ref),l!=null&&l.paid_at&&e.append("paid_at",l.paid_at),l!=null&&l.evidence&&e.append("evidence",l.evidence);const a=await m(`/admin/withdrawals/${u}/mark-paid`,{method:"POST",body:e});if(a!=null&&a.success){const o=n.value.findIndex(c=>c.id===u);return o!==-1&&(n.value[o]=a.data),((r=d.value)==null?void 0:r.id)===u&&(d.value=a.data),{success:!0,data:a.data,message:a.message}}else return s.value=(a==null?void 0:a.message)||"Erreur lors du marquage comme payÃ©",{success:!1,message:s.value}}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors du marquage comme payÃ©",console.error("ðŸš« [Withdrawals Store] Error marking withdrawal as paid:",e),{success:!1,message:s.value}}finally{i.value=!1}},fetchEligibleCommissions:async(u,l)=>{var r,t,e;try{i.value=!0,s.value=null;const a=new URLSearchParams;l&&Object.entries(l).forEach(([f,g])=>{g!=null&&g!==""&&a.append(f,g.toString())});const o=`/admin/withdrawals/users/${u}/eligible-commissions${a.toString()?`?${a.toString()}`:""}`,c=await m(o);return c!=null&&c.success||c!=null&&c.data?{success:!0,data:{data:Array.isArray((r=c==null?void 0:c.data)==null?void 0:r.data)?c.data.data:Array.isArray(c==null?void 0:c.data)?c.data:Array.isArray(c)?c:[],pagination:((t=c==null?void 0:c.data)==null?void 0:t.pagination)||null}}:(s.value=(c==null?void 0:c.message)||"Erreur lors du chargement des commissions Ã©ligibles",{success:!1,message:s.value})}catch(a){return s.value=((e=a.data)==null?void 0:e.message)||a.message||"Erreur lors du chargement des commissions Ã©ligibles",console.error("ðŸš« [Withdrawals Store] Error fetching eligible commissions:",a),{success:!1,message:s.value}}finally{i.value=!1}},exportCsv:async u=>{var l,r;try{const t={...u},e=localStorage.getItem("auth_token"),a=new URLSearchParams;Object.entries(t).forEach(([O,S])=>{S!=null&&S!==""&&a.append(O,S.toString())});const o=`/admin/withdrawals/export${a.toString()?`?${a.toString()}`:""}`,c=await fetch(`https://tujjar.zincolo.com/api${o}`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(!c.ok)throw new Error("Export failed");const f=await c.blob(),g=window.URL.createObjectURL(f),y=document.createElement("a");return y.href=g,y.setAttribute("download",`withdrawals_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(y),y.click(),y.remove(),window.URL.revokeObjectURL(g),{success:!0,message:"Export terminÃ© avec succÃ¨s"}}catch(t){return s.value=((r=(l=t.response)==null?void 0:l.data)==null?void 0:r.message)||"Erreur lors de l'export",console.error("Error exporting withdrawals:",t),{success:!1,message:s.value}}},resetFilters:()=>{h.value={sort:"created_at",dir:"desc",page:1,per_page:15}},resetState:()=>{n.value=[],d.value=null,w.value=null,s.value=null,p.value={current_page:1,last_page:1,per_page:15,total:0,from:0,to:0},h.value={page:1,per_page:15,sort:"created_at",dir:"desc"}}}});export{z as u};
