import{d as ee,aL as ae,u as se,k as te,b8 as oe,r as C,V as le,o as ie,c as y,b as r,e,n as l,f as u,aU as ne,v as t,az as V,g as a,t as i,ac as p,h as v,m as d}from"./main-DnYrbSQO.js";import{u as ue}from"./commissions-CmyeVjiO.js";import{_ as re}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DQ73-MJ6.js";import{useQuickConfirm as me}from"./useConfirmAction-BI0MVrs1.js";import{u as de}from"./useNotifications-B96M_DMY.js";import{V as M}from"./VChip-CjuV2Q4G.js";import{a as F,V as ce}from"./VRow-B-6WkvV7.js";import{V as j,b as D,c as E}from"./VCard-om2cqSxr.js";import{V as A}from"./VCardText-ByjN3mlm.js";import{V as P,a as c,b as _,d as f}from"./VList-DOWShsA2.js";import{V as _e}from"./VAvatar-BwJp41ss.js";import{V as Q}from"./VTextarea-Dcb-AMDz.js";import{V as G}from"./VSpacer-CqgRR1TD.js";import{V as H}from"./VDialog-Bxp8pJL4.js";import{V as fe}from"./VTextField-BFgmXL2S.js";import"./VBreadcrumbs-C9tszCP5.js";/* empty css              */import"./createSimpleFunctional-D0EIrpo1.js";import"./VImg-CrKU03S9.js";import"./ssrBoot-DYjajp4c.js";import"./VDivider-u64Rz-6W.js";import"./VField-CQs8lPb7.js";import"./forwardRefs-CKYzHDJS.js";import"./VOverlay-B2NeWL_F.js";import"./lazy-tUmo4pC_.js";import"./dialog-transition-DVo_RrAy.js";const pe={key:0,class:"text-center py-8"},ve={class:"mt-4"},be={key:1,class:"text-center py-8"},he={class:"text-h5 mb-2"},ye={class:"text-body-1 mb-4"},ge={key:2},Ve={class:"d-flex justify-space-between align-center mb-6"},ke={class:"text-h4 font-weight-bold mb-1"},xe={class:"d-flex align-center gap-2"},we={class:"text-h5 font-weight-bold text-success"},Ce={class:"d-flex gap-3"},je={key:0,class:"d-flex align-center mb-4"},De={class:"text-h6"},Ae={class:"text-body-2 mb-0"},Le={key:0,class:"text-caption mb-0"},Re={key:0},Te={class:"text-wrap"},Se={key:3,class:"text-center py-8"},Ie={class:"text-h6 mb-2"},qe={class:"text-body-2 text-medium-emphasis mb-4"},Be={class:"text-h6"},Fe={class:"mb-4"},Ne={class:"text-h6"},Ue={class:"mb-4"},ca=ee({__name:"index",setup($e){const{t:o}=ae(),h=se(),S=te(),{showSuccess:I,showError:g}=de(),{confirm:$}=me(),k=ue(),{loading:q}=oe(k),s=C(null),L=C(!1),R=C(!1),x=C(""),B=C(0),w=C(""),J=le(()=>[{title:o("dashboard"),to:"/admin/dashboard"},{title:o("commissions"),to:"/admin/commissions"},{title:`Commission ${h.params.id}`,to:`/admin/commissions/${h.params.id}`}]),T=async()=>{try{console.log("🔍 Fetching commission:",h.params.id);const m=await k.fetchCommission(h.params.id);if(!m){console.error("❌ Commission not found after fetch"),g(o("admin_commissions_not_found")),S.push("/admin/commissions");return}s.value=m,console.log("✅ Commission fetched successfully:",m)}catch(m){console.error("❌ Error fetching commission:",m),g(o("admin_commissions_loading_error")),S.push("/admin/commissions")}},K=async()=>{if(!s.value)return;if(await $({title:o("admin_commissions_confirm_approval"),text:o("admin_commissions_approve_confirmation",{amount:s.value.amount,currency:s.value.currency}),confirmText:o("actions.approve"),color:"success",type:"success"})){const n=await k.approveCommission(s.value.id);n.success?(I(n.message),await T()):g(n.message)}},O=()=>{s.value&&(x.value="",L.value=!0)},W=async()=>{if(!s.value||!x.value.trim())return;const m=await k.rejectCommission(s.value.id,x.value);m.success?(I(m.message),L.value=!1,await T()):g(m.message)},X=async()=>{if(!s.value)return;if(await $({title:o("admin_commissions_mark_as_paid"),text:o("admin_commissions_payment_confirmation",{amount:s.value.amount,currency:s.value.currency}),confirmText:o("actions.confirm_payment"),color:"primary",type:"success"})){const n=await k.markAsPaid(s.value.id);n.success?(I(n.message),await T()):g(n.message)}},Y=()=>{s.value&&(B.value=s.value.amount,w.value="",R.value=!0)},Z=async()=>{if(!s.value||!w.value.trim())return;const m=await k.adjustCommission(s.value.id,B.value,w.value);m.success?(I(m.message),R.value=!1,await T()):g(m.message)},N=()=>{S.push("/admin/commissions")};return ie(async()=>{if(console.log("🚀 Commission detail page mounted, ID:",h.params.id),console.log("🔍 Current commission state:",s.value),console.log("🔍 Loading state:",q.value),!h.params.id||h.params.id==="undefined"){console.error("❌ Invalid commission ID:",h.params.id),g(o("admin_commissions_invalid_id")),S.push("/admin/commissions");return}await T(),console.log("🔍 After fetch - Commission:",s.value),console.log("🔍 After fetch - Loading:",q.value)}),(m,n)=>(r(),y("div",null,[e(re,{items:J.value},null,8,["items"]),l(q)?(r(),y("div",pe,[e(ne,{indeterminate:"",color:"primary"}),u("p",ve,t(l(o)("admin_commissions_loading")),1)])):!s.value&&!l(q)?(r(),y("div",be,[e(V,{icon:"tabler-alert-circle",size:"64",class:"mb-4",color:"error"}),u("h2",he,t(l(o)("admin_commissions_not_found")),1),u("p",ye,t(l(o)("admin_commissions_not_found_description")),1),e(p,{color:"primary",variant:"elevated","prepend-icon":"tabler-arrow-left",onClick:N},{default:a(()=>[i(t(l(o)("actions.backToList")),1)]),_:1})])):s.value?(r(),y("div",ge,[u("div",Ve,[u("div",null,[u("h1",ke," Commission "+t(s.value.id.slice(-8)),1),u("div",xe,[e(M,{color:s.value.status_badge.color,variant:"tonal"},{default:a(()=>[i(t(s.value.status_badge.text),1)]),_:1},8,["color"]),u("span",we,t(s.value.amount)+" "+t(s.value.currency),1)])]),u("div",Ce,[e(p,{color:"grey",variant:"outlined","prepend-icon":"tabler-arrow-left",onClick:N},{default:a(()=>[i(t(l(o)("actions.back")),1)]),_:1}),s.value.can_be_approved?(r(),v(p,{key:0,color:"success",variant:"elevated","prepend-icon":"tabler-check",onClick:K},{default:a(()=>[i(t(l(o)("actions.approve")),1)]),_:1})):d("",!0),s.value.can_be_rejected?(r(),v(p,{key:1,color:"error",variant:"elevated","prepend-icon":"tabler-x",onClick:O},{default:a(()=>[i(t(l(o)("actions.reject")),1)]),_:1})):d("",!0),s.value.can_be_adjusted?(r(),v(p,{key:2,color:"warning",variant:"elevated","prepend-icon":"tabler-edit",onClick:Y},{default:a(()=>[i(t(l(o)("actions.adjust")),1)]),_:1})):d("",!0),s.value.status==="approved"&&!s.value.paid_at?(r(),v(p,{key:3,color:"primary",variant:"elevated","prepend-icon":"tabler-cash",onClick:X},{default:a(()=>[i(t(l(o)("admin_commissions_mark_as_paid")),1)]),_:1})):d("",!0)])]),e(ce,null,{default:a(()=>[e(F,{cols:"12",md:"6"},{default:a(()=>[e(j,null,{default:a(()=>[e(D,null,{default:a(()=>[e(V,{icon:"tabler-percentage",class:"me-2"}),i(" "+t(l(o)("admin_commissions_details")),1)]),_:1}),e(A,null,{default:a(()=>[e(P,null,{default:a(()=>[e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_base_amount")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(s.value.base_amount)+" "+t(s.value.currency),1)]),_:1})]),_:1}),s.value.rate?(r(),v(c,{key:0},{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_rate")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(s.value.rate)+"%",1)]),_:1})]),_:1})):d("",!0),s.value.qty?(r(),v(c,{key:1},{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_quantity")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(s.value.qty),1)]),_:1})]),_:1})):d("",!0),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_final_amount")),1)]),_:1}),e(f,{class:"text-success font-weight-bold"},{default:a(()=>[i(t(s.value.amount)+" "+t(s.value.currency),1)]),_:1})]),_:1}),s.value.rule_code?(r(),v(c,{key:2},{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_applied_rule")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(s.value.rule_code),1)]),_:1})]),_:1})):d("",!0),s.value.eligible_at?(r(),v(c,{key:3},{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_eligible_on")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(new Date(s.value.eligible_at).toLocaleString("fr-FR")),1)]),_:1})]),_:1})):d("",!0),s.value.approved_at?(r(),v(c,{key:4},{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_approved_on")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(new Date(s.value.approved_at).toLocaleString("fr-FR")),1)]),_:1})]),_:1})):d("",!0),s.value.paid_at?(r(),v(c,{key:5},{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_commissions_paid_on")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(new Date(s.value.paid_at).toLocaleString("fr-FR")),1)]),_:1})]),_:1})):d("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{cols:"12",md:"6"},{default:a(()=>[e(j,null,{default:a(()=>[e(D,null,{default:a(()=>[e(V,{icon:"tabler-user",class:"me-2"}),i(" "+t(l(o)("admin_commissions_affiliate_info")),1)]),_:1}),e(A,null,{default:a(()=>[s.value.affiliate?(r(),y("div",je,[e(_e,{size:"48",class:"me-4"},{default:a(()=>[e(V,{icon:"tabler-user"})]),_:1}),u("div",null,[u("h6",De,t(s.value.affiliate.nom_complet),1),u("p",Ae,t(s.value.affiliate.email),1),s.value.affiliate.telephone?(r(),y("p",Le,t(s.value.affiliate.telephone),1)):d("",!0)])])):d("",!0)]),_:1})]),_:1})]),_:1}),e(F,{cols:"12",md:"6"},{default:a(()=>[e(j,null,{default:a(()=>[e(D,null,{default:a(()=>[e(V,{icon:"tabler-shopping-cart",class:"me-2"}),i(" "+t(l(o)("admin_commissions_order_info")),1)]),_:1}),e(A,null,{default:a(()=>[s.value.commande?(r(),y("div",Re,[e(P,null,{default:a(()=>[e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_orders_id")),1)]),_:1}),e(f,null,{default:a(()=>[e(M,{to:`/admin/orders/${s.value.commande.id}`,color:"primary",variant:"outlined",size:"small"},{default:a(()=>[i(t(s.value.commande.id.slice(-8)),1)]),_:1},8,["to"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_orders_status")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(s.value.commande.statut),1)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_orders_total_ttc")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(s.value.commande.total_ttc)+" "+t(s.value.commande.devise),1)]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[i(t(l(o)("admin_orders_created_at")),1)]),_:1}),e(f,null,{default:a(()=>[i(t(new Date(s.value.commande.created_at).toLocaleString("fr-FR")),1)]),_:1})]),_:1})]),_:1})])):d("",!0)]),_:1})]),_:1})]),_:1}),s.value.notes?(r(),v(F,{key:0,cols:"12",md:"6"},{default:a(()=>[e(j,null,{default:a(()=>[e(D,null,{default:a(()=>[e(V,{icon:"tabler-notes",class:"me-2"}),i(" "+t(l(o)("admin_commissions_notes")),1)]),_:1}),e(A,null,{default:a(()=>[u("pre",Te,t(s.value.notes),1)]),_:1})]),_:1})]),_:1})):d("",!0)]),_:1})])):(r(),y("div",Se,[e(V,{icon:"tabler-alert-circle",size:"64",class:"mb-4",color:"error"}),u("h3",Ie,t(l(o)("admin_commissions_not_found")),1),u("p",qe,t(l(o)("admin_commissions_not_found_description")),1),e(p,{color:"primary",onClick:N},{default:a(()=>[i(t(l(o)("actions.backToCommissions")),1)]),_:1})])),e(H,{modelValue:L.value,"onUpdate:modelValue":n[2]||(n[2]=b=>L.value=b),"max-width":"500"},{default:a(()=>[e(j,null,{default:a(()=>[e(D,null,{default:a(()=>[u("span",Be,t(l(o)("admin_commissions_reject_commission")),1)]),_:1}),e(A,null,{default:a(()=>[u("p",Fe,t(l(o)("admin_commissions_reject_message")),1),e(Q,{modelValue:x.value,"onUpdate:modelValue":n[0]||(n[0]=b=>x.value=b),label:l(o)("admin_commissions_reject_reason"),placeholder:l(o)("admin_commissions_reject_placeholder"),rows:"3",required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(E,null,{default:a(()=>[e(G),e(p,{color:"grey",variant:"text",onClick:n[1]||(n[1]=b=>L.value=!1)},{default:a(()=>[i(t(l(o)("actions.cancel")),1)]),_:1}),e(p,{color:"error",variant:"elevated",disabled:!x.value.trim(),onClick:W},{default:a(()=>[i(t(l(o)("actions.reject")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(H,{modelValue:R.value,"onUpdate:modelValue":n[6]||(n[6]=b=>R.value=b),"max-width":"500"},{default:a(()=>[e(j,null,{default:a(()=>[e(D,null,{default:a(()=>[u("span",Ne,t(l(o)("admin_commissions_adjust_commission")),1)]),_:1}),e(A,null,{default:a(()=>{var b,z;return[u("p",Ue,[i(t(l(o)("admin_commissions_current_amount"))+": ",1),u("strong",null,t((b=s.value)==null?void 0:b.amount)+" "+t((z=s.value)==null?void 0:z.currency),1)]),e(fe,{modelValue:B.value,"onUpdate:modelValue":n[3]||(n[3]=U=>B.value=U),modelModifiers:{number:!0},label:l(o)("admin_commissions_new_amount"),type:"number",step:"0.01",min:"0",suffix:"MAD",required:"",class:"mb-4"},null,8,["modelValue","label"]),e(Q,{modelValue:w.value,"onUpdate:modelValue":n[4]||(n[4]=U=>w.value=U),label:l(o)("admin_commissions_adjust_reason"),placeholder:l(o)("admin_commissions_adjust_placeholder"),rows:"3",required:""},null,8,["modelValue","label","placeholder"])]}),_:1}),e(E,null,{default:a(()=>[e(G),e(p,{color:"grey",variant:"text",onClick:n[5]||(n[5]=b=>R.value=!1)},{default:a(()=>[i(t(l(o)("actions.cancel")),1)]),_:1}),e(p,{color:"warning",variant:"elevated",disabled:!w.value.trim(),onClick:Z},{default:a(()=>[i(t(l(o)("actions.adjust")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{ca as default};
