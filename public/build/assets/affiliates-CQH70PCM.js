import{b4 as xe,r as m,V as S,b5 as L,d as ie,aL as re,g as N,o as j,f as t,b as e,e as o,az as q,t as r,ac as k,s as h,w as ye,D as Ve,c as we,l as I,m as s,p as O,aU as ke}from"./main-uLG9IIeX.js";import{u as Ce}from"./useNotifications-DDBS_wPD.js";import{V as T,c as H}from"./VCard-CB1gT6RB.js";import{V as R}from"./VCardText-BZtszuIK.js";import{V as M}from"./VAvatar-bHPDEsYY.js";import{V as J}from"./VDialog-DU1pBIct.js";import{a as E,V as te}from"./VRow-aGfXYx3U.js";import{V as Ae}from"./VTextField-Dxeq5kx5.js";import{V as G}from"./VSelect-sWnAtot-.js";import{V as Te}from"./VDataTableServer-DfLBg0lg.js";import{V as Q}from"./VTooltip-Ce3bfmSx.js";import{V as le}from"./VBadge-C2esTGRG.js";import{V as se}from"./VChip-B84WcmDa.js";import{V as oe}from"./VTextarea-BuIc6d95.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VImg-BS6_svHJ.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./dialog-transition-2hF0ajsQ.js";/* empty css              */import"./VField-CfH1YcVv.js";import"./VList-uZDByhc2.js";import"./ssrBoot-BPhRU-mF.js";import"./VDivider-UqGR4x4D.js";import"./VMenu-DP1p-55V.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VDataTable-DNqSzzrc.js";import"./VPagination-DYW6O4lq.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";const Se=xe("affiliateApplications",()=>{const x=m([]),a=m({pending_approval:0,email_not_verified:0,approved_applications:0,refused_applications:0,recent_signups:0}),n=m(!1),p=m(new Set),y=m(null),C=m({current_page:1,last_page:1,per_page:15,total:0}),b=m({page:1,perPage:15,sort:"created_at",dir:"desc"}),z=S(()=>x.value.length>0),A=S(()=>n.value),V=u=>p.value.has(u),F=async u=>{var g,f;n.value=!0,y.value=null;try{u&&Object.assign(b.value,u);const d=await L.get("admin/affiliate-applications",{params:b.value});if(d.data.success)x.value=d.data.data,C.value=d.data.pagination;else throw new Error(d.data.message||"Failed to fetch applications")}catch(d){y.value=((f=(g=d.response)==null?void 0:g.data)==null?void 0:f.message)||d.message||"Failed to fetch applications",console.error("Error fetching applications:",d)}finally{n.value=!1}},U=async()=>{try{const u=await L.get("/admin/affiliate-applications/stats");u.data.success&&(a.value=u.data.data)}catch(u){console.error("Error fetching stats:",u)}};return{applications:x,stats:a,loading:n,resendingIds:p,error:y,pagination:C,filters:b,hasApplications:z,isLoading:A,isResending:V,fetchApplications:F,fetchStats:U,approveApplication:async(u,g)=>{var f,d;try{const v=await L.post(`/admin/affiliate-applications/${u}/approve`,{reason:g});if(v.data.success){const P=x.value.findIndex(w=>w.id===u);return P!==-1&&(x.value[P].approval_status="approved"),await U(),v.data}else throw new Error(v.data.message||"Failed to approve application")}catch(v){throw new Error(((d=(f=v.response)==null?void 0:f.data)==null?void 0:d.message)||v.message||"Failed to approve application")}},refuseApplication:async(u,g)=>{var f,d;try{const v=await L.post(`/admin/affiliate-applications/${u}/refuse`,{reason:g});if(v.data.success){const P=x.value.findIndex(w=>w.id===u);return P!==-1&&(x.value[P].approval_status="refused",x.value[P].refusal_reason=g),await U(),v.data}else throw new Error(v.data.message||"Failed to refuse application")}catch(v){throw new Error(((d=(f=v.response)==null?void 0:f.data)==null?void 0:d.message)||v.message||"Failed to refuse application")}},resendVerification:async u=>{var g,f;p.value.add(u);try{const d=await L.post(`admin/affiliate-applications/${u}/resend-verification`);if(d.data.success)return d.data;throw new Error(d.data.message||"Failed to resend verification")}catch(d){throw new Error(((f=(g=d.response)==null?void 0:g.data)==null?void 0:f.message)||d.message||"Failed to resend verification")}finally{p.value.delete(u)}},resetFilters:()=>{b.value={page:1,perPage:15,sort:"created_at",dir:"desc"}}}}),ze={class:"text-h5 mb-4"},Fe={class:"text-body-1 mb-6"},Ue=ie({__name:"ConfirmDialog",props:{modelValue:{type:Boolean},title:{default:"Confirmer l'action"},text:{default:"Êtes-vous sûr de vouloir continuer ?"},confirmText:{default:"Confirmer"},cancelText:{default:"Annuler"},color:{default:"primary"},icon:{default:"tabler-alert-circle"},loading:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","cancel"],setup(x,{emit:a}){const{t:n}=re(),p=x,y=a,C=S(()=>p.title||n("dialogs.confirmAction")),b=S(()=>p.text||n("dialogs.confirmMessage")),z=S(()=>p.confirmText||n("actions.confirm")),A=S(()=>p.cancelText||n("actions.cancel")),V=_=>{y("update:modelValue",_)},F=()=>{y("confirm"),V(!1)},U=()=>{y("cancel"),V(!1)};return(_,B)=>(j(),N(J,{"model-value":p.modelValue,"max-width":"500",persistent:"","onUpdate:modelValue":V},{default:t(()=>[e(T,{class:"text-center pa-6"},{default:t(()=>[e(R,null,{default:t(()=>[e(M,{size:"88",color:p.color,variant:"tonal",class:"mb-6"},{default:t(()=>[e(q,{icon:p.icon,size:"48"},null,8,["icon"])]),_:1},8,["color"]),o("h5",ze,r(C.value),1),o("p",Fe,r(b.value),1)]),_:1}),e(H,{class:"justify-center gap-3"},{default:t(()=>[e(k,{color:p.color,variant:"elevated",loading:p.loading,onClick:F},{default:t(()=>[h(r(z.value),1)]),_:1},8,["color","loading"]),e(k,{color:"secondary",variant:"outlined",disabled:p.loading,onClick:U},{default:t(()=>[h(r(A.value),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),De={class:"d-flex flex-column gap-6"},Ee={class:"d-flex justify-space-between align-center mb-6"},Re={class:"text-h4"},$e={class:"text-body-2"},Pe={class:"text-h4"},qe={class:"text-body-2"},Be={class:"text-h4"},je={class:"text-body-2"},Le={class:"text-h4"},Ne={class:"text-body-2"},Ie={class:"text-h4"},Me={class:"text-body-2"},Oe={class:"d-flex align-center gap-3"},Ge={class:"font-weight-medium"},Qe={class:"text-caption text-medium-emphasis"},He={class:"text-body-2"},Je={class:"text-body-2"},Ke={class:"d-flex gap-1"},We={class:"text-center py-8"},Xe={class:"text-h6 mb-2"},Ye={class:"text-body-2 text-medium-emphasis"},Ze={class:"text-h5 mb-4"},ea={class:"text-body-1 mb-6"},aa={class:"text-medium-emphasis"},ta={class:"text-h5 mb-4"},la={class:"text-body-1 mb-6"},sa={class:"text-medium-emphasis"},$a=ie({__name:"affiliates",setup(x){const{t:a}=re(),n=Se(),{showSuccess:p,showError:y}=Ce(),C=m(""),b=m(""),z=m(""),A=m(15),V=m(!1),F=m(!1),U=m(!1),_=m(null),B=m(""),$=m(""),K=S(()=>n.isLoading),u=S(()=>n.applications),g=S(()=>n.pagination),f=S(()=>n.stats),d=[{title:a("table_column_user"),key:"user",sortable:!1},{title:a("table_column_email"),key:"email",sortable:!0},{title:a("table_column_phone"),key:"telephone",sortable:!1},{title:a("table_column_bank"),key:"bank_type",sortable:!1},{title:a("table_column_email_verified"),key:"email_verified",sortable:!0},{title:a("table_column_approval_status"),key:"approval_status",sortable:!0},{title:a("table_column_created_at"),key:"created_at",sortable:!0},{title:a("table_column_actions"),key:"actions",sortable:!1}],v=[{title:a("filter_all"),value:""},{title:a("affiliate_status_pending_approval"),value:"pending_approval"},{title:a("affiliate_status_approved"),value:"approved"},{title:a("affiliate_status_refused"),value:"refused"}],P=[{title:a("filter_all"),value:""},{title:a("email_verified"),value:"true"},{title:a("email_not_verified"),value:"false"}],w=async()=>{await n.fetchApplications({q:C.value||void 0,approval_status:b.value||void 0,email_verified:z.value||void 0,perPage:A.value})};let W;const ne=()=>{clearTimeout(W),W=setTimeout(()=>{n.filters.page=1,w()},300)};ye([C,b,z,A],()=>{ne()},{deep:!0});const ce=c=>{n.filters.page=c,w()},de=c=>{c.length>0&&(n.filters.sort=c[0].key,n.filters.dir=c[0].order,w())},ue=c=>{_.value=c,B.value="",V.value=!0},pe=c=>{_.value=c,$.value="",F.value=!0},fe=async()=>{if(_.value)try{await n.approveApplication(_.value.id,B.value),p(a("affiliate_approved_success")),V.value=!1,w()}catch(c){y(c.message||a("error_during_approval"))}},_e=async()=>{if(!(!_.value||!$.value.trim()))try{await n.refuseApplication(_.value.id,$.value),p(a("affiliate_refused_success")),F.value=!1,w()}catch(c){y(c.message||a("error_during_refusal"))}},me=c=>{_.value=c,U.value=!0},ve=async()=>{if(_.value)try{await n.resendVerification(_.value.id),p(a("verification_email_sent_success"))}catch(c){y(c.message||a("error_sending_email"))}},X=c=>{switch(c){case"approved":return"success";case"pending_approval":return"warning";case"refused":return"error";default:return"default"}},ge=c=>{switch(c){case"approved":return a("affiliate_status_approved");case"pending_approval":return a("affiliate_status_pending_approval_short");case"refused":return a("affiliate_status_refused");default:return c}},be=c=>{switch(c){case"approved":return"✓";case"pending_approval":return"⏳";case"refused":return"✗";default:return"?"}},he=c=>new Date(c).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),Y=()=>{C.value="",b.value="",z.value="",n.resetFilters(),w()};return Ve(async()=>{await n.fetchStats(),await w()}),(c,i)=>{var Z,ee;return j(),we("div",De,[o("div",Ee,[i[13]||(i[13]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold mb-1"}," File d'Attente d'Approbation "),o("p",{class:"text-body-1 mb-0"}," Gérer les demandes d'inscription des affiliés ")],-1)),e(k,{color:"primary",variant:"elevated",onClick:Y},{default:t(()=>[e(q,{start:"",icon:"tabler-refresh"}),i[12]||(i[12]=h(" Actualiser "))]),_:1,__:[12]})]),f.value?(j(),N(te,{key:0,class:"mb-6"},{default:t(()=>[e(E,{cols:"12",md:"2"},{default:t(()=>[e(T,{variant:"tonal",color:"warning"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[o("div",Re,r(f.value.pending_approval||0),1),o("div",$e,r(s(a)("affiliate_status_pending_approval_short")),1)]),_:1})]),_:1})]),_:1}),e(E,{cols:"12",md:"2"},{default:t(()=>[e(T,{variant:"tonal",color:"info"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[o("div",Pe,r(f.value.email_not_verified||0),1),o("div",qe,r(s(a)("email_not_verified")),1)]),_:1})]),_:1})]),_:1}),e(E,{cols:"12",md:"2"},{default:t(()=>[e(T,{variant:"tonal",color:"success"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[o("div",Be,r(f.value.approved_applications||0),1),o("div",je,r(s(a)("affiliate_status_approved")),1)]),_:1})]),_:1})]),_:1}),e(E,{cols:"12",md:"2"},{default:t(()=>[e(T,{variant:"tonal",color:"error"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[o("div",Le,r(f.value.refused_applications||0),1),o("div",Ne,r(s(a)("affiliate_status_refused")),1)]),_:1})]),_:1})]),_:1}),e(E,{cols:"12",md:"2"},{default:t(()=>[e(T,{variant:"tonal",color:"primary"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>[o("div",Ie,r(f.value.recent_signups||0),1),o("div",Me,r(s(a)("last_7_days")),1)]),_:1})]),_:1})]),_:1})]),_:1})):I("",!0),e(T,{class:"mb-6"},{default:t(()=>[e(R,null,{default:t(()=>[e(te,{class:"align-center"},{default:t(()=>[e(E,{cols:"12",md:"4"},{default:t(()=>[e(Ae,{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=l=>C.value=l),label:s(a)("action_search"),placeholder:s(a)("search_placeholder_name_email_phone"),"prepend-inner-icon":"tabler-search",clearable:"",density:"compact"},null,8,["modelValue","label","placeholder"])]),_:1}),e(E,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:b.value,"onUpdate:modelValue":i[1]||(i[1]=l=>b.value=l),label:s(a)("table_column_approval_status"),items:v,clearable:"",density:"compact"},null,8,["modelValue","label"])]),_:1}),e(E,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:z.value,"onUpdate:modelValue":i[2]||(i[2]=l=>z.value=l),label:s(a)("table_column_email_verified"),items:P,clearable:"",density:"compact"},null,8,["modelValue","label"])]),_:1}),e(E,{cols:"12",md:"2",class:"d-flex gap-2"},{default:t(()=>[e(G,{modelValue:A.value,"onUpdate:modelValue":i[3]||(i[3]=l=>A.value=l),label:s(a)("items_per_page"),items:[10,15,25,50],density:"compact"},null,8,["modelValue","label"]),e(k,{color:"secondary",variant:"outlined",icon:"tabler-filter-off",onClick:Y})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:t(()=>[e(Te,{"items-per-page":A.value,"onUpdate:itemsPerPage":i[4]||(i[4]=l=>A.value=l),headers:d,items:u.value,"items-length":g.value.total,loading:K.value,page:g.value.current_page,"onUpdate:page":ce,"onUpdate:sortBy":de},{"item.user":t(({item:l})=>[o("div",Oe,[e(M,{size:"40",color:"primary",variant:"tonal"},{default:t(()=>[e(q,{icon:"tabler-user"})]),_:1}),o("div",null,[o("div",Ge,r(l.nom_complet),1),o("div",Qe," ID: "+r(l.id.slice(0,8)),1)])])]),"item.bank_type":t(({item:l})=>[o("div",He,[e(q,{icon:"tabler-building-bank",size:"16",class:"me-2"}),h(" "+r(l.bank_type||s(a)("admin_affiliates_bank_not_provided")),1)])]),"item.email_verified":t(({item:l})=>[e(le,{color:l.email_verified_at?"success":"warning",content:l.email_verified_at?"✓":"!",inline:""},{default:t(()=>[e(se,{size:"small",color:l.email_verified_at?"success":"warning",variant:"tonal"},{default:t(()=>[h(r(l.email_verified_at?s(a)("admin_affiliates_email_verified"):s(a)("admin_affiliates_email_not_verified")),1)]),_:2},1032,["color"])]),_:2},1032,["color","content"])]),"item.approval_status":t(({item:l})=>[e(le,{color:X(l.approval_status),content:be(l.approval_status),inline:""},{default:t(()=>[e(se,{size:"small",color:X(l.approval_status),variant:"tonal"},{default:t(()=>[h(r(ge(l.approval_status)),1)]),_:2},1032,["color"])]),_:2},1032,["color","content"])]),"item.created_at":t(({item:l})=>[o("div",Je,r(he(l.created_at)),1)]),"item.actions":t(({item:l})=>[o("div",Ke,[l.email_verified_at?I("",!0):(j(),N(Q,{key:0,text:s(a)("admin_affiliates_resend_verification_tooltip")},{activator:t(({props:D})=>[e(k,O(D,{size:"small",color:"info",variant:"text",icon:"tabler-mail",loading:s(n).isResending(l.id),disabled:s(n).isResending(l.id),onClick:ke(ae=>me(l),["stop"])}),null,16,["loading","disabled","onClick"])]),_:2},1032,["text"])),l.approval_status==="pending_approval"?(j(),N(Q,{key:1,text:s(a)("approve_request")},{activator:t(({props:D})=>[e(k,O(D,{size:"small",color:"success",variant:"text",icon:"tabler-check",onClick:ae=>ue(l)}),null,16,["onClick"])]),_:2},1032,["text"])):I("",!0),l.approval_status==="pending_approval"?(j(),N(Q,{key:2,text:s(a)("refuse_request")},{activator:t(({props:D})=>[e(k,O(D,{size:"small",color:"error",variant:"text",icon:"tabler-x",onClick:ae=>pe(l)}),null,16,["onClick"])]),_:2},1032,["text"])):I("",!0)])]),"no-data":t(()=>[o("div",We,[e(q,{icon:"tabler-users-off",size:"64",class:"mb-4",color:"disabled"}),o("h3",Xe,r(s(a)("no_users_found")),1),o("p",Ye,r(s(a)("no_users_match_criteria")),1)])]),_:1},8,["items-per-page","items","items-length","loading","page"])]),_:1}),e(J,{modelValue:V.value,"onUpdate:modelValue":i[7]||(i[7]=l=>V.value=l),"max-width":"600",persistent:""},{default:t(()=>[e(T,{class:"pa-6"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>{var l;return[e(M,{size:"88",color:"success",variant:"tonal",class:"mb-6"},{default:t(()=>[e(q,{icon:"tabler-check",size:"48"})]),_:1}),o("h5",Ze,r(s(a)("approve_affiliation_request")),1),o("p",ea,[h(r(s(a)("approve_affiliate_confirm",{name:(l=_.value)==null?void 0:l.nom_complet}))+" ",1),i[14]||(i[14]=o("br",null,null,-1)),o("small",aa,r(s(a)("user_account_created_automatically")),1)]),e(oe,{modelValue:B.value,"onUpdate:modelValue":i[5]||(i[5]=D=>B.value=D),label:s(a)("reason_optional"),placeholder:s(a)("approval_reason_placeholder"),rows:"3",variant:"outlined",class:"mb-4"},null,8,["modelValue","label","placeholder"])]}),_:1}),e(H,{class:"justify-center gap-3"},{default:t(()=>[e(k,{color:"success",variant:"elevated",onClick:fe},{default:t(()=>[h(r(s(a)("action_approve")),1)]),_:1}),e(k,{color:"secondary",variant:"outlined",onClick:i[6]||(i[6]=l=>V.value=!1)},{default:t(()=>[h(r(s(a)("action_cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:F.value,"onUpdate:modelValue":i[10]||(i[10]=l=>F.value=l),"max-width":"600",persistent:""},{default:t(()=>[e(T,{class:"pa-6"},{default:t(()=>[e(R,{class:"text-center"},{default:t(()=>{var l;return[e(M,{size:"88",color:"error",variant:"tonal",class:"mb-6"},{default:t(()=>[e(q,{icon:"tabler-x",size:"48"})]),_:1}),o("h5",ta,r(s(a)("refuse_affiliation_request")),1),o("p",la,[h(r(s(a)("refuse_affiliate_confirm",{name:(l=_.value)==null?void 0:l.nom_complet}))+" ",1),i[15]||(i[15]=o("br",null,null,-1)),o("small",sa,r(s(a)("action_requires_justification")),1)]),e(oe,{modelValue:$.value,"onUpdate:modelValue":i[8]||(i[8]=D=>$.value=D),label:s(a)("refusal_reason_required"),placeholder:s(a)("refusal_reason_placeholder"),variant:"outlined",rows:"3",error:!$.value.trim(),class:"mb-4"},null,8,["modelValue","label","placeholder","error"])]}),_:1}),e(H,{class:"justify-center gap-3"},{default:t(()=>[e(k,{color:"error",variant:"elevated",disabled:!$.value.trim(),onClick:_e},{default:t(()=>[h(r(s(a)("action_refuse")),1)]),_:1},8,["disabled"]),e(k,{color:"secondary",variant:"outlined",onClick:i[9]||(i[9]=l=>F.value=!1)},{default:t(()=>[h(r(s(a)("action_cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ue,{modelValue:U.value,"onUpdate:modelValue":i[11]||(i[11]=l=>U.value=l),title:s(a)("resend_verification_email"),text:s(a)("resend_verification_confirm",{email:(Z=_.value)==null?void 0:Z.email}),"confirm-text":s(a)("action_resend"),"cancel-text":s(a)("action_cancel"),color:"info",icon:"tabler-mail",loading:s(n).isResending(((ee=_.value)==null?void 0:ee.id)||""),onConfirm:ve},null,8,["modelValue","title","text","confirm-text","cancel-text","loading"])])}}});export{$a as default};
