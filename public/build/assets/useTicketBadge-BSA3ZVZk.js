import{r as u,o as T,at as b,ba as C}from"./main-0h7RfoM1.js";import{u as A}from"./useAuth-Gxh1X3Vv.js";function y(){const{user:t,hasRole:n}=A(),e=u(0),s=u(!1),l=u(null),v=300*1e3;let o=null;const i=async()=>{var d,g;if(!(!t||!t.value)){s.value=!0,l.value=null;try{let a="";if(n("admin"))a="/api/admin/support/tickets/pending-count";else if(n("affiliate"))a="/api/affiliate/tickets/pending-count";else return;const c=await C(a);c.success?(e.value=c.count||0,console.log("✅ Ticket badge updated:",e.value)):(l.value=c.message||"Failed to fetch ticket count",e.value=0,console.log("❌ Ticket badge error:",l.value))}catch(a){console.error("Error fetching ticket count:",a),l.value=((g=(d=a.response)==null?void 0:d.data)==null?void 0:g.message)||"Failed to fetch ticket count",e.value=0}finally{s.value=!1}}},r=()=>{o&&clearInterval(o),o=setInterval(i,v)},f=()=>{o&&(clearInterval(o),o=null)},p=()=>{i()},m=()=>{e.value+=1},k=()=>{e.value>0&&(e.value-=1)},h=()=>{e.value=0};return T(()=>{console.log("🚀 useTicketBadge mounted:",{hasUser:!!(t!=null&&t.value),isAdmin:n("admin"),isAffiliate:n("affiliate")}),t&&t.value&&(n("admin")||n("affiliate"))?(console.log("✅ Starting ticket badge polling"),i(),r()):console.log("❌ Not starting ticket badge - user not authenticated or no role")}),b(()=>{f()}),{pendingCount:e,loading:s,error:l,fetchPendingCount:i,refresh:p,incrementCount:m,decrementCount:k,resetCount:h,startPolling:r,stopPolling:f}}export{y as u};
