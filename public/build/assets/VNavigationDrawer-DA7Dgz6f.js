import{b5 as ae,r as A,V as S,_ as O,a0 as oe,o as Q,w as H,bb as G,b_ as re,bi as L,bl as ne,b$ as se,aj as le,Z as ie,ae as ue,b3 as ce,bg as ve,ar as z,al as de,c9 as me,aq as fe,cb as he,as as ge,co as ye,W as Y,bj as we,bd as pe,aD as be,a2 as Se,e as k,q as J,aB as Ee,T as Ce,F as _e,b4 as ke,a_ as Te,ah as Pe,bk as Me,ag as Ie,cp as De,a4 as xe,bh as Ve,ai as Be}from"./main-3LuWNv9W.js";import{u as I}from"./useApi-C6mAvy3D.js";import{u as Ae}from"./useNotifications-B3v5F4dH.js";import{u as Oe,b as Ne}from"./VOverlay-DHKe6cTP.js";import{u as Re}from"./forwardRefs-BZg6tG7B.js";import{u as He}from"./ssrBoot-DPE17Lki.js";import{V as Le}from"./VImg-DjZhnPY1.js";const tt=ae("affiliate-cart",()=>{const e=A([]),i=A({items_count:0,total_amount:0,estimated_commission:0}),c=A(!1),y=A(null),{showSuccess:r,showError:l}=Ae(),u=S(()=>i.value.items_count),w=S(()=>e.value.reduce((n,a)=>n+a.qty,0)),E=S(()=>i.value.total_amount),p=S(()=>i.value.estimated_commission),g=S(()=>e.value.length>0),f=(n,a)=>e.value.filter(t=>{const o=t.variante_id||void 0;return t.produit_id===n&&o===a}).reduce((t,o)=>t+o.qty,0),h=(n,a,t,o)=>{const s=f(n,o),v=s+t;return{canAdd:v>=a,currentQty:s,totalAfterAdd:v}},d=async()=>{c.value=!0,y.value=null,console.log("🔄 [Cart Store] Fetching cart...");try{const{data:n,error:a}=await I("affiliate/cart/summary",{method:"GET"});if(console.log("📡 [Cart Store] Fetch cart response:",{data:n.value,error:a.value}),a.value)throw a.value;if(n.value){const t=n.value;e.value=t.items||[],i.value={items_count:t.items_count||0,total_amount:t.total_amount||0,estimated_commission:t.estimated_commission||0},console.log("✅ [Cart Store] Cart updated:",{itemsCount:e.value.length,summaryCount:i.value.items_count,totalAmount:i.value.total_amount,estimatedCommission:i.value.estimated_commission}),console.log("🛒 [Cart Store] Items with command types:",e.value.map(o=>({title:o.product.titre,type_command:o.type_command,qty:o.qty,sell_price:o.sell_price,item_commission:o.item_commission})))}}catch(n){y.value=n.message||"Erreur lors du chargement du panier",console.error("❌ [Cart Store] Fetch cart error:",n),l(y.value||"Erreur lors du chargement du panier")}finally{c.value=!1}};return{items:e,summary:i,loading:c,error:y,count:u,totalQty:w,subtotal:E,estimatedCommission:p,hasItems:g,getProductQuantityInCart:f,canAddQuantity:h,fetchCart:d,addItem:async n=>{console.log("🔄 [Cart Store] Adding item:",n);try{const{data:a,error:t}=await I("affiliate/cart/add",{method:"POST",body:JSON.stringify({...n,type_command:n.type_command||"order_sample"}),headers:{"Content-Type":"application/json"}});if(console.log("📡 [Cart Store] API response:",{data:a.value,error:t.value}),t.value)if(t.value.status===422){const o=t.value.message||"Stock insuffisant ou données invalides";throw l(o),new Error(o)}else if(t.value.status===404){const o=t.value.message||"Produit non trouvé";throw l(o),new Error(o)}else if(t.value.status===400){const o=t.value.message||"Stock insuffisant";throw l(o),new Error(o)}else throw t.value;return r("Ajouté au panier"),console.log("✅ [Cart Store] Item added successfully, refreshing cart..."),await d(),console.log("🔄 [Cart Store] Cart refreshed, new count:",e.value.length),a.value}catch(a){console.error("❌ [Cart Store] Add item error:",a);const t=a.message||"Erreur lors de l'ajout au panier";throw a.message||l(t),a}},updateItem:async(n,a)=>{try{const{data:t,error:o}=await I("affiliate/cart/items",{method:"PATCH",body:JSON.stringify({item_key:n,...a}),headers:{"Content-Type":"application/json"}});if(o.value)if(o.value.status===422){const s=o.value.message||"Données invalides";throw l(s),new Error(s)}else if(o.value.status===404){const s=o.value.message||"Article non trouvé";throw l(s),new Error(s)}else throw o.value;return r("Panier mis à jour"),await d(),t.value}catch(t){const o=t.message||"Erreur lors de la mise à jour";throw t.message||l(o),t}},removeItem:async n=>{try{const{data:a,error:t}=await I("affiliate/cart/items",{method:"DELETE",body:JSON.stringify({item_key:n}),headers:{"Content-Type":"application/json"}});if(t.value)if(t.value.status===422){const o=t.value.message||"Impossible de retirer ce produit";throw l(o),new Error(o)}else if(t.value.status===404){const o=t.value.message||"Produit non trouvé dans le panier";throw l(o),new Error(o)}else throw t.value;return r("Produit retiré du panier"),await d(),a.value}catch(a){const t=a.message||"Erreur lors de la suppression";throw a.message||l(t),a}},clear:async()=>{try{const{data:n,error:a}=await I("affiliate/cart/clear",{method:"DELETE"});if(a.value)throw a.value;return r("Panier vidé"),e.value=[],i.value={items_count:0,total_amount:0,estimated_commission:0},n.value}catch(n){const a=n.message||"Erreur lors du vidage du panier";throw l(a),n}},preview:async()=>{try{const{data:n,error:a}=await I("/affiliate/cart/preview",{method:"POST"});if(a.value)throw a.value;return n.value}catch(n){const a=n.message||"Erreur lors de l'aperçu";throw l(a),n}},checkout:async(n,a=0,t=0)=>{c.value=!0,y.value=null;try{const{data:o,error:s}=await I("affiliate/checkout",{method:"POST",body:JSON.stringify({receiver_name:n.nom_complet,receiver_phone:n.telephone,city_id:n.city_id,address_line:n.adresse,note:n.note||"",delivery_fee:a,adjusted_commission:t}),headers:{"Content-Type":"application/json"}});if(s.value)throw s.value;const v=o.value;return v!=null&&v.success&&(r(v.message||"Commande créée avec succès"),e.value=[],i.value={items_count:0,total_amount:0,estimated_commission:0}),o.value}catch(o){throw y.value=o.message||"Erreur lors de la validation de la commande",l(y.value||"Erreur lors de la validation de la commande"),o}finally{c.value=!1}},fetchCities:async n=>{var a;try{const t=new URLSearchParams;n&&t.append("q",n);const{data:o,error:s}=await I(`affiliate/ozon/cities?${t.toString()}`,{method:"GET"});if(s.value)throw s.value;const m=(((a=o.value)==null?void 0:a.data)||[]).map(M=>({city_id:M.city_id,name:M.name,prices:M.prices||{}}));console.log("🏙️ [Cart Store] Cities loaded:",m.length,"cities"),console.log("🏙️ [Cart Store] Sample city with prices:",m[0]);const P=m.slice(0,3);return console.log("🏙️ [Cart Store] Sample cities for debugging:",P),m}catch(t){return console.error("❌ [Cart Store] Fetch cities error:",t),l("Erreur lors du chargement des villes"),[]}}}}),R=A(!1);function at(){return{cartDrawerOpen:R,openCartDrawer:()=>{R.value=!0},closeCartDrawer:()=>{R.value=!1},toggleCartDrawer:()=>{R.value=!R.value}}}function Ye(e){let{rootEl:i,isSticky:c,layoutItemStyles:y}=e;const r=O(!1),l=O(0),u=S(()=>{const p=typeof r.value=="boolean"?"top":r.value;return[c.value?{top:"auto",bottom:"auto",height:void 0}:void 0,r.value?{[p]:oe(l.value)}:{top:y.value.top}]});Q(()=>{H(c,p=>{p?window.addEventListener("scroll",E,{passive:!0}):window.removeEventListener("scroll",E)},{immediate:!0})}),G(()=>{window.removeEventListener("scroll",E)});let w=0;function E(){const p=w>window.scrollY?"up":"down",g=i.value.getBoundingClientRect(),f=parseFloat(y.value.top??0),h=window.scrollY-Math.max(0,l.value-f),d=g.height+Math.max(l.value,f)-window.scrollY-window.innerHeight,b=parseFloat(getComputedStyle(i.value).getPropertyValue("--v-body-scroll-y"))||0;g.height<window.innerHeight-f?(r.value="top",l.value=f):p==="up"&&r.value==="bottom"||p==="down"&&r.value==="top"?(l.value=window.scrollY+g.top-b,r.value=!0):p==="down"&&d<=0?(l.value=0,r.value="bottom"):p==="up"&&h<=0&&(b?r.value!=="top"&&(l.value=-h+b+f,r.value="top"):(l.value=g.top+h,r.value="top")),w=window.scrollY}return{isStuck:r,stickyStyles:u}}const Fe=100,We=20;function U(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function Z(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let i=0;for(let c=e.length-1;c>0;c--){if(e[c].t===e[c-1].t)continue;const y=U(i),r=(e[c].d-e[c-1].d)/(e[c].t-e[c-1].t);i+=(r-y)*Math.abs(r),c===e.length-1&&(i*=.5)}return U(i)*1e3}function je(){const e={};function i(r){Array.from(r.changedTouches).forEach(l=>{(e[l.identifier]??(e[l.identifier]=new re(We))).push([r.timeStamp,l])})}function c(r){Array.from(r.changedTouches).forEach(l=>{delete e[l.identifier]})}function y(r){var p;const l=(p=e[r])==null?void 0:p.values().reverse();if(!l)throw new Error(`No samples for touch id ${r}`);const u=l[0],w=[],E=[];for(const g of l){if(u[0]-g[0]>Fe)break;w.push({t:g[0],d:g[1].clientX}),E.push({t:g[0],d:g[1].clientY})}return{x:Z(w),y:Z(E),get direction(){const{x:g,y:f}=this,[h,d]=[Math.abs(g),Math.abs(f)];return h>d&&g>=0?"right":h>d&&g<=0?"left":d>h&&f>=0?"down":d>h&&f<=0?"up":qe()}}}return{addMovement:i,endTouch:c,getVelocity:y}}function qe(){throw new Error}function $e(e){let{el:i,isActive:c,isTemporary:y,width:r,touchless:l,position:u}=e;Q(()=>{window.addEventListener("touchstart",D,{passive:!0}),window.addEventListener("touchmove",T,{passive:!1}),window.addEventListener("touchend",N,{passive:!0})}),G(()=>{window.removeEventListener("touchstart",D),window.removeEventListener("touchmove",T),window.removeEventListener("touchend",N)});const w=S(()=>["left","right"].includes(u.value)),{addMovement:E,endTouch:p,getVelocity:g}=je();let f=!1;const h=O(!1),d=O(0),b=O(0);let C;function x(a,t){return(u.value==="left"?a:u.value==="right"?document.documentElement.clientWidth-a:u.value==="top"?a:u.value==="bottom"?document.documentElement.clientHeight-a:B())-(t?r.value:0)}function V(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const o=u.value==="left"?(a-b.value)/r.value:u.value==="right"?(document.documentElement.clientWidth-a-b.value)/r.value:u.value==="top"?(a-b.value)/r.value:u.value==="bottom"?(document.documentElement.clientHeight-a-b.value)/r.value:B();return t?Math.max(0,Math.min(1,o)):o}function D(a){if(l.value)return;const t=a.changedTouches[0].clientX,o=a.changedTouches[0].clientY,s=25,v=u.value==="left"?t<s:u.value==="right"?t>document.documentElement.clientWidth-s:u.value==="top"?o<s:u.value==="bottom"?o>document.documentElement.clientHeight-s:B(),m=c.value&&(u.value==="left"?t<r.value:u.value==="right"?t>document.documentElement.clientWidth-r.value:u.value==="top"?o<r.value:u.value==="bottom"?o>document.documentElement.clientHeight-r.value:B());(v||m||c.value&&y.value)&&(C=[t,o],b.value=x(w.value?t:o,c.value),d.value=V(w.value?t:o),f=b.value>-20&&b.value<80,p(a),E(a))}function T(a){const t=a.changedTouches[0].clientX,o=a.changedTouches[0].clientY;if(f){if(!a.cancelable){f=!1;return}const v=Math.abs(t-C[0]),m=Math.abs(o-C[1]);(w.value?v>m&&v>3:m>v&&m>3)?(h.value=!0,f=!1):(w.value?m:v)>3&&(f=!1)}if(!h.value)return;a.preventDefault(),E(a);const s=V(w.value?t:o,!1);d.value=Math.max(0,Math.min(1,s)),s>1?b.value=x(w.value?t:o,!0):s<0&&(b.value=x(w.value?t:o,!1))}function N(a){if(f=!1,!h.value)return;E(a),h.value=!1;const t=g(a.changedTouches[0].identifier),o=Math.abs(t.x),s=Math.abs(t.y);(w.value?o>s&&o>400:s>o&&s>3)?c.value=t.direction===({left:"right",right:"left",top:"down",bottom:"up"}[u.value]||B()):c.value=d.value>.5}const n=S(()=>h.value?{transform:u.value==="left"?`translateX(calc(-100% + ${d.value*r.value}px))`:u.value==="right"?`translateX(calc(100% - ${d.value*r.value}px))`:u.value==="top"?`translateY(calc(-100% + ${d.value*r.value}px))`:u.value==="bottom"?`translateY(calc(100% - ${d.value*r.value}px))`:B(),transition:"none"}:void 0);return L(h,()=>{var o,s;const a=((o=i.value)==null?void 0:o.style.transform)??null,t=((s=i.value)==null?void 0:s.style.transition)??null;ne(()=>{var v,m,P,M;(m=i.value)==null||m.style.setProperty("transform",((v=n.value)==null?void 0:v.transform)||"none"),(M=i.value)==null||M.style.setProperty("transition",((P=n.value)==null?void 0:P.transition)||null)}),se(()=>{var v,m;(v=i.value)==null||v.style.setProperty("transform",a),(m=i.value)==null||m.style.setProperty("transition",t)})}),{isDragging:h,dragProgress:d,dragStyles:n}}function B(){throw new Error}const Xe=["start","end","left","right","top","bottom"],ze=ie({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>Xe.includes(e)},sticky:Boolean,...Ve(),...xe(),...Ne(),...De({mobile:null}),...Ie(),...Me(),...Pe(),...Te({tag:"nav"}),...ke()},"VNavigationDrawer"),ot=le()({name:"VNavigationDrawer",props:ze(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,i){let{attrs:c,emit:y,slots:r}=i;const{isRtl:l}=ue(),{themeClasses:u}=ce(e),{borderClasses:w}=ve(e),{backgroundColorClasses:E,backgroundColorStyles:p}=z(()=>e.color),{elevationClasses:g}=de(e),{displayClasses:f,mobile:h}=me(e),{roundedClasses:d}=fe(e),b=he(),C=ge(e,"modelValue",null,_=>!!_),{ssrBootStyles:x}=He(),{scopeId:V}=Re(),D=A(),T=O(!1),{runOpenDelay:N,runCloseDelay:n}=Oe(e,_=>{T.value=_}),a=S(()=>e.rail&&e.expandOnHover&&T.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),t=S(()=>ye(e.location,l.value)),o=Y(()=>e.persistent),s=S(()=>!e.permanent&&(h.value||e.temporary)),v=S(()=>e.sticky&&!s.value&&t.value!=="bottom");L(()=>e.expandOnHover&&e.rail!=null,()=>{H(T,_=>y("update:rail",!_))}),L(()=>!e.disableResizeWatcher,()=>{H(s,_=>!e.permanent&&Be(()=>C.value=!_))}),L(()=>!e.disableRouteWatcher&&!!b,()=>{H(b.currentRoute,()=>s.value&&(C.value=!1))}),H(()=>e.permanent,_=>{_&&(C.value=!0)}),e.modelValue==null&&!s.value&&(C.value=e.permanent||!h.value);const{isDragging:m,dragProgress:P}=$e({el:D,isActive:C,isTemporary:s,width:a,touchless:Y(()=>e.touchless),position:t}),M=S(()=>{const _=s.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):a.value;return m.value?_*P.value:_}),{layoutItemStyles:F,layoutItemScrimStyles:K}=we({id:e.name,order:S(()=>parseInt(e.order,10)),position:t,layoutSize:M,elementSize:a,active:pe(C),disableTransitions:Y(()=>m.value),absolute:S(()=>e.absolute||v.value&&typeof W.value!="string")}),{isStuck:W,stickyStyles:ee}=Ye({rootEl:D,isSticky:v,layoutItemStyles:F}),j=z(()=>typeof e.scrim=="string"?e.scrim:null),te=S(()=>({...m.value?{opacity:P.value*.2,transition:"none"}:void 0,...K.value}));return be({VList:{bgColor:"transparent"}}),Se(()=>{const _=r.image||e.image;return k(_e,null,[k(e.tag,J({ref:D,onMouseenter:N,onMouseleave:n,class:["v-navigation-drawer",`v-navigation-drawer--${t.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":T.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":s.value,"v-navigation-drawer--persistent":o.value,"v-navigation-drawer--active":C.value,"v-navigation-drawer--sticky":v.value},u.value,E.value,w.value,f.value,g.value,d.value,e.class],style:[p.value,F.value,x.value,ee.value,e.style]},V,c),{default:()=>{var q,$,X;return[_&&k("div",{key:"image",class:"v-navigation-drawer__img"},[r.image?k(Ee,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:e.image}}},r.image):k(Le,{key:"image-img",alt:"",cover:!0,height:"inherit",src:e.image},null)]),r.prepend&&k("div",{class:"v-navigation-drawer__prepend"},[(q=r.prepend)==null?void 0:q.call(r)]),k("div",{class:"v-navigation-drawer__content"},[($=r.default)==null?void 0:$.call(r)]),r.append&&k("div",{class:"v-navigation-drawer__append"},[(X=r.append)==null?void 0:X.call(r)])]}}),k(Ce,{name:"fade-transition"},{default:()=>[s.value&&(m.value||C.value)&&!!e.scrim&&k("div",J({class:["v-navigation-drawer__scrim",j.backgroundColorClasses.value],style:[te.value,j.backgroundColorStyles.value],onClick:()=>{o.value||(C.value=!1)}},V),null)]})])}),{isStuck:W}}});export{ot as V,at as a,tt as u};
