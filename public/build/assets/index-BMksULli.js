import{b5 as Ze,r as D,ca as ke,ba as me,d as ye,aL as he,V as P,w as le,bb as De,h as B,b as h,g as t,e,t as g,az as $,n as o,v as l,m as Y,f as s,c as W,b0 as Fe,b1 as et,ac as K,ai as fe,b8 as qe,c_ as Ee,z as tt,b7 as ot,o as at,F as lt,j as rt,q as ve}from"./main-0h7RfoM1.js";import{u as it}from"./boutiques-DXeqghG2.js";import{u as nt}from"./categories-BV5DZAWQ.js";import{u as Ve}from"./useNotifications-QM5aCJtM.js";import{useQuickConfirm as $e}from"./useConfirmAction-CnNtpBUM.js";import{u as ze}from"./useSafeNavigation-CzH0JCTD.js";import{_ as st}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-pmQ-bLAs.js";import{u as ct}from"./useFormErrors-Bm1n1o_v.js";import{V as Pe}from"./VDialog-rW2Q1SF0.js";import{b as _e,c as Ie,V as X}from"./VCard-BJO62jXa.js";import{V as Z}from"./VCardText-DBDe3l6V.js";import{V as Se,a as dt}from"./VAlert-S22fKLZ6.js";import{V as T}from"./VChip-Cb1gcZbV.js";import{V as ut}from"./VForm-BfVpbreJ.js";import{V as oe}from"./VTextField-CB8SxAnl.js";import{V as se,a as C}from"./VRow-CwTmyELD.js";import{V as ce}from"./VSelect-E3I5xPtI.js";import{a as mt}from"./VList-D8OGLl9W.js";import{V as vt}from"./VTextarea-DdmtxOZ7.js";import{V as Ue}from"./VSpacer-CFtTO3F2.js";import{V as pt,a as ft,b as _t,c as gt}from"./VExpansionPanels-CQTpumM2.js";import{V as Re}from"./VDataTable-CrgqCoMT.js";import{V as Be}from"./VSkeletonLoader-kYFbwP3l.js";import{V as Ae}from"./VPagination-CjKu94po.js";import{C as yt}from"./ConfirmActionDialog-BE_Klsie.js";import{V as Te}from"./VAvatar-BcyggOHV.js";import{V as ht}from"./VImg-D8VstP0L.js";import{V as bt}from"./VSwitch-Br01TNvq.js";import{V as kt}from"./VDataTableServer-S93ZGevF.js";import{V as pe}from"./VTooltip-DRyk7D5U.js";import{_ as Vt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useApi-Bh3KIVij.js";import"./VBreadcrumbs-C5bXM6fl.js";import"./VOverlay-cV5WKNuZ.js";import"./forwardRefs-DtnMMuBS.js";import"./lazy-DAn2yZiW.js";import"./dialog-transition--QLlkKWU.js";import"./createSimpleFunctional-CRjW3p8V.js";import"./VField-ThiSfLeE.js";/* empty css              */import"./VMenu-BRSAgo5d.js";import"./VCheckboxBtn-DNqYvCTV.js";import"./ssrBoot-_8LWlSSM.js";import"./VDivider-CF-VI2ua.js";import"./VTable-BHYHnEIv.js";import"./filter-BbUs5nlv.js";const we=Ze("admin-stock",()=>{const F=D([]),c=D(null),n=D([]),U=D(!1),d=D(!1),I=D(!1),A=ke({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),j=ke({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),k=ke({q:"",categorie_id:"",boutique_id:"",actif:!0,with_variants:!0,min_qty:void 0,max_qty:void 0,page:1,per_page:15,sort:"updated_at",dir:"desc"});let x=null;const f=async a=>x?(console.log("ðŸ”„ [Stock Store] Fetch already in progress, waiting..."),x):(U.value=!0,x=(async()=>{try{const i={page:(a==null?void 0:a.page)||k.page||1,per_page:(a==null?void 0:a.per_page)||k.per_page||15};if((a==null?void 0:a.actif)!==void 0||k.actif!==void 0){const z=(a==null?void 0:a.actif)??k.actif;i.actif=z===!0?1:z===!1?0:z}if((a==null?void 0:a.with_variants)!==void 0||k.with_variants!==void 0){const z=(a==null?void 0:a.with_variants)??k.with_variants;i.with_variants=z===!0?1:z===!1?0:z}(a!=null&&a.q||k.q)&&(i.q=(a==null?void 0:a.q)||k.q),(a!=null&&a.categorie_id||k.categorie_id)&&(i.categorie_id=(a==null?void 0:a.categorie_id)||k.categorie_id),(a!=null&&a.boutique_id||k.boutique_id)&&(i.boutique_id=(a==null?void 0:a.boutique_id)||k.boutique_id),console.log("ðŸ”§ [Stock Store] Making API call with params:",i),console.log("ðŸ”§ [Stock Store] Auth token:",localStorage.getItem("auth_token")?"Present":"Missing");const b=await me("/admin/stock",{method:"GET",query:i});return console.log("ðŸ“¦ [Stock Store] API Response:",b),console.log("ðŸ“¦ [Stock Store] Response success:",b.success),b.success&&(F.value=b.data,Object.assign(A,b.pagination)),b}catch(i){throw console.error("ðŸš¨ [Stock Store] Failed to fetch stock list:",i),i}finally{U.value=!1,x=null}})(),x),q=async()=>{I.value=!0;try{console.log("ðŸ“Š [Stock Store] Fetching summary...");const a=await me("/admin/stock/summary",{method:"GET"});return console.log("ðŸ“Š [Stock Store] Summary response:",a),a.success&&(c.value=a.data),a}catch(a){throw console.error("ðŸš¨ [Stock Store] Failed to fetch stock summary:",a),a}finally{I.value=!1}};return{items:F,summary:c,history:n,loading:U,historyLoading:d,summaryLoading:I,pagination:A,historyPagination:j,filters:k,fetchList:f,fetchSummary:q,createMovement:async a=>{try{const i=await me("/admin/stock/movements",{method:"POST",body:a});return i.success&&(await f(),c.value&&await q()),i}catch(i){throw console.error("Failed to create stock movement:",i),i}},fetchHistory:async(a,i)=>{d.value=!0,console.log("ðŸ” [Stock Store] fetchHistory called with:",{varianteId:a,customFilters:i});try{const b={...i};Object.keys(b).forEach(O=>{(b[O]===void 0||b[O]==="")&&delete b[O]});const z=`/admin/stock/${a}/history`;console.log("ðŸ“¡ [Stock Store] Making API request:",{url:z,params:b});const w=await me(z,{method:"GET",query:b});return console.log("ðŸ“¥ [Stock Store] API response:",w),w.success&&(n.value=w.data,Object.assign(j,w.pagination),console.log("âœ… [Stock Store] History updated:",{historyLength:n.value.length,pagination:j})),w}catch(b){throw console.error("âŒ [Stock Store] Failed to fetch stock history:",b),b}finally{d.value=!1,console.log("ðŸ [Stock Store] fetchHistory completed, loading set to false")}},updateFilters:a=>{Object.assign(k,a)},resetFilters:()=>{Object.assign(k,{q:"",categorie_id:"",boutique_id:"",actif:!0,with_variants:!0,min_qty:void 0,max_qty:void 0,page:1,per_page:15,sort:"updated_at",dir:"desc"})},getStockStatusColor:(a,i)=>a<=0?"error":a<=i*.1?"warning":"success",getStockStatusText:(a,i)=>a<=0?"Rupture":a<=i*.1?"Stock faible":"En stock",getMovementTypeColor:a=>{switch(a){case"in":return"success";case"out":return"error";case"adjust":return"warning";default:return"primary"}},getMovementTypeIcon:a=>{switch(a){case"in":return"tabler-arrow-up";case"out":return"tabler-arrow-down";case"adjust":return"tabler-adjustments";default:return"tabler-package"}},formatMovementQuantity:(a,i)=>{switch(a){case"in":return`+${i}`;case"out":return`-${Math.abs(i)}`;case"adjust":return i>0?`+${i}`:`${i}`;default:return`${i}`}}}}),ge=[{value:"in",label:"EntrÃ©e stock",color:"success",icon:"tabler-arrow-up"},{value:"out",label:"Sortie stock",color:"error",icon:"tabler-arrow-down"},{value:"adjust",label:"Ajustement",color:"warning",icon:"tabler-adjustments"}],je=[{value:"purchase",label:"Achat"},{value:"correction",label:"Correction"},{value:"return",label:"Retour"},{value:"damage",label:"Dommage"},{value:"manual",label:"Manuel"},{value:"delivery_return",label:"Retour livraison"},{value:"cancel",label:"Annulation"}],St={class:"d-flex align-center"},wt={class:"flex-grow-1"},xt={class:"font-weight-medium"},Mt={key:0,class:"text-caption"},Tt={class:"text-end"},Ct={class:"text-caption"},Dt={class:"d-flex gap-2"},qt={class:"d-flex align-center"},Et=ye({__name:"StockMovementDialog",props:{modelValue:{type:Boolean},item:{},movementType:{}},emits:["update:modelValue","saved"],setup(F,{emit:c}){const n=F,U=c,{t:d}=he(),{showError:I}=Ve(),{confirmCreate:A}=$e(),{errors:j,clear:k,set:x}=ct(),f=we(),q=D(),L=D(!1),Q=D(!0),p=D({produit_id:"",variante_id:null,entrepot_id:null,type:"in",quantity:1,reason:"manual",note:null,reference:null}),H=P({get:()=>n.modelValue,set:u=>U("update:modelValue",u)}),S=P(()=>{var v;const u=((v=ge.find(m=>m.value===n.movementType))==null?void 0:v.label)||"";return d("stock.dialog.movement.title")+" - "+u}),M=P(()=>ge),ee=P(()=>je),R=P(()=>n.item?{on_hand:n.item.metrics.on_hand,reserved:n.item.metrics.reserved,available:n.item.metrics.available}:null),y=P(()=>n.movementType==="out"),a=P(()=>{if(!(!y.value||!R.value))return R.value.available}),i={produit_id:[u=>(console.log("ðŸ” [StockMovementDialog] Validating produit_id:",u,"-> valid:",!!u),!!u||d("validation.required"))],quantity:[u=>!!u||d("validation.required"),u=>u>0||d("validation.min_value",{min:1}),u=>y.value&&a.value!==void 0?u<=a.value||d("stock.validation.insufficient_stock",{available:a.value}):!0],reason:[u=>!!u||d("validation.required")]},b=()=>{var v,m,E,J,ae,te;const u=((m=(v=n.item)==null?void 0:v.product)==null?void 0:m.id)||"";if(console.log("ðŸ”§ [StockMovementDialog] Resetting form with:",{productId:u,movementType:n.movementType,hasItem:!!n.item,variantId:(J=(E=n.item)==null?void 0:E.variant)==null?void 0:J.id,itemStructure:n.item?{product:n.item.product?{id:n.item.product.id,titre:n.item.product.titre}:null,variant:n.item.variant?{id:n.item.variant.id}:null}:null}),!u&&n.modelValue){console.warn("âš ï¸ [StockMovementDialog] No product ID available when dialog is open, skipping reset");return}p.value={produit_id:u,variante_id:((te=(ae=n.item)==null?void 0:ae.variant)==null?void 0:te.id)||null,entrepot_id:null,type:n.movementType,quantity:1,reason:"manual",note:null,reference:null},k(),console.log("âœ… [StockMovementDialog] Form data set to:",p.value)},z=async()=>{if(!q.value)return console.log("âŒ [StockMovementDialog] No form ref available for validation"),!1;console.log("ðŸ” [StockMovementDialog] Validating form with data:",p.value);const{valid:u}=await q.value.validate();return console.log("ðŸ” [StockMovementDialog] Form validation result:",u),u},w=async()=>{var m,E,J,ae,te,de,ue;if(console.log("ðŸ’¾ [StockMovementDialog] Save triggered"),console.log("ðŸ” [StockMovementDialog] Current props state:",{item:n.item,movementType:n.movementType,modelValue:n.modelValue,productId:(E=(m=n.item)==null?void 0:m.product)==null?void 0:E.id,productTitle:(ae=(J=n.item)==null?void 0:J.product)==null?void 0:ae.titre}),console.log("ðŸ” [StockMovementDialog] Current form data:",p.value),!Q.value){console.log("âŒ [StockMovementDialog] Component not mounted, aborting");return}!p.value.produit_id&&((de=(te=n.item)==null?void 0:te.product)!=null&&de.id)&&(console.log("ðŸ”§ [StockMovementDialog] Fixing missing produit_id before validation"),p.value.produit_id=n.item.product.id);const u=await z();if(console.log("ðŸ” [StockMovementDialog] Form validation result:",u),!u){console.log("âŒ [StockMovementDialog] Form validation failed, cannot proceed");return}if(!p.value.produit_id){console.log("âŒ [StockMovementDialog] Missing produit_id after validation, cannot proceed"),I(d("stock.errors.missing_product")||"Product is required");return}console.log("ðŸ¤” [StockMovementDialog] Showing confirmation dialog...");const v=await A(d("stock.movement")||"movement");if(console.log("âœ… [StockMovementDialog] Confirmation result:",v),!!v){L.value=!0;try{const G={produit_id:String(p.value.produit_id),variante_id:p.value.variante_id?String(p.value.variante_id):null,entrepot_id:p.value.entrepot_id?String(p.value.entrepot_id):null,type:p.value.type,quantity:Number(p.value.quantity),reason:p.value.reason,note:p.value.note||null,reference:p.value.reference||null};console.log("ðŸš€ [StockMovementDialog] Submitting movement payload:",G);const re=await f.createMovement(G);console.log("âœ… [StockMovementDialog] Movement created successfully:",re),Q.value&&(U("saved"),O())}catch(G){if(console.error("ðŸš¨ [StockMovementDialog] Save failed:",G),Q.value)if(G.status===422&&((ue=G.data)!=null&&ue.errors))console.log("ðŸ”´ [StockMovementDialog] Setting validation errors:",G.data.errors),x(G.data.errors);else{const re=G.message||d("stock.errors.movement_failed");console.log("ðŸ”´ [StockMovementDialog] Showing error notification:",re),I(re)}}finally{L.value=!1}}},O=()=>{H.value=!1,b()};return le(()=>n.modelValue,u=>{var v,m,E,J;u&&(console.log("ðŸ” [StockMovementDialog] Dialog opening with props:",{item:n.item,movementType:n.movementType,productId:(m=(v=n.item)==null?void 0:v.product)==null?void 0:m.id,productTitle:(J=(E=n.item)==null?void 0:E.product)==null?void 0:J.titre}),fe(()=>{b()}))},{immediate:!0}),le(()=>n.item,u=>{var v,m;u&&n.modelValue&&(console.log("ðŸ”„ [StockMovementDialog] Item changed, resetting form with new item:",{productId:(v=u.product)==null?void 0:v.id,productTitle:(m=u.product)==null?void 0:m.titre}),fe(()=>{b()}))},{deep:!0,immediate:!0}),le(()=>[n.modelValue,n.item,n.movementType],([u,v,m])=>{var E;u&&((E=v==null?void 0:v.product)!=null&&E.id)&&(console.log("ðŸ”„ [StockMovementDialog] All props ready, ensuring form is set:",{productId:v.product.id,movementType:m,hasValidData:!!v.product.id}),fe(()=>{p.value.produit_id||(console.log("ðŸ”§ [StockMovementDialog] Fixing missing produit_id in combined watcher"),b())}))},{deep:!0,immediate:!0}),le(()=>n.movementType,u=>{var v,m;console.log("ðŸ”„ [StockMovementDialog] Movement type changed to:",u),console.log("ðŸ” [StockMovementDialog] Props when movement type changed:",{item:n.item,modelValue:n.modelValue,productId:(m=(v=n.item)==null?void 0:v.product)==null?void 0:m.id}),p.value.type!==u&&(p.value.type=u)},{immediate:!0}),De(()=>{Q.value=!1,q.value&&(q.value=null),p.value={produit_id:"",variante_id:null,entrepot_id:null,type:"in",quantity:1,reason:"manual",note:null,reference:null},k()}),(u,v)=>(h(),B(Pe,{modelValue:H.value,"onUpdate:modelValue":v[6]||(v[6]=m=>H.value=m),"max-width":"600",persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(_e,{class:"d-flex align-center"},{default:t(()=>[e($,{icon:o(f).getMovementTypeIcon(u.movementType),color:o(f).getMovementTypeColor(u.movementType),class:"me-2"},null,8,["icon","color"]),g(" "+l(S.value),1)]),_:1}),e(Z,null,{default:t(()=>[u.item?(h(),B(Se,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[s("div",St,[s("div",wt,[s("div",xt,l(u.item.product.titre),1),u.item.variant?(h(),W("div",Mt,l(u.item.variant.libelle),1)):Y("",!0)]),s("div",Tt,[s("div",Ct,l(o(d)("stock.current_stock")),1),s("div",Dt,[e(T,{size:"x-small",color:"success"},{default:t(()=>{var m;return[g(l(o(d)("stock.on_hand"))+": "+l((m=R.value)==null?void 0:m.on_hand),1)]}),_:1}),e(T,{size:"x-small",color:"warning"},{default:t(()=>{var m;return[g(l(o(d)("stock.reserved"))+": "+l((m=R.value)==null?void 0:m.reserved),1)]}),_:1}),e(T,{size:"x-small",color:"info"},{default:t(()=>{var m;return[g(l(o(d)("stock.available"))+": "+l((m=R.value)==null?void 0:m.available),1)]}),_:1})])])])]),_:1})):Y("",!0),e(ut,{ref_key:"formRef",ref:q,id:"stock-movement-form"},{default:t(()=>[e(oe,{modelValue:p.value.produit_id,"onUpdate:modelValue":v[0]||(v[0]=m=>p.value.produit_id=m),rules:i.produit_id,style:{display:"none"}},null,8,["modelValue","rules"]),e(se,null,{default:t(()=>[e(C,{cols:"12"},{default:t(()=>[e(ce,{modelValue:p.value.type,"onUpdate:modelValue":v[1]||(v[1]=m=>p.value.type=m),items:M.value,label:o(d)("stock.fields.type"),"item-title":"label","item-value":"value",variant:"outlined",readonly:""},{item:t(({props:m,item:E})=>[e(mt,Fe(et(m)),{prepend:t(()=>[e($,{icon:E.raw.icon,color:E.raw.color},null,8,["icon","color"])]),_:2},1040)]),selection:t(({item:m})=>[s("div",qt,[e($,{icon:m.raw.icon,color:m.raw.color,class:"me-2"},null,8,["icon","color"]),g(" "+l(m.raw.label),1)])]),_:1},8,["modelValue","items","label"])]),_:1}),e(C,{cols:"12",md:"6"},{default:t(()=>[e(oe,{modelValue:p.value.quantity,"onUpdate:modelValue":v[2]||(v[2]=m=>p.value.quantity=m),modelModifiers:{number:!0},label:o(d)("stock.fields.quantity"),rules:i.quantity,"error-messages":o(j).quantity,max:a.value,type:"number",min:"1",variant:"outlined",required:""},null,8,["modelValue","label","rules","error-messages","max"])]),_:1}),e(C,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:p.value.reason,"onUpdate:modelValue":v[3]||(v[3]=m=>p.value.reason=m),items:ee.value,label:o(d)("stock.fields.reason"),rules:i.reason,"error-messages":o(j).reason,"item-title":"label","item-value":"value",variant:"outlined",required:""},null,8,["modelValue","items","label","rules","error-messages"])]),_:1}),e(C,{cols:"12",md:"6"},{default:t(()=>[e(oe,{modelValue:p.value.reference,"onUpdate:modelValue":v[4]||(v[4]=m=>p.value.reference=m),label:o(d)("stock.fields.reference"),"error-messages":o(j).reference,variant:"outlined",placeholder:"PO-2025-001, RET-123..."},null,8,["modelValue","label","error-messages"])]),_:1}),e(C,{cols:"12"},{default:t(()=>[e(vt,{modelValue:p.value.note,"onUpdate:modelValue":v[5]||(v[5]=m=>p.value.note=m),label:o(d)("stock.fields.note"),"error-messages":o(j).note,variant:"outlined",rows:"3",placeholder:o(d)("stock.fields.note_placeholder")},null,8,["modelValue","label","error-messages","placeholder"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ie,null,{default:t(()=>[e(Ue),e(K,{variant:"outlined",onClick:O},{default:t(()=>[g(l(o(d)("common.cancel")),1)]),_:1}),e(K,{color:"primary",loading:L.value,onClick:w},{default:t(()=>[g(l(o(d)("stock.actions.create_movement")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),$t={class:"d-flex align-center"},zt={class:"flex-grow-1"},Pt={class:"font-weight-medium"},It={key:0,class:"text-caption"},Ut={class:"text-end"},Rt={class:"text-caption"},Bt={class:"d-flex gap-2"},At={class:"font-weight-medium"},jt={class:"text-caption text-medium-emphasis"},Lt={key:1,class:"text-medium-emphasis"},Ht={class:"text-center py-8"},Ot={class:"text-h6 mb-2"},Nt={class:"text-body-2"},Wt={key:1,class:"d-flex justify-center mt-4"},Qt=ye({__name:"StockHistoryDialog",props:{modelValue:{type:Boolean},item:{}},emits:["update:modelValue"],setup(F,{emit:c}){const n=F,U=c,{t:d,d:I}=he(),A=we(),{history:j,historyLoading:k,historyPagination:x}=qe(A),f=D({variante_id:"",entrepot_id:"",type:void 0,reason:void 0,date_from:"",date_to:"",per_page:15}),q=()=>{f.value={variante_id:"",entrepot_id:"",type:void 0,reason:void 0,date_from:"",date_to:"",per_page:15}},L=P({get:()=>n.modelValue,set:y=>U("update:modelValue",y)}),Q=P(()=>n.item?d("stock.history.title_for",{product:n.item.product.titre}):d("stock.history.title")),p=P(()=>[{title:d("stock.history.columns.date"),key:"created_at",sortable:!1},{title:d("stock.history.columns.type"),key:"type",sortable:!1},{title:d("stock.history.columns.quantity"),key:"quantity",sortable:!1,align:"center"},{title:d("stock.history.columns.reference"),key:"reference",sortable:!1},{title:d("stock.history.columns.variant"),key:"variant",sortable:!1}]),H=P(()=>[{value:"",label:d("common.all")},...ge.map(y=>({value:y.value,label:y.label}))]),S=P(()=>[{value:"",label:d("common.all")},...je.map(y=>({value:y.value,label:y.label}))]),M=async()=>{var i;if(!n.item){console.log("âŒ [StockHistoryDialog] No item provided");return}if(!((i=n.item.variant)!=null&&i.id)){console.error("âŒ [StockHistoryDialog] No variant ID found for stock item:",n.item);return}const y=n.item.variant.id;console.log("ðŸ” [StockHistoryDialog] Fetching history for:",{productId:n.item.product.id,productTitle:n.item.product.titre,variantId:y,variantLabel:n.item.variant.libelle,filters:f.value});const a={per_page:f.value.per_page||15};f.value.entrepot_id&&(a.entrepot_id=f.value.entrepot_id),f.value.type&&(a.type=f.value.type),f.value.reason&&(a.reason=f.value.reason),f.value.date_from&&(a.date_from=f.value.date_from),f.value.date_to&&(a.date_to=f.value.date_to),console.log("ðŸ“¡ [StockHistoryDialog] Making API call with variant ID:",y,"and filters:",a);try{await A.fetchHistory(y,a),console.log("âœ… [StockHistoryDialog] History fetched successfully")}catch(b){console.error("âŒ [StockHistoryDialog] Failed to fetch history:",b)}},ee=()=>{f.value={variante_id:"",entrepot_id:"",type:void 0,reason:void 0,date_from:"",date_to:"",per_page:15},M()},R=()=>{L.value=!1};return le(()=>n.modelValue,y=>{y&&n.item&&(q(),M())}),le(()=>f.value,()=>{n.modelValue&&n.item&&M()},{deep:!0}),(y,a)=>(h(),B(Pe,{modelValue:L.value,"onUpdate:modelValue":a[5]||(a[5]=i=>L.value=i),"max-width":"1000",scrollable:""},{default:t(()=>[e(X,null,{default:t(()=>[e(_e,{class:"d-flex align-center"},{default:t(()=>[e($,{icon:"tabler-history",class:"me-2"}),g(" "+l(Q.value),1)]),_:1}),e(Z,null,{default:t(()=>[y.item?(h(),B(Se,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[s("div",$t,[s("div",zt,[s("div",Pt,l(y.item.product.titre),1),y.item.variant?(h(),W("div",It,l(y.item.variant.libelle),1)):Y("",!0)]),s("div",Ut,[s("div",Rt,l(o(d)("stock.current_stock")),1),s("div",Bt,[e(T,{size:"x-small",color:"success"},{default:t(()=>[g(l(o(d)("stock.on_hand"))+": "+l(y.item.metrics.on_hand),1)]),_:1}),e(T,{size:"x-small",color:"warning"},{default:t(()=>[g(l(o(d)("stock.reserved"))+": "+l(y.item.metrics.reserved),1)]),_:1}),e(T,{size:"x-small",color:"info"},{default:t(()=>[g(l(o(d)("stock.available"))+": "+l(y.item.metrics.available),1)]),_:1})])])])]),_:1})):Y("",!0),e(pt,{class:"mb-4"},{default:t(()=>[e(ft,null,{default:t(()=>[e(_t,null,{default:t(()=>[e($,{icon:"tabler-filter",class:"me-2"}),g(" "+l(o(d)("common.filters")),1)]),_:1}),e(gt,null,{default:t(()=>[e(se,null,{default:t(()=>[e(C,{cols:"12",md:"3"},{default:t(()=>[e(ce,{modelValue:f.value.type,"onUpdate:modelValue":a[0]||(a[0]=i=>f.value.type=i),items:H.value,label:o(d)("stock.filters.type"),"item-title":"label","item-value":"value",variant:"outlined",density:"compact"},null,8,["modelValue","items","label"])]),_:1}),e(C,{cols:"12",md:"3"},{default:t(()=>[e(ce,{modelValue:f.value.reason,"onUpdate:modelValue":a[1]||(a[1]=i=>f.value.reason=i),items:S.value,label:o(d)("stock.filters.reason"),"item-title":"label","item-value":"value",variant:"outlined",density:"compact"},null,8,["modelValue","items","label"])]),_:1}),e(C,{cols:"12",md:"3"},{default:t(()=>[e(oe,{modelValue:f.value.date_from,"onUpdate:modelValue":a[2]||(a[2]=i=>f.value.date_from=i),label:o(d)("stock.filters.date_from"),type:"date",variant:"outlined",density:"compact"},null,8,["modelValue","label"])]),_:1}),e(C,{cols:"12",md:"3"},{default:t(()=>[e(oe,{modelValue:f.value.date_to,"onUpdate:modelValue":a[3]||(a[3]=i=>f.value.date_to=i),label:o(d)("stock.filters.date_to"),type:"date",variant:"outlined",density:"compact"},null,8,["modelValue","label"])]),_:1}),e(C,{cols:"12"},{default:t(()=>[e(K,{color:"secondary",variant:"outlined",size:"small",onClick:ee},{default:t(()=>[g(l(o(d)("common.clear_filters")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Re,{headers:p.value,items:o(j),loading:o(k),"no-data-text":o(d)("stock.history.no_movements"),"hide-default-footer":""},{"item.created_at":t(({item:i})=>[s("div",null,[s("div",At,l(o(I)(new Date(i.created_at),"short")),1),s("div",jt,l(o(I)(new Date(i.created_at),"time")),1)])]),"item.type":t(({item:i})=>[e(T,{size:"small",color:o(A).getMovementTypeColor(i.type),"prepend-icon":o(A).getMovementTypeIcon(i.type)},{default:t(()=>{var b;return[g(l(((b=o(ge).find(z=>z.value===i.type))==null?void 0:b.label)||i.type),1)]}),_:2},1032,["color","prepend-icon"])]),"item.quantity":t(({item:i})=>[e(T,{size:"small",color:o(A).getMovementTypeColor(i.type),variant:"tonal"},{default:t(()=>[g(l(o(A).formatMovementQuantity(i.type,i.quantity)),1)]),_:2},1032,["color"])]),"item.reference":t(({item:i})=>[i.reference?(h(),B(T,{key:0,size:"small",variant:"outlined"},{default:t(()=>[g(l(i.reference),1)]),_:2},1024)):(h(),W("span",Lt,"â€”"))]),"item.variant":t(({item:i})=>[e(T,{size:"small",color:"primary",variant:"tonal"},{default:t(()=>[g(l(i.variant.libelle),1)]),_:2},1024)]),loading:t(()=>[e(Be,{type:"table-row@5"})]),"no-data":t(()=>[s("div",Ht,[e($,{icon:"tabler-history-off",size:"64",class:"mb-4",color:"disabled"}),s("h6",Ot,l(o(d)("stock.history.no_movements")),1),s("p",Nt,l(o(d)("stock.history.no_movements_desc")),1)])]),_:1},8,["headers","items","loading","no-data-text"]),o(x).total>0?(h(),W("div",Wt,[e(Ae,{"model-value":o(x).current_page,length:o(x).last_page,"total-visible":5,"onUpdate:modelValue":a[4]||(a[4]=i=>{f.value.per_page=i,M()})},null,8,["model-value","length"])])):Y("",!0)]),_:1}),e(Ie,null,{default:t(()=>[e(Ue),e(K,{variant:"outlined",onClick:R},{default:t(()=>[g(l(o(d)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Gt={key:1},Kt=ye({__name:"ErrorBoundary",props:{fallbackRoute:{default:"/admin/dashboard"},maxRetries:{default:3},showErrorAlert:{type:Boolean,default:!0}},emits:["error","retry"],setup(F,{expose:c,emit:n}){const U=F,d=n,{t:I}=he(),{safePush:A,emergencyReset:j}=ze(),{showError:k}=Ve(),x=D(!1),f=D(""),q=D(0);Ee((S,M,ee)=>{console.error("ðŸš¨ [Error Boundary] Component error captured:",S,ee),d("error",S);const R=S.message||S.toString();return R.includes("emitsOptions")||R.includes("Cannot read properties of null")?(console.error("ðŸš¨ [Error Boundary] Component lifecycle error detected"),fe(()=>{if(q.value<U.maxRetries){console.log("ðŸ”„ [Error Boundary] Attempting automatic recovery..."),q.value++,x.value=!1;return}L(S)}),!1):R.includes("startsWith")||R.includes("Cannot read properties of undefined")?(console.error("ðŸš¨ [Error Boundary] Property access error detected"),L(S),!1):(L(S),!1)});const L=S=>{x.value=!0,f.value=S.message||I("common.unknown_error"),U.showErrorAlert&&k(f.value),q.value>=U.maxRetries&&setTimeout(()=>{x.value&&(console.warn("ðŸ”„ [Error Boundary] Max retries reached, suggesting dashboard navigation"),k(I("common.too_many_errors_redirecting")),H())},5e3)},Q=()=>{x.value=!1,f.value="",q.value=0},p=async()=>{if(q.value>=U.maxRetries){k(I("common.max_retries_reached")),H();return}q.value++,x.value=!1,f.value="",d("retry"),await new Promise(S=>setTimeout(S,500))},H=async()=>{try{await A(U.fallbackRoute,{fallback:"/admin/dashboard",skipSafetyCheck:!0})}catch(S){console.error("ðŸš¨ [Error Boundary] Dashboard navigation failed:",S),j("/admin/dashboard")}};return c({clearError:Q,retry:p,goToDashboard:H,hasError:()=>x.value,retryCount:()=>q.value}),(S,M)=>(h(),W("div",null,[x.value?(h(),B(Se,{key:0,type:"error",closable:"","onClick:close":Q,class:"mb-4"},{append:t(()=>[e(K,{variant:"outlined",size:"small",onClick:p,class:"ml-2"},{default:t(()=>[g(l(S.$t("common.retry")),1)]),_:1}),e(K,{variant:"outlined",size:"small",color:"secondary",onClick:H,class:"ml-2"},{default:t(()=>[g(l(S.$t("common.go_to_dashboard")),1)]),_:1})]),default:t(()=>[e(dt,null,{default:t(()=>[g(l(S.$t("common.error_occurred")),1)]),_:1}),s("div",null,l(f.value),1)]),_:1})):Y("",!0),x.value?Y("",!0):(h(),W("div",Gt,[tt(S.$slots,"default")]))]))}}),Yt={class:"d-flex justify-space-between align-center mb-4"},Jt={class:"text-h4 mb-2"},Xt={class:"text-body-1 mb-0"},Zt={class:"text-h5 font-weight-bold"},Ft={class:"text-body-2"},eo={class:"text-h5 font-weight-bold"},to={class:"text-body-2"},oo={class:"text-h5 font-weight-bold"},ao={class:"text-body-2"},lo={class:"text-h5 font-weight-bold"},ro={class:"text-body-2"},io={class:"d-flex align-center"},no={class:"font-weight-medium"},so={class:"text-caption text-medium-emphasis"},co={class:"d-flex justify-space-between align-center mb-4"},uo={class:"text-h6"},mo={class:"d-flex align-center"},vo={class:"font-weight-medium"},po={class:"text-caption text-medium-emphasis"},fo={key:1,class:"text-medium-emphasis"},_o={key:0},go={key:1,class:"text-medium-emphasis"},yo={key:1,class:"text-medium-emphasis"},ho={key:0},bo={class:"d-flex align-center"},ko={class:"text-caption"},Vo={class:"text-caption text-medium-emphasis"},So={key:1,class:"text-medium-emphasis"},wo={class:"d-flex gap-1"},xo={class:"pa-4"},Mo={class:"text-center py-12"},To={class:"text-h6 mb-2"},Co={class:"text-body-2 text-medium-emphasis mb-4"},Le=ye({__name:"index",setup(F){const{t:c}=he(),{showSuccess:n,showError:U}=Ve(),{checkEmergencyReset:d}=ze(),I=ot();console.log("ðŸ” [Stock Page] Auth status:",{isAuthenticated:I.isAuthenticated,hasToken:!!I.token,hasUser:!!I.user,tokenFromStorage:!!localStorage.getItem("auth_token")});const{confirmCreate:A,isDialogVisible:j,isLoading:k,dialogTitle:x,dialogText:f,dialogIcon:q,dialogColor:L,confirmButtonText:Q,cancelButtonText:p,handleConfirm:H,handleCancel:S}=$e(),M=we(),ee=it(),R=nt(),{items:y,summary:a,loading:i,summaryLoading:b,pagination:z,filters:w}=qe(M),O=D(!1),u=D(!1),v=D(null),m=D("in"),E=D(!0),J=D();Ee((_,V,r)=>{console.error("ðŸš¨ [Stock Page] Error captured:",_,r);const N=_.message||"";return(N.includes("navigation")||N.includes("router"))&&d(),!1});const ae=P(()=>{try{return[{title:c("nav_dashboard"),to:"admin-dashboard"},{title:c("stock.title"),to:"admin-stock"}]}catch{return[{title:"Dashboard",to:"admin-dashboard"},{title:"Stock",to:"admin-stock"}]}}),te=D(""),de=P(()=>[{title:c("product"),key:"product",sortable:!1,width:"35%"},{title:c("sku"),key:"sku",sortable:!0,width:"15%"},{title:c("on_hand"),key:"on_hand",sortable:!0,width:"12%"},{title:c("available"),key:"available",sortable:!0,width:"12%"},{title:c("reserved"),key:"reserved",sortable:!0,width:"12%"},{title:c("status"),key:"status",sortable:!1,width:"14%"}]),ue=P(()=>y.value.map(_=>({..._,on_hand:_.metrics.on_hand,available:_.metrics.available,reserved:_.metrics.reserved}))),G=_=>_<=0?"error":_<=5?"warning":_<=10?"info":"success",re=_=>_<=0?"tabler-alert-circle":_<=5?"tabler-alert-triangle":_<=10?"tabler-info-circle":"tabler-circle-check",He=_=>_<=0?"Rupture":_<=5?"Faible":_<=10?"Moyen":"Bon",Oe=P(()=>{try{return[{title:c("stock.columns.product"),key:"product",sortable:!1,width:"22%",minWidth:"220px"},{title:"SKU",key:"sku",sortable:!1,width:"10%",minWidth:"100px"},{title:c("stock.columns.variant"),key:"variant",sortable:!1,width:"13%",minWidth:"110px"},{title:c("stock.columns.category"),key:"category",sortable:!1,width:"10%",minWidth:"90px"},{title:c("stock.columns.boutique"),key:"boutique",sortable:!1,width:"10%",minWidth:"90px"},{title:c("stock.columns.on_hand"),key:"on_hand",sortable:!0,align:"center",width:"7%",minWidth:"70px"},{title:c("stock.columns.reserved"),key:"reserved",sortable:!0,align:"center",width:"7%",minWidth:"70px"},{title:c("stock.columns.available"),key:"available",sortable:!0,align:"center",width:"7%",minWidth:"70px"},{title:c("stock.columns.last_movement"),key:"last_movement",sortable:!1,width:"10%",minWidth:"100px"},{title:c("common.actions"),key:"actions",sortable:!1,align:"center",width:"4%",minWidth:"120px"}]}catch{return[{title:"Product",key:"product",sortable:!1,width:"60%"},{title:"Actions",key:"actions",sortable:!1,width:"40%"}]}}),Ne=P(()=>{try{return ee.items||[]}catch{return[]}}),We=P(()=>{try{return R.categories||[]}catch{return[]}}),xe=async()=>{if(E.value)try{await Promise.all([M.fetchList(),M.fetchSummary(),ee.fetchBoutiques({per_page:100}),R.fetchCategories({per_page:100})])}catch(_){E.value&&console.error("Fetch error:",_)}},Qe=_=>{var V,r,N,ne;M.updateFilters({page:_.page,per_page:_.itemsPerPage,sort:(r=(V=_.sortBy)==null?void 0:V[0])==null?void 0:r.key,dir:(ne=(N=_.sortBy)==null?void 0:N[0])==null?void 0:ne.order})},be=(_,V)=>{v.value=_,m.value=V,O.value=!0},Ge=_=>{v.value=_,u.value=!0},Ke=()=>{O.value=!1,n(c("stock.messages.movement_created"))},Me=()=>{M.resetFilters(),E.value&&M.fetchList()},Ye=_=>{console.error("ðŸš¨ [Stock Page] Error boundary caught error:",_),U(c("common.error_occurred")||"Error occurred")},Je=()=>{console.log("ðŸ”„ [Stock Page] Retrying after error"),xe()};let ie=null;const Xe=le(()=>w.value,()=>{E.value&&(ie&&clearTimeout(ie),ie=setTimeout(()=>{M.fetchList()},300))},{deep:!0});return at(()=>{xe()}),De(()=>{E.value=!1,ie&&(clearTimeout(ie),ie=null),O.value=!1,u.value=!1,v.value=null,Xe()}),(_,V)=>(h(),B(Kt,{ref_key:"errorBoundaryRef",ref:J,"fallback-route":"/admin/dashboard","max-retries":3,onError:Ye,onRetry:Je},{default:t(()=>[s("div",null,[e(st,{items:ae.value,class:"mb-6"},null,8,["items"]),e(se,{class:"mb-6"},{default:t(()=>[e(C,{cols:"12"},{default:t(()=>[e(X,null,{default:t(()=>[e(Z,null,{default:t(()=>[s("div",Yt,[s("div",null,[s("h2",Jt,l(o(c)("stock.title")),1),s("p",Xt,l(o(c)("stock.subtitle")),1)])]),o(a)?(h(),B(se,{key:0},{default:t(()=>[e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(X,{color:"primary",variant:"tonal"},{default:t(()=>[e(Z,{class:"text-center"},{default:t(()=>[e($,{icon:"tabler-package",size:"32",class:"mb-2"}),s("div",Zt,l(o(a).totals.products_count),1),s("div",Ft,l(o(c)("stock.kpi.products")),1)]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(X,{color:"success",variant:"tonal"},{default:t(()=>[e(Z,{class:"text-center"},{default:t(()=>[e($,{icon:"tabler-stack",size:"32",class:"mb-2"}),s("div",eo,l(o(a).totals.total_on_hand),1),s("div",to,l(o(c)("stock.kpi.on_hand")),1)]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(X,{color:"warning",variant:"tonal"},{default:t(()=>[e(Z,{class:"text-center"},{default:t(()=>[e($,{icon:"tabler-clock",size:"32",class:"mb-2"}),s("div",oo,l(o(a).totals.total_reserved),1),s("div",ao,l(o(c)("stock.kpi.reserved")),1)]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(X,{color:"info",variant:"tonal"},{default:t(()=>[e(Z,{class:"text-center"},{default:t(()=>[e($,{icon:"tabler-check",size:"32",class:"mb-2"}),s("div",lo,l(o(a).totals.total_available),1),s("div",ro,l(o(c)("stock.kpi.available")),1)]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(X,{class:"mb-6"},{default:t(()=>[e(_e,{class:"d-flex align-center"},{default:t(()=>[e($,{icon:"tabler-chart-bar",class:"me-2"}),g(" "+l(o(c)("stock_statistics_by_product")),1)]),_:1}),e(Z,null,{default:t(()=>[e(Re,{headers:de.value,items:ue.value,loading:o(i),density:"compact","items-per-page":10,search:te.value},{top:t(()=>[e(oe,{modelValue:te.value,"onUpdate:modelValue":V[0]||(V[0]=r=>te.value=r),label:o(c)("search_product"),"prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","label"])]),"item.product":t(({item:r})=>[s("div",io,[e(Te,{size:"32",class:"me-3"},{default:t(()=>[r.product.image?(h(),B(ht,{key:0,src:r.product.image},null,8,["src"])):(h(),B($,{key:1,icon:"tabler-package"}))]),_:2},1024),s("div",null,[s("div",no,l(r.product.titre),1),s("div",so,l(r.variant.libelle),1)])])]),"item.sku":t(({item:r})=>[e(T,{size:"small",variant:"tonal",color:"primary"},{default:t(()=>[g(l(r.variant.sku),1)]),_:2},1024)]),"item.available":t(({item:r})=>[e(T,{size:"small",color:G(r.metrics.available),variant:"tonal"},{default:t(()=>[g(l(r.metrics.available),1)]),_:2},1032,["color"])]),"item.status":t(({item:r})=>[e(T,{size:"small",color:G(r.metrics.available),variant:"tonal"},{default:t(()=>[e($,{icon:re(r.metrics.available),size:"12",class:"me-1"},null,8,["icon"]),g(" "+l(He(r.metrics.available)),1)]),_:2},1032,["color"])]),_:1},8,["headers","items","loading","search"])]),_:1})]),_:1}),e(X,{class:"mb-6"},{default:t(()=>[e(Z,null,{default:t(()=>[s("div",co,[s("h3",uo,l(o(c)("stock.filters.title")),1),e(K,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"tabler-refresh",onClick:Me},{default:t(()=>[g(l(o(c)("common.clear")),1)]),_:1})]),e(se,null,{default:t(()=>[e(C,{cols:"12",md:"4"},{default:t(()=>[e(oe,{modelValue:o(w).q,"onUpdate:modelValue":V[1]||(V[1]=r=>o(w).q=r),label:o(c)("stock.filters.search"),"prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",clearable:"",placeholder:o(c)("stock.filters.search_placeholder")},null,8,["modelValue","label","placeholder"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(ce,{modelValue:o(w).boutique_id,"onUpdate:modelValue":V[2]||(V[2]=r=>o(w).boutique_id=r),items:Ne.value,label:o(c)("stock.filters.boutique"),"item-title":"nom","item-value":"id",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","label"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(ce,{modelValue:o(w).categorie_id,"onUpdate:modelValue":V[3]||(V[3]=r=>o(w).categorie_id=r),items:We.value,label:o(c)("stock.filters.category"),"item-title":"nom","item-value":"id",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","label"])]),_:1}),e(C,{cols:"12",sm:"6",md:"2"},{default:t(()=>[e(bt,{modelValue:o(w).with_variants,"onUpdate:modelValue":V[4]||(V[4]=r=>o(w).with_variants=r),label:o(c)("stock.filters.with_variants"),color:"primary",density:"compact"},null,8,["modelValue","label"])]),_:1})]),_:1}),e(se,null,{default:t(()=>[e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(oe,{modelValue:o(w).min_qty,"onUpdate:modelValue":V[5]||(V[5]=r=>o(w).min_qty=r),modelModifiers:{number:!0},label:o(c)("stock.filters.min_qty"),type:"number",variant:"outlined",density:"compact",min:"0","prepend-inner-icon":"tabler-arrow-up"},null,8,["modelValue","label"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e(oe,{modelValue:o(w).max_qty,"onUpdate:modelValue":V[6]||(V[6]=r=>o(w).max_qty=r),modelModifiers:{number:!0},label:o(c)("stock.filters.max_qty"),type:"number",variant:"outlined",density:"compact",min:"0","prepend-inner-icon":"tabler-arrow-down"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1}),e(X,null,{default:t(()=>[e(_e,{class:"d-flex justify-space-between align-center"},{default:t(()=>[s("span",null,l(o(c)("stock.table.title")),1),o(i)?Y("",!0):(h(),B(T,{key:0,size:"small",color:"primary",variant:"tonal"},{default:t(()=>[g(l(o(z).total)+" "+l(o(c)("stock.table.items")),1)]),_:1}))]),_:1}),e(kt,{headers:Oe.value,items:o(y),loading:o(i),"items-per-page":o(w).per_page,page:o(w).page,"items-length":o(z).total,"onUpdate:options":Qe,"hide-default-footer":"",class:"stock-table"},{"item.product":t(({item:r})=>[s("div",mo,[e(Te,{color:"grey-lighten-2",size:"40",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-package"})]),_:1}),s("div",null,[s("div",vo,l(r.product.titre),1),s("div",po,l(r.product.slug),1)])])]),"item.sku":t(({item:r})=>[r.product.sku?(h(),B(T,{key:0,size:"small",color:"secondary",variant:"tonal",class:"font-mono"},{default:t(()=>[g(l(r.product.sku),1)]),_:2},1024)):(h(),W("span",fo,"â€”"))]),"item.variant":t(({item:r})=>[r.variant?(h(),W("div",_o,[e(T,{size:"small",color:"primary",variant:"tonal"},{default:t(()=>[g(l(r.variant.libelle),1)]),_:2},1024)])):(h(),W("span",go,"â€”"))]),"item.category":t(({item:r})=>[r.product.categorie?(h(),B(T,{key:0,size:"small",variant:"outlined"},{default:t(()=>[g(l(r.product.categorie.nom),1)]),_:2},1024)):(h(),W("span",yo,"â€”"))]),"item.boutique":t(({item:r})=>[e(T,{size:"small",color:"info",variant:"tonal"},{default:t(()=>[g(l(r.product.boutique.nom),1)]),_:2},1024)]),"item.on_hand":t(({item:r})=>[e(T,{size:"small",color:o(M).getStockStatusColor(r.metrics.available,r.metrics.on_hand),variant:"tonal"},{default:t(()=>[g(l(r.metrics.on_hand),1)]),_:2},1032,["color"])]),"item.reserved":t(({item:r})=>[e(T,{size:"small",color:"warning",variant:"tonal"},{default:t(()=>[g(l(r.metrics.reserved),1)]),_:2},1024)]),"item.available":t(({item:r})=>[e(T,{size:"small",color:o(M).getStockStatusColor(r.metrics.available,r.metrics.on_hand)},{default:t(()=>[g(l(r.metrics.available),1)]),_:2},1032,["color"])]),"item.last_movement":t(({item:r})=>[r.metrics.last_movement_at?(h(),W("div",ho,[s("div",bo,[e($,{icon:o(M).getMovementTypeIcon(r.metrics.last_movement_type||""),color:o(M).getMovementTypeColor(r.metrics.last_movement_type||""),size:"16",class:"me-1"},null,8,["icon","color"]),s("span",ko,l(r.metrics.last_movement_type),1)]),s("div",Vo,l(_.$d(new Date(r.metrics.last_movement_at),"short")),1)])):(h(),W("span",So,"â€”"))]),"item.actions":t(({item:r})=>[s("div",wo,[e(pe,null,{activator:t(({props:N})=>[e(K,ve(N,{icon:"",size:"small",color:"success",variant:"text",onClick:ne=>be(r,"in")}),{default:t(()=>[e($,{icon:"tabler-arrow-up"})]),_:2},1040,["onClick"])]),default:t(()=>[s("span",null,l(o(c)("stock.actions.in")),1)]),_:2},1024),e(pe,null,{activator:t(({props:N})=>[e(K,ve(N,{icon:"",size:"small",color:"error",variant:"text",onClick:ne=>be(r,"out")}),{default:t(()=>[e($,{icon:"tabler-arrow-down"})]),_:2},1040,["onClick"])]),default:t(()=>[s("span",null,l(o(c)("stock.actions.out")),1)]),_:2},1024),e(pe,null,{activator:t(({props:N})=>[e(K,ve(N,{icon:"",size:"small",color:"warning",variant:"text",onClick:ne=>be(r,"adjust")}),{default:t(()=>[e($,{icon:"tabler-adjustments"})]),_:2},1040,["onClick"])]),default:t(()=>[s("span",null,l(o(c)("stock.actions.adjust")),1)]),_:2},1024),e(pe,null,{activator:t(({props:N})=>[e(K,ve(N,{icon:"",size:"small",color:"info",variant:"text",onClick:ne=>Ge(r)}),{default:t(()=>[e($,{icon:"tabler-history"})]),_:2},1040,["onClick"])]),default:t(()=>[s("span",null,l(o(c)("stock.actions.history")),1)]),_:2},1024)])]),loading:t(()=>[s("div",xo,[(h(),W(lt,null,rt(8,r=>e(Be,{key:r,type:"table-row",class:"mb-2"})),64))])]),"no-data":t(()=>[s("div",Mo,[e($,{icon:"tabler-package-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),s("h3",To,l(o(c)("stock.table.no_data_title")),1),s("p",Co,l(o(c)("stock.table.no_data_subtitle")),1),e(K,{color:"primary",variant:"outlined","prepend-icon":"tabler-refresh",onClick:Me},{default:t(()=>[g(l(o(c)("stock.table.reset_filters")),1)]),_:1})])]),_:1},8,["headers","items","loading","items-per-page","page","items-length"]),e(Z,null,{default:t(()=>[e(Ae,{modelValue:o(w).page,"onUpdate:modelValue":V[7]||(V[7]=r=>o(w).page=r),length:o(z).last_page,"total-visible":7},null,8,["modelValue","length"])]),_:1})]),_:1}),O.value?(h(),B(Et,{key:0,modelValue:O.value,"onUpdate:modelValue":V[8]||(V[8]=r=>O.value=r),item:v.value,"movement-type":m.value,onSaved:Ke},null,8,["modelValue","item","movement-type"])):Y("",!0),u.value?(h(),B(Qt,{key:1,modelValue:u.value,"onUpdate:modelValue":V[9]||(V[9]=r=>u.value=r),item:v.value},null,8,["modelValue","item"])):Y("",!0),e(yt,{"is-dialog-visible":o(j),"is-loading":o(k),"dialog-title":o(x),"dialog-text":o(f),"dialog-icon":o(q),"dialog-color":o(L),"confirm-button-text":o(Q),"cancel-button-text":o(p),onConfirm:o(H),onCancel:o(S)},null,8,["is-dialog-visible","is-loading","dialog-title","dialog-text","dialog-icon","dialog-color","confirm-button-text","cancel-button-text","onConfirm","onCancel"])])]),_:1},512))}}),Ce={};typeof Ce=="function"&&Ce(Le);const ka=Vt(Le,[["__scopeId","data-v-d5ea4280"]]);export{ka as default};
