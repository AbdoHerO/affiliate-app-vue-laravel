import{b5 as Ee,r as S,V as F,ba as te,d as ye,aL as ge,h as A,b as C,g as e,m as E,e as t,f as i,v as a,n as o,ac as R,t as w,c as I,k as Fe,b7 as Le,b8 as qe,w as pe,o as Te,F as Ne,j as Re,az as ae}from"./main-BW7J9dbc.js";import{u as De}from"./useNotifications-C-RqLAHj.js";import{useQuickConfirm as Ue}from"./useConfirmAction-C1AhwA5O.js";import{_ as ze}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-D-su4oyA.js";import{C as je}from"./ConfirmActionDialog-DUQAUWcx.js";import{V as T,b as se,c as ve}from"./VCard-BBEboEsQ.js";import{V as z}from"./VCardText-CXwuP4rm.js";import{V as ne,a as W}from"./VRow-CGHQgNV4.js";import{V as q}from"./VChip-Dc9HlRo1.js";import{V as Me}from"./VDataTable-Cjf3VvYQ.js";import{V as be}from"./VSpacer-BxZvfEPo.js";import{V as xe}from"./VDialog-BYRvlSU6.js";import{V as _e,a as Be}from"./VTabs-GSMjEVVu.js";import{V as fe,a as Oe}from"./VWindowItem-BSLJcrS4.js";import{V as he}from"./VDataTableServer-OmbqW_h9.js";import{V as we}from"./VTooltip-DmGX3M8u.js";import{V as He}from"./VTextarea-Wxm7h69M.js";import"./VBreadcrumbs-CSfprZFP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createSimpleFunctional-468wPgla.js";import"./VAvatar-CBx3oh99.js";import"./VImg-NyJdDnCF.js";/* empty css              */import"./VPagination-D6oKxvR6.js";import"./VSelect-BbnjVQGu.js";import"./VTextField-DCEu5f_P.js";import"./VField-ECDxRtcR.js";import"./forwardRefs-t39oHzh6.js";import"./VList-BrmO1UK3.js";import"./ssrBoot-DTcmQToe.js";import"./VDivider-C4kHsR9g.js";import"./dialog-transition-C3MiiA6M.js";import"./VMenu-DTZ6uDZD.js";import"./VOverlay-CpnKYLAB.js";import"./lazy-CTr8uHza.js";import"./VCheckboxBtn-BRmrHq-R.js";import"./VTable-CglbVig3.js";import"./filter-BV1I079x.js";const Xe=Ee("affiliatePayments",()=>{const j=S([]),n=S([]),_=S(null),L=S({}),f=S({commissions:!1,withdrawals:!1,payout:!1}),k=S(null),D=S({current_page:1,last_page:1,per_page:15,total:0,from:null,to:null}),y=S({current_page:1,last_page:1,per_page:15,total:0,from:null,to:null}),h=S({q:"",status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}),x=S({status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}),K=F(()=>j.value.length>0),r=F(()=>n.value.length>0),V=F(()=>f.value.commissions),g=F(()=>f.value.withdrawals),b=F(()=>f.value.payout),$=F(()=>{var d;return((d=L.value.eligible)==null?void 0:d.total)||0}),G=F(()=>{var d;return((d=L.value.eligible)==null?void 0:d.count)||0}),oe=async(d=1)=>{var p,U;f.value.commissions=!0,k.value=null;try{const u=new URLSearchParams;u.append("page",d.toString()),u.append("per_page",((p=h.value.per_page)==null?void 0:p.toString())||"15"),h.value.q&&u.append("q",h.value.q),(U=h.value.status)!=null&&U.length&&h.value.status.forEach(Q=>u.append("status[]",Q)),h.value.date_from&&u.append("date_from",h.value.date_from),h.value.date_to&&u.append("date_to",h.value.date_to),h.value.amount_min&&u.append("amount_min",h.value.amount_min.toString()),h.value.amount_max&&u.append("amount_max",h.value.amount_max.toString()),h.value.sort&&u.append("sort",h.value.sort),h.value.dir&&u.append("dir",h.value.dir);const P=await te(`/affiliate/commissions?${u.toString()}`);if(P.success)j.value=P.data,D.value=P.pagination,L.value=P.summary||{};else throw new Error(P.message||"Failed to fetch commissions")}catch(u){k.value=u.message||"An error occurred while fetching commissions",console.error("Error fetching affiliate commissions:",u)}finally{f.value.commissions=!1}},M=async(d=1)=>{var p,U;f.value.withdrawals=!0,k.value=null;try{const u=new URLSearchParams;u.append("page",d.toString()),u.append("per_page",((p=x.value.per_page)==null?void 0:p.toString())||"15"),(U=x.value.status)!=null&&U.length&&x.value.status.forEach(Q=>u.append("status[]",Q)),x.value.date_from&&u.append("date_from",x.value.date_from),x.value.date_to&&u.append("date_to",x.value.date_to),x.value.sort&&u.append("sort",x.value.sort),x.value.dir&&u.append("dir",x.value.dir);const P=await te(`/affiliate/withdrawals?${u.toString()}`);if(P.success)n.value=P.data,y.value=P.pagination;else throw new Error(P.message||"Failed to fetch withdrawals")}catch(u){k.value=u.message||"An error occurred while fetching withdrawals",console.error("Error fetching affiliate withdrawals:",u)}finally{f.value.withdrawals=!1}};return{commissions:j,withdrawals:n,currentWithdrawal:_,commissionsSummary:L,loading:f,error:k,commissionsPagination:D,withdrawalsPagination:y,commissionsFilters:h,withdrawalsFilters:x,hasCommissions:K,hasWithdrawals:r,isLoadingCommissions:V,isLoadingWithdrawals:g,isLoadingPayout:b,eligibleCommissionsTotal:$,eligibleCommissionsCount:G,fetchCommissions:oe,fetchWithdrawals:M,fetchWithdrawal:async d=>{f.value.withdrawals=!0,k.value=null;try{const p=await te(`/affiliate/withdrawals/${d}`);if(p.success)_.value=p.data;else throw new Error(p.message||"Failed to fetch withdrawal")}catch(p){k.value=p.message||"An error occurred while fetching the withdrawal",console.error("Error fetching affiliate withdrawal:",p)}finally{f.value.withdrawals=!1}},requestPayout:async d=>{f.value.payout=!0,k.value=null;try{const p=await te("/affiliate/withdrawals/request",{method:"POST",body:JSON.stringify({notes:d})});if(p.success)return await Promise.all([oe(),M()]),p.data;throw new Error(p.message||"Failed to request payout")}catch(p){throw k.value=p.message||"An error occurred while requesting payout",console.error("Error requesting affiliate payout:",p),p}finally{f.value.payout=!1}},updateCommissionsFilters:d=>{h.value={...h.value,...d}},updateWithdrawalsFilters:d=>{x.value={...x.value,...d}},resetCommissionsFilters:()=>{h.value={q:"",status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}},resetWithdrawalsFilters:()=>{x.value={status:[],date_from:"",date_to:"",sort:"created_at",dir:"desc",per_page:15}},clearCurrentWithdrawal:()=>{_.value=null},getCommissionStatusColor:d=>({pending:"warning",eligible:"info",approved:"primary",paid:"success",canceled:"error",adjusted:"orange"})[d]||"secondary",getCommissionStatusLabel:d=>({pending:"En attente",eligible:"Éligible",approved:"Approuvée",paid:"Payée",canceled:"Annulée",adjusted:"Ajustée"})[d]||d,getWithdrawalStatusColor:d=>({pending:"warning",approved:"info",in_payment:"primary",paid:"success",rejected:"error",canceled:"secondary"})[d]||"secondary",getWithdrawalStatusLabel:d=>({pending:"En attente",approved:"Approuvé",in_payment:"En cours de paiement",paid:"Payé",rejected:"Rejeté",canceled:"Annulé"})[d]||d}}),Ie={class:"text-h5"},Ke={class:"text-body-2 text-medium-emphasis mb-0"},Ge={class:"text-center"},Je={class:"text-h4 mb-2"},Qe={class:"text-center"},Ye={class:"text-h4 mb-2"},Ze={class:"text-body-1 mb-0"},et={class:"mb-3"},tt={class:"text-caption text-medium-emphasis mb-1"},at={class:"text-body-1 font-weight-medium"},st={class:"mb-3"},ot={class:"text-caption text-medium-emphasis mb-1"},it={class:"text-body-1 font-weight-medium"},lt={class:"mb-3"},nt={class:"text-caption text-medium-emphasis mb-1"},rt={class:"text-body-1 font-weight-medium"},dt={class:"mb-3"},mt={class:"text-caption text-medium-emphasis mb-1"},ct={class:"text-body-1 font-weight-medium"},ut={class:"mb-3"},pt={class:"text-caption text-medium-emphasis mb-1"},_t={class:"text-body-1 font-weight-medium"},ft={class:"mb-3"},ht={class:"text-caption text-medium-emphasis mb-1"},wt={class:"text-body-1 font-weight-medium"},yt={class:"mb-3"},gt={class:"text-caption text-medium-emphasis mb-1"},vt={class:"text-body-1"},bt={class:"text-body-2 font-family-monospace"},xt={class:"text-body-2 font-family-monospace"},Ct={key:0},kt={class:"text-body-2 font-weight-medium"},Vt={key:0,class:"text-caption text-medium-emphasis"},St={key:1,class:"text-medium-emphasis"},$t={class:"text-body-2 font-weight-medium"},At={class:"text-body-2"},Pt=ye({__name:"WithdrawalDetailsModal",props:{isVisible:{type:Boolean},withdrawal:{}},emits:["update:isVisible"],setup(j,{emit:n}){const{t:_}=ge(),L=j,f=n,k=F({get:()=>L.isVisible,set:r=>f("update:isVisible",r)}),D=r=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"MAD"}).format(r),y=r=>new Date(r).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),h=r=>({pending:"warning",approved:"info",in_payment:"primary",paid:"success",rejected:"error",canceled:"secondary"})[r]||"secondary",x=r=>({pending:"En attente",approved:"Approuvé",in_payment:"En cours de paiement",paid:"Payé",rejected:"Rejeté",canceled:"Annulé"})[r]||r,K=r=>({bank_transfer:"Virement bancaire",check:"Chèque",cash:"Espèces"})[r]||r;return(r,V)=>(C(),A(xe,{modelValue:k.value,"onUpdate:modelValue":V[2]||(V[2]=g=>k.value=g),"max-width":"800",persistent:""},{default:e(()=>[r.withdrawal?(C(),A(T,{key:0},{default:e(()=>[t(se,{class:"d-flex align-center justify-space-between"},{default:e(()=>[i("div",null,[i("h3",Ie,a(o(_)("labels.withdrawalDetails")),1),i("p",Ke,a(o(_)("reference"))+": #"+a(r.withdrawal.id.slice(-8)),1)]),t(R,{icon:"tabler-x",variant:"text",size:"small",onClick:V[0]||(V[0]=g=>k.value=!1)})]),_:1}),t(z,null,{default:e(()=>[t(ne,null,{default:e(()=>[t(W,{cols:"12",md:"6"},{default:e(()=>[t(T,{variant:"tonal",color:"primary",class:"mb-4"},{default:e(()=>[t(z,null,{default:e(()=>[i("div",Ge,[i("h4",Je,a(D(r.withdrawal.amount)),1),t(q,{color:h(r.withdrawal.status),variant:"elevated",size:"large"},{default:e(()=>[w(a(x(r.withdrawal.status)),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),_:1}),t(W,{cols:"12",md:"6"},{default:e(()=>[t(T,{variant:"tonal",color:"success",class:"mb-4"},{default:e(()=>[t(z,null,{default:e(()=>[i("div",Qe,[i("h4",Ye,a(r.withdrawal.commission_count||0),1),i("p",Ze,a(o(_)("commissions_included")),1)])]),_:1})]),_:1})]),_:1}),t(W,{cols:"12"},{default:e(()=>[t(T,{variant:"outlined"},{default:e(()=>[t(se,null,{default:e(()=>[w(a(o(_)("detailed_information")),1)]),_:1}),t(z,null,{default:e(()=>[t(ne,null,{default:e(()=>[t(W,{cols:"12",sm:"6"},{default:e(()=>[i("div",et,[i("p",tt,a(o(_)("payment_method")),1),i("p",at,a(K(r.withdrawal.method)),1)])]),_:1}),t(W,{cols:"12",sm:"6"},{default:e(()=>[i("div",st,[i("p",ot,a(o(_)("creation_date")),1),i("p",it,a(y(r.withdrawal.created_at)),1)])]),_:1}),r.withdrawal.approved_at?(C(),A(W,{key:0,cols:"12",sm:"6"},{default:e(()=>[i("div",lt,[i("p",nt,a(o(_)("approval_date")),1),i("p",rt,a(y(r.withdrawal.approved_at)),1)])]),_:1})):E("",!0),r.withdrawal.paid_at?(C(),A(W,{key:1,cols:"12",sm:"6"},{default:e(()=>[i("div",dt,[i("p",mt,a(o(_)("payment_date")),1),i("p",ct,a(y(r.withdrawal.paid_at)),1)])]),_:1})):E("",!0),r.withdrawal.payment_ref?(C(),A(W,{key:2,cols:"12"},{default:e(()=>[i("div",ut,[i("p",pt,a(o(_)("payment_reference")),1),i("p",_t,a(r.withdrawal.payment_ref),1)])]),_:1})):E("",!0),r.withdrawal.iban_rib?(C(),A(W,{key:3,cols:"12"},{default:e(()=>[i("div",ft,[i("p",ht,a(o(_)("rib_iban")),1),i("p",wt,a(r.withdrawal.iban_rib),1)])]),_:1})):E("",!0),r.withdrawal.notes?(C(),A(W,{key:4,cols:"12"},{default:e(()=>[i("div",yt,[i("p",gt,a(o(_)("notes")),1),i("p",vt,a(r.withdrawal.notes),1)])]),_:1})):E("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),r.withdrawal.items&&r.withdrawal.items.length>0?(C(),A(W,{key:0,cols:"12"},{default:e(()=>[t(T,{variant:"outlined"},{default:e(()=>[t(se,null,{default:e(()=>[w(a(o(_)("commissions_included")),1)]),_:1}),t(z,null,{default:e(()=>[t(Me,{headers:[{title:o(_)("commission"),key:"commission.id",sortable:!1},{title:o(_)("order"),key:"commission.commande.id",sortable:!1},{title:o(_)("product"),key:"commission.produit",sortable:!1},{title:o(_)("amount"),key:"amount",sortable:!1},{title:o(_)("order_type"),key:"commission.order_type",sortable:!1},{title:o(_)("date"),key:"commission.created_at",sortable:!1}],items:r.withdrawal.items,"items-per-page":"5",class:"text-no-wrap"},{"item.commission.id":e(({item:g})=>{var b,$;return[i("span",bt," #"+a((($=(b=g.commission)==null?void 0:b.id)==null?void 0:$.slice(-8))||"N/A"),1)]}),"item.commission.commande.id":e(({item:g})=>{var b,$,G;return[i("span",xt," #"+a(((G=($=(b=g.commission)==null?void 0:b.commande)==null?void 0:$.id)==null?void 0:G.slice(-8))||"N/A"),1)]}),"item.commission.produit":e(({item:g})=>{var b;return[(b=g.commission)!=null&&b.produit?(C(),I("div",Ct,[i("div",kt,a(g.commission.produit.titre),1),g.commission.produit.sku?(C(),I("div",Vt,[t(q,{size:"x-small",color:"secondary",variant:"outlined",class:"font-mono"},{default:e(()=>[w(a(g.commission.produit.sku),1)]),_:2},1024)])):E("",!0)])):(C(),I("span",St,"N/A"))]}),"item.amount":e(({item:g})=>[i("span",$t,a(D(g.amount)),1)]),"item.commission.order_type":e(({item:g})=>[t(q,{size:"small",variant:"tonal"},{default:e(()=>{var b,$;return[w(a((($=(b=g.commission)==null?void 0:b.commande_article)==null?void 0:$.type_command)||"N/A"),1)]}),_:2},1024)]),"item.commission.created_at":e(({item:g})=>{var b;return[i("span",At,a((b=g.commission)!=null&&b.created_at?y(g.commission.created_at):"N/A"),1)]}),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1})):E("",!0)]),_:1})]),_:1}),t(ve,null,{default:e(()=>[t(be),t(R,{variant:"outlined",onClick:V[1]||(V[1]=g=>k.value=!1)},{default:e(()=>[w(a(o(_)("actions.close")),1)]),_:1})]),_:1})]),_:1})):E("",!0)]),_:1},8,["modelValue"]))}}),Wt={class:"d-flex justify-space-between align-center mb-6"},Et={class:"text-h4 font-weight-bold mb-1"},Ft={class:"text-body-1 text-medium-emphasis"},Lt={class:"d-flex justify-space-between align-center"},qt={class:"text-caption text-medium-emphasis mb-1"},Tt={class:"text-h6 font-weight-bold"},Nt={class:"text-caption text-medium-emphasis"},Rt={class:"font-weight-medium"},Dt={key:1,class:"text-medium-emphasis"},Ut={class:"font-weight-bold"},zt={class:"text-center py-8"},jt={class:"text-h6 mb-2"},Mt={class:"text-body-2 text-medium-emphasis"},Bt={class:"font-weight-medium"},Ot={class:"font-weight-bold"},Ht={class:"text-body-2"},Xt={class:"d-flex gap-1"},It={class:"text-center py-8"},Kt={class:"mb-4"},Gt={class:"text-body-1 mb-2"},Jt={class:"text-body-2 text-medium-emphasis"},Ta=ye({__name:"index",setup(j){const{t:n}=ge(),_=Fe(),{showSuccess:L,showError:f}=De(),{confirm:k}=Ue(),D=Le(),y=Xe(),{commissions:h,withdrawals:x,currentWithdrawal:K,commissionsSummary:r,loading:V,error:g,commissionsPagination:b,withdrawalsPagination:$,commissionsFilters:G,withdrawalsFilters:oe,eligibleCommissionsTotal:M,eligibleCommissionsCount:Z}=qe(y),N=S("commissions"),B=S(!1),J=S(""),O=S(null),ee=S(!1),re=F(()=>[{title:n("nav.dashboard"),to:{name:"affiliate-dashboard"}},{title:n("affiliate_payments_title"),active:!0}]),de=[{title:n("table.order"),key:"commande.id",sortable:!1},{title:n("table.product"),key:"commandeArticle.produit.titre",sortable:!1},{title:"SKU",key:"sku",sortable:!1,width:"100px"},{title:n("order_type"),key:"order_type",sortable:!1},{title:n("table.type"),key:"type",sortable:!0},{title:n("affiliate_payments_base_amount"),key:"base_amount",sortable:!0},{title:n("table.commission"),key:"amount",sortable:!0},{title:n("table.status"),key:"status",sortable:!0},{title:n("table.date"),key:"created_at",sortable:!0}],me=[{title:n("table.reference"),key:"id",sortable:!1},{title:n("table.amount"),key:"amount",sortable:!0},{title:n("affiliate_payments_method"),key:"method",sortable:!1},{title:n("table.status"),key:"status",sortable:!0},{title:n("affiliate_payments_commissions"),key:"commission_count",sortable:!1},{title:n("table.date"),key:"created_at",sortable:!0},{title:n("table.actions"),key:"actions",sortable:!1}],ie=F(()=>Z.value>0&&M.value>0),H=async(l=1)=>{try{await y.fetchCommissions(l)}catch{f(n("errors.commissions_load_failed"))}},d=async(l=1)=>{try{await y.fetchWithdrawals(l)}catch{f(n("errors.withdrawals_load_failed"))}},p=l=>{H(l)},U=l=>{d(l)},u=l=>{y.updateCommissionsFilters({per_page:l}),H()},P=l=>{y.updateWithdrawalsFilters({per_page:l}),d()},Q=l=>{if(l.length>0){const{key:m,order:s}=l[0];y.updateCommissionsFilters({sort:m,dir:s}),H()}},Ce=l=>{if(l.length>0){const{key:m,order:s}=l[0];y.updateWithdrawalsFilters({sort:m,dir:s}),d()}},ke=()=>{if(!ie.value){f(n("errors.no_eligible_commissions"));return}B.value=!0,J.value=""},Ve=async()=>{try{await k({title:n("affiliate_payments_confirm_withdrawal"),text:n("affiliate_payments_confirm_withdrawal_text",{amount:X(M.value),count:Z.value}),icon:"tabler-wallet",color:"primary"})&&(await y.requestPayout(J.value),L(n("affiliate_payments_withdrawal_success")),B.value=!1)}catch(l){f(l.message||n("errors.withdrawal_request_failed"))}},X=l=>l==null||isNaN(Number(l))?"0,00 MAD":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"MAD"}).format(Number(l)),ce=l=>new Date(l).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}),Se=l=>({order_sample:"primary",exchange:"warning"})[l]||"secondary",$e=l=>({order_sample:"Échantillon",exchange:"Échange"})[l]||l||"N/A",Ae=async l=>{try{await y.fetchWithdrawal(l),ee.value=!0}catch(m){f(m.message||n("errors.withdrawal_details_load"))}},Pe=l=>l.status==="paid"&&l.evidence_path,We=l=>{console.log("Starting evidence download for withdrawal:",l);const m=D.token,s="http://localhost:8000/api",v=`${s}/affiliate/withdrawals/${l}/evidence`;if(console.log("Evidence download details:",{token:m?`${m.substring(0,10)}...`:"NO TOKEN",url:v,apiBaseUrl:s}),!m){console.error("No auth token available"),f(n("affiliate_payments_session_expired"));return}O.value=l;const c=new XMLHttpRequest;c.open("GET",v,!0),c.setRequestHeader("Authorization",`Bearer ${m}`),c.setRequestHeader("Accept","*/*"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.responseType="blob",c.onload=function(){if(O.value=null,c.status===200){const le=c.response;console.log(`Received evidence blob: ${le.size} bytes, type: ${le.type}`);const ue=window.URL.createObjectURL(le),Y=document.createElement("a");Y.href=ue,Y.download=`preuve-paiement-retrait-${l}`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),window.URL.revokeObjectURL(ue),L("Preuve de paiement téléchargée avec succès")}else console.error(`Evidence download failed with status: ${c.status}`),f(`Erreur lors du téléchargement: ${c.status}`)},c.onerror=function(){console.error("Evidence download network error"),O.value=null,f("Erreur réseau lors du téléchargement")},c.ontimeout=function(){console.error("Evidence download timeout"),O.value=null,f("Timeout lors du téléchargement")},c.timeout=3e4,console.log("Sending evidence download request..."),c.send()};return pe(N,l=>{l==="commissions"?H():l==="withdrawals"&&d()}),pe(g,l=>{l&&f(l)}),Te(()=>{H()}),(l,m)=>(C(),I("div",null,[t(ze,{items:re.value},null,8,["items"]),i("div",Wt,[i("div",null,[i("h1",Et,a(o(n)("affiliate_payments_title")),1),i("p",Ft,a(o(n)("affiliate_payments_description")),1)]),N.value==="commissions"?(C(),A(R,{key:0,color:"primary","prepend-icon":"tabler-wallet",disabled:!ie.value,loading:o(V).payout,onClick:ke},{default:e(()=>[w(a(o(n)("affiliate_payments_request_withdrawal")),1)]),_:1},8,["disabled","loading"])):E("",!0)]),N.value==="commissions"?(C(),A(ne,{key:0,class:"mb-6"},{default:e(()=>[(C(!0),I(Ne,null,Re(o(r),(s,v)=>(C(),A(W,{key:v,cols:"12",sm:"6",md:"3"},{default:e(()=>[t(T,null,{default:e(()=>[t(z,null,{default:e(()=>[i("div",Lt,[i("div",null,[i("p",qt,a(o(y).getCommissionStatusLabel(v)),1),i("h3",Tt,a(X(s.total)),1),i("p",Nt,a(o(n)("affiliate_payments_commission_count",{count:s.count})),1)]),t(q,{color:o(y).getCommissionStatusColor(v),variant:"tonal",size:"small"},{default:e(()=>[w(a(v),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):E("",!0),t(Be,{modelValue:N.value,"onUpdate:modelValue":m[0]||(m[0]=s=>N.value=s),class:"mb-6"},{default:e(()=>[t(_e,{value:"commissions"},{default:e(()=>[w(a(o(n)("commissions")),1)]),_:1}),t(_e,{value:"withdrawals"},{default:e(()=>[w(a(o(n)("withdrawals")),1)]),_:1})]),_:1},8,["modelValue"]),t(Oe,{modelValue:N.value,"onUpdate:modelValue":m[1]||(m[1]=s=>N.value=s)},{default:e(()=>[t(fe,{value:"commissions"},{default:e(()=>[t(T,null,{default:e(()=>[t(he,{headers:de,items:o(h),loading:o(V).commissions,"items-length":o(b).total,"items-per-page":o(b).per_page,page:o(b).current_page,"item-value":"id","onUpdate:page":p,"onUpdate:itemsPerPage":u,"onUpdate:sortBy":Q},{"item.commande.id":e(({item:s})=>[t(R,{variant:"text",size:"small",color:"primary",onClick:v=>{var c;return o(_).push({name:"affiliate-orders-id",params:{id:(c=s.commande)==null?void 0:c.id}})}},{default:e(()=>{var v,c;return[w(" #"+a(((c=(v=s.commande)==null?void 0:v.id)==null?void 0:c.toString().slice(-8))||"N/A"),1)]}),_:2},1032,["onClick"])]),"item.commandeArticle.produit.titre":e(({item:s})=>{var v,c;return[i("span",Rt,a(((c=(v=s.commandeArticle)==null?void 0:v.produit)==null?void 0:c.titre)||"N/A"),1)]}),"item.sku":e(({item:s})=>{var v,c;return[(c=(v=s.commandeArticle)==null?void 0:v.produit)!=null&&c.sku?(C(),A(q,{key:0,size:"small",color:"secondary",variant:"outlined",class:"font-mono"},{default:e(()=>[w(a(s.commandeArticle.produit.sku),1)]),_:2},1024)):(C(),I("span",Dt,"—"))]}),"item.order_type":e(({item:s})=>{var v;return[t(q,{size:"small",color:Se((v=s.commandeArticle)==null?void 0:v.type_command),variant:"tonal"},{default:e(()=>{var c;return[w(a($e((c=s.commandeArticle)==null?void 0:c.type_command)),1)]}),_:2},1032,["color"])]}),"item.base_amount":e(({item:s})=>[w(a(X(s.base_amount)),1)]),"item.amount":e(({item:s})=>[i("span",Ut,a(X(s.amount)),1)]),"item.status":e(({item:s})=>[t(q,{color:o(y).getCommissionStatusColor(s.status),size:"small",variant:"tonal"},{default:e(()=>[w(a(o(y).getCommissionStatusLabel(s.status)),1)]),_:2},1032,["color"])]),"item.created_at":e(({item:s})=>[w(a(ce(s.created_at)),1)]),"no-data":e(()=>[i("div",zt,[t(ae,{icon:"tabler-percentage-off",size:"64",class:"text-disabled mb-4"}),i("h3",jt,a(o(n)("affiliate_payments_no_commissions_found")),1),i("p",Mt,a(o(n)("affiliate_payments_no_commissions_yet")),1)])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),_:1})]),_:1}),t(fe,{value:"withdrawals"},{default:e(()=>[t(T,null,{default:e(()=>[t(he,{headers:me,items:o(x),loading:o(V).withdrawals,"items-length":o($).total,"items-per-page":o($).per_page,page:o($).current_page,"item-value":"id","onUpdate:page":U,"onUpdate:itemsPerPage":P,"onUpdate:sortBy":Ce},{"item.id":e(({item:s})=>[i("span",Bt," #"+a(s.id.toString().slice(-8)),1)]),"item.amount":e(({item:s})=>[i("span",Ot,a(X(s.amount)),1)]),"item.method":e(({item:s})=>[t(q,{size:"small",variant:"tonal",color:"info"},{default:e(()=>[w(a(s.method==="bank_transfer"?"Virement bancaire":s.method),1)]),_:2},1024)]),"item.status":e(({item:s})=>[t(q,{color:o(y).getWithdrawalStatusColor(s.status),size:"small",variant:"tonal"},{default:e(()=>[w(a(o(y).getWithdrawalStatusLabel(s.status)),1)]),_:2},1032,["color"])]),"item.commission_count":e(({item:s})=>[i("span",Ht,a(o(n)("affiliate_payments_commission_count",{count:s.commission_count})),1)]),"item.created_at":e(({item:s})=>[w(a(ce(s.created_at)),1)]),"item.actions":e(({item:s})=>[i("div",Xt,[t(R,{icon:"tabler-eye",size:"small",variant:"text",color:"primary",onClick:v=>Ae(s.id)},{default:e(()=>[t(ae,{icon:"tabler-eye"}),t(we,{activator:"parent",location:"top"},{default:e(()=>[w(a(l.$t("payments.actions.view")),1)]),_:1})]),_:2},1032,["onClick"]),Pe(s)?(C(),A(R,{key:0,icon:"tabler-file-download",size:"small",variant:"text",color:"success",loading:O.value===s.id,onClick:v=>We(s.id)},{default:e(()=>[t(ae,{icon:"tabler-file-download"}),t(we,{activator:"parent",location:"top"},{default:e(()=>[w(a(o(n)("download_payment_proof")),1)]),_:1})]),_:2},1032,["loading","onClick"])):E("",!0)])]),"no-data":e(()=>[i("div",It,[t(ae,{icon:"tabler-wallet-off",size:"64",class:"text-disabled mb-4"}),m[6]||(m[6]=i("h3",{class:"text-h6 mb-2"},"Aucun retrait trouvé",-1)),m[7]||(m[7]=i("p",{class:"text-body-2 text-medium-emphasis"}," Vous n'avez pas encore demandé de retrait. ",-1))])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(xe,{modelValue:B.value,"onUpdate:modelValue":m[4]||(m[4]=s=>B.value=s),"max-width":"500"},{default:e(()=>[t(T,null,{default:e(()=>[t(se,null,{default:e(()=>[w(a(o(n)("affiliate_payments_request_withdrawal")),1)]),_:1}),t(z,null,{default:e(()=>[i("div",Kt,[i("p",Gt,[i("strong",null,a(o(n)("affiliate_payments_eligible_amount"))+":",1),w(" "+a(X(o(M))),1)]),i("p",Jt,a(o(n)("affiliate_payments_eligible_commissions_text",{count:o(Z)})),1)]),t(He,{modelValue:J.value,"onUpdate:modelValue":m[2]||(m[2]=s=>J.value=s),label:o(n)("affiliate_payments_notes_optional"),placeholder:o(n)("affiliate_payments_notes_placeholder"),rows:"3",counter:"1000",maxlength:"1000"},null,8,["modelValue","label","placeholder"])]),_:1}),t(ve,null,{default:e(()=>[t(be),t(R,{variant:"outlined",onClick:m[3]||(m[3]=s=>B.value=!1)},{default:e(()=>[w(a(o(n)("affiliate_payments_cancel")),1)]),_:1}),t(R,{color:"primary",loading:o(V).payout,onClick:Ve},{default:e(()=>[w(a(o(n)("affiliate_payments_confirm_request")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Pt,{"is-visible":ee.value,"onUpdate:isVisible":m[5]||(m[5]=s=>ee.value=s),withdrawal:o(K)},null,8,["is-visible","withdrawal"]),t(je)]))}});export{Ta as default};
