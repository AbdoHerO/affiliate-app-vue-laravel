import{b4 as j,r as v,V as W}from"./main-uLG9IIeX.js";import{$ as m}from"./api-DSi3Suj8.js";const B=j("withdrawals",()=>{const n=v([]),d=v(null),w=v(null),c=v(!1),s=v(null),p=v({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),f=v({page:1,per_page:15,sort:"created_at",dir:"desc"}),_=W(()=>n.value.length>0),$=W(()=>c.value),O=i=>Object.fromEntries(Object.entries(i).filter(([l,r])=>!(r===""||r===null||r===void 0||Array.isArray(r)&&r.length===0))),b=async i=>{var l;try{c.value=!0,s.value=null,i&&(f.value={...i});const r=O(f.value),t=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{u!=null&&u!==""&&(Array.isArray(u)?u.forEach(h=>t.append(`${o}[]`,h.toString())):t.append(o,u.toString()))});const e=`/admin/withdrawals${t.toString()?`?${t.toString()}`:""}`;console.log("ðŸ”„ [Withdrawals Store] Fetching:",e),console.log("ðŸ“‹ [Withdrawals Store] Applied filters:",f.value);const a=await m(e);console.log("ðŸ“¥ [Withdrawals Store] Raw response:",a),a!=null&&a.success?(n.value=a.data||[],a.pagination&&Object.assign(p.value,a.pagination),a.summary&&w.value&&Object.assign(w.value,a.summary),console.log("âœ… [Withdrawals Store] Data loaded:",n.value.length,"withdrawals"),console.log("ðŸ“„ [Withdrawals Store] Pagination:",p.value),console.log("ðŸ“Š [Withdrawals Store] Summary:",w.value)):s.value=(a==null?void 0:a.message)||"Erreur lors du chargement des retraits"}catch(r){s.value=((l=r.data)==null?void 0:l.message)||r.message||"Erreur lors du chargement des retraits",console.error("ðŸš« [Withdrawals Store] Error fetching withdrawals:",r)}finally{c.value=!1}},E=async i=>{var l,r;try{c.value=!0,s.value=null,console.log("ðŸ”„ [Withdrawals Store] Fetching withdrawal:",i);const t=await m(`/admin/withdrawals/${i}`);return t!=null&&t.success?(d.value=t.data,console.log("âœ… [Withdrawals Store] Withdrawal loaded:",(l=t.data)==null?void 0:l.id),{success:!0,data:t.data}):(s.value=(t==null?void 0:t.message)||"Erreur lors du chargement du retrait",{success:!1,message:s.value})}catch(t){return s.value=((r=t.data)==null?void 0:r.message)||t.message||"Erreur lors du chargement du retrait",console.error("ðŸš« [Withdrawals Store] Error fetching withdrawal:",t),{success:!1,message:s.value}}finally{c.value=!1}};return{withdrawals:n,currentWithdrawal:d,summary:w,loading:c,error:s,pagination:p,filters:f,hasWithdrawals:_,isLoading:$,fetchList:b,fetchOne:E,create:async i=>{var l;try{c.value=!0,s.value=null;const r=await m("/admin/withdrawals",{method:"POST",body:i});return r!=null&&r.success?(await b(),{success:!0,data:r.data,message:r.message}):(s.value=(r==null?void 0:r.message)||"Erreur lors de la crÃ©ation du retrait",{success:!1,message:s.value})}catch(r){return s.value=((l=r.data)==null?void 0:l.message)||r.message||"Erreur lors de la crÃ©ation du retrait",console.error("ðŸš« [Withdrawals Store] Error creating withdrawal:",r),{success:!1,message:s.value}}finally{c.value=!1}},attachCommissions:async(i,l)=>{var r,t;try{c.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${i}/attach-commissions`,{method:"POST",body:l});return e!=null&&e.success?(((r=d.value)==null?void 0:r.id)===i&&await E(i),{success:!0,data:e.data.data,message:e.message}):(s.value=(e==null?void 0:e.message)||"Erreur lors de l'attachement des commissions",{success:!1,message:s.value})}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors de l'attachement des commissions",console.error("ðŸš« [Withdrawals Store] Error attaching commissions:",e),{success:!1,message:s.value}}finally{c.value=!1}},detachCommissions:async(i,l)=>{var r,t;try{c.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${i}/detach-commissions`,{method:"POST",body:l});return e!=null&&e.success?(((r=d.value)==null?void 0:r.id)===i&&await E(i),{success:!0,data:e.data.data,message:e.message}):(s.value=(e==null?void 0:e.message)||"Erreur lors du dÃ©tachement des commissions",{success:!1,message:s.value})}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors du dÃ©tachement des commissions",console.error("ðŸš« [Withdrawals Store] Error detaching commissions:",e),{success:!1,message:s.value}}finally{c.value=!1}},approve:async(i,l)=>{var r,t;try{c.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${i}/approve`,{method:"POST",body:l||{}});if(e!=null&&e.success){const a=n.value.findIndex(o=>o.id===i);return a!==-1&&(n.value[a]=e.data.data),((r=d.value)==null?void 0:r.id)===i&&(d.value=e.data.data),{success:!0,data:e.data.data,message:e.message}}else return s.value=(e==null?void 0:e.message)||"Erreur lors de l'approbation du retrait",{success:!1,message:s.value}}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors de l'approbation du retrait",console.error("ðŸš« [Withdrawals Store] Error approving withdrawal:",e),{success:!1,message:s.value}}finally{c.value=!1}},reject:async(i,l)=>{var r,t,e;try{c.value=!0,s.value=null;const a=await m(`/admin/withdrawals/${i}/reject`,{method:"POST",body:l});if(a!=null&&a.success){const o=n.value.findIndex(u=>u.id===i);return o!==-1&&(n.value[o]=a.data.data),((r=d.value)==null?void 0:r.id)===i&&(d.value=a.data.data),{success:!0,data:a.data.data,message:a.data.message}}else return s.value=a.data.message||"Erreur lors du rejet du retrait",{success:!1,message:s.value}}catch(a){return s.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Erreur lors du rejet du retrait",console.error("Error rejecting withdrawal:",a),{success:!1,message:s.value}}finally{c.value=!1}},markInPayment:async(i,l)=>{var r,t;try{c.value=!0,s.value=null;const e=await m(`/admin/withdrawals/${i}/mark-in-payment`,{method:"POST",body:l||{}});if(e!=null&&e.success){const a=n.value.findIndex(o=>o.id===i);return a!==-1&&(n.value[a]=e.data),((r=d.value)==null?void 0:r.id)===i&&(d.value=e.data),{success:!0,data:e.data,message:e.message}}else return s.value=(e==null?void 0:e.message)||"Erreur lors du marquage en cours de paiement",{success:!1,message:s.value}}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors du marquage en cours de paiement",console.error("ðŸš« [Withdrawals Store] Error marking withdrawal in payment:",e),{success:!1,message:s.value}}finally{c.value=!1}},markPaid:async(i,l)=>{var r,t;try{c.value=!0,s.value=null;const e=new FormData;l!=null&&l.payment_ref&&e.append("payment_ref",l.payment_ref),l!=null&&l.paid_at&&e.append("paid_at",l.paid_at),l!=null&&l.evidence&&e.append("evidence",l.evidence);const a=await m(`/admin/withdrawals/${i}/mark-paid`,{method:"POST",body:e});if(a!=null&&a.success){const o=n.value.findIndex(u=>u.id===i);return o!==-1&&(n.value[o]=a.data),((r=d.value)==null?void 0:r.id)===i&&(d.value=a.data),{success:!0,data:a.data,message:a.message}}else return s.value=(a==null?void 0:a.message)||"Erreur lors du marquage comme payÃ©",{success:!1,message:s.value}}catch(e){return s.value=((t=e.data)==null?void 0:t.message)||e.message||"Erreur lors du marquage comme payÃ©",console.error("ðŸš« [Withdrawals Store] Error marking withdrawal as paid:",e),{success:!1,message:s.value}}finally{c.value=!1}},fetchEligibleCommissions:async(i,l)=>{var r,t,e;try{c.value=!0,s.value=null;const a=new URLSearchParams;l&&Object.entries(l).forEach(([h,g])=>{g!=null&&g!==""&&a.append(h,g.toString())});const o=`/admin/withdrawals/users/${i}/eligible-commissions${a.toString()?`?${a.toString()}`:""}`,u=await m(o);return u!=null&&u.success||u!=null&&u.data?{success:!0,data:{data:Array.isArray((r=u==null?void 0:u.data)==null?void 0:r.data)?u.data.data:Array.isArray(u==null?void 0:u.data)?u.data:Array.isArray(u)?u:[],pagination:((t=u==null?void 0:u.data)==null?void 0:t.pagination)||null}}:(s.value=(u==null?void 0:u.message)||"Erreur lors du chargement des commissions Ã©ligibles",{success:!1,message:s.value})}catch(a){return s.value=((e=a.data)==null?void 0:e.message)||a.message||"Erreur lors du chargement des commissions Ã©ligibles",console.error("ðŸš« [Withdrawals Store] Error fetching eligible commissions:",a),{success:!1,message:s.value}}finally{c.value=!1}},exportCsv:async i=>{var l,r;try{const t={...i},e=localStorage.getItem("auth_token"),a=new URLSearchParams;Object.entries(t).forEach(([P,S])=>{S!=null&&S!==""&&a.append(P,S.toString())});const o=`/admin/withdrawals/export${a.toString()?`?${a.toString()}`:""}`,u=await fetch(`https://affiliate.moriny.com/api${o}`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(!u.ok)throw new Error("Export failed");const h=await u.blob(),g=window.URL.createObjectURL(h),y=document.createElement("a");return y.href=g,y.setAttribute("download",`withdrawals_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(y),y.click(),y.remove(),window.URL.revokeObjectURL(g),{success:!0,message:"Export terminÃ© avec succÃ¨s"}}catch(t){return s.value=((r=(l=t.response)==null?void 0:l.data)==null?void 0:r.message)||"Erreur lors de l'export",console.error("Error exporting withdrawals:",t),{success:!1,message:s.value}}},resetFilters:()=>{f.value={sort:"created_at",dir:"desc",page:1,per_page:15}},resetState:()=>{n.value=[],d.value=null,w.value=null,s.value=null,p.value={current_page:1,last_page:1,per_page:15,total:0,from:0,to:0},f.value={page:1,per_page:15,sort:"created_at",dir:"desc"}}}});export{B as u};
