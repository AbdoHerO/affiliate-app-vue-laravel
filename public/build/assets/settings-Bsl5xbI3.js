import{b5 as B,r as d,V as o,w as Y,ba as $,aE as j,aF as V,aL as _,bs as q}from"./main-BGmfaZsq.js";const G=B("settings",()=>{const a=d({}),s=d(!1),c=d(!1),f=d(null),y=o(()=>a.value.app_name||"Affiliate Platform"),g=o(()=>a.value.app_logo||a.value.company_logo||""),v=o(()=>a.value.app_favicon||a.value.favicon||""),l=o(()=>a.value.primary_color||"#6366F1"),u=o(()=>a.value.secondary_color||"#8B5CF6"),i=o(()=>a.value.default_language||"fr"),r=o(()=>a.value.app_theme||"light"),w=o(()=>a.value.login_background_image||""),b=o(()=>a.value.signup_background_image||""),F=o(()=>a.value.facebook_pxm_api_key||""),S=o(()=>({name:a.value.company_name||"",email:a.value.company_email||"",phone:a.value.company_phone||"",address:a.value.company_address||"",website:a.value.company_website||""})),k=o(()=>({facebook:a.value.company_social_facebook||"",instagram:a.value.company_social_instagram||"",twitter:a.value.company_social_twitter||""})),A=o(()=>({logo:g.value,favicon:v.value,primaryColor:l.value,secondaryColor:u.value,theme:r.value})),C=o(()=>({defaultLanguage:i.value,timezone:a.value.timezone||"Africa/Casablanca",currency:a.value.currency||"MAD",currencySymbol:a.value.currency_symbol||"MAD",dateFormat:a.value.date_format||"DD/MM/YYYY",timeFormat:a.value.time_format||"24"})),E=async()=>{if(!c.value){s.value=!0;try{console.log("ðŸ”„ Initializing settings store..."),await m(),p(),c.value=!0,console.log("âœ… Settings store initialized successfully")}catch(e){console.error("âŒ Settings store initialization failed:",e),a.value={app_name:"Affiliate Platform",app_description:"Advanced Affiliate Marketing Platform",primary_color:"#6366F1",secondary_color:"#8B5CF6",app_theme:"light",default_language:"fr",currency:"MAD",currency_symbol:"MAD",facebook_pxm_api_key:""},c.value=!0,console.log("âš ï¸ Using default settings due to initialization failure")}finally{s.value=!1}}},m=async()=>{try{console.log("ðŸ”„ Fetching settings from API...");const e=await fetch("/api/public/app-config",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(t&&t.success)a.value=t.data||{},f.value=new Date,console.log("âœ… Settings fetched successfully:",t.data);else throw console.warn("âš ï¸ Settings API returned unsuccessful response:",t),new Error("Settings API returned unsuccessful response")}catch(e){throw console.error("âŒ Failed to fetch settings:",e),a.value={},e}},L=async(e,t)=>{s.value=!0;try{const n=await $(`/admin/settings/${e}`,{method:"PUT",body:t});if(n.success)await m(),p(),x();else throw new Error(n.message||"Failed to update settings")}catch(n){throw console.error("Failed to update settings:",n),n}finally{s.value=!1}},P=(e,t)=>a.value[e]??t,p=()=>{T(),z(),I(),M(),D(),U(),N()},T=()=>{try{const e=j(),t=V();if(r.value&&r.value!=="system"&&(e.theme=r.value),l.value){const n=t.themes.value.light,h=t.themes.value.dark;n&&(n.colors.primary=l.value),h&&(h.colors.primary=l.value)}}catch(e){console.warn("Failed to apply theme settings:",e)}},z=()=>{try{const{locale:e}=_();i.value&&e.value!==i.value&&(e.value=i.value)}catch(e){console.warn("Failed to apply language settings:",e)}},I=()=>{try{const{setFontForLanguage:e}=q(),{locale:t}=_();e(t.value),document.body.className=document.body.className.replace(/language-\w+/g,""),document.body.classList.add(`language-${t.value}`),document.documentElement.lang=t.value,console.log("âœ… Font settings applied for language:",t.value)}catch(e){console.warn("Failed to apply font settings:",e)}},M=()=>{const e=v.value||a.value.favicon;if(e){const t=document.querySelector('link[rel="icon"]');if(t)t.href=e;else{const n=document.createElement("link");n.rel="icon",n.href=e,document.head.appendChild(n)}console.log("âœ… Favicon updated:",e)}},D=()=>{const e=g.value||a.value.company_logo;e&&(window.dispatchEvent(new CustomEvent("logo:updated",{detail:{logoUrl:e}})),console.log("âœ… Logo updated:",e))},U=()=>{const e=y.value;e&&(document.title=e,window.dispatchEvent(new CustomEvent("appName:updated",{detail:{appName:e}})),console.log("âœ… App name updated:",e))},N=()=>{const e=document.documentElement;l.value&&e.style.setProperty("--settings-primary-color",l.value),u.value&&e.style.setProperty("--settings-secondary-color",u.value)},x=()=>{window.dispatchEvent(new CustomEvent("settings:updated",{detail:{settings:a.value}}))};return Y(()=>a.value,()=>{c.value&&p()},{deep:!0}),{settings:o(()=>a.value),loading:o(()=>s.value),initialized:o(()=>c.value),lastUpdated:o(()=>f.value),appName:y,appLogo:g,appFavicon:v,primaryColor:l,secondaryColor:u,defaultLanguage:i,appTheme:r,loginBackground:w,signupBackground:b,facebookPxmApiKey:F,companyInfo:S,socialLinks:k,brandingInfo:A,localizationInfo:C,initialize:E,fetchSettings:m,updateSettings:L,getSetting:P,applySettings:p}});G();export{G as u};
