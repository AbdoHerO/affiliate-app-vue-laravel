import{d as pe,aL as fe,r as W,V as I,w as Q,c as F,o as P,b as t,g as K,l as M,f as l,m as o,ac as O,s as p,t as r,e as m,aV as Se,az as se,F as he,i as xe,v as Ce,ai as ke,Z as J,aj as te,b9 as Ie,a2 as ae,aB as re,ak as Ae,cu as Pe,H as $e,ao as We,bO as Be,cv as Ee,ba as Z,N as Le,as as Te,p as oe,by as Ue,cr as De,c6 as Re,cG as Fe,bR as ne,aD as Ne,bQ as ze,cq as Me,cm as Ge,j as je,at as Oe,cX as He,aU as qe,a$ as Qe,b0 as Xe}from"./main-uLG9IIeX.js";import{u as be}from"./withdrawals-CIZKjV5q.js";import{$ as Ze}from"./api-DSi3Suj8.js";import{u as we}from"./useNotifications-DDBS_wPD.js";import{u as Je}from"./useFormErrors-XAfRt52c.js";import{u as Ke}from"./useSafeNavigation-DJ7P_ADI.js";import{_ as Ye}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-nczKusLe.js";import{V as G,a as _}from"./VRow-aGfXYx3U.js";import{V as et,a as ue,b as de,m as tt}from"./VSheet-DZhM4VzH.js";import{V as ce}from"./VTextField-Dxeq5kx5.js";import{V as Y,b as at}from"./VCard-CB1gT6RB.js";import{V as ee}from"./VCardText-BZtszuIK.js";import{V as me}from"./VCheckbox-BPY3LPcF.js";import{V as ge}from"./VDivider-UqGR4x4D.js";import{V as lt}from"./VChip-B84WcmDa.js";import{c as st}from"./createSimpleFunctional-DugzUcbB.js";import{V as Ve}from"./VAvatar-bHPDEsYY.js";import{a as ve,m as ot,V as _e,b as it}from"./VWindowItem-DPvP18Ki.js";import{V as rt}from"./VForm-C9FiqBHN.js";import{V as nt}from"./VAutocomplete-ZR_xQm-B.js";import{a as ut,b as dt,d as ct}from"./VList-uZDByhc2.js";import{V as mt}from"./VSelect-sWnAtot-.js";import{V as vt}from"./VTextarea-BuIc6d95.js";import{V as _t}from"./VAlert-TgguXW_5.js";import"./index-D-EbNoF1.js";import"./VBreadcrumbs-D7yKQl5l.js";/* empty css              */import"./VCheckboxBtn-CogF2AUK.js";import"./VField-CfH1YcVv.js";import"./VImg-BS6_svHJ.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./ssrBoot-BPhRU-mF.js";import"./filter-D_SbaZWa.js";import"./VMenu-DP1p-55V.js";import"./dialog-transition-2hF0ajsQ.js";const pt={class:"commission-selector"},ft={key:1},ht={key:0,class:"text-center py-4"},bt={class:"mt-2"},wt={key:1,class:"text-center py-4"},gt={key:2},Vt={class:"commission-list",style:{"max-height":"400px","overflow-y":"auto"}},yt={class:"text-body-2"},St={class:"text-caption text-medium-emphasis"},xt={class:"text-body-2"},Ct={class:"text-caption text-medium-emphasis"},kt={class:"text-body-2 font-weight-medium"},It={class:"text-caption"},At={class:"text-h6"},Pt={class:"text-h6"},$t=pe({__name:"CommissionSelector",props:{userId:{},selectedCommissions:{default:()=>[]},mode:{default:"manual"},targetAmount:{default:0}},emits:["update:selectedCommissions","update:targetAmount","update:mode"],setup(a,{emit:T}){const{t:e}=fe(),n=a,g=T,V=be(),{showError:x}=we(),C=W([]),B=W(!1),h=W(""),s=W([...n.selectedCommissions]),y=W(n.mode),w=W(n.targetAmount),U=W(!1),$=I(()=>h.value?C.value.filter(i=>{var v,d,L;return i.id.toLowerCase().includes(h.value.toLowerCase())||((v=i.commande)==null?void 0:v.id.toLowerCase().includes(h.value.toLowerCase()))||((L=(d=i.produit)==null?void 0:d.titre)==null?void 0:L.toLowerCase().includes(h.value.toLowerCase()))}):C.value),R=I(()=>C.value.filter(i=>s.value.includes(i.id))),N=I(()=>R.value.reduce((i,v)=>{const d=Number(v.amount)||0;return i+d},0)),D=I(()=>$.value.length>0&&$.value.every(i=>s.value.includes(i.id))),z=I(()=>s.value.length>0&&!D.value);Q(()=>n.selectedCommissions,i=>{console.log("📥 Received prop change:",i),U.value=!0,s.value=[...i],ke(()=>{U.value=!1,console.log("✅ Prop update complete, local changes allowed")})},{deep:!0}),Q(()=>n.mode,i=>{y.value=i}),Q(()=>n.targetAmount,i=>{w.value=i}),Q(s,i=>{U.value?console.log("🔄 Skipping emit - updating from props"):(console.log("📤 Emitting selection change to parent:",i),g("update:selectedCommissions",i))},{deep:!0}),Q(y,i=>{g("update:mode",i)}),Q(w,i=>{g("update:targetAmount",i)});const E=async()=>{if(n.userId){B.value=!0;try{const i=await V.fetchEligibleCommissions(n.userId);i.success&&i.data?C.value=i.data.data||[]:x(i.message||e("admin_commission_load_error"))}catch{x(e("admin_commission_load_error"))}finally{B.value=!1}}},H=i=>{const v=s.value.indexOf(i);v>-1?s.value.splice(v,1):s.value.push(i)},b=()=>{D.value?$.value.forEach(i=>{const v=s.value.indexOf(i.id);v>-1&&s.value.splice(v,1)}):$.value.forEach(i=>{s.value.includes(i.id)||s.value.push(i.id)})},j=()=>{if(!w.value||w.value<=0)return;s.value=[];let i=0;const v=[...C.value].sort((d,L)=>new Date(d.created_at).getTime()-new Date(L.created_at).getTime());for(const d of v){if(i>=w.value)break;s.value.push(d.id),i+=d.amount}},q=()=>{s.value=[]};return Q(()=>n.userId,E,{immediate:!0}),(i,v)=>(P(),F("div",pt,[t(G,{class:"mb-4"},{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[t(et,{modelValue:y.value,"onUpdate:modelValue":v[0]||(v[0]=d=>y.value=d),inline:"",class:"mb-4"},{default:l(()=>[t(ue,{label:o(e)("admin_commission_manual_selection"),value:"manual"},null,8,["label"]),t(ue,{label:o(e)("admin_commission_auto_selection"),value:"auto"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),y.value==="auto"?(P(),K(G,{key:0,class:"mb-4"},{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(ce,{modelValue:w.value,"onUpdate:modelValue":v[1]||(v[1]=d=>w.value=d),modelModifiers:{number:!0},label:o(e)("admin_commission_target_amount"),type:"number",min:"0",step:"0.01",suffix:"MAD",onBlur:j},null,8,["modelValue","label"])]),_:1}),t(_,{cols:"12",md:"6",class:"d-flex align-center"},{default:l(()=>[t(O,{color:"primary",variant:"tonal",onClick:j},{default:l(()=>[p(r(o(e)("admin_commission_auto_select_button")),1)]),_:1})]),_:1})]),_:1})):M("",!0),y.value==="manual"?(P(),F("div",ft,[t(G,{class:"mb-4"},{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(ce,{modelValue:h.value,"onUpdate:modelValue":v[2]||(v[2]=d=>h.value=d),label:o(e)("admin_commission_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:""},null,8,["modelValue","label"])]),_:1}),t(_,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:l(()=>[t(O,{variant:"tonal",size:"small",onClick:b},{default:l(()=>[p(r(D.value?o(e)("admin_commission_deselect_all"):o(e)("admin_commission_select_all")),1)]),_:1}),t(O,{variant:"tonal",color:"error",size:"small",onClick:q},{default:l(()=>[p(r(o(e)("admin_commission_clear")),1)]),_:1})]),_:1})]),_:1}),t(Y,null,{default:l(()=>[t(ee,null,{default:l(()=>[B.value?(P(),F("div",ht,[t(Se,{indeterminate:""}),m("p",bt,r(o(e)("admin_commission_loading")),1)])):$.value.length===0?(P(),F("div",wt,[t(se,{icon:"tabler-inbox",size:"48",class:"mb-2"}),m("p",null,r(o(e)("admin_commission_no_eligible")),1)])):(P(),F("div",gt,[t(G,{class:"mb-2 font-weight-medium"},{default:l(()=>[t(_,{cols:"1"},{default:l(()=>[t(me,{"model-value":D.value,indeterminate:z.value,"onUpdate:modelValue":b},null,8,["model-value","indeterminate"])]),_:1}),t(_,{cols:"3"},{default:l(()=>[p(r(o(e)("admin_commission_header_commission")),1)]),_:1}),t(_,{cols:"3"},{default:l(()=>[p(r(o(e)("admin_commission_header_order")),1)]),_:1}),t(_,{cols:"2"},{default:l(()=>[p(r(o(e)("admin_commission_header_amount")),1)]),_:1}),t(_,{cols:"2"},{default:l(()=>[p(r(o(e)("admin_commission_header_status")),1)]),_:1}),t(_,{cols:"1"},{default:l(()=>[p(r(o(e)("admin_commission_header_date")),1)]),_:1})]),_:1}),t(ge,{class:"mb-2"}),m("div",Vt,[(P(!0),F(he,null,xe($.value,d=>(P(),K(G,{key:d.id,class:Ce(["mb-1 align-center",{"bg-primary-lighten-5":s.value.includes(d.id)}])},{default:l(()=>[t(_,{cols:"1"},{default:l(()=>[t(me,{"model-value":s.value.includes(d.id),onClick:L=>H(d.id)},null,8,["model-value","onClick"])]),_:2},1024),t(_,{cols:"3"},{default:l(()=>[m("div",yt,r(d.id.substring(0,8))+"...",1),m("div",St,r(d.type),1)]),_:2},1024),t(_,{cols:"3"},{default:l(()=>{var L,X;return[m("div",xt,r((L=d.commande)==null?void 0:L.id.substring(0,8))+"...",1),m("div",Ct,r((X=d.produit)==null?void 0:X.titre),1)]}),_:2},1024),t(_,{cols:"2"},{default:l(()=>[m("div",kt,r(Number(d.amount).toFixed(2))+" MAD",1)]),_:2},1024),t(_,{cols:"2"},{default:l(()=>[t(lt,{color:d.status==="approved"?"success":"info",variant:"tonal",size:"small"},{default:l(()=>[p(r(d.status),1)]),_:2},1032,["color"])]),_:2},1024),t(_,{cols:"1"},{default:l(()=>[m("div",It,r(new Date(d.created_at).toLocaleDateString()),1)]),_:2},1024)]),_:2},1032,["class"]))),128))])]))]),_:1})]),_:1})])):M("",!0),s.value.length>0?(P(),K(Y,{key:2,class:"mt-4",color:"primary",variant:"tonal"},{default:l(()=>[t(ee,null,{default:l(()=>[t(G,null,{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[m("div",At,r(o(e)("admin_commission_selected_count",{count:s.value.length})),1)]),_:1}),t(_,{cols:"12",md:"6",class:"text-md-end"},{default:l(()=>[m("div",Pt,r(o(e)("admin_commission_total"))+": "+r(Number(N.value).toFixed(2))+" MAD",1)]),_:1})]),_:1})]),_:1})]),_:1})):M("",!0)]))}}),ie=Symbol.for("vuetify:v-stepper"),ye=J({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),Wt=te()({name:"VStepperActions",props:ye(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(a,T){let{emit:e,slots:n}=T;const{t:g}=Ie();function V(){e("click:prev")}function x(){e("click:next")}return ae(()=>{const C={onClick:V},B={onClick:x};return t("div",{class:"v-stepper-actions"},[t(re,{defaults:{VBtn:{disabled:["prev",!0].includes(a.disabled),text:g(a.prevText),variant:"text"}}},{default:()=>{var h;return[((h=n.prev)==null?void 0:h.call(n,{props:C}))??t(O,C,null)]}}),t(re,{defaults:{VBtn:{color:a.color,disabled:["next",!0].includes(a.disabled),text:g(a.nextText),variant:"tonal"}}},{default:()=>{var h;return[((h=n.next)==null?void 0:h.call(n,{props:B}))??t(O,B,null)]}})])}),{}}}),Bt=st("v-stepper-header"),Et=J({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:Z,default:"$complete"},editable:Boolean,editIcon:{type:Z,default:"$edit"},error:Boolean,errorIcon:{type:Z,default:"$error"},icon:Z,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),Lt=J({...Et(),...Ee()},"VStepperItem"),Tt=te()({name:"VStepperItem",directives:{Ripple:Ae},props:Lt(),emits:{"group:selected":a=>!0},setup(a,T){let{slots:e}=T;const n=Pe(a,ie,!0),g=I(()=>(n==null?void 0:n.value.value)??a.value),V=I(()=>a.rules.every(w=>w()===!0)),x=I(()=>!a.disabled&&a.editable),C=I(()=>!a.disabled&&a.editable),B=I(()=>a.error||!V.value),h=I(()=>a.complete||a.rules.length>0&&V.value),s=I(()=>B.value?a.errorIcon:h.value?a.completeIcon:n.isSelected.value&&a.editable?a.editIcon:a.icon),y=I(()=>({canEdit:C.value,hasError:B.value,hasCompleted:h.value,title:a.title,subtitle:a.subtitle,step:g.value,value:a.value}));return ae(()=>{var N,D,z;const w=(!n||n.isSelected.value||h.value||C.value)&&!B.value&&!a.disabled,U=!!(a.title!=null||e.title),$=!!(a.subtitle!=null||e.subtitle);function R(){n==null||n.toggle()}return $e(t("button",{class:["v-stepper-item",{"v-stepper-item--complete":h.value,"v-stepper-item--disabled":a.disabled,"v-stepper-item--error":B.value},n==null?void 0:n.selectedClass.value],disabled:!a.editable,type:"button",onClick:R},[x.value&&Be(!0,"v-stepper-item"),t(Ve,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:w?a.color:void 0,size:24},{default:()=>{var E;return[((E=e.icon)==null?void 0:E.call(e,y.value))??(s.value?t(se,{icon:s.value},null):g.value)]}}),t("div",{class:"v-stepper-item__content"},[U&&t("div",{key:"title",class:"v-stepper-item__title"},[((N=e.title)==null?void 0:N.call(e,y.value))??a.title]),$&&t("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[((D=e.subtitle)==null?void 0:D.call(e,y.value))??a.subtitle]),(z=e.default)==null?void 0:z.call(e,y.value)])]),[[We("ripple"),a.ripple&&a.editable,null]])}),{}}}),Ut=J({...Ue(ot(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),Dt=te()({name:"VStepperWindow",props:Ut(),emits:{"update:modelValue":a=>!0},setup(a,T){let{slots:e}=T;const n=Le(ie,null),g=Te(a,"modelValue"),V=I({get(){var x;return g.value!=null||!n?g.value:(x=n.items.value.find(C=>n.selected.value.includes(C.id)))==null?void 0:x.value},set(x){g.value=x}});return ae(()=>{const x=ve.filterProps(a);return t(ve,oe({_as:"VStepperWindow"},x,{modelValue:V.value,"onUpdate:modelValue":C=>V.value=C,class:["v-stepper-window",a.class],style:a.style,mandatory:!1,touch:!1}),e)}),{}}}),Rt=J({...it()},"VStepperWindowItem"),Ft=te()({name:"VStepperWindowItem",props:Rt(),setup(a,T){let{slots:e}=T;return ae(()=>{const n=_e.filterProps(a);return t(_e,oe({_as:"VStepperWindowItem"},n,{class:["v-stepper-window-item",a.class],style:a.style}),e)}),{}}}),Nt=J({altLabels:Boolean,bgColor:String,completeIcon:Z,editIcon:Z,editable:Boolean,errorIcon:Z,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...Ge()},"Stepper"),zt=J({...Nt(),...Me({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...tt(),...ze(ye(),["prevText","nextText"])},"VStepper"),Mt=te()({name:"VStepper",props:zt(),emits:{"update:modelValue":a=>!0},setup(a,T){let{slots:e}=T;const{items:n,next:g,prev:V,selected:x}=De(a,ie),{displayClasses:C,mobile:B}=Re(a),{completeIcon:h,editIcon:s,errorIcon:y,color:w,editable:U,prevText:$,nextText:R}=Fe(a),N=I(()=>a.items.map((E,H)=>{const b=ne(E,a.itemTitle,E),j=ne(E,a.itemValue,H+1);return{title:b,value:j,raw:E}})),D=I(()=>n.value.findIndex(E=>x.value.includes(E.id))),z=I(()=>a.disabled?a.disabled:D.value===0?"prev":D.value===n.value.length-1?"next":!1);return Ne({VStepperItem:{editable:U,errorIcon:y,completeIcon:h,editIcon:s,prevText:$,nextText:R},VStepperActions:{color:w,disabled:z,prevText:$,nextText:R}}),ae(()=>{const E=de.filterProps(a),H=!!(e.header||a.items.length),b=a.items.length>0,j=!a.hideActions&&!!(b||e.actions);return t(de,oe(E,{color:a.bgColor,class:["v-stepper",{"v-stepper--alt-labels":a.altLabels,"v-stepper--flat":a.flat,"v-stepper--non-linear":a.nonLinear,"v-stepper--mobile":B.value},C.value,a.class],style:a.style}),{default:()=>{var q,i;return[H&&t(Bt,{key:"stepper-header"},{default:()=>[N.value.map((v,d)=>{let{raw:L,...X}=v;return t(he,null,[!!d&&t(ge,null,null),t(Tt,X,{default:e[`header-item.${X.value}`]??e.header,icon:e.icon,title:e.title,subtitle:e.subtitle})])})]}),b&&t(Dt,{key:"stepper-window"},{default:()=>[N.value.map(v=>t(Ft,{value:v.value},{default:()=>{var d,L;return((d=e[`item.${v.value}`])==null?void 0:d.call(e,v))??((L=e.item)==null?void 0:L.call(e,v))}}))]}),(q=e.default)==null?void 0:q.call(e,{prev:V,next:g}),j&&(((i=e.actions)==null?void 0:i.call(e,{next:g,prev:V}))??t(Wt,{key:"stepper-actions","onClick:prev":V,"onClick:next":g},e))]}})}),{prev:V,next:g}}}),Gt={class:"text-h4 font-weight-bold"},jt={class:"text-body-1 text-medium-emphasis"},Ot={key:0},Ht={class:"text-h6 mb-6"},qt={class:"text-caption"},Qt={key:1},Xt={class:"text-h6 mb-4"},Zt={key:2},Jt={class:"text-h6 mb-4"},Kt={class:"mb-2"},Yt={class:"mb-2"},ea={class:"mb-2"},ta={class:"mb-2"},aa={key:0,class:"mb-2"},la={class:"mb-2"},sa={key:1,class:"mb-2"},oa={class:"d-flex justify-space-between"},ia={class:"d-flex gap-2"},le=3,Ga=pe({__name:"create",setup(a){const T=je(),{t:e}=fe(),n=be(),{showSuccess:g,showError:V}=we(),{errors:x,set:C,clear:B}=Je(),{safePush:h}=Ke(),s=W({user_id:"",amount:null,method:"bank_transfer",notes:"",commission_ids:[]}),y=W("manual"),w=W(0),U=W(!1),$=W([]),R=W(!1),N=W([]),D=W(!1),z=W(),E=I(()=>[{title:e("dashboard"),to:"/admin/dashboard"},{title:e("finance"),disabled:!0},{title:e("admin_withdrawals_title"),to:"/admin/withdrawals"},{title:e("admin_withdrawals_create"),disabled:!0}]),H=I(()=>{if(b.value!==le||!s.value.user_id)return!1;const f=s.value.commission_ids.length>0,c=w.value>0&&y.value==="auto";return f||c}),b=W(1),j=f=>{var c,u;return((c=x.value)==null?void 0:c[f])&&((u=x.value[f])==null?void 0:u.length)>0},q=f=>{var c;return((c=x.value)==null?void 0:c[f])||[]},i=async f=>{var c,u;R.value=!0;try{const k=new URLSearchParams;f&&k.append("q",f),k.append("per_page","50"),k.append("role","affiliate");const S=`/admin/users${k.toString()?`?${k.toString()}`:""}`;console.log("🔍 [Create Withdrawal] Fetching users from:",S);const A=await Ze(S);console.log("📥 [Create Withdrawal] API Response:",A),A!=null&&A.users||(c=A==null?void 0:A.data)!=null&&c.users?($.value=A.users||((u=A.data)==null?void 0:u.users)||[],console.log("✅ [Create Withdrawal] Users loaded:",$.value.length)):(console.error("❌ [Create Withdrawal] API returned error:",A),V((A==null?void 0:A.message)||e("errors.users_loading_error")))}catch(k){console.error("🚫 [Create Withdrawal] Error fetching users:",k),V(e("errors.users_loading_error"))}finally{R.value=!1}},v=async()=>{if(b.value<le){if(z.value){const{valid:f}=await z.value.validate();if(!f)return}b.value++}},d=()=>{b.value>1&&b.value--},L=async()=>{var c,u,k;if(!H.value)return;const{valid:f}=await((c=z.value)==null?void 0:c.validate());if(f){U.value=!0,B();try{const S={user_id:s.value.user_id,method:s.value.method,notes:s.value.notes||void 0};y.value==="auto"&&w.value>0?(S.amount=w.value,S.mode="auto"):s.value.commission_ids.length>0&&(S.commission_ids=s.value.commission_ids,S.mode="manual"),console.log("🔄 [Create Withdrawal] Submitting:",S);const A=await n.create(S);A.success?(g(A.message||e("admin_withdrawals_create_success")),await h(`/admin/withdrawals/${(u=A.data)==null?void 0:u.id}`)):V(A.message||e("admin_withdrawals_create_error"))}catch(S){console.error("🚫 [Create Withdrawal] Error:",S),(k=S.data)!=null&&k.errors?C(S.data.errors):V(e("admin_withdrawals_create_error_general"))}finally{U.value=!1}}},X=async()=>{console.log("🔄 [Create Withdrawal] Cancelling, navigating to withdrawals list");try{await h("/admin/withdrawals")}catch(f){console.error("🚫 [Create Withdrawal] Error during cancel navigation:",f),T.push("/admin/withdrawals").catch(console.error)}};return Oe(()=>{console.log("🧹 [Create Withdrawal] Component unmounting"),U.value=!1,R.value=!1}),Q(()=>s.value.user_id,async f=>{var c;if(s.value.commission_ids=[],w.value=0,!f){N.value=[];return}D.value=!0;try{const u=await n.fetchEligibleCommissions(f),k=Array.isArray((c=u==null?void 0:u.data)==null?void 0:c.data)?u.data.data:Array.isArray(u==null?void 0:u.data)?u.data:[];N.value=k,console.log("✅ [Create Withdrawal] Loaded eligible commissions:",N.value.length)}catch(u){console.error("❌ [Create Withdrawal] Error loading commissions:",u),V(e("errors.commissions_loading_error"))}finally{D.value=!1}},{immediate:!0}),He((f,c,u)=>{console.log("🔄 [Create Withdrawal] Leaving component, navigating to:",f==null?void 0:f.path),U.value=!1,R.value=!1,u()}),i(),(f,c)=>(P(),F("div",null,[t(Ye,{items:E.value},null,8,["items"]),t(G,{class:"mb-6"},{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[m("h1",Gt,r(o(e)("admin_withdrawals_create_new")),1),m("p",jt,r(o(e)("admin_withdrawals_create_description")),1)]),_:1})]),_:1}),t(Y,{class:"mb-6"},{default:l(()=>[t(ee,null,{default:l(()=>[t(Mt,{modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=u=>b.value=u),items:[{title:o(e)("admin_withdrawals_step_select_affiliate"),subtitle:o(e)("admin_withdrawals_step_select_affiliate_subtitle")},{title:o(e)("admin_withdrawals_step_select_commissions"),subtitle:o(e)("admin_withdrawals_step_select_commissions_subtitle")},{title:o(e)("admin_withdrawals_step_confirmation"),subtitle:o(e)("admin_withdrawals_step_confirmation_subtitle")}],flat:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(Y,null,{default:l(()=>[t(ee,null,{default:l(()=>[t(rt,{ref_key:"formRef",ref:z,onSubmit:qe(L,["prevent"])},{default:l(()=>[b.value===1?(P(),F("div",Ot,[m("h3",Ht,r(o(e)("admin_withdrawals_select_affiliate_title")),1),t(G,null,{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[t(nt,{modelValue:s.value.user_id,"onUpdate:modelValue":c[1]||(c[1]=u=>s.value.user_id=u),items:$.value,loading:R.value,"item-title":"nom_complet","item-value":"id",label:o(e)("admin_withdrawals_select_affiliate_label"),placeholder:o(e)("admin_withdrawals_search_affiliate_placeholder"),clearable:"",error:j("user_id"),"error-messages":q("user_id"),"onUpdate:search":i,"onClick:control":i,class:"mb-4"},{item:l(({props:u,item:k})=>[t(ut,Qe(Xe(u)),{prepend:l(()=>[t(Ve,{size:"32",color:"primary"},{default:l(()=>{var S;return[m("span",qt,r((S=k.raw.nom_complet)==null?void 0:S.charAt(0)),1)]}),_:2},1024)]),default:l(()=>[t(dt,null,{default:l(()=>[p(r(k.raw.nom_complet),1)]),_:2},1024),t(ct,null,{default:l(()=>[p(r(k.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","label","placeholder","error","error-messages"])]),_:1})]),_:1}),t(G,null,{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(mt,{modelValue:s.value.method,"onUpdate:modelValue":c[2]||(c[2]=u=>s.value.method=u),items:[{title:o(e)("admin_withdrawals_bank_transfer"),value:"bank_transfer"}],label:o(e)("admin_withdrawals_method"),error:j("method"),"error-messages":q("method")},null,8,["modelValue","items","label","error","error-messages"])]),_:1}),t(_,{cols:"12",md:"6"},{default:l(()=>[t(vt,{modelValue:s.value.notes,"onUpdate:modelValue":c[3]||(c[3]=u=>s.value.notes=u),label:o(e)("admin_withdrawals_notes_optional"),placeholder:o(e)("admin_withdrawals_notes_placeholder"),rows:"3",error:j("notes"),"error-messages":q("notes")},null,8,["modelValue","label","placeholder","error","error-messages"])]),_:1})]),_:1})])):M("",!0),b.value===2&&s.value.user_id?(P(),F("div",Qt,[m("h3",Xt,r(o(e)("admin_withdrawals_commission_selection")),1),t($t,{"user-id":s.value.user_id,"selected-commissions":s.value.commission_ids,"onUpdate:selectedCommissions":c[4]||(c[4]=u=>s.value.commission_ids=u),mode:y.value,"onUpdate:mode":c[5]||(c[5]=u=>y.value=u),"target-amount":w.value,"onUpdate:targetAmount":c[6]||(c[6]=u=>w.value=u)},null,8,["user-id","selected-commissions","mode","target-amount"])])):M("",!0),b.value===3?(P(),F("div",Zt,[m("h3",Jt,r(o(e)("confirmation")),1),t(_t,{color:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[t(se,{icon:"tabler-info-circle",class:"me-2"}),p(" "+r(o(e)("verify_before_creating_withdrawal")),1)]),_:1}),t(G,null,{default:l(()=>[t(_,{cols:"12",md:"6"},{default:l(()=>[t(Y,{variant:"tonal"},{default:l(()=>[t(at,null,{default:l(()=>[p(r(o(e)("withdrawal_information")),1)]),_:1}),t(ee,null,{default:l(()=>{var u,k;return[m("div",Kt,[m("strong",null,r(o(e)("affiliate"))+":",1),p(" "+r((u=$.value.find(S=>S.id===s.value.user_id))==null?void 0:u.nom_complet),1)]),m("div",Yt,[m("strong",null,r(o(e)("email"))+":",1),p(" "+r((k=$.value.find(S=>S.id===s.value.user_id))==null?void 0:k.email),1)]),m("div",ea,[m("strong",null,r(o(e)("method"))+":",1),p(" "+r(s.value.method==="bank_transfer"?o(e)("bank_transfer"):s.value.method),1)]),m("div",ta,[m("strong",null,r(o(e)("selection_mode"))+":",1),p(" "+r(y.value==="auto"?o(e)("automatic"):o(e)("manual")),1)]),y.value==="auto"?(P(),F("div",aa,[m("strong",null,r(o(e)("target_amount"))+":",1),p(" "+r(Number(w.value).toFixed(2))+" MAD ",1)])):M("",!0),m("div",la,[m("strong",null,r(o(e)("selected_commissions"))+":",1),p(" "+r(s.value.commission_ids.length),1)]),s.value.notes?(P(),F("div",sa,[m("strong",null,r(o(e)("notes"))+":",1),p(" "+r(s.value.notes),1)])):M("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])):M("",!0),t(G,{class:"mt-6"},{default:l(()=>[t(_,{cols:"12"},{default:l(()=>[m("div",oa,[m("div",null,[b.value>1?(P(),K(O,{key:0,variant:"tonal",onClick:d},{default:l(()=>[p(r(o(e)("actions.previous")),1)]),_:1})):M("",!0)]),m("div",ia,[t(O,{variant:"tonal",onClick:X},{default:l(()=>[p(r(o(e)("actions.cancel")),1)]),_:1}),b.value<le?(P(),K(O,{key:0,color:"primary",disabled:b.value===1&&!s.value.user_id,onClick:v},{default:l(()=>[p(r(o(e)("actions.next")),1)]),_:1},8,["disabled"])):M("",!0),b.value===le?(P(),K(O,{key:1,color:"primary",loading:U.value,disabled:!H.value,type:"submit"},{default:l(()=>[p(r(o(e)("admin_withdrawals_create_withdrawal")),1)]),_:1},8,["loading","disabled"])):M("",!0)])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]))}});export{Ga as default};
