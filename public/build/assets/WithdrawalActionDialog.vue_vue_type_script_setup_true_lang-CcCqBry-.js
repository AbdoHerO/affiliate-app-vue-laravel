import{V as K}from"./VChip-B84WcmDa.js";import{d as W,aL as q,g as A,o as m,f as s,s as h,t as p,r as d,V as f,w as O,b as t,az as P,l as E,e as c,aU as Q,c as k,m as u,ac as I,ai as X}from"./main-uLG9IIeX.js";import{u as Y}from"./withdrawals-CIZKjV5q.js";import{u as Z}from"./useNotifications-DDBS_wPD.js";import{V as ee}from"./VDialog-DU1pBIct.js";import{V as ae,b as te,c as re}from"./VCard-CB1gT6RB.js";import{V as le}from"./VCardText-BZtszuIK.js";import{V as R}from"./VAlert-TgguXW_5.js";import{V as oe}from"./VForm-C9FiqBHN.js";import{V as L}from"./VTextarea-BuIc6d95.js";import{V as T}from"./VTextField-Dxeq5kx5.js";import{V as se,a as M}from"./VRow-aGfXYx3U.js";import{V as ie}from"./VFileInput-D1Glyc4K.js";import{V as ne}from"./VSpacer-BCNmCEP9.js";const De=W({__name:"WithdrawalStatusBadge",props:{status:{},color:{default:void 0}},setup(g){const C=g,{t:r}=q(),_=i=>{switch(i){case"pending":return r("admin_withdrawals_pending");case"approved":return r("admin_withdrawals_approved");case"in_payment":return r("admin_withdrawals_in_payment");case"paid":return r("admin_withdrawals_paid");case"rejected":return r("admin_withdrawals_rejected");case"canceled":return r("admin_withdrawals_canceled");default:return i}},w={pending:"warning",approved:"info",in_payment:"primary",paid:"success",rejected:"error",canceled:"secondary"},j=i=>C.color||w[i]||"secondary";return(i,l)=>(m(),A(K,{color:j(i.status),variant:"tonal",size:"small"},{default:s(()=>[h(p(_(i.status)),1)]),_:1},8,["color"]))}}),de={class:"d-flex justify-space-between align-center"},ce={class:"text-body-1 font-weight-medium"},ue={class:"text-body-2"},me={class:"text-end"},pe={class:"text-h6"},_e={class:"text-caption"},we={key:0},ve={key:1},fe={key:2},he={key:3},Ne=W({__name:"WithdrawalActionDialog",props:{isVisible:{type:Boolean},withdrawal:{},action:{}},emits:["update:isVisible","success","closed"],setup(g,{emit:C}){const r=g,_=C,w=Y(),{showSuccess:j,showError:i}=Z(),{t:l}=q(),F=d(!1),V=d(""),v=d(""),n=d(""),b=d(""),S=d(null),y=d(!1),z=f(()=>{switch(r.action){case"approve":return l("admin_withdrawals_approve_withdrawal");case"reject":return l("admin_withdrawals_reject_withdrawal");case"mark_in_payment":return l("admin_withdrawals_mark_in_payment");case"mark_paid":return l("admin_withdrawals_mark_paid");default:return l("actions.action")}}),G=f(()=>{switch(r.action){case"approve":return"tabler-check";case"reject":return"tabler-x";case"mark_in_payment":return"tabler-clock";case"mark_paid":return"tabler-credit-card";default:return"tabler-help"}}),x=f(()=>{switch(r.action){case"approve":return"success";case"reject":return"error";case"mark_in_payment":return"primary";case"mark_paid":return"success";default:return"primary"}}),J=f(()=>{switch(r.action){case"approve":return l("actions.approve");case"reject":return l("actions.reject");case"mark_in_payment":return l("admin_withdrawals_mark_in_payment_short");case"mark_paid":return l("admin_withdrawals_mark_paid_short");default:return l("actions.confirm")}}),U=f(()=>{switch(r.action){case"reject":return v.value.trim().length>0;default:return!0}});O(()=>r.isVisible,e=>{e&&($(),y.value=!1)});const $=()=>{V.value="",v.value="",n.value="",b.value="",S.value=null},B=async()=>{y.value||(y.value=!0,_("update:isVisible",!1),await X(),_("closed"),y.value=!1)},H=e=>{const a=e.target;a.files&&a.files.length>0&&(S.value=a.files[0])},D=async()=>{if(!(!U.value||!r.withdrawal)){F.value=!0;try{let e;switch(r.action){case"approve":e=await w.approve(r.withdrawal.id,{note:V.value||void 0});break;case"reject":e=await w.reject(r.withdrawal.id,{reason:v.value});break;case"mark_in_payment":e=await w.markInPayment(r.withdrawal.id,{payment_ref:n.value||void 0});break;case"mark_paid":e=await w.markPaid(r.withdrawal.id,{payment_ref:n.value||void 0,paid_at:b.value||void 0,evidence:S.value||void 0});break;default:throw new Error("Action non supportée")}e.success?(j(e.message),_("success"),await B()):i(e.message)}catch{i(l("admin_withdrawal_action_error"))}finally{F.value=!1}}};return(e,a)=>(m(),A(ee,{"model-value":e.isVisible,"max-width":"600",persistent:"","onUpdate:modelValue":a[5]||(a[5]=o=>_("update:isVisible",o)),"onClick:outside":B},{default:s(()=>[t(ae,null,{default:s(()=>[t(te,{class:"d-flex align-center gap-2"},{default:s(()=>[t(P,{icon:G.value,color:x.value},null,8,["icon","color"]),h(" "+p(z.value),1)]),_:1}),t(le,null,{default:s(()=>[e.withdrawal?(m(),A(R,{key:0,color:x.value,variant:"tonal",class:"mb-4"},{default:s(()=>{var o,N;return[c("div",de,[c("div",null,[c("div",ce,p((o=e.withdrawal.user)==null?void 0:o.nom_complet),1),c("div",ue,p((N=e.withdrawal.user)==null?void 0:N.email),1)]),c("div",me,[c("div",pe,p(e.withdrawal.amount)+" MAD",1),c("div",_e,p(e.withdrawal.commission_count)+" commission(s)",1)])])]}),_:1},8,["color"])):E("",!0),t(oe,{onSubmit:Q(D,["prevent"])},{default:s(()=>[e.action==="approve"?(m(),k("div",we,[t(L,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=o=>V.value=o),label:u(l)("admin_withdrawals_note_optional"),placeholder:u(l)("admin_withdrawals_note_placeholder"),rows:"3","auto-grow":""},null,8,["modelValue","label","placeholder"])])):e.action==="reject"?(m(),k("div",ve,[t(L,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=o=>v.value=o),label:u(l)("admin_withdrawals_reject_reason"),placeholder:u(l)("admin_withdrawals_reject_placeholder"),rows:"3","auto-grow":"",rules:[o=>!!o||"La raison est requise"],required:""},null,8,["modelValue","label","placeholder","rules"])])):e.action==="mark_in_payment"?(m(),k("div",fe,[t(T,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=o=>n.value=o),label:u(l)("admin_withdrawals_payment_reference_optional"),placeholder:"REF-12345"},null,8,["modelValue","label"])])):e.action==="mark_paid"?(m(),k("div",he,[t(se,null,{default:s(()=>[t(M,{cols:"12",md:"6"},{default:s(()=>[t(T,{modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=o=>n.value=o),label:u(l)("admin_withdrawals_payment_reference"),placeholder:"REF-12345"},null,8,["modelValue","label"])]),_:1}),t(M,{cols:"12",md:"6"},{default:s(()=>[t(T,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=o=>b.value=o),label:u(l)("admin_withdrawals_payment_date"),type:"datetime-local"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(ie,{label:"Preuve de paiement (optionnelle)",accept:"image/*,.pdf","prepend-icon":"tabler-paperclip",onChange:H}),t(R,{color:"info",variant:"tonal",class:"mt-2"},{default:s(()=>[t(P,{icon:"tabler-info-circle",class:"me-2"}),a[6]||(a[6]=h(" Formats acceptés: PDF, JPG, PNG (max 5MB) "))]),_:1,__:[6]})])):E("",!0)]),_:1})]),_:1}),t(re,null,{default:s(()=>[t(ne),t(I,{variant:"tonal",onClick:B},{default:s(()=>a[7]||(a[7]=[h(" Annuler ")])),_:1,__:[7]}),t(I,{color:x.value,loading:F.value,disabled:!U.value,onClick:D},{default:s(()=>[h(p(J.value),1)]),_:1},8,["color","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}});export{De as _,Ne as a};
