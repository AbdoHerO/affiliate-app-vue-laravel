import{d as G,aL as J,r as c,V as A,D as Q,c as E,o as U,e as r,b as a,t as n,m as o,f as t,s as m,ac as V,az as h,cD as W,g as X,aU as Y,b5 as z}from"./main-uLG9IIeX.js";import{b as F,V as x,c as Z}from"./VCard-CB1gT6RB.js";import{V as k}from"./VCardText-BZtszuIK.js";import{V as I}from"./VDataTableServer-DfLBg0lg.js";import{V as $}from"./VChip-B84WcmDa.js";import{V as S,a as u}from"./VRow-aGfXYx3U.js";import{V as b}from"./VTextField-Dxeq5kx5.js";import{V as N}from"./VSelect-sWnAtot-.js";import{V as j}from"./VAvatar-bHPDEsYY.js";import{V as ee}from"./VForm-C9FiqBHN.js";import{V as ae}from"./VTextarea-BuIc6d95.js";import{V as te}from"./VSpacer-BCNmCEP9.js";import{V as le}from"./VDialog-DU1pBIct.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VImg-BS6_svHJ.js";import"./VDataTable-DNqSzzrc.js";import"./VPagination-DYW6O4lq.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VField-CfH1YcVv.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";import"./VDivider-UqGR4x4D.js";/* empty css              */import"./VList-uZDByhc2.js";import"./ssrBoot-BPhRU-mF.js";import"./dialog-transition-2hF0ajsQ.js";import"./VMenu-DP1p-55V.js";const se={class:"d-flex justify-space-between align-center mb-6"},oe={class:"text-h4 font-weight-bold mb-1"},ie={class:"text-body-1 mb-0"},ne={class:"d-flex gap-2"},re={class:"d-flex align-center"},de={class:"font-weight-medium"},me={class:"text-body-2 text-medium-emphasis"},ue={class:"text-truncate",style:{"max-width":"200px"}},pe={key:1,class:"text-medium-emphasis"},ce={class:"d-flex align-center"},fe={class:"text-body-2"},_e={class:"text-center py-8"},ve={class:"text-h6 mb-2"},be={class:"text-body-2"},Je=G({__name:"dispensations",setup(Ve){const{t:l}=J(),C=c(!1),q=c([]),f=c({current_page:1,last_page:1,per_page:15,total:0}),d=c({search:"",affiliate_id:"",start_date:"",end_date:"",min_points:"",max_points:""}),g=c(!1),p=c({affiliate_id:"",points:"",comment:"",reference:""}),B=c([]),w=c([]),D=c(!1),K=A(()=>[{title:l("affiliate"),key:"referrer_affiliate",sortable:!1},{title:l("points"),key:"points",sortable:!0},{title:l("comment"),key:"comment",sortable:!1},{title:l("reference"),key:"reference",sortable:!1},{title:l("created_by"),key:"created_by_admin",sortable:!1},{title:l("date"),key:"created_at",sortable:!0},{title:l("actions"),key:"actions",sortable:!1}]),L=A(()=>[{title:l("name"),key:"nom_complet",sortable:!0},{title:l("email"),key:"email",sortable:!0},{title:l("current_points"),key:"profil_affilie.points",sortable:!0},{title:l("total_commissions"),key:"total_commissions",sortable:!0},{title:l("actions"),key:"actions",sortable:!1}]),y=async(i=1)=>{C.value=!0;try{const s={page:i,per_page:f.value.per_page,...d.value};Object.keys(s).forEach(v=>{(s[v]===""||s[v]===null)&&delete s[v]});const e=await z.get("/admin/referrals/dispensations",{params:s});e.data.success&&(q.value=e.data.data,f.value=e.data.pagination)}catch(s){console.error("Failed to fetch dispensations:",s)}finally{C.value=!1}},M=async()=>{D.value=!0;try{const i=await z.get("/admin/affiliates",{params:{per_page:100}});i.data.success&&(B.value=i.data.data,w.value=i.data.data.map(s=>{var e;return{value:((e=s.profil_affilie)==null?void 0:e.id)||s.id,title:`${s.nom_complet} (${s.email})`}}))}catch(i){console.error("Failed to fetch affiliates:",i)}finally{D.value=!1}},_=()=>{f.value.current_page=1,y()},O=()=>{d.value={search:"",affiliate_id:"",start_date:"",end_date:"",min_points:"",max_points:""},y()},R=(i=null)=>{var s,e;p.value={affiliate_id:((s=i==null?void 0:i.profil_affilie)==null?void 0:s.id)||"",points:((e=i==null?void 0:i.profil_affilie)==null?void 0:e.points)||"100",comment:i?`Bonus pour ${i.nom_complet}`:"",reference:`REF-${Date.now()}`},g.value=!0},T=async()=>{try{(await z.post("/admin/referrals/dispensations",p.value)).data.success&&(g.value=!1,y())}catch(i){console.error("Failed to create dispensation:",i)}},H=i=>new Date(i).toLocaleDateString(),P=i=>`${i} pts`;return Q(()=>{y(),M()}),(i,s)=>(U(),E("div",null,[r("div",se,[r("div",null,[r("h1",oe,n(o(l)("dispensations_management")),1),r("p",ie,n(o(l)("dispensations_subtitle")),1)])]),a(x,{class:"mb-6"},{default:t(()=>[a(F,null,{default:t(()=>[m(n(o(l)("affiliates_list")),1)]),_:1}),a(k,null,{default:t(()=>[a(I,{headers:L.value,items:B.value,loading:D.value,"item-value":"id",class:"text-no-wrap"},{"item.profil_affilie.points":t(({item:e})=>[a($,{color:"primary",size:"small"},{default:t(()=>{var v;return[m(n(((v=e.profil_affilie)==null?void 0:v.points)||0)+" pts ",1)]}),_:2},1024)]),"item.actions":t(({item:e})=>[a(V,{color:"primary",size:"small",onClick:v=>R(e)},{default:t(()=>[a(h,{start:"",icon:"tabler-plus"}),m(" "+n(o(l)("create_dispensation")),1)]),_:2},1032,["onClick"])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),a(x,{class:"mb-6"},{default:t(()=>[a(F,null,{default:t(()=>[m(n(o(l)("filters")),1)]),_:1}),a(k,null,{default:t(()=>[a(S,null,{default:t(()=>[a(u,{cols:"12",md:"3"},{default:t(()=>[a(b,{modelValue:d.value.search,"onUpdate:modelValue":s[0]||(s[0]=e=>d.value.search=e),label:o(l)("search"),placeholder:o(l)("search_comment_reference"),"prepend-inner-icon":"tabler-search",clearable:"",onKeyup:W(_,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),a(u,{cols:"12",md:"3"},{default:t(()=>[a(N,{modelValue:d.value.affiliate_id,"onUpdate:modelValue":[s[1]||(s[1]=e=>d.value.affiliate_id=e),_],items:w.value,label:o(l)("affiliate"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),a(u,{cols:"12",md:"2"},{default:t(()=>[a(b,{modelValue:d.value.min_points,"onUpdate:modelValue":s[2]||(s[2]=e=>d.value.min_points=e),type:"number",label:o(l)("min_points"),onChange:_},null,8,["modelValue","label"])]),_:1}),a(u,{cols:"12",md:"2"},{default:t(()=>[a(b,{modelValue:d.value.max_points,"onUpdate:modelValue":s[3]||(s[3]=e=>d.value.max_points=e),type:"number",label:o(l)("max_points"),onChange:_},null,8,["modelValue","label"])]),_:1}),a(u,{cols:"12",md:"2"},{default:t(()=>[r("div",ne,[a(V,{color:"primary",onClick:_},{default:t(()=>[m(n(o(l)("search")),1)]),_:1}),a(V,{variant:"outlined",onClick:O},{default:t(()=>[m(n(o(l)("clear")),1)]),_:1})])]),_:1})]),_:1}),a(S,{class:"mt-2"},{default:t(()=>[a(u,{cols:"12",md:"3"},{default:t(()=>[a(b,{modelValue:d.value.start_date,"onUpdate:modelValue":s[4]||(s[4]=e=>d.value.start_date=e),type:"date",label:o(l)("start_date"),onChange:_},null,8,["modelValue","label"])]),_:1}),a(u,{cols:"12",md:"3"},{default:t(()=>[a(b,{modelValue:d.value.end_date,"onUpdate:modelValue":s[5]||(s[5]=e=>d.value.end_date=e),type:"date",label:o(l)("end_date"),onChange:_},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1}),a(x,null,{default:t(()=>[a(k,null,{default:t(()=>[a(I,{page:f.value.current_page,"onUpdate:page":[s[6]||(s[6]=e=>f.value.current_page=e),y],headers:K.value,items:q.value,"items-length":f.value.total,"items-per-page":f.value.per_page,loading:C.value,class:"text-no-wrap"},{"item.referrer_affiliate":t(({item:e})=>[r("div",re,[a(j,{size:"32",class:"me-3",color:"primary",variant:"tonal"},{default:t(()=>[a(h,{icon:"tabler-user-star"})]),_:1}),r("div",null,[r("div",de,n(e.referrer_affiliate.utilisateur.nom_complet),1),r("div",me,n(e.referrer_affiliate.utilisateur.email),1)])])]),"item.points":t(({item:e})=>[a($,{color:"success",size:"small"},{default:t(()=>[m(n(P(e.points)),1)]),_:2},1024)]),"item.comment":t(({item:e})=>[r("div",ue,n(e.comment),1)]),"item.reference":t(({item:e})=>[e.reference?(U(),X($,{key:0,color:"info",size:"small",variant:"outlined"},{default:t(()=>[m(n(e.reference),1)]),_:2},1024)):(U(),E("span",pe,"-"))]),"item.created_by_admin":t(({item:e})=>[r("div",ce,[a(j,{size:"24",class:"me-2",color:"secondary",variant:"tonal"},{default:t(()=>[a(h,{icon:"tabler-shield",size:"16"})]),_:1}),r("span",fe,n(e.created_by_admin.nom_complet),1)])]),"item.created_at":t(({item:e})=>[m(n(H(e.created_at)),1)]),"item.actions":t(({item:e})=>[a(V,{icon:"tabler-eye",size:"small",variant:"text",onClick:()=>i.$router.push({name:"admin-referrals-dispensations-id",params:{id:e.id}})},null,8,["onClick"])]),"no-data":t(()=>[r("div",_e,[a(h,{icon:"tabler-gift-off",size:"64",class:"mb-4",color:"disabled"}),r("h6",ve,n(o(l)("no_dispensations")),1),r("p",be,n(o(l)("no_dispensations_description")),1)])]),_:1},8,["page","headers","items","items-length","items-per-page","loading"])]),_:1})]),_:1}),a(le,{modelValue:g.value,"onUpdate:modelValue":s[12]||(s[12]=e=>g.value=e),"max-width":"600"},{default:t(()=>[a(x,null,{default:t(()=>[a(F,null,{default:t(()=>[m(n(o(l)("create_dispensation")),1)]),_:1}),a(k,null,{default:t(()=>[a(ee,{onSubmit:Y(T,["prevent"])},{default:t(()=>[a(S,null,{default:t(()=>[a(u,{cols:"12"},{default:t(()=>[a(N,{modelValue:p.value.affiliate_id,"onUpdate:modelValue":s[7]||(s[7]=e=>p.value.affiliate_id=e),items:w.value,label:o(l)("affiliate"),rules:[e=>!!e||o(l)("affiliate_required")],required:""},null,8,["modelValue","items","label","rules"])]),_:1}),a(u,{cols:"12"},{default:t(()=>[a(b,{modelValue:p.value.points,"onUpdate:modelValue":s[8]||(s[8]=e=>p.value.points=e),type:"number",label:o(l)("points"),rules:[e=>!!e||o(l)("points_required"),e=>e>0||o(l)("points_must_be_positive"),e=>e<=1e4||o(l)("points_max_limit")],required:""},null,8,["modelValue","label","rules"])]),_:1}),a(u,{cols:"12"},{default:t(()=>[a(ae,{modelValue:p.value.comment,"onUpdate:modelValue":s[9]||(s[9]=e=>p.value.comment=e),label:o(l)("comment"),rules:[e=>!!e||o(l)("comment_required"),e=>e.length>=10||o(l)("comment_min_length")],rows:"3",required:""},null,8,["modelValue","label","rules"])]),_:1}),a(u,{cols:"12"},{default:t(()=>[a(b,{modelValue:p.value.reference,"onUpdate:modelValue":s[10]||(s[10]=e=>p.value.reference=e),label:o(l)("reference_optional"),placeholder:o(l)("campaign_code_or_reference")},null,8,["modelValue","label","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Z,null,{default:t(()=>[a(te),a(V,{variant:"outlined",onClick:s[11]||(s[11]=e=>g.value=!1)},{default:t(()=>[m(n(o(l)("cancel")),1)]),_:1}),a(V,{color:"primary",onClick:T},{default:t(()=>[m(n(o(l)("create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Je as default};
