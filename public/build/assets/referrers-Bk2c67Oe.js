import{d as le,aL as se,r as c,V as J,w as ne,D as oe,c as K,o as T,e as r,b as e,t as i,m as n,f as t,az as h,s as u,ac as w,g as ie,aU as re,b5 as R}from"./main-uLG9IIeX.js";import{a as m,V as k}from"./VRow-aGfXYx3U.js";import{V as f,b as S,c as O}from"./VCard-CB1gT6RB.js";import{V as v}from"./VCardText-BZtszuIK.js";import{V as g}from"./VTextField-Dxeq5kx5.js";import{V as N}from"./VSelect-sWnAtot-.js";import{V as q}from"./VSpacer-BCNmCEP9.js";import{V as D}from"./VChip-B84WcmDa.js";import{V as P}from"./VDataTable-DNqSzzrc.js";import{V as de}from"./VAvatar-bHPDEsYY.js";import{V as ue}from"./VImg-BS6_svHJ.js";import{V as me}from"./VForm-C9FiqBHN.js";import{V as _e}from"./VTextarea-BuIc6d95.js";import{V as Q}from"./VDialog-DU1pBIct.js";/* empty css              */import"./createSimpleFunctional-DugzUcbB.js";import"./VField-CfH1YcVv.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./VList-uZDByhc2.js";import"./ssrBoot-BPhRU-mF.js";import"./VDivider-UqGR4x4D.js";import"./dialog-transition-2hF0ajsQ.js";import"./VMenu-DP1p-55V.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VPagination-DYW6O4lq.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";const pe={class:"d-flex justify-space-between align-center mb-6"},ce={class:"text-h4 mb-1"},fe={class:"text-body-1 mb-0"},ve={class:"d-flex align-center"},be={class:"text-sm text-medium-emphasis mb-0"},ge={class:"text-h6"},xe={class:"d-flex align-center"},he={class:"text-sm text-medium-emphasis mb-0"},Ve={class:"text-h6"},ye={class:"d-flex align-center"},we={class:"text-sm text-medium-emphasis mb-0"},ke={class:"text-h6"},Ce={class:"d-flex align-center"},Ie={class:"text-sm text-medium-emphasis mb-0"},Ue={class:"text-h6"},ze={class:"d-flex gap-3"},De={class:"d-flex align-center"},Fe={key:1},$e={class:"font-weight-medium mb-0"},Le={class:"text-sm text-medium-emphasis mb-0"},Re={class:"font-weight-medium text-success"},Se={class:"font-weight-medium text-warning"},Ae={class:"d-flex gap-2"},Be={class:"text-center py-8"},Ee={class:"text-h6 mb-2"},Me={class:"text-body-1"},Te={class:"text-sm text-medium-emphasis mb-1"},Ne={class:"text-h6 text-success"},qe={class:"text-sm text-medium-emphasis mb-1"},He={class:"text-h6 text-warning"},je={class:"text-sm text-medium-emphasis mb-1"},Ge={class:"text-h6 text-info"},Je={class:"text-truncate",style:{"max-width":"200px"}},Ke={class:"text-center py-4"},yt=le({__name:"referrers",setup(Oe){const{t:s}=se(),A=c(!1),V=c([]),B=c([]),C=c({total_referrers:0,total_points_earned:0,total_points_dispensed:0,total_points_balance:0,total_verified_signups:0,total_signups:0,recent_dispensations:[]}),d=c({search:"",min_balance:"",max_balance:"",min_earned:"",max_earned:"",min_signups:"",max_signups:"",has_dispensations:"",sort_by:"points_balance",sort_order:"desc"}),I=c(!1),y=c(null),x=c({affiliate_id:"",points:0,comment:"",reference:""}),E=c(!1),F=c(!1),U=c({dispensations:[],pagination:{},summary:{}}),M=c(!1),W=J(()=>[{title:s("affiliate"),key:"user",sortable:!1},{title:s("verified_signups"),key:"verified_signups",sortable:!0},{title:s("total_signups"),key:"total_signups",sortable:!0},{title:s("points_earned"),key:"points_earned",sortable:!0},{title:s("points_dispensed"),key:"points_dispensed",sortable:!0},{title:s("points_balance"),key:"points_balance",sortable:!0},{title:s("actions"),key:"actions",sortable:!1}]),H=J(()=>{let o=[...B.value];if(d.value.search){const l=d.value.search.toLowerCase();o=o.filter(a=>a.user.nom_complet.toLowerCase().includes(l)||a.user.email.toLowerCase().includes(l))}if(d.value.min_balance&&(o=o.filter(l=>l.points_balance>=parseInt(d.value.min_balance))),d.value.max_balance&&(o=o.filter(l=>l.points_balance<=parseInt(d.value.max_balance))),d.value.min_earned&&(o=o.filter(l=>l.points_earned>=parseInt(d.value.min_earned))),d.value.max_earned&&(o=o.filter(l=>l.points_earned<=parseInt(d.value.max_earned))),d.value.min_signups&&(o=o.filter(l=>l.total_signups>=parseInt(d.value.min_signups))),d.value.max_signups&&(o=o.filter(l=>l.total_signups<=parseInt(d.value.max_signups))),d.value.has_dispensations!==""){const l=d.value.has_dispensations==="true";o=o.filter(a=>l?a.points_dispensed>0:a.points_dispensed===0)}return o.sort((l,a)=>{const _=d.value.sort_by,$=d.value.sort_order==="desc"?-1:1;let z,L;return _==="user_name"?(z=l.user.nom_complet,L=a.user.nom_complet):(z=l[_],L=a[_]),typeof z=="string"?z.localeCompare(L)*$:(z-L)*$}),o}),X=async()=>{A.value=!0;try{const o=await R.get("/admin/referrers");o.data.success&&(B.value=o.data.data,V.value=o.data.data)}catch(o){console.error("Error fetching referrers:",o)}finally{A.value=!1}},p=()=>{V.value=H.value},Y=()=>{d.value={search:"",min_balance:"",max_balance:"",min_earned:"",max_earned:"",min_signups:"",max_signups:"",has_dispensations:"",sort_by:"points_balance",sort_order:"desc"},p()},j=async()=>{try{const o=await R.get("/admin/referrers/statistics");o.data.success&&(C.value=o.data.data)}catch(o){console.error("Error fetching statistics:",o)}},Z=o=>{y.value=o,x.value={affiliate_id:o.id,points:o.points_balance,comment:s("points_dispensation_for_user",{name:o.user.nom_complet}),reference:`REF-${Date.now()}`},I.value=!0},G=async()=>{E.value=!0;try{const o=await R.post("/admin/referrers/dispensations",x.value);if(o.data.success){if(I.value=!1,y.value){const l=V.value.findIndex(a=>a.id===y.value.id);if(l!==-1){const a=o.data.data.updated_summary;V.value[l].points_dispensed+=x.value.points,V.value[l].points_balance=a.balance}}j(),console.log("Dispensation created successfully")}}catch(o){console.error("Error creating dispensation:",o)}finally{E.value=!1}},ee=async o=>{y.value=o,F.value=!0,M.value=!0;try{const l=await R.get(`/admin/referrers/${o.id}/dispensations`);l.data.success&&(U.value=l.data.data)}catch(l){console.error("Error fetching dispensation history:",l)}finally{M.value=!1}},b=o=>new Intl.NumberFormat("fr-FR").format(o),te=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ae=o=>o===0?"grey":o<100?"orange":o<500?"blue":"green";return ne(H,o=>{V.value=o},{immediate:!0}),oe(()=>{X(),j()}),(o,l)=>(T(),K("div",null,[r("div",pe,[r("div",null,[r("h4",ce,i(n(s)("referrers_management")),1),r("p",fe,i(n(s)("manage_affiliate_points_and_dispensations")),1)])]),e(k,{class:"mb-6"},{default:t(()=>[e(m,{cols:"12",md:"3"},{default:t(()=>[e(f,null,{default:t(()=>[e(v,null,{default:t(()=>[r("div",ve,[e(h,{color:"primary",size:"40",class:"me-4"},{default:t(()=>l[17]||(l[17]=[u("tabler-users")])),_:1,__:[17]}),r("div",null,[r("p",be,i(n(s)("total_referrers")),1),r("h6",ge,i(C.value.total_referrers||0),1)])])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:t(()=>[e(f,null,{default:t(()=>[e(v,null,{default:t(()=>[r("div",xe,[e(h,{color:"success",size:"40",class:"me-4"},{default:t(()=>l[18]||(l[18]=[u("tabler-coins")])),_:1,__:[18]}),r("div",null,[r("p",he,i(n(s)("total_points_earned")),1),r("h6",Ve,i(b(C.value.total_points_earned||0)),1)])])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:t(()=>[e(f,null,{default:t(()=>[e(v,null,{default:t(()=>[r("div",ye,[e(h,{color:"warning",size:"40",class:"me-4"},{default:t(()=>l[19]||(l[19]=[u("tabler-gift")])),_:1,__:[19]}),r("div",null,[r("p",we,i(n(s)("total_points_dispensed")),1),r("h6",ke,i(b(C.value.total_points_dispensed||0)),1)])])]),_:1})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:t(()=>[e(f,null,{default:t(()=>[e(v,null,{default:t(()=>[r("div",Ce,[e(h,{color:"info",size:"40",class:"me-4"},{default:t(()=>l[20]||(l[20]=[u("tabler-wallet")])),_:1,__:[20]}),r("div",null,[r("p",Ie,i(n(s)("total_points_balance")),1),r("h6",Ue,i(b(C.value.total_points_balance||0)),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{class:"mb-6"},{default:t(()=>[e(S,null,{default:t(()=>[u(i(n(s)("filters")),1)]),_:1}),e(v,null,{default:t(()=>[e(k,null,{default:t(()=>[e(m,{cols:"12",md:"4"},{default:t(()=>[e(g,{modelValue:d.value.search,"onUpdate:modelValue":l[0]||(l[0]=a=>d.value.search=a),label:n(s)("search"),placeholder:n(s)("search_by_name_email"),"prepend-inner-icon":"tabler-search",clearable:"",onInput:p},null,8,["modelValue","label","placeholder"])]),_:1}),e(m,{cols:"12",md:"2"},{default:t(()=>[e(g,{modelValue:d.value.min_balance,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.min_balance=a),label:n(s)("min_balance"),type:"number",min:"0",onInput:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"2"},{default:t(()=>[e(g,{modelValue:d.value.max_balance,"onUpdate:modelValue":l[2]||(l[2]=a=>d.value.max_balance=a),label:n(s)("max_balance"),type:"number",min:"0",onInput:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"2"},{default:t(()=>[e(g,{modelValue:d.value.min_earned,"onUpdate:modelValue":l[3]||(l[3]=a=>d.value.min_earned=a),label:n(s)("min_earned"),type:"number",min:"0",onInput:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"2"},{default:t(()=>[e(g,{modelValue:d.value.max_earned,"onUpdate:modelValue":l[4]||(l[4]=a=>d.value.max_earned=a),label:n(s)("max_earned"),type:"number",min:"0",onInput:p},null,8,["modelValue","label"])]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(m,{cols:"12",md:"2"},{default:t(()=>[e(g,{modelValue:d.value.min_signups,"onUpdate:modelValue":l[5]||(l[5]=a=>d.value.min_signups=a),label:n(s)("min_signups"),type:"number",min:"0",onInput:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"2"},{default:t(()=>[e(g,{modelValue:d.value.max_signups,"onUpdate:modelValue":l[6]||(l[6]=a=>d.value.max_signups=a),label:n(s)("max_signups"),type:"number",min:"0",onInput:p},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12",md:"3"},{default:t(()=>[e(N,{modelValue:d.value.has_dispensations,"onUpdate:modelValue":[l[7]||(l[7]=a=>d.value.has_dispensations=a),p],items:[{value:"",title:n(s)("all")},{value:"true",title:n(s)("with_dispensations")},{value:"false",title:n(s)("without_dispensations")}],label:n(s)("dispensation_status")},null,8,["modelValue","items","label"])]),_:1}),e(m,{cols:"12",md:"3"},{default:t(()=>[e(N,{modelValue:d.value.sort_by,"onUpdate:modelValue":[l[8]||(l[8]=a=>d.value.sort_by=a),p],items:[{value:"points_balance",title:n(s)("points_balance")},{value:"points_earned",title:n(s)("points_earned")},{value:"points_dispensed",title:n(s)("points_dispensed")},{value:"total_signups",title:n(s)("total_signups")},{value:"verified_signups",title:n(s)("verified_signups")},{value:"user_name",title:n(s)("name")}],label:n(s)("sort_by")},null,8,["modelValue","items","label"])]),_:1}),e(m,{cols:"12",md:"2"},{default:t(()=>[e(N,{modelValue:d.value.sort_order,"onUpdate:modelValue":[l[9]||(l[9]=a=>d.value.sort_order=a),p],items:[{value:"desc",title:n(s)("descending")},{value:"asc",title:n(s)("ascending")}],label:n(s)("sort_order")},null,8,["modelValue","items","label"])]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>[r("div",ze,[e(w,{color:"primary",onClick:p},{default:t(()=>[e(h,{start:"",icon:"tabler-filter"}),u(" "+i(n(s)("apply_filters")),1)]),_:1}),e(w,{variant:"outlined",onClick:Y},{default:t(()=>[e(h,{start:"",icon:"tabler-filter-off"}),u(" "+i(n(s)("reset_filters")),1)]),_:1}),e(q),e(D,{color:"info",size:"small"},{default:t(()=>[u(i(n(s)("showing_results",{count:V.value.length,total:B.value.length})),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(S,null,{default:t(()=>[u(i(n(s)("referrers_list")),1)]),_:1}),e(v,null,{default:t(()=>[e(P,{headers:W.value,items:V.value,loading:A.value,"item-value":"id",class:"text-no-wrap"},{"item.user":t(({item:a})=>[r("div",De,[e(de,{size:"32",class:"me-3"},{default:t(()=>{var _;return[a.user.photo_profil?(T(),ie(ue,{key:0,src:a.user.photo_profil},null,8,["src"])):(T(),K("span",Fe,i(((_=a.user.nom_complet)==null?void 0:_.charAt(0))||"A"),1))]}),_:2},1024),r("div",null,[r("p",$e,i(a.user.nom_complet),1),r("p",Le,i(a.user.email),1)])])]),"item.verified_signups":t(({item:a})=>[e(D,{color:"success",size:"small"},{default:t(()=>[u(i(a.verified_signups),1)]),_:2},1024)]),"item.total_signups":t(({item:a})=>[e(D,{color:"info",size:"small"},{default:t(()=>[u(i(a.total_signups),1)]),_:2},1024)]),"item.points_earned":t(({item:a})=>[r("span",Re,i(b(a.points_earned))+" pts ",1)]),"item.points_dispensed":t(({item:a})=>[r("span",Se,i(b(a.points_dispensed))+" pts ",1)]),"item.points_balance":t(({item:a})=>[e(D,{color:ae(a.points_balance),size:"small"},{default:t(()=>[u(i(b(a.points_balance))+" pts ",1)]),_:2},1032,["color"])]),"item.actions":t(({item:a})=>[r("div",Ae,[e(w,{color:"primary",size:"small",disabled:a.points_balance===0,onClick:_=>Z(a)},{default:t(()=>[e(h,{start:"",icon:"tabler-gift"}),u(" "+i(n(s)("dispense")),1)]),_:2},1032,["disabled","onClick"]),e(w,{color:"info",variant:"outlined",size:"small",onClick:_=>ee(a)},{default:t(()=>[e(h,{start:"",icon:"tabler-history"}),u(" "+i(n(s)("history")),1)]),_:2},1032,["onClick"])])]),"no-data":t(()=>[r("div",Be,[e(h,{size:"64",color:"grey",class:"mb-4"},{default:t(()=>l[21]||(l[21]=[u("tabler-users-off")])),_:1,__:[21]}),r("h6",Ee,i(n(s)("no_referrers_found")),1),r("p",Me,i(n(s)("no_referrers_found_message")),1)])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),e(Q,{modelValue:I.value,"onUpdate:modelValue":l[14]||(l[14]=a=>I.value=a),"max-width":"600"},{default:t(()=>[e(f,null,{default:t(()=>[e(S,null,{default:t(()=>[u(i(n(s)("dispense_points")),1)]),_:1}),e(v,null,{default:t(()=>[e(me,{onSubmit:re(G,["prevent"])},{default:t(()=>[e(k,null,{default:t(()=>[e(m,{cols:"12"},{default:t(()=>{var a,_;return[e(g,{"model-value":(_=(a=y.value)==null?void 0:a.user)==null?void 0:_.nom_complet,label:n(s)("affiliate"),readonly:"",variant:"outlined"},null,8,["model-value","label"])]}),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>{var a,_;return[e(g,{modelValue:x.value.points,"onUpdate:modelValue":l[10]||(l[10]=$=>x.value.points=$),label:n(s)("points_to_dispense"),hint:`${n(s)("max_balance")}: ${((a=y.value)==null?void 0:a.points_balance)||0} pts`,type:"number",min:1,max:((_=y.value)==null?void 0:_.points_balance)||0,variant:"outlined",required:""},null,8,["modelValue","label","hint","max"])]}),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(g,{modelValue:x.value.reference,"onUpdate:modelValue":l[11]||(l[11]=a=>x.value.reference=a),label:n(s)("reference"),variant:"outlined"},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(_e,{modelValue:x.value.comment,"onUpdate:modelValue":l[12]||(l[12]=a=>x.value.comment=a),label:n(s)("comment"),placeholder:n(s)("dispensation_comment_placeholder"),variant:"outlined",rows:"3",required:""},null,8,["modelValue","label","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),e(O,null,{default:t(()=>[e(q),e(w,{variant:"outlined",onClick:l[13]||(l[13]=a=>I.value=!1)},{default:t(()=>[u(i(n(s)("cancel")),1)]),_:1}),e(w,{color:"primary",loading:E.value,onClick:G},{default:t(()=>[u(i(n(s)("dispense_points")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:F.value,"onUpdate:modelValue":l[16]||(l[16]=a=>F.value=a),"max-width":"800"},{default:t(()=>[e(f,null,{default:t(()=>[e(S,null,{default:t(()=>{var a,_;return[u(i(n(s)("dispensation_history"))+" - "+i((_=(a=y.value)==null?void 0:a.user)==null?void 0:_.nom_complet),1)]}),_:1}),e(v,null,{default:t(()=>[e(k,{class:"mb-4"},{default:t(()=>[e(m,{cols:"4"},{default:t(()=>[e(f,{variant:"outlined"},{default:t(()=>[e(v,{class:"text-center"},{default:t(()=>{var a;return[r("p",Te,i(n(s)("points_earned")),1),r("h6",Ne,i(b(((a=U.value.summary)==null?void 0:a.earned)||0)),1)]}),_:1})]),_:1})]),_:1}),e(m,{cols:"4"},{default:t(()=>[e(f,{variant:"outlined"},{default:t(()=>[e(v,{class:"text-center"},{default:t(()=>{var a;return[r("p",qe,i(n(s)("points_dispensed")),1),r("h6",He,i(b(((a=U.value.summary)==null?void 0:a.dispensed)||0)),1)]}),_:1})]),_:1})]),_:1}),e(m,{cols:"4"},{default:t(()=>[e(f,{variant:"outlined"},{default:t(()=>[e(v,{class:"text-center"},{default:t(()=>{var a;return[r("p",je,i(n(s)("points_balance")),1),r("h6",Ge,i(b(((a=U.value.summary)==null?void 0:a.balance)||0)),1)]}),_:1})]),_:1})]),_:1})]),_:1}),e(P,{headers:[{title:n(s)("date"),key:"created_at"},{title:n(s)("points"),key:"points"},{title:n(s)("comment"),key:"comment"},{title:n(s)("reference"),key:"reference"},{title:n(s)("admin"),key:"created_by_admin"}],items:U.value.dispensations,loading:M.value,"item-value":"id",class:"text-no-wrap"},{"item.created_at":t(({item:a})=>[u(i(te(a.created_at)),1)]),"item.points":t(({item:a})=>[e(D,{color:"warning",size:"small"},{default:t(()=>[u(i(b(a.points))+" pts ",1)]),_:2},1024)]),"item.comment":t(({item:a})=>[r("span",Je,i(a.comment),1)]),"item.created_by_admin":t(({item:a})=>{var _;return[u(i(((_=a.created_by_admin)==null?void 0:_.nom_complet)||"N/A"),1)]}),"no-data":t(()=>[r("div",Ke,[r("p",null,i(n(s)("no_dispensations_found")),1)])]),_:1},8,["headers","items","loading"])]),_:1}),e(O,null,{default:t(()=>[e(q),e(w,{onClick:l[15]||(l[15]=a=>F.value=!1)},{default:t(()=>[u(i(n(s)("close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{yt as default};
