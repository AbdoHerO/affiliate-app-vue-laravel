import{d as ae,aL as se,u as ie,k as oe,b8 as le,r as S,V as w,o as re,c as _,b as r,e as i,m as T,n as e,f as o,aU as ce,v as s,h as p,g as l,t as n,ac as x,F as P,j as U,az as M,aW as ne,ai as E}from"./main-BGmfaZsq.js";import{u as de}from"./tickets-CHHnbtkA.js";import{u as ue}from"./useNotifications-TnKci45M.js";import{useQuickConfirm as fe}from"./useConfirmAction-BkzLltMc.js";import{u as me}from"./useTicketBadge-_Zy7V4fI.js";import{_ as _e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cd38G7fQ.js";import{C as pe}from"./ConfirmActionDialog-BIIpHLew.js";import{V as g}from"./VChip-S_h5DeIW.js";import{b as G,V as H,c as ge}from"./VCard-hQ_o7lvO.js";import{V as K}from"./VCardText-BzdllyhI.js";import{V as he}from"./VAvatar-CXniQsPN.js";import{V as ke}from"./VDivider-oo2GmB8o.js";import{V as ve}from"./VForm-9k5StL4q.js";import{V as be}from"./VTextarea-Dm9Swusq.js";import{V as xe}from"./VFileInput-BLh4W2ou.js";import{V as ye}from"./VSpacer-B4IQn0G0.js";import{V as Ve}from"./VAlert-CPLjIjOe.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-CopD15QX.js";import"./VBreadcrumbs-CXXoPXro.js";import"./VDialog-DIYcXxVx.js";import"./VOverlay-CvSSR2rW.js";import"./forwardRefs-BxxmAO9z.js";import"./lazy-DgLfxsl0.js";import"./VImg-6pMKiBpi.js";import"./dialog-transition-BhMeiVQ2.js";import"./createSimpleFunctional-BjWjRu3X.js";import"./VField-BqE6uwOn.js";/* empty css              */const we={key:0,class:"text-center py-8"},Te={class:"text-body-1 mt-4"},Be={key:1},ze={class:"d-flex justify-space-between align-center mb-6"},Se={class:"text-h4 font-weight-bold mb-1"},Me={class:"d-flex align-center gap-4"},De={class:"text-body-2 text-medium-emphasis"},Fe={class:"d-flex gap-2"},Le={class:"d-flex align-start gap-3"},Ae={class:"flex-grow-1"},Ie={class:"d-flex align-center justify-space-between mb-2"},Ne={class:"font-weight-medium"},Re={class:"text-caption text-medium-emphasis"},je={class:"message-content"},qe={class:"text-body-1 mb-2",style:{"white-space":"pre-wrap"}},Pe={key:0,class:"attachments"},Ue={class:"text-subtitle-2 mb-2"},Ee={class:"d-flex flex-wrap gap-2"},Ge={class:"text-caption text-medium-emphasis mt-1"},He={key:2,class:"text-center py-8"},Ke={class:"text-h6 mb-2"},Qe={class:"text-body-2 text-medium-emphasis mb-4"},We=ae({__name:"index",setup($e){const{t}=se(),h=ie(),D=oe(),{showSuccess:B,showError:k}=ue(),u=fe(),{confirm:F}=u,{refresh:Q}=me(),f=de(),{currentTicket:c,loading:y,error:L}=le(f),v=S(""),z=S([]),V=S(),W=w(()=>{var a;return[{title:t("nav.dashboard"),to:"/affiliate/dashboard"},{title:t("affiliate_tickets_title"),to:"/affiliate/tickets"},{title:t("affiliate_tickets_detail_title",{id:(a=h.params.id)==null?void 0:a.toString().slice(-8)}),active:!0}]}),$=w(()=>{var a;return((a=c.value)==null?void 0:a.status)!=="closed"}),J=w(()=>{var a;return((a=c.value)==null?void 0:a.status)==="closed"}),O=w(()=>{var a;return(a=c.value)!=null&&a.messages?[...c.value.messages].sort((m,d)=>new Date(m.created_at).getTime()-new Date(d.created_at).getTime()):[]}),X=async()=>{try{await f.fetchTicket(h.params.id),await E(),I()}catch{k(t("errors.ticket_load_failed")),D.push({name:"affiliate-tickets"})}},Y=a=>{const m=a.target;m.files&&(z.value=Array.from(m.files))},A=async()=>{if(!v.value.trim()){k(t("errors.message_required"));return}try{await f.addMessage(h.params.id,{message:v.value,attachments:z.value}),v.value="",z.value=[],B(t("affiliate_tickets_message_success")),Q(),await E(),I()}catch(a){k(a.message||t("errors.message_add_failed"))}},Z=async()=>{try{await F({title:t("affiliate_tickets_close_title"),text:t("affiliate_tickets_close_text"),icon:"tabler-lock",color:"warning"})&&(await f.updateTicketStatus(h.params.id,"closed"),B(t("affiliate_tickets_close_success")))}catch(a){k(a.message||t("errors.ticket_close_failed"))}},ee=async()=>{try{await F({title:t("affiliate_tickets_reopen_title"),text:t("affiliate_tickets_reopen_text"),icon:"tabler-lock-open",color:"info"})&&(await f.updateTicketStatus(h.params.id,"open"),B(t("affiliate_tickets_reopen_success")))}catch(a){k(a.message||t("errors.ticket_reopen_failed"))}},I=()=>{V.value&&(V.value.scrollTop=V.value.scrollHeight)},N=a=>new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),te=a=>{if(a===0)return"0 Bytes";const m=1024,d=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(a)/Math.log(m));return parseFloat((a/Math.pow(m,b)).toFixed(2))+" "+d[b]},R=()=>{D.push({name:"affiliate-tickets"})};return re(()=>{X()}),(a,m)=>(r(),_("div",null,[i(_e,{items:W.value},null,8,["items"]),e(y).detail?(r(),_("div",we,[i(ce,{indeterminate:"",color:"primary",size:"64"}),o("p",Te,s(e(t)("affiliate_tickets_loading")),1)])):e(c)?(r(),_("div",Be,[o("div",ze,[o("div",null,[o("h1",Se,s(e(c).subject),1),o("div",Me,[i(g,{color:e(f).getStatusColor(e(c).status),variant:"tonal"},{default:l(()=>[n(s(e(f).getStatusLabel(e(c).status)),1)]),_:1},8,["color"]),i(g,{color:e(f).getPriorityColor(e(c).priority),variant:"tonal",size:"small"},{default:l(()=>[n(s(e(f).getPriorityLabel(e(c).priority)),1)]),_:1},8,["color"]),i(g,{color:"info",variant:"tonal",size:"small"},{default:l(()=>[n(s(e(f).getCategoryLabel(e(c).category)),1)]),_:1}),o("span",De,s(e(t)("affiliate_tickets_created_on",{date:N(e(c).created_at)})),1)])]),o("div",Fe,[J.value?(r(),p(x,{key:0,color:"info",variant:"outlined","prepend-icon":"tabler-lock-open",loading:e(y).status,onClick:ee},{default:l(()=>[n(s(e(t)("actions.reopen")),1)]),_:1},8,["loading"])):T("",!0),$.value?(r(),p(x,{key:1,color:"warning",variant:"outlined","prepend-icon":"tabler-lock",loading:e(y).status,onClick:Z},{default:l(()=>[n(s(e(t)("actions.close")),1)]),_:1},8,["loading"])):T("",!0),i(x,{variant:"outlined","prepend-icon":"tabler-arrow-left",onClick:R},{default:l(()=>[n(s(e(t)("actions.back")),1)]),_:1})])]),i(H,{class:"mb-6"},{default:l(()=>[i(G,null,{default:l(()=>[n(s(e(t)("affiliate_tickets_conversation")),1)]),_:1}),i(K,null,{default:l(()=>[o("div",{ref_key:"messagesContainer",ref:V,class:"messages-container",style:{"max-height":"500px","overflow-y":"auto"}},[(r(!0),_(P,null,U(O.value,d=>{var b,j,q;return r(),_("div",{key:d.id,class:"message mb-4"},[o("div",Le,[i(he,{size:"40"},{default:l(()=>[i(M,{icon:"tabler-user"})]),_:1}),o("div",Ae,[o("div",Ie,[o("div",null,[o("span",Ne,s(((b=d.sender)==null?void 0:b.nom_complet)||e(t)("support")),1),((j=d.sender)==null?void 0:j.id)===e(c).requester_id?(r(),p(g,{key:0,size:"x-small",color:"primary",variant:"tonal",class:"ml-2"},{default:l(()=>[n(s(e(t)("affiliate_tickets_you")),1)]),_:1})):(r(),p(g,{key:1,size:"x-small",color:"success",variant:"tonal",class:"ml-2"},{default:l(()=>[n(s(e(t)("affiliate_tickets_support")),1)]),_:1}))]),o("span",Re,s(N(d.created_at)),1)]),o("div",je,[o("p",qe,s(d.body),1),(q=d.attachments)!=null&&q.length?(r(),_("div",Pe,[o("h4",Ue,s(e(t)("affiliate_tickets_attachments"))+":",1),o("div",Ee,[(r(!0),_(P,null,U(d.attachments,C=>(r(),p(g,{key:C.id,size:"small",variant:"outlined","prepend-icon":"tabler-paperclip",clickable:"",color:"primary",href:C.url,target:"_blank",component:"a"},{default:l(()=>[i(M,{icon:"tabler-download",size:"16",class:"me-1"}),n(" "+s(C.original_name)+" ("+s(te(C.size))+") ",1)]),_:2},1032,["href"]))),128))])])):T("",!0)])])]),i(ke,{class:"mt-4"})])}),128))],512)]),_:1})]),_:1}),e(c).status!=="closed"?(r(),p(H,{key:0},{default:l(()=>[i(G,null,{default:l(()=>[n(s(e(t)("affiliate_tickets_add_reply")),1)]),_:1}),i(K,null,{default:l(()=>[i(ve,{onSubmit:ne(A,["prevent"])},{default:l(()=>[i(be,{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=d=>v.value=d),label:e(t)("affiliate_tickets_your_message"),placeholder:e(t)("affiliate_tickets_message_placeholder"),rows:"4",counter:"5000",maxlength:"5000",required:""},null,8,["modelValue","label","placeholder"]),i(xe,{label:e(t)("affiliate_tickets_attachments_optional"),multiple:"",accept:"image/*,.pdf,.doc,.docx,.txt","prepend-icon":"tabler-paperclip",class:"mt-4",onChange:Y},null,8,["label"]),o("p",Ge,s(e(t)("affiliate_tickets_file_formats")),1)]),_:1})]),_:1}),i(ge,null,{default:l(()=>[i(ye),i(x,{color:"primary","prepend-icon":"tabler-send",loading:e(y).message,onClick:A},{default:l(()=>[n(s(e(t)("actions.send")),1)]),_:1},8,["loading"])]),_:1})]),_:1})):(r(),p(Ve,{key:1,type:"info",variant:"tonal",class:"mt-6"},{default:l(()=>[n(s(e(t)("affiliate_tickets_closed_notice")),1)]),_:1}))])):e(L)?(r(),_("div",He,[i(M,{icon:"tabler-alert-circle",size:"64",class:"text-error mb-4"}),o("h3",Ke,s(e(t)("general.error")),1),o("p",Qe,s(e(L)),1),i(x,{color:"primary",onClick:R},{default:l(()=>[n(s(e(t)("affiliate_tickets_back_to_tickets")),1)]),_:1})])):T("",!0),i(pe,{"is-dialog-visible":e(u).isDialogVisible.value,"is-loading":e(u).isLoading.value,"dialog-title":e(u).dialogTitle.value,"dialog-text":e(u).dialogText.value,"dialog-icon":e(u).dialogIcon.value,"dialog-color":e(u).dialogColor.value,"confirm-button-text":e(u).confirmButtonText.value,"cancel-button-text":e(u).cancelButtonText.value,onConfirm:e(u).handleConfirm,onCancel:e(u).handleCancel},null,8,["is-dialog-visible","is-loading","dialog-title","dialog-text","dialog-icon","dialog-color","confirm-button-text","cancel-button-text","onConfirm","onCancel"])]))}}),Ct=Ce(We,[["__scopeId","data-v-c564706e"]]);export{Ct as default};
