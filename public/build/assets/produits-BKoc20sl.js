import{b5 as F,r as f,ca as $}from"./main-3LuWNv9W.js";import{u as l}from"./useApi-C6mAvy3D.js";const K=F("produits",()=>{const h=f([]),u=f(null),p=f([]),w=f([]),v=f([]),b=f([]),S=f([]),m=f(!1),g=f(null),D=$({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),P=$({q:"",boutique_id:"",categorie_id:"",actif:"",sort:"created_at",dir:"desc",page:1,perPage:15});let y=null;return{produits:h,currentProduit:u,images:p,videos:w,variantes:v,propositions:b,ruptures:S,loading:m,error:g,pagination:D,filters:P,fetchProduits:async(n={})=>{y&&y.abort(),y=new AbortController,m.value=!0;try{const r={...P,...n};Object.keys(r).forEach(c=>{const d=r[c];(d===""||d===null||d===void 0)&&delete r[c]});const a={};Object.entries(r).forEach(([c,d])=>{d!=null&&d!==""&&(a[c]=String(d))});const e=new URLSearchParams(a).toString(),t=`/admin/produits${e?`?${e}`:""}`,{data:s,error:o}=await l(t,{signal:y.signal});if(o.value){const c=o.value.message||"Error fetching products";throw g.value=c,o.value}const i=s.value;i.success?(h.value=i.data,i.meta&&Object.assign(D,{current_page:i.meta.current_page,last_page:i.meta.last_page,per_page:i.meta.per_page,total:i.meta.total,from:i.meta.from||0,to:i.meta.to||0})):g.value=i.message}catch(r){if(r.name!=="AbortError")throw console.error("Failed to fetch produits:",r),r}finally{m.value=!1}},fetchProduit:async n=>{var r,a,e,t,s;m.value=!0;try{console.debug("[Store] Fetching product with ID:",n);const{data:o,error:i}=await l(`/admin/produits/${n}`);if(i.value){const E=i.value.message||"Error fetching product";throw g.value=E,i.value}const c=o.value,d=c.success?c.data:c.data||c;if(d&&d.id)return u.value=d,console.debug("[Store] Product fetched successfully:",{id:d.id,images:((r=d.images)==null?void 0:r.length)||0,videos:((a=d.videos)==null?void 0:a.length)||0,variantes:((e=d.variantes)==null?void 0:e.length)||0,propositions:((t=d.propositions)==null?void 0:t.length)||0,ruptures:((s=d.ruptures)==null?void 0:s.length)||0}),d.images&&(p.value=d.images),d.videos&&(w.value=d.videos),d.variantes&&(v.value=d.variantes),d.propositions&&(b.value=d.propositions),d.ruptures&&(S.value=d.ruptures),d;{const E=c.message||"Invalid product data received";throw g.value=E,new Error(E)}}catch(o){throw console.error("Failed to fetch produit:",o),o}finally{m.value=!1}},createProduit:async n=>{m.value=!0;try{const r={...n};(!r.quantite_min||r.quantite_min<1)&&(r.quantite_min=1),console.debug("[Store] Creating product with data:",r);const{data:a,error:e}=await l("/admin/produits",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(e.value){const s=e.value.message||"Error creating product";throw g.value=s,e.value}const t=a.value;if(t.success)return console.debug("[Store] Product created successfully with ID:",t.data.id),u.value=t.data,h.value.unshift(t.data),t.data;throw g.value=t.message,new Error(t.message)}catch(r){throw console.error("Failed to create produit:",r),r}finally{m.value=!1}},updateProduit:async(n,r)=>{var a;m.value=!0;try{const{data:e,error:t}=await l(`/admin/produits/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(t.value){const o=t.value.message||"Error updating product";throw g.value=o,t.value}const s=e.value;if(s.success){const o=h.value.findIndex(i=>i.id===n);return o!==-1&&(h.value[o]=s.data),((a=u.value)==null?void 0:a.id)===n&&(u.value=s.data),s.data}throw new Error(s.message)}catch(e){throw console.error("Failed to update produit:",e),e}finally{m.value=!1}},deleteProduit:async n=>{var r;m.value=!0;try{const{error:a}=await l(`/admin/produits/${n}`,{method:"DELETE"});if(a.value){const t=a.value.message||"Error deleting product";throw g.value=t,a.value}const e=h.value.findIndex(t=>t.id===n);return e!==-1&&h.value.splice(e,1),((r=u.value)==null?void 0:r.id)===n&&(u.value=null),!0}catch(a){throw console.error("Failed to delete produit:",a),a}finally{m.value=!1}},fetchImages:async n=>{try{const{data:r,error:a}=await l(`/admin/produits/${n}/images`);if(a.value)throw a.value;const e=r.value;return p.value=e.data||[],p.value}catch(r){throw console.error("Failed to fetch images:",r),r}},addImage:async(n,r)=>{var a;try{const{data:e,error:t}=await l(`/admin/produits/${n}/images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(t.value)throw t.value;const s=e.value;if(s.success)return p.value.push(s.data),((a=u.value)==null?void 0:a.id)===n&&u.value.images&&u.value.images.push(s.data),s.data;throw new Error(s.message)}catch(e){throw console.error("Failed to add image:",e),e}},sortImages:async(n,r)=>{var a;try{const{data:e,error:t}=await l(`/admin/produits/${n}/images/sort`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:r})});if(t.value)throw t.value;const s=e.value;if(s.success)return r.forEach(o=>{const i=p.value.find(c=>c.id===o.id);i&&(i.ordre=o.ordre)}),p.value.sort((o,i)=>o.ordre-i.ordre),(a=u.value)!=null&&a.images&&(r.forEach(o=>{const i=u.value.images.find(c=>c.id===o.id);i&&(i.ordre=o.ordre)}),u.value.images.sort((o,i)=>o.ordre-i.ordre)),!0;throw new Error(s.message)}catch(e){throw console.error("Failed to sort images:",e),e}},deleteImage:async(n,r)=>{var a;try{const{data:e,error:t}=await l(`/admin/produits/${n}/images/${r}`,{method:"DELETE"});if(t.value)throw t.value;const s=e.value;if(s.success){const o=p.value.findIndex(i=>i.id===r);if(o!==-1&&p.value.splice(o,1),(a=u.value)!=null&&a.images){const i=u.value.images.findIndex(c=>c.id===r);i!==-1&&u.value.images.splice(i,1)}return!0}throw new Error(s.message)}catch(e){throw console.error("Failed to delete image:",e),e}},clearCurrentProduit:()=>{u.value=null,p.value=[],w.value=[],v.value=[]},resetFilters:()=>{Object.assign(P,{q:"",boutique_id:"",categorie_id:"",actif:"",sort:"created_at",direction:"desc",page:1,per_page:15})},uploadImages:async(n,r)=>{try{const a=r.map(async e=>{const t=new FormData;t.append("file",e);const{data:s}=await l(`/admin/produits/${n}/images/upload`,{method:"POST",body:t,headers:{Accept:"application/json"}}),o=s.value;if(o.success)return p.value.push(o.data),o.data;throw new Error(o.message||"Upload failed")});return await Promise.all(a)}catch(a){throw console.error("Error uploading images:",a),a}},addVideoUrl:async(n,r)=>{try{const{data:a}=await l(`/admin/produits/${n}/videos`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),e=a.value;if(e.success)return w.value.push(e.data),e.data;throw new Error(e.message||"Failed to add video")}catch(a){throw console.error("Error adding video URL:",a),a}},uploadVideos:async(n,r)=>{try{const a=r.map(async e=>{const t=new FormData;t.append("file",e);const{data:s}=await l(`/admin/produits/${n}/videos/upload`,{method:"POST",body:t,headers:{Accept:"application/json"}}),o=s.value;if(o.success)return w.value.push(o.data),o.data;throw new Error(o.message||"Upload failed")});return await Promise.all(a)}catch(a){throw console.error("Error uploading videos:",a),a}},deleteVideo:async(n,r)=>{try{const{data:a}=await l(`/admin/produits/${n}/videos/${r}`,{method:"DELETE"}),e=a.value;if(e.success){const t=w.value.findIndex(s=>s.id===r);return t!==-1&&w.value.splice(t,1),!0}throw new Error(e.message||"Failed to delete video")}catch(a){throw console.error("Error deleting video:",a),a}},createVariant:async(n,r)=>{try{const{data:a}=await l(`/admin/produits/${n}/variantes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),e=a.value;if(e.success)return v.value.push(e.data),e.data;throw new Error(e.message||"Failed to create variant")}catch(a){throw console.error("Error creating variant:",a),a}},updateVariant:async(n,r,a)=>{try{const{data:e}=await l(`/admin/produits/${n}/variantes/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=e.value;if(t.success){const s=v.value.findIndex(o=>o.id===r);return s!==-1&&(v.value[s]=t.data),t.data}throw new Error(t.message||"Failed to update variant")}catch(e){throw console.error("Error updating variant:",e),e}},deleteVariant:async(n,r)=>{try{const{data:a}=await l(`/admin/produits/${n}/variantes/${r}`,{method:"DELETE"}),e=a.value;if(e.success){const t=v.value.findIndex(s=>s.id===r);return t!==-1&&v.value.splice(t,1),!0}throw new Error(e.message||"Failed to delete variant")}catch(a){throw console.error("Error deleting variant:",a),a}},uploadVariantImage:async(n,r,a)=>{try{const e=new FormData;e.append("file",a);const{data:t}=await l(`/admin/produits/${n}/variantes/${r}/image`,{method:"POST",body:e,headers:{Accept:"application/json"}}),s=t.value;if(s.success){const o=v.value.findIndex(i=>i.id===r);return o!==-1&&(v.value[o]={...v.value[o],image_url:s.data.image_url}),s.data}throw new Error(s.message||"Failed to upload variant image")}catch(e){throw console.error("Error uploading variant image:",e),e}}}});export{K as u};
