import{d as J,u as X,k as Y,aL as Z,b7 as tt,b8 as et,V as $,r as E,o as at,c as k,b as m,e as i,n as t,f as n,aU as st,v as s,h as u,m as f,g as e,ac as v,t as h,az as I}from"./main-DEzoUo6n.js";import{u as ot}from"./withdrawals-CXL0ZkbV.js";import{_ as it}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7m1-yvQE.js";import{_ as nt,a as lt}from"./WithdrawalActionDialog.vue_vue_type_script_setup_true_lang-CyY17-da.js";import{A as rt}from"./ActionIcon-Bo-k4-Vl.js";import{useQuickConfirm as dt}from"./useConfirmAction-lawnJ6WL.js";import{u as ct}from"./useNotifications-Bc6GUAmT.js";import{a as p,V as g}from"./VRow-CCKjjrNU.js";import{V,b as C}from"./VCard-BQBmQiQJ.js";import{V as D}from"./VCardText-DtKfeQ8i.js";import{V as mt}from"./VAvatar-DcdpS4jo.js";import{V as _t}from"./VDataTable-CY4RDaZO.js";import{V as B}from"./VChip-BLx6lUDe.js";import"./VBreadcrumbs-GZoY2rRV.js";import"./VDialog-SdVxorIC.js";import"./VOverlay-D7sMErQR.js";import"./forwardRefs-BYcTBJDs.js";import"./lazy-BPEwf1-U.js";import"./VImg-Dcm3Nb79.js";import"./dialog-transition-PfMbSZsR.js";import"./VAlert--Qma1TSN.js";import"./createSimpleFunctional-DUhC6iZd.js";import"./VForm-rtEvNB7m.js";import"./VField-BrxQSdNw.js";import"./VTextarea-BfvN6PTe.js";import"./VTextField-BiqUvfe6.js";import"./VFileInput-4CKii6WE.js";import"./VSpacer-om3XMluz.js";/* empty css              */import"./VTooltip-CxfTaIey.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VPagination-BwetZgLf.js";import"./VSelect-DRK_p5uX.js";import"./VList-PlS4cpk2.js";import"./ssrBoot-BNMsj90G.js";import"./VDivider-96JDmIpb.js";import"./VMenu-CAJpv2vQ.js";import"./VCheckboxBtn-ispl65Ef.js";import"./VTable-pKKqnQcU.js";import"./filter-C0NlBkaG.js";const ut={key:0,class:"text-center py-8"},pt={class:"mt-4"},ht={key:1},ft={class:"d-flex align-center gap-3 mb-2"},wt={class:"text-h4 font-weight-bold"},vt={class:"text-body-1 text-medium-emphasis"},bt={class:"d-flex gap-2 justify-md-end"},yt={class:"text-caption text-medium-emphasis"},xt={class:"text-h6 font-weight-bold"},kt={class:"text-caption text-medium-emphasis"},gt={class:"text-body-1"},Vt={class:"text-caption text-medium-emphasis"},Ct={class:"text-body-1"},Dt={class:"text-caption text-medium-emphasis"},St={class:"text-body-1"},zt={class:"text-caption text-medium-emphasis"},At={class:"text-body-1"},Nt={class:"text-caption text-medium-emphasis"},Tt={class:"text-body-1"},$t={class:"text-caption text-medium-emphasis"},It={class:"text-body-1 font-family-monospace"},Bt={class:"d-flex align-center gap-3 mb-4"},jt={class:"text-h6"},Lt={class:"text-h6"},Wt={class:"text-body-2 text-medium-emphasis"},Et={class:"text-caption text-medium-emphasis"},Mt={class:"text-body-1"},Rt={class:"text-caption text-medium-emphasis"},Ut={class:"text-body-1 font-family-monospace"},Ot={class:"text-caption text-medium-emphasis"},Ft={class:"text-body-1"},Ht={class:"text-body-2",style:{"white-space":"pre-line"}},Kt={class:"text-body-2"},Pt={key:0,class:"d-flex gap-2"},Qt={class:"text-body-2 font-family-monospace"},qt={class:"text-body-2 font-family-monospace"},Gt={key:1,class:"text-medium-emphasis"},Jt={class:"text-body-2 font-weight-medium"},Xt={class:"text-body-2"},Yt={class:"text-center py-8"},Zt={class:"text-center py-8"},te={key:2,class:"text-center py-8"},ee={class:"text-h6 mb-2"},ae={class:"text-body-2 text-medium-emphasis mb-4"},He=J({__name:"index",setup(se){const M=X(),x=Y(),{t:a}=Z(),A=ot();tt();const{confirm:R}=dt(),{showSuccess:N,showError:S}=ct(),{currentWithdrawal:o,loading:U}=et(A),O=$(()=>{const r=M.params.id;return!r||typeof r!="string"||r.trim()===""?(console.error("ðŸš« [Withdrawal Detail] Invalid withdrawal ID:",r),x.push("/admin/withdrawals").catch(console.error),""):r}),b=E([]),y=E({isVisible:!1,withdrawal:null,action:"approve"}),F=$(()=>{var r;return[{title:a("nav_dashboard"),to:"/admin/dashboard"},{title:a("nav_financial_management"),disabled:!0},{title:a("nav_withdrawals"),to:"/admin/withdrawals"},{title:((r=o.value)==null?void 0:r.id.substring(0,8))||a("admin_withdrawals_details"),disabled:!0}]}),H=[{title:a("admin_commissions_title"),key:"commission.id",sortable:!1},{title:a("table_order_id"),key:"commission.commande.id",sortable:!1},{title:"SKU",key:"commission.sku",sortable:!1,width:"150px"},{title:"Type Commande",key:"commission.order_type",sortable:!1},{title:a("admin_withdrawals_amount"),key:"amount",sortable:!1},{title:a("table_status"),key:"commission.status",sortable:!1},{title:a("table_created"),key:"commission.created_at",sortable:!1},{title:a("table_actions"),key:"actions",sortable:!1}],j=$(()=>{var r,d;return((r=o.value)==null?void 0:r.status)==="pending"||((d=o.value)==null?void 0:d.status)==="approved"}),K=r=>({order_sample:"primary",exchange:"warning"})[r]||"secondary",P=r=>({order_sample:"Ã‰chantillon",exchange:"Ã‰change"})[r]||r||"N/A",T=async()=>{try{const r=O.value;if(!r){S(a("invalid_withdrawal_id")),x.push("/admin/withdrawals");return}const d=await A.fetchOne(r);d.success||(S(d.message||a("error_loading_withdrawal")),x.push("/admin/withdrawals"))}catch(r){console.error("Error fetching withdrawal:",r),S(a("error_loading_withdrawal")),x.push("/admin/withdrawals")}},z=r=>{o.value&&(y.value={isVisible:!0,withdrawal:o.value,action:r})},Q=async()=>{try{y.value.isVisible=!1,y.value.withdrawal=null,await T(),N(a("action_successful"))}catch(r){console.error("Error handling action success:",r),S(a("error_updating_data"))}},q=async()=>{if(!o.value||b.value.length===0)return;if(await R({title:a("admin_withdrawals_detach_commissions"),text:a("detach_commissions_confirm",{count:b.value.length}),confirmText:a("detach"),color:"error",type:"danger"})){const d=await A.detachCommissions(o.value.id,{commission_ids:b.value});d.success?(N(d.message),b.value=[],T()):S(d.message)}},G=async()=>{o.value&&N(a("export_in_progress"))},L=()=>{x.push("/admin/withdrawals")};return at(()=>{T()}),(r,d)=>(m(),k("div",null,[i(it,{items:F.value},null,8,["items"]),t(U)?(m(),k("div",ut,[i(st,{indeterminate:"",size:"64"}),n("p",pt,s(t(a)("loading_data")),1)])):t(o)?(m(),k("div",ht,[i(g,{class:"mb-6"},{default:e(()=>[i(p,{cols:"12",md:"6"},{default:e(()=>[n("div",ft,[i(v,{icon:"tabler-arrow-left",variant:"tonal",size:"small",onClick:L}),n("h1",wt,s(t(a)("nav_withdrawals"))+" "+s(t(o).id.substring(0,8)),1),i(nt,{status:t(o).status},null,8,["status"])]),n("p",vt,s(t(a)("admin_withdrawals_details")),1)]),_:1}),i(p,{cols:"12",md:"6",class:"text-md-end"},{default:e(()=>[n("div",bt,[t(o).can_approve?(m(),u(v,{key:0,color:"success",variant:"tonal","prepend-icon":"tabler-check",onClick:d[0]||(d[0]=l=>z("approve"))},{default:e(()=>[h(s(t(a)("admin_withdrawals_approve")),1)]),_:1})):f("",!0),t(o).can_reject?(m(),u(v,{key:1,color:"error",variant:"tonal","prepend-icon":"tabler-x",onClick:d[1]||(d[1]=l=>z("reject"))},{default:e(()=>[h(s(t(a)("admin_withdrawals_reject")),1)]),_:1})):f("",!0),t(o).can_mark_in_payment?(m(),u(v,{key:2,color:"primary",variant:"tonal","prepend-icon":"tabler-clock",onClick:d[2]||(d[2]=l=>z("mark_in_payment"))},{default:e(()=>[h(s(t(a)("admin_withdrawals_mark_in_payment")),1)]),_:1})):f("",!0),t(o).can_mark_paid?(m(),u(v,{key:3,color:"success","prepend-icon":"tabler-credit-card",onClick:d[3]||(d[3]=l=>z("mark_paid"))},{default:e(()=>[h(s(t(a)("admin_withdrawals_mark_paid")),1)]),_:1})):f("",!0),i(v,{variant:"tonal","prepend-icon":"tabler-download",onClick:G},{default:e(()=>[h(s(t(a)("action_download")),1)]),_:1})])]),_:1})]),_:1}),i(g,{class:"mb-6"},{default:e(()=>[i(p,{cols:"12",md:"6"},{default:e(()=>[i(V,null,{default:e(()=>[i(C,null,{default:e(()=>[h(s(t(a)("admin_withdrawals_details")),1)]),_:1}),i(D,null,{default:e(()=>[i(g,null,{default:e(()=>[i(p,{cols:"6"},{default:e(()=>[n("div",yt,s(t(a)("admin_withdrawals_amount")),1),n("div",xt,s(Number(t(o).amount).toFixed(2))+" MAD",1)]),_:1}),i(p,{cols:"6"},{default:e(()=>[n("div",kt,s(t(a)("payment_method")),1),n("div",gt,s(t(o).method==="bank_transfer"?t(a)("bank_transfer"):t(o).method),1)]),_:1}),i(p,{cols:"6"},{default:e(()=>[n("div",Vt,s(t(a)("commissions")),1),n("div",Ct,s(t(a)("commission_count_text",{count:t(o).commission_count})),1)]),_:1}),i(p,{cols:"6"},{default:e(()=>[n("div",Dt,s(t(a)("admin_withdrawals_created_at")),1),n("div",St,s(new Date(t(o).created_at).toLocaleString()),1)]),_:1}),t(o).approved_at?(m(),u(p,{key:0,cols:"6"},{default:e(()=>[n("div",zt,s(t(a)("admin_withdrawals_approved_at")),1),n("div",At,s(new Date(t(o).approved_at).toLocaleString()),1)]),_:1})):f("",!0),t(o).paid_at?(m(),u(p,{key:1,cols:"6"},{default:e(()=>[n("div",Nt,s(t(a)("admin_withdrawals_paid_at")),1),n("div",Tt,s(new Date(t(o).paid_at).toLocaleString()),1)]),_:1})):f("",!0),t(o).payment_ref?(m(),u(p,{key:2,cols:"12"},{default:e(()=>[n("div",$t,s(t(a)("payment_reference")),1),n("div",It,s(t(o).payment_ref),1)]),_:1})):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),i(p,{cols:"12",md:"6"},{default:e(()=>[i(V,null,{default:e(()=>[i(C,null,{default:e(()=>[h(s(t(a)("admin_withdrawals_affiliate_info")),1)]),_:1}),i(D,null,{default:e(()=>{var l,_;return[n("div",Bt,[i(mt,{size:"48",color:"primary"},{default:e(()=>{var c,w;return[n("span",jt,s((w=(c=t(o).user)==null?void 0:c.nom_complet)==null?void 0:w.charAt(0)),1)]}),_:1}),n("div",null,[n("div",Lt,s((l=t(o).user)==null?void 0:l.nom_complet),1),n("div",Wt,s((_=t(o).user)==null?void 0:_.email),1)])]),i(g,null,{default:e(()=>{var c;return[(c=t(o).user)!=null&&c.telephone?(m(),u(p,{key:0,cols:"12"},{default:e(()=>[n("div",Et,s(t(a)("phone")),1),n("div",Mt,s(t(o).user.telephone),1)]),_:1})):f("",!0),t(o).iban_rib?(m(),u(p,{key:1,cols:"12"},{default:e(()=>[n("div",Rt,s(t(a)("rib"))+"/IBAN",1),n("div",Ut,s(t(o).iban_rib),1)]),_:1})):f("",!0),t(o).bank_type?(m(),u(p,{key:2,cols:"12"},{default:e(()=>[n("div",Ot,s(t(a)("bank_type")),1),n("div",Ft,s(t(o).bank_type),1)]),_:1})):f("",!0)]}),_:1})]}),_:1})]),_:1})]),_:1})]),_:1}),t(o).notes||t(o).admin_reason?(m(),u(g,{key:0,class:"mb-6"},{default:e(()=>[t(o).notes?(m(),u(p,{key:0,cols:"12",md:"6"},{default:e(()=>[i(V,null,{default:e(()=>[i(C,null,{default:e(()=>[h(s(t(a)("notes")),1)]),_:1}),i(D,null,{default:e(()=>[n("div",Ht,s(t(o).notes),1)]),_:1})]),_:1})]),_:1})):f("",!0),t(o).admin_reason?(m(),u(p,{key:1,cols:"12",md:"6"},{default:e(()=>[i(V,{color:"error",variant:"tonal"},{default:e(()=>[i(C,null,{default:e(()=>[h(s(t(a)("rejection_reason")),1)]),_:1}),i(D,null,{default:e(()=>[n("div",Kt,s(t(o).admin_reason),1)]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})):f("",!0),t(o).evidence_url?(m(),u(g,{key:1,class:"mb-6"},{default:e(()=>[i(p,{cols:"12"},{default:e(()=>[i(V,null,{default:e(()=>[i(C,null,{default:e(()=>[h(s(t(a)("payment_proof")),1)]),_:1}),i(D,null,{default:e(()=>[i(v,{href:t(o).evidence_url,target:"_blank",color:"primary",variant:"tonal","prepend-icon":"tabler-download"},{default:e(()=>[h(s(t(a)("download_proof")),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0),i(V,null,{default:e(()=>[i(C,{class:"d-flex justify-space-between align-center"},{default:e(()=>{var l;return[n("span",null,s(t(a)("admin_withdrawals_linked_commissions"))+" ("+s(((l=t(o).items)==null?void 0:l.length)||0)+")",1),j.value&&b.value.length>0?(m(),k("div",Pt,[i(v,{color:"error",variant:"tonal",size:"small","prepend-icon":"tabler-unlink",onClick:q},{default:e(()=>[h(s(t(a)("action_detach"))+" ("+s(b.value.length)+") ",1)]),_:1})])):f("",!0)]}),_:1}),t(o).items&&t(o).items.length>0?(m(),u(_t,{key:0,headers:H,items:t(o).items,"show-select":j.value,modelValue:b.value,"onUpdate:modelValue":d[4]||(d[4]=l=>b.value=l),"item-value":"commission.id","items-per-page":"10"},{"item.commission.id":e(({item:l})=>{var _,c;return[n("div",Qt,s((c=(_=l.commission)==null?void 0:_.id)==null?void 0:c.substring(0,8))+"... ",1)]}),"item.commission.commande.id":e(({item:l})=>{var _,c,w;return[n("div",qt,s((w=(c=(_=l.commission)==null?void 0:_.commande)==null?void 0:c.id)==null?void 0:w.substring(0,8))+"... ",1)]}),"item.commission.sku":e(({item:l})=>{var _,c,w;return[(w=(c=(_=l.commission)==null?void 0:_.commande_article)==null?void 0:c.produit)!=null&&w.sku?(m(),u(B,{key:0,size:"small",color:"secondary",variant:"outlined",class:"font-mono"},{default:e(()=>[h(s(l.commission.commande_article.produit.sku),1)]),_:2},1024)):(m(),k("span",Gt,"â€”"))]}),"item.commission.order_type":e(({item:l})=>{var _,c;return[i(B,{size:"small",color:K((c=(_=l.commission)==null?void 0:_.commande_article)==null?void 0:c.type_command),variant:"tonal"},{default:e(()=>{var w,W;return[h(s(P((W=(w=l.commission)==null?void 0:w.commande_article)==null?void 0:W.type_command)),1)]}),_:2},1032,["color"])]}),"item.amount":e(({item:l})=>[n("div",Jt,s(Number(l.amount).toFixed(2))+" MAD ",1)]),"item.commission.status":e(({item:l})=>{var _;return[i(B,{color:((_=l.commission)==null?void 0:_.status)==="paid"?"success":"info",variant:"tonal",size:"small"},{default:e(()=>{var c;return[h(s(((c=l.commission)==null?void 0:c.status)==="paid"?t(a)("status_paid"):t(a)("status_pending")),1)]}),_:2},1032,["color"])]}),"item.commission.created_at":e(({item:l})=>{var _;return[n("div",Xt,s((_=l.commission)!=null&&_.created_at?new Date(l.commission.created_at).toLocaleDateString():"-"),1)]}),"item.actions":e(({item:l})=>[i(rt,{icon:"tabler-eye",label:t(a)("action_view"),tooltip:t(a)("admin_withdrawals_view_commission"),onClick:_=>{var c;return t(x).push(`/admin/commissions/${(c=l.commission)==null?void 0:c.id}`)}},null,8,["label","tooltip","onClick"])]),"no-data":e(()=>[n("div",Yt,[i(I,{icon:"tabler-inbox",size:"48",class:"mb-2"}),n("p",null,s(t(a)("no_commissions_linked")),1)])]),_:1},8,["items","show-select","modelValue"])):(m(),u(D,{key:1},{default:e(()=>[n("div",Zt,[i(I,{icon:"tabler-inbox",size:"48",class:"mb-2"}),n("p",null,s(t(a)("no_commissions_linked")),1)])]),_:1}))]),_:1})])):(m(),k("div",te,[i(I,{icon:"tabler-alert-circle",size:"64",color:"error",class:"mb-4"}),n("h3",ee,s(t(a)("admin_withdrawals_not_found")),1),n("p",ae,s(t(a)("admin_withdrawals_not_found_description")),1),i(v,{color:"primary",onClick:L},{default:e(()=>[h(s(t(a)("admin_withdrawals_back_to_list")),1)]),_:1})])),i(lt,{"is-visible":y.value.isVisible,"onUpdate:isVisible":d[5]||(d[5]=l=>y.value.isVisible=l),withdrawal:y.value.withdrawal,action:y.value.action,onSuccess:Q},null,8,["is-visible","withdrawal","action"])]))}});export{He as default};
