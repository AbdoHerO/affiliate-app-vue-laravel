import{d as Fe,aL as ze,u as Me,k as Ue,r as V,V as j,o as je,cT as Ge,c as b,b as _,f as t,e as a,m as p,aU as le,v as o,n as v,ac as x,h as C,g as l,t as u,az as f,F as ke,j as qe,ai as Ne}from"./main-BW7J9dbc.js";import{u as He}from"./shipping-C1TQJ-A8.js";import{useConfirmAction as Ke}from"./useConfirmAction-C1AhwA5O.js";import{u as We}from"./useNotifications-C-RqLAHj.js";import{O as Ye}from"./OrderStatusTimeline-Kp8zAMry.js";import{V as S}from"./VChip-Dc9HlRo1.js";import{V as se,a as Je}from"./VTabs-GSMjEVVu.js";import{V as oe,a as Qe}from"./VWindowItem-BSLJcrS4.js";import{V as I,b as A,c as Xe}from"./VCard-BBEboEsQ.js";import{V as R}from"./VCardText-CXwuP4rm.js";import{V as K,a as k}from"./VRow-CGHQgNV4.js";import{V as Ze}from"./VDivider-C4kHsR9g.js";import{V as et,a as tt}from"./VTimeline-M1uGP7Nt.js";import{V as at,a as it}from"./VAlert-C-u8vegp.js";import{V as Te}from"./VTextField-DCEu5f_P.js";import{V as lt}from"./VSelect-BbnjVQGu.js";import{V as st}from"./VTextarea-Wxm7h69M.js";import{V as ot}from"./VSpacer-BxZvfEPo.js";import{V as nt}from"./VDialog-BYRvlSU6.js";import"./VExpansionPanels-CaG50yjF.js";import"./lazy-CTr8uHza.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAvatar-CBx3oh99.js";import"./VImg-NyJdDnCF.js";import"./forwardRefs-t39oHzh6.js";import"./ssrBoot-DTcmQToe.js";import"./createSimpleFunctional-468wPgla.js";/* empty css              */import"./VField-ECDxRtcR.js";import"./VList-BrmO1UK3.js";import"./dialog-transition-C3MiiA6M.js";import"./VMenu-DTZ6uDZD.js";import"./VOverlay-CpnKYLAB.js";import"./VCheckboxBtn-BRmrHq-R.js";const rt={class:"d-flex flex-column gap-6"},dt={key:0,class:"text-center py-8"},ut={class:"mt-4"},ct={key:1},_t={class:"d-flex justify-space-between align-center mb-6"},vt={class:"d-flex align-center gap-4"},mt={class:"text-h4 font-weight-bold mb-1"},pt={class:"d-flex align-center gap-2"},ft={class:"d-flex gap-2"},gt={class:"mb-4"},yt={class:"text-body-2 text-medium-emphasis mb-1"},ht={class:"text-h6"},bt={class:"mb-4"},xt={class:"text-body-2 text-medium-emphasis mb-1"},Vt={class:"text-body-1"},kt=["href"],Nt={key:0,class:"mb-4"},Tt={class:"text-body-2 text-medium-emphasis mb-1"},Ct={class:"text-body-1"},wt={class:"mb-4"},St={class:"text-body-2 text-medium-emphasis mb-1"},It={class:"text-h6"},At={class:"mb-4"},Rt={class:"text-body-2 text-medium-emphasis mb-1"},Bt={class:"text-body-1"},Et={key:0,class:"mb-4"},Dt={class:"text-body-2 text-medium-emphasis mb-1"},Ot={class:"text-body-1"},$t={class:"mb-4"},Lt={class:"text-body-2 text-medium-emphasis mb-1"},Pt={class:"text-body-1"},Ft={class:"mb-4"},zt={class:"mb-4"},Mt={class:"text-body-2 text-medium-emphasis mb-1"},Ut={class:"text-body-1"},jt={class:"mb-4"},Gt={class:"text-body-2 text-medium-emphasis mb-1"},qt={class:"text-body-1"},Ht={class:"mb-4"},Kt={class:"text-body-2 text-medium-emphasis mb-1"},Wt={class:"mb-4"},Yt={class:"text-body-2 text-medium-emphasis mb-1"},Jt={class:"text-body-1"},Qt={class:"mb-4"},Xt={class:"text-body-2 text-medium-emphasis mb-1"},Zt={class:"text-h6"},ea={class:"mb-4"},ta={class:"text-body-1"},aa={class:"text-body-1"},ia={class:"text-body-2 text-medium-emphasis mb-1"},la={class:"text-body-1"},sa={class:"text-body-1"},oa={class:"text-body-2"},na={class:"mb-4"},ra={class:"text-body-1"},da={class:"text-caption text-medium-emphasis"},ua={class:"mb-4"},ca={class:"text-body-1"},_a={class:"text-caption text-medium-emphasis"},va={class:"mb-4"},ma={class:"mb-4"},pa={class:"text-body-2 text-medium-emphasis mb-1"},fa={class:"text-h6"},ga={class:"text-center py-8"},ya={key:1},ha={class:"d-flex flex-column flex-md-row align-md-center justify-space-between gap-4 mb-4"},ba={class:"d-flex align-center gap-2"},xa={class:"d-flex align-center gap-2"},Va={key:0,class:"text-body-2 text-medium-emphasis"},ka={class:"mb-3"},Na={class:"text-body-1 font-weight-medium"},Ta={class:"mb-3"},Ca={class:"text-body-1"},wa={class:"mb-3"},Sa={class:"text-body-1"},Ia={class:"mb-3"},Aa={class:"text-body-1"},Ra={class:"mb-3"},Ba={class:"text-h6 text-primary"},Ea={key:0},Da={class:"d-flex flex-column flex-md-row align-md-center justify-space-between"},Oa={class:"text-body-1 font-weight-medium mb-1"},$a={key:0,class:"text-body-2 text-medium-emphasis mb-2"},La={class:"text-body-2 text-medium-emphasis"},Pa={key:1,class:"text-center py-8"},Fa={class:"text-center py-8"};const za={class:"d-flex gap-3 mt-4"},Ma={key:0},Ua={key:1},ja={class:"mt-6"},Ga={key:2,class:"text-center py-8"},qa={key:3,class:"text-center py-8"},Ha={class:"mb-4"},Bi=Fe({__name:"index",setup(Ka){const{t:r}=ze(),Ce=Me(),we=Ue(),N=He(),{confirm:ee}=Ke(),{showSuccess:D,showError:T}=We(),G=V("parcel"),O=V(null),B=V(!1),W=V(null),E=V(""),ne=V([]),F=V(!1),z=V(!1),q=V(!1),w=V(""),M=V(""),$=V(""),L=V(""),P=V(!1),Se=j(()=>N.isLoading),s=j(()=>N.currentShippingOrder),re=j(()=>Ce.params.id),J=async()=>{try{await N.fetchShippingOrder(re.value),s.value||(console.log("🔄 [Order] Order not found - redirecting automatically"),F.value=!0,setTimeout(()=>{window.location.href="/admin/orders/shipping"},1500))}catch(i){console.error("❌ [Order] Error fetching shipping order:",i),F.value=!0,setTimeout(()=>{window.location.href="/admin/orders/shipping"},1500)}},Q=async()=>{var i,e;if((e=(i=s.value)==null?void 0:i.shipping_parcel)!=null&&e.tracking_number){B.value=!0;try{O.value=await N.getTracking(s.value.shipping_parcel.tracking_number),D(r("admin_shipping_tracking_success"))}catch(n){T(n.message||r("admin_shipping_tracking_error"))}finally{B.value=!1}}},Ie=async()=>{var i,e;if((e=(i=s.value)==null?void 0:i.shipping_parcel)!=null&&e.tracking_number)try{W.value=await N.getParcelInfo(s.value.shipping_parcel.tracking_number)}catch(n){T(n.message||r("admin_shipping_parcel_info_error"))}},Wa=async()=>{if(await ee({title:r("admin_shipping_delivery_note_create_confirm_title"),text:r("admin_shipping_delivery_note_create_confirm_text"),confirmText:r("admin_shipping_delivery_note_create_confirm_button"),color:"primary"}))try{const e=await N.createDeliveryNote();E.value=e,D(`Bon de livraison créé: ${e}`)}catch(e){T(e.message||r("admin_shipping_delivery_note_create_error"))}},Ya=async()=>{var e,n;if(!E.value||!((n=(e=s.value)==null?void 0:e.shipping_parcel)!=null&&n.tracking_number)){T(r("admin_shipping_delivery_note_required"));return}if(await ee({title:"Ajouter le colis au bon de livraison",text:`Ajouter le colis ${s.value.shipping_parcel.tracking_number} au bon ${E.value} ?`,confirmText:"Ajouter",color:"primary"}))try{await N.addParcelsToDeliveryNote(E.value,[s.value.shipping_parcel.tracking_number]),D(r("admin_shipping_parcel_added"))}catch(c){T(c.message||r("admin_shipping_add_parcel_error"))}},Ja=async()=>{if(!E.value){T(r("admin_shipping_delivery_note_no_save"));return}if(await ee({title:"Sauvegarder le bon de livraison",text:`Sauvegarder le bon de livraison ${E.value} ?`,confirmText:"Sauvegarder",color:"success"}))try{await N.saveDeliveryNote(E.value),D(r("admin_shipping_delivery_note_saved")),await J()}catch(e){T(e.message||r("admin_shipping_save_error"))}},Qa=(i,e)=>{let n="";switch(e){case"pdf":n=`https://client.ozoneexpress.ma/pdf-delivery-note?dn-ref=${i}`;break;case"a4":n=`https://client.ozoneexpress.ma/pdf-delivery-note-tickets?dn-ref=${i}`;break;case"100x100":n=`https://client.ozoneexpress.ma/pdf-delivery-note-tickets-4-4?dn-ref=${i}`;break}n&&window.open(n,"_blank")},Ae=()=>{var i,e;w.value=((e=(i=s.value)==null?void 0:i.shipping_parcel)==null?void 0:e.status)||"",M.value="",z.value=!0},Re=async()=>{if(!(!w.value||!s.value)){q.value=!0;try{await N.updateShippingStatus(s.value.id,{status:w.value,note:M.value||void 0}),D(`Statut mis à jour vers: ${de(w.value)}`+(w.value==="livree"?" (Commission créée automatiquement)":"")),z.value=!1,await J()}catch(i){T(i.message||"Erreur lors de la mise à jour du statut")}finally{q.value=!1}}},Be=()=>{z.value=!1,w.value="",M.value=""},Ee=i=>{switch(i){case"created":return"info";case"in_transit":return"warning";case"delivered":return"success";case"returned":return"error";default:return"default"}},de=i=>{switch(i){case"created":return"Créé";case"in_transit":return"En transit";case"delivered":return"Livré";case"returned":return r("order.status.returned");default:return i}},H=i=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD"}).format(i),ue=j(()=>{var i,e,n;return((n=(e=(i=O.value)==null?void 0:i.tracking_info)==null?void 0:e.TRACKING)==null?void 0:n["TRACKING-NUMBER"])||""}),X=j(()=>{var i,e,n;return((n=(e=(i=O.value)==null?void 0:i.tracking_info)==null?void 0:e.TRACKING)==null?void 0:n.LAST_TRACKING)||null}),ce=j(()=>{var e,n,c;const i=(c=(n=(e=O.value)==null?void 0:e.tracking_info)==null?void 0:n.TRACKING)==null?void 0:c.HISTORY;return i?Object.values(i).filter(m=>m&&m.TIME_STR).sort((m,g)=>new Date(g.TIME_STR).getTime()-new Date(m.TIME_STR).getTime()):[]}),U=j(()=>{var i,e,n;return((n=(e=(i=O.value)==null?void 0:i.parcel_info)==null?void 0:e.PARCEL_INFO)==null?void 0:n.INFOS)||null}),_e=i=>{if(!i)return"secondary";const e=i.toLowerCase();return e.includes("nouveau")||e.includes("créé")?"info":e.includes("en cours")||e.includes("transit")?"warning":e.includes("livré")?"success":e.includes(r("order.status.returned").toLowerCase())||e.includes("refusé")?"error":"secondary"},ve=i=>{if(!i)return"";try{return new Date(i).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return i}},De=async()=>{const i=ue.value;if(i)try{await navigator.clipboard.writeText(i),D(r("admin_shipping_tracking_copied"))}catch{T(r("admin_shipping_copy_error"))}},me=async()=>{console.log("🔙 [Navigation] GoBack function called"),F.value=!0;try{N.clearCurrentShippingOrder(),O.value=null,W.value=null,E.value="",ne.value=[],z.value=!1,B.value=!1,q.value=!1,P.value=!1,w.value="",M.value="",$.value="",L.value="",G.value="parcel",await Ne(),console.log("🔙 [Navigation] Using direct window.location for guaranteed navigation"),window.location.href="/admin/orders/shipping"}catch(i){console.error("❌ [Navigation] Error in goBack:",i),window.location.href="/admin/orders/shipping"}},pe=()=>{var i,e,n,c,m,g;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.nom_complet)||((c=(n=s.value)==null?void 0:n.shipping_parcel)==null?void 0:c.receiver)||((g=(m=s.value)==null?void 0:m.client)==null?void 0:g.nom_complet)||"-"},te=()=>{var i,e,n,c,m,g;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.telephone)||((c=(n=s.value)==null?void 0:n.shipping_parcel)==null?void 0:c.phone)||((g=(m=s.value)==null?void 0:m.client)==null?void 0:g.telephone)||"-"},fe=()=>{var i,e,n,c;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.email)||((c=(n=s.value)==null?void 0:n.client)==null?void 0:c.email)||null},ge=()=>{var i,e,n,c,m,g;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.ville)||((c=(n=s.value)==null?void 0:n.shipping_parcel)==null?void 0:c.city_name)||((g=(m=s.value)==null?void 0:m.adresse)==null?void 0:g.ville)||"-"},ae=()=>{var i,e,n,c,m,g;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.adresse)||((c=(n=s.value)==null?void 0:n.shipping_parcel)==null?void 0:c.address)||((g=(m=s.value)==null?void 0:m.adresse)==null?void 0:g.adresse)||"-"},ye=()=>{var i,e,n,c;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.code_postal)||((c=(n=s.value)==null?void 0:n.adresse)==null?void 0:c.code_postal)||null},he=()=>{var i,e,n,c;return((e=(i=s.value)==null?void 0:i.client_final_data)==null?void 0:e.pays)||((c=(n=s.value)==null?void 0:n.adresse)==null?void 0:c.pays)||"MA"},Oe=async()=>{const i=`${pe()}
${te()}
${ae()}
${ge()}, ${he()}`;try{await navigator.clipboard.writeText(i),D(r("admin_shipping_address_copied"))}catch{T(r("admin_shipping_address_copy_failed"))}},$e=async()=>{if(!$.value.trim()&&!L.value.trim()){T("Veuillez saisir au moins le nom ou le téléphone du livreur");return}P.value=!0;try{await N.updateDeliveryBoyInfo(re.value,{delivery_boy_name:$.value.trim()||null,delivery_boy_phone:L.value.trim()||null}),D("Informations du livreur enregistrées avec succès"),await J()}catch(i){T(i.message||"Erreur lors de l'enregistrement")}finally{P.value=!1}},Le=()=>{var i,e;$.value=((i=s.value)==null?void 0:i.delivery_boy_name)||"",L.value=((e=s.value)==null?void 0:e.delivery_boy_phone)||""},Pe=()=>{s.value&&($.value=s.value.delivery_boy_name||"",L.value=s.value.delivery_boy_phone||"")};je(async()=>{await J(),Pe()});let Z=!1;return Ge(async(i,e,n)=>{if(Z)return console.log("🚪 [Navigation] Already navigating - skipping duplicate guard"),n();Z=!0,F.value=!0,console.log("🚪 [Navigation] === STARTING NAVIGATION FROM SHIPPING DETAIL ==="),console.log("🚪 [Navigation] To:",i.path,"| Name:",i.name),console.log("🚪 [Navigation] From:",e.path,"| Name:",e.name);try{z.value=!1,console.log("✅ [Navigation] Step 1: Dialogs cleared"),B.value=!1,q.value=!1,P.value=!1,console.log("✅ [Navigation] Step 2: Loading states cleared"),w.value="",M.value="",$.value="",L.value="",console.log("✅ [Navigation] Step 3: Form data cleared"),O.value=null,W.value=null,E.value="",ne.value=[],G.value="parcel",console.log("✅ [Navigation] Step 4: Reactive refs cleared"),N.clearCurrentShippingOrder(),console.log("✅ [Navigation] Step 5: Store state cleared"),await Ne(),console.log("✅ [Navigation] Step 6: DOM updated"),setTimeout(()=>{console.log("🚪 [Navigation] === PROCEEDING WITH NAVIGATION AFTER DELAY ==="),Z=!1,n()},100)}catch(c){console.error("❌ [Navigation] CRITICAL ERROR during cleanup:",c),console.log("🚪 [Navigation] === FORCING NAVIGATION DESPITE ERROR ==="),Z=!1,F.value=!1,n()}}),(i,e)=>{var n,c,m,g,be;return _(),b(ke,null,[t("div",rt,[Se.value?(_(),b("div",dt,[a(le,{indeterminate:"",color:"primary",size:"64"}),t("p",ut,o(v(r)("loading_order")),1)])):s.value?(_(),b("div",ct,[t("div",_t,[t("div",vt,[a(x,{icon:"tabler-arrow-left",variant:"text",onClick:me}),t("div",null,[t("h1",mt,o(v(r)("shipment"))+" "+o(s.value.id.slice(0,8)),1),t("div",pt,[(n=s.value.shipping_parcel)!=null&&n.tracking_number?(_(),C(S,{key:0,size:"small",color:"primary",variant:"tonal",class:"font-mono"},{default:l(()=>[u(o(s.value.shipping_parcel.tracking_number),1)]),_:1})):p("",!0),a(S,{size:"small",color:Ee(((c=s.value.shipping_parcel)==null?void 0:c.status)||"unknown"),variant:"tonal"},{default:l(()=>{var d;return[u(o(de(((d=s.value.shipping_parcel)==null?void 0:d.status)||"unknown")),1)]}),_:1},8,["color"]),a(S,{size:"small",color:(m=s.value.shipping_parcel)!=null&&m.sent_to_carrier?"primary":"warning",variant:"tonal"},{default:l(()=>{var d,y;return[a(f,{start:"",icon:(d=s.value.shipping_parcel)!=null&&d.sent_to_carrier?"tabler-truck":"tabler-package"},null,8,["icon"]),u(" "+o((y=s.value.shipping_parcel)!=null&&y.sent_to_carrier?v(r)("carrier"):v(r)("local")),1)]}),_:1},8,["color"]),a(S,{size:"small",color:"info",variant:"tonal"},{default:l(()=>{var d,y;return[u(o(((d=s.value.shipping_parcel)==null?void 0:d.city_name)||((y=s.value.adresse)==null?void 0:y.ville)||"-"),1)]}),_:1})])])]),t("div",ft,[a(x,{color:"info",variant:"outlined",onClick:Q,loading:B.value},{default:l(()=>[a(f,{start:"",icon:"tabler-route"}),e[15]||(e[15]=u(" Tracking "))]),_:1,__:[15]},8,["loading"]),a(x,{color:"secondary",variant:"outlined",onClick:Ie},{default:l(()=>[a(f,{start:"",icon:"tabler-info-circle"}),e[16]||(e[16]=u(" Infos Colis "))]),_:1,__:[16]}),(g=s.value.shipping_parcel)!=null&&g.sent_to_carrier?p("",!0):(_(),C(x,{key:0,color:"warning",variant:"outlined",onClick:Ae},{default:l(()=>[a(f,{start:"",icon:"tabler-edit"}),e[17]||(e[17]=u(" Modifier Statut "))]),_:1,__:[17]})),p("",!0)])]),a(Je,{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=d=>G.value=d),class:"mb-6"},{default:l(()=>[a(se,{value:"parcel"},{default:l(()=>[a(f,{start:"",icon:"tabler-package"}),e[22]||(e[22]=u(" Informations Colis "))]),_:1,__:[22]}),a(se,{value:"tracking"},{default:l(()=>[a(f,{start:"",icon:"tabler-route"}),e[23]||(e[23]=u(" Suivi "))]),_:1,__:[23]}),p("",!0),a(se,{value:"delivery-boy"},{default:l(()=>[a(f,{start:"",icon:"tabler-user"}),e[25]||(e[25]=u(" Livreur "))]),_:1,__:[25]})]),_:1},8,["modelValue"]),a(Qe,{modelValue:G.value,"onUpdate:modelValue":e[11]||(e[11]=d=>G.value=d)},{default:l(()=>[a(oe,{value:"parcel"},{default:l(()=>[a(I,{class:"mb-6"},{default:l(()=>[a(A,{class:"d-flex align-center justify-space-between"},{default:l(()=>[t("span",null,o(i.$t("orders.client_final.title")),1),ae()?(_(),C(x,{key:0,size:"small",color:"primary",variant:"outlined","prepend-icon":"tabler-copy",onClick:Oe},{default:l(()=>[u(o(i.$t("orders.client_final.copy_address")),1)]),_:1})):p("",!0)]),_:1}),a(R,null,{default:l(()=>[a(K,null,{default:l(()=>[a(k,{cols:"12",md:"6"},{default:l(()=>[t("div",gt,[t("div",yt,o(i.$t("orders.client_final.name")),1),t("div",ht,o(pe()),1)]),t("div",bt,[t("div",xt,o(i.$t("orders.client_final.phone")),1),t("div",Vt,[t("a",{href:`tel:${te()}`,class:"text-decoration-none"},o(te()),9,kt)])]),fe()?(_(),b("div",Nt,[t("div",Tt,o(i.$t("orders.client_final.email")),1),t("div",Ct,o(fe()),1)])):p("",!0)]),_:1}),a(k,{cols:"12",md:"6"},{default:l(()=>[t("div",wt,[t("div",St,o(i.$t("orders.client_final.city")),1),t("div",It,[a(S,{color:"secondary",variant:"tonal",size:"small"},{default:l(()=>[u(o(ge()),1)]),_:1})])]),t("div",At,[t("div",Rt,o(i.$t("orders.client_final.address")),1),t("div",Bt,o(ae()),1)]),ye()?(_(),b("div",Et,[t("div",Dt,o(i.$t("orders.client_final.postal_code")),1),t("div",Ot,o(ye()),1)])):p("",!0),t("div",$t,[t("div",Lt,o(i.$t("orders.client_final.country")),1),t("div",Pt,o(he()),1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(K,null,{default:l(()=>[a(k,{cols:"12",md:"8"},{default:l(()=>[a(I,null,{default:l(()=>[a(A,null,{default:l(()=>[u(o(v(r)("labels.packageDetails")),1)]),_:1}),a(R,null,{default:l(()=>[a(K,null,{default:l(()=>[a(k,{cols:"12",md:"6"},{default:l(()=>[t("div",Ft,[e[26]||(e[26]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Numéro de suivi",-1)),a(S,{color:"primary",variant:"tonal",class:"font-mono"},{default:l(()=>[u(o(s.value.shipping_parcel.tracking_number),1)]),_:1})]),t("div",zt,[t("div",Mt,o(v(r)("recipient")),1),t("div",Ut,o(s.value.shipping_parcel.receiver),1)]),t("div",jt,[t("div",Gt,o(v(r)("phone")),1),t("div",qt,o(s.value.shipping_parcel.phone),1)])]),_:1}),a(k,{cols:"12",md:"6"},{default:l(()=>[t("div",Ht,[t("div",Kt,o(v(r)("city")),1),a(S,{color:"info",variant:"tonal"},{default:l(()=>[u(o(s.value.shipping_parcel.city_name),1)]),_:1})]),t("div",Wt,[t("div",Yt,o(v(r)("address")),1),t("div",Jt,o(s.value.shipping_parcel.address),1)]),t("div",Qt,[t("div",Xt,o(v(r)("price")),1),t("div",Zt,o(H(s.value.shipping_parcel.price||0)),1)])]),_:1})]),_:1}),a(Ze,{class:"my-4"}),t("div",ea,[e[27]||(e[27]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Note",-1)),t("div",ta,o(s.value.shipping_parcel.note||"Aucune note"),1)]),s.value.shipping_parcel.delivered_price?(_(),C(K,{key:0},{default:l(()=>[a(k,{cols:"4"},{default:l(()=>[e[28]||(e[28]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Prix livraison",-1)),t("div",aa,o(H(s.value.shipping_parcel.delivered_price)),1)]),_:1,__:[28]}),a(k,{cols:"4"},{default:l(()=>[t("div",ia,o(v(r)("labels.returnFee")),1),t("div",la,o(H(s.value.shipping_parcel.returned_price||0)),1)]),_:1}),a(k,{cols:"4"},{default:l(()=>[e[29]||(e[29]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Prix refus",-1)),t("div",sa,o(H(s.value.shipping_parcel.refused_price||0)),1)]),_:1,__:[29]})]),_:1})):p("",!0)]),_:1})]),_:1}),W.value?(_(),C(I,{key:0,class:"mt-4"},{default:l(()=>[a(A,null,{default:l(()=>e[30]||(e[30]=[u("Informations API")])),_:1,__:[30]}),a(R,null,{default:l(()=>[t("pre",oa,o(JSON.stringify(W.value,null,2)),1)]),_:1})]),_:1})):p("",!0)]),_:1}),a(k,{cols:"12",md:"4"},{default:l(()=>[a(I,null,{default:l(()=>[a(A,null,{default:l(()=>e[31]||(e[31]=[u("Commande Originale")])),_:1,__:[31]}),a(R,null,{default:l(()=>{var d,y,h,Y,xe,Ve;return[t("div",na,[e[32]||(e[32]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Client",-1)),t("div",ra,o(((d=s.value.client)==null?void 0:d.nom_complet)||"-"),1),t("div",da,o(((y=s.value.client)==null?void 0:y.telephone)||"-"),1)]),t("div",ua,[e[33]||(e[33]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Affilié",-1)),t("div",ca,o(((Y=(h=s.value.affilie)==null?void 0:h.utilisateur)==null?void 0:Y.nom_complet)||"-"),1),t("div",_a,o(((Ve=(xe=s.value.affilie)==null?void 0:xe.utilisateur)==null?void 0:Ve.email)||"-"),1)]),t("div",va,[e[34]||(e[34]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Boutique",-1)),a(S,{color:"info",variant:"tonal"},{default:l(()=>{var ie;return[u(o(((ie=s.value.boutique)==null?void 0:ie.nom)||"-"),1)]}),_:1})]),t("div",ma,[t("div",pa,o(v(r)("admin_total")),1),t("div",fa,o(H(s.value.total_ttc||0)),1)]),a(x,{color:"primary",variant:"outlined",block:"",onClick:e[4]||(e[4]=ie=>v(we).push({name:"admin-orders-pre-id",params:{id:s.value.id}}))},{default:l(()=>[u(o(v(r)("actions.viewOrder")),1)]),_:1})]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(oe,{value:"tracking"},{default:l(()=>[B.value?(_(),C(I,{key:0},{default:l(()=>[a(A,null,{default:l(()=>e[35]||(e[35]=[u("Suivi du Colis")])),_:1,__:[35]}),a(R,null,{default:l(()=>[t("div",ga,[a(le,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[36]||(e[36]=t("h3",{class:"text-h6 mb-2"},"Récupération des données de suivi...",-1)),e[37]||(e[37]=t("p",{class:"text-body-2 text-medium-emphasis"}," Veuillez patienter pendant que nous récupérons les informations ",-1))])]),_:1})]),_:1})):O.value?(_(),b("div",ya,[a(I,{class:"mb-4"},{default:l(()=>[a(A,{class:"d-flex align-center justify-space-between"},{default:l(()=>[e[39]||(e[39]=t("span",null,"Suivi du Colis",-1)),a(x,{color:"primary",variant:"outlined",onClick:Q,loading:B.value},{default:l(()=>[a(f,{start:"",icon:"tabler-refresh"}),e[38]||(e[38]=u(" Actualiser "))]),_:1,__:[38]},8,["loading"])]),_:1,__:[39]}),a(R,null,{default:l(()=>{var d,y;return[t("div",ha,[t("div",ba,[a(S,{color:"primary",variant:"tonal",class:"font-mono",size:"large"},{default:l(()=>[u(o(ue.value),1)]),_:1}),a(x,{icon:"tabler-copy",variant:"text",size:"small",onClick:De})]),t("div",xa,[a(S,{color:_e(((d=X.value)==null?void 0:d.STATUT)||""),variant:"tonal",size:"large"},{default:l(()=>{var h;return[u(o(((h=X.value)==null?void 0:h.STATUT)||"Statut inconnu"),1)]}),_:1},8,["color"]),(y=X.value)!=null&&y.TIME_STR?(_(),b("div",Va," Mis à jour le "+o(ve(X.value.TIME_STR)),1)):p("",!0)])]),U.value?(_(),C(K,{key:0},{default:l(()=>[a(k,{cols:"12",md:"6"},{default:l(()=>[t("div",ka,[e[40]||(e[40]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Destinataire",-1)),t("div",Na,o(U.value.RECEIVER||"-"),1)]),t("div",Ta,[e[41]||(e[41]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Téléphone",-1)),t("div",Ca,o(U.value.PHONE||"-"),1)])]),_:1}),a(k,{cols:"12",md:"6"},{default:l(()=>[t("div",wa,[e[42]||(e[42]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Ville",-1)),t("div",Sa,o(U.value.CITY_NAME||"-"),1)]),t("div",Ia,[e[43]||(e[43]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Adresse",-1)),t("div",Aa,o(U.value.ADDRESS||"-"),1)])]),_:1}),U.value.PRICE?(_(),C(k,{key:0,cols:"12"},{default:l(()=>[t("div",Ra,[e[44]||(e[44]=t("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Prix",-1)),t("div",Ba,o(H(parseFloat(U.value.PRICE)||0)),1)])]),_:1})):p("",!0)]),_:1})):p("",!0)]}),_:1})]),_:1}),a(I,null,{default:l(()=>[a(A,null,{default:l(()=>e[45]||(e[45]=[u("Historique du Suivi")])),_:1,__:[45]}),a(R,null,{default:l(()=>[ce.value.length>0?(_(),b("div",Ea,[a(et,{side:"end",align:"start","truncate-line":"both",density:"compact"},{default:l(()=>[(_(!0),b(ke,null,qe(ce.value,(d,y)=>(_(),C(tt,{key:y,"dot-color":_e(d.STATUT),size:"small"},{icon:l(()=>{var h;return[a(f,{icon:(h=d.STATUT)!=null&&h.toLowerCase().includes("livré")?"tabler-check":"tabler-package",size:"16"},null,8,["icon"])]}),default:l(()=>[t("div",Da,[t("div",null,[t("div",Oa,o(d.STATUT),1),d.COMMENT?(_(),b("div",$a,o(d.COMMENT),1)):p("",!0)]),t("div",La,o(ve(d.TIME_STR)),1)])]),_:2},1032,["dot-color"]))),128))]),_:1})])):(_(),b("div",Pa,[a(f,{icon:"tabler-timeline",size:"64",class:"mb-4",color:"disabled"}),e[46]||(e[46]=t("h3",{class:"text-h6 mb-2"},"Aucun événement de suivi",-1)),e[47]||(e[47]=t("p",{class:"text-body-2 text-medium-emphasis"}," Aucun événement de suivi pour le moment. ",-1))]))]),_:1})]),_:1})])):(_(),C(I,{key:2},{default:l(()=>[a(A,{class:"d-flex align-center justify-space-between"},{default:l(()=>[e[49]||(e[49]=t("span",null,"Suivi du Colis",-1)),a(x,{color:"primary",variant:"outlined",onClick:Q,loading:B.value},{default:l(()=>[a(f,{start:"",icon:"tabler-refresh"}),e[48]||(e[48]=u(" Récupérer le Suivi "))]),_:1,__:[48]},8,["loading"])]),_:1,__:[49]}),a(R,null,{default:l(()=>[t("div",Fa,[a(f,{icon:"tabler-route",size:"64",class:"mb-4",color:"disabled"}),e[51]||(e[51]=t("h3",{class:"text-h6 mb-2"},"Aucune donnée de suivi",-1)),e[52]||(e[52]=t("p",{class:"text-body-2 text-medium-emphasis mb-4"},' Cliquez sur "Récupérer le Suivi" pour obtenir les informations de suivi ',-1)),a(x,{color:"primary",variant:"elevated",onClick:Q,loading:B.value},{default:l(()=>[a(f,{start:"",icon:"tabler-route"}),e[50]||(e[50]=u(" Récupérer le Suivi "))]),_:1,__:[50]},8,["loading"])])]),_:1})]),_:1}))]),_:1}),p("",!0),a(oe,{value:"delivery-boy"},{default:l(()=>[a(I,null,{default:l(()=>[a(A,{class:"d-flex align-center"},{default:l(()=>[a(f,{icon:"tabler-user",class:"me-2"}),e[62]||(e[62]=u(" Informations du Livreur "))]),_:1,__:[62]}),a(R,null,{default:l(()=>{var d,y;return[a(K,null,{default:l(()=>[a(k,{cols:"12",md:"6"},{default:l(()=>[a(Te,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=h=>$.value=h),label:"Nom du livreur",placeholder:"Ex: Ahmed Benali",variant:"outlined","prepend-inner-icon":"tabler-user",disabled:P.value},null,8,["modelValue","disabled"])]),_:1}),a(k,{cols:"12",md:"6"},{default:l(()=>[a(Te,{modelValue:L.value,"onUpdate:modelValue":e[10]||(e[10]=h=>L.value=h),label:"Téléphone du livreur",placeholder:"Ex: +212 6 12 34 56 78",variant:"outlined","prepend-inner-icon":"tabler-phone",disabled:P.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t("div",za,[a(x,{color:"primary",variant:"elevated",loading:P.value,onClick:$e},{default:l(()=>[a(f,{start:"",icon:"tabler-device-floppy"}),e[63]||(e[63]=u(" Enregistrer "))]),_:1,__:[63]},8,["loading"]),a(x,{variant:"outlined",onClick:Le,disabled:P.value},{default:l(()=>[a(f,{start:"",icon:"tabler-refresh"}),e[64]||(e[64]=u(" Réinitialiser "))]),_:1,__:[64]},8,["disabled"])]),(d=s.value)!=null&&d.delivery_boy_name||(y=s.value)!=null&&y.delivery_boy_phone?(_(),C(at,{key:0,type:"info",variant:"tonal",class:"mt-4"},{default:l(()=>{var h,Y;return[a(it,null,{default:l(()=>e[65]||(e[65]=[u("Informations actuelles")])),_:1,__:[65]}),(h=s.value)!=null&&h.delivery_boy_name?(_(),b("div",Ma,[e[66]||(e[66]=t("strong",null,"Nom:",-1)),u(" "+o(s.value.delivery_boy_name),1)])):p("",!0),(Y=s.value)!=null&&Y.delivery_boy_phone?(_(),b("div",Ua,[e[67]||(e[67]=t("strong",null,"Téléphone:",-1)),u(" "+o(s.value.delivery_boy_phone),1)])):p("",!0)]}),_:1})):p("",!0)]}),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("div",ja,[(be=s.value)!=null&&be.id?(_(),C(Ye,{key:0,"order-id":s.value.id,endpoint:"admin","order-type":"shipping"},null,8,["order-id"])):p("",!0)])])):F.value?F.value?(_(),b("div",qa,[a(le,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[70]||(e[70]=t("h3",{class:"text-h6 mb-2"},"Redirection en cours...",-1)),e[71]||(e[71]=t("p",{class:"text-body-2 text-medium-emphasis"}," Veuillez patienter pendant la redirection ",-1))])):p("",!0):(_(),b("div",Ga,[a(f,{icon:"tabler-alert-circle",size:"64",class:"mb-4",color:"error"}),e[68]||(e[68]=t("h3",{class:"text-h6 mb-2"},"Commande introuvable",-1)),e[69]||(e[69]=t("p",{class:"text-body-2 text-medium-emphasis mb-4"}," La commande demandée n'existe pas ou n'a pas été expédiée ",-1)),a(x,{color:"primary",variant:"elevated",onClick:me},{default:l(()=>[u(o(v(r)("actions.backToList")),1)]),_:1})]))]),a(nt,{modelValue:z.value,"onUpdate:modelValue":e[14]||(e[14]=d=>z.value=d),"max-width":"500",persistent:""},{default:l(()=>[a(I,null,{default:l(()=>[a(A,{class:"text-h6"},{default:l(()=>[a(f,{start:"",icon:"tabler-edit",color:"warning"}),u(" "+o(v(r)("labels.modifyShippingStatus")),1)]),_:1}),a(R,null,{default:l(()=>[t("p",Ha,[u(o(v(r)("modify_local_shipment_status"))+" ",1),t("strong",null,o(v(r)("note"))+":",1),u(" "+o(v(r)("note_delivered_status_commission")),1)]),a(lt,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=d=>w.value=d),label:"Nouveau statut",items:[{title:"En attente",value:"pending"},{title:"Expédiée",value:"expediee"},{title:"Livrée",value:"livree"},{title:"Refusée",value:"refusee"},{title:v(r)("order.status.returned_feminine"),value:"retournee"},{title:"Annulée",value:"annulee"}],variant:"outlined",class:"mb-4"},null,8,["modelValue","items"]),a(st,{modelValue:M.value,"onUpdate:modelValue":e[13]||(e[13]=d=>M.value=d),label:"Note (optionnelle)",placeholder:v(r)("admin_shipping_status_note_placeholder"),rows:"3",variant:"outlined"},null,8,["modelValue","placeholder"])]),_:1}),a(Xe,null,{default:l(()=>[a(ot),a(x,{variant:"text",onClick:Be,disabled:q.value},{default:l(()=>e[72]||(e[72]=[u(" Annuler ")])),_:1,__:[72]},8,["disabled"]),a(x,{color:"warning",variant:"elevated",loading:q.value,disabled:!w.value,onClick:Re},{default:l(()=>[a(f,{start:"",icon:"tabler-check"}),e[73]||(e[73]=u(" Mettre à jour "))]),_:1,__:[73]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});export{Bi as default};
