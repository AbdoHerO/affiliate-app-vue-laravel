import{d as Oe,u as Ne,j as Pe,aL as Be,r as D,V as W,D as je,c as p,o as u,b as a,e as o,aV as Le,ac as V,l as k,t as l,f as s,s as m,g as y,az as h,F as Re,m as _}from"./main-uLG9IIeX.js";import{u as Ue}from"./preorders-BH6YwS2K.js";import{useQuickConfirm as Ie}from"./useConfirmAction-C-KKQTYr.js";import{u as Me}from"./useNotifications-DDBS_wPD.js";import{C as qe}from"./ConfirmActionDialog-uPYgr6qv.js";import{O as We}from"./OzonExpressConfirmDialog-4wkpIU85.js";import{V as w}from"./VChip-B84WcmDa.js";import{V as H,a as He}from"./VTabs-BkhoRyPL.js";import{V as Q,a as Qe}from"./VWindowItem-DPvP18Ki.js";import{V as P,b as B}from"./VCard-CB1gT6RB.js";import{V as j}from"./VCardText-BZtszuIK.js";import{V as G,a as $}from"./VRow-aGfXYx3U.js";import{V as Ge}from"./VDataTable-DNqSzzrc.js";import{V as re}from"./VAvatar-bHPDEsYY.js";import{V as Je}from"./VImg-BS6_svHJ.js";import{V as de}from"./VSelect-sWnAtot-.js";import{V as Ke}from"./VTextarea-BuIc6d95.js";import{V as ue}from"./VDivider-UqGR4x4D.js";import{V as Xe}from"./VSnackbar-BT89hKev.js";import"./VDialog-DU1pBIct.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./dialog-transition-2hF0ajsQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTooltip-Ce3bfmSx.js";import"./ssrBoot-BPhRU-mF.js";import"./createSimpleFunctional-DugzUcbB.js";/* empty css              */import"./VPagination-DYW6O4lq.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VField-CfH1YcVv.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";import"./VTextField-Dxeq5kx5.js";import"./VList-uZDByhc2.js";import"./VMenu-DP1p-55V.js";const Ye={class:"d-flex flex-column gap-6"},Ze={key:0,class:"text-center py-8"},et={key:1},tt={class:"d-flex justify-space-between align-center mb-6"},at={class:"d-flex align-center gap-4"},ot={class:"text-h4 font-weight-bold mb-1"},it={key:0,class:"d-flex align-center gap-2"},st={class:"d-flex gap-2"},lt={class:"mb-4"},nt={class:"text-body-2 text-medium-emphasis mb-1"},rt={class:"text-h6"},dt={class:"mb-4"},ut={class:"text-body-2 text-medium-emphasis mb-1"},mt={class:"text-body-1"},ct=["href"],_t={key:0,class:"mb-4"},ft={class:"text-body-2 text-medium-emphasis mb-1"},vt={class:"text-body-1"},pt={class:"mb-4"},gt={class:"text-body-2 text-medium-emphasis mb-1"},bt={class:"text-h6"},yt={class:"mb-4"},xt={class:"text-body-2 text-medium-emphasis mb-1"},ht={class:"text-body-1"},Ct={key:0,class:"mb-4"},Vt={class:"text-body-2 text-medium-emphasis mb-1"},kt={class:"text-body-1"},wt={class:"mb-4"},Tt={class:"text-body-2 text-medium-emphasis mb-1"},zt={class:"text-body-1"},Dt={class:"d-flex align-center gap-3"},$t={class:"font-weight-medium"},Et={key:1,class:"text-medium-emphasis"},At={class:"text-medium-emphasis"},St={class:"font-weight-medium text-primary"},Ft={class:"text-success font-weight-medium"},Ot={class:"font-weight-bold"},Nt={key:1,class:"mb-4"},Pt={class:"text-body-2 text-medium-emphasis mb-1"},Bt={key:1,class:"mb-4"},jt={key:1,class:"mb-4"},Lt={class:"text-body-1"},Rt={class:"mb-4"},Ut={class:"text-body-1"},It={class:"text-caption text-medium-emphasis"},Mt={class:"mb-4"},qt={class:"mb-4"},Wt={class:"text-body-1"},Ht={class:"d-flex justify-space-between mb-2"},Qt={class:"d-flex justify-space-between font-weight-bold text-h6"},Gt={class:"text-caption text-medium-emphasis mt-2"},Jt={key:2,class:"text-center py-8"},Fa=Oe({__name:"index",setup(Kt){const me=Ne(),F=Pe(),{t:n}=Be(),T=Ue(),{confirm:ce,isDialogVisible:_e,isLoading:fe,dialogTitle:ve,dialogText:pe,dialogIcon:ge,dialogColor:be,confirmButtonText:ye,cancelButtonText:xe,handleConfirm:he,handleCancel:Ce}=Ie(),{showSuccess:O,showError:E,snackbar:A}=Me(),N=D("client"),g=D(!1),L=D(!1),R=D(!1),U=D(!1),C=D({statut:"",confirmation_cc:"",notes:""}),Ve=W(()=>T.isLoading),t=W(()=>T.currentPreorder),ke=W(()=>me.params.id),we=[{title:"En attente",value:"en_attente"},{title:n("admin_preorder_status_confirmed_fem"),value:"confirmee"}],Te=[{title:n("admin_preorder_status_not_contacted"),value:"non_contacte"},{title:n("admin_preorder_status_to_confirm"),value:"a_confirmer"},{title:n("admin_preorder_status_confirmed"),value:"confirme"},{title:n("admin_preorder_status_unreachable"),value:"injoignable"}],I=async()=>{try{await T.fetchPreorder(ke.value),t.value&&(C.value={statut:t.value.statut,confirmation_cc:t.value.confirmation_cc,notes:t.value.notes||""})}catch(i){E(i.message||"Erreur lors du chargement de la commande"),F.push({name:"admin-orders-pre"})}},J=()=>{g.value=!g.value,!g.value&&t.value&&(C.value={statut:t.value.statut,confirmation_cc:t.value.confirmation_cc,notes:t.value.notes||""})},ze=async()=>{if(t.value){L.value=!0;try{await T.updatePreorder(t.value.id,C.value),O(n("admin_preorder_update_success")),g.value=!1,await I(),F.replace({name:"admin-orders-pre-id",params:{id:t.value.id}})}catch(i){E(i.message||n("admin_preorder_update_error"))}finally{L.value=!1}}},De=async()=>{if(!t.value)return;if(await ce({title:n("admin_preorder_confirm_title"),text:n("admin_preorder_confirm_text"),confirmText:n("admin_preorder_confirm_button"),color:"success"}))try{await T.changeStatus(t.value.id,"confirmee"),O(n("admin_preorder_confirm_success"))}catch(e){E(e.message||n("admin_preorder_confirm_error"))}},$e=async()=>{t.value&&(R.value=!0)},Ee=async i=>{if(t.value){U.value=!0;try{await T.sendToShipping(t.value.id,i),O(`Commande envoyée vers OzonExpress en mode ${i==="ramassage"?"Ramassage":"Stock"}`),await I()}catch(e){E(e.message||"Erreur lors de l'envoi vers OzonExpress"),console.error("Detail shipping error:",e)}finally{U.value=!1}}},Ae=()=>{},K=i=>{switch(i){case"en_attente":return"warning";case"confirmee":return"success";default:return"default"}},X=i=>{switch(i){case"en_attente":return"En attente";case"confirmee":return n("admin_preorder_status_confirmed_fem");default:return i}},Y=i=>{switch(i){case"non_contacte":return"default";case"a_confirmer":return"warning";case"confirme":return"success";case"injoignable":return"error";default:return"default"}},Z=i=>{switch(i){case"non_contacte":return n("admin_preorder_status_not_contacted");case"a_confirmer":return n("admin_preorder_status_to_confirm");case"confirme":return n("admin_preorder_status_confirmed");case"injoignable":return n("admin_preorder_status_unreachable");default:return i}},z=i=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD"}).format(i),Se=i=>new Date(i).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),ee=()=>{F.push({name:"admin-orders-pre"})},te=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.nom_complet)||((d=(r=t.value)==null?void 0:r.client)==null?void 0:d.nom_complet)||"-"},M=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.telephone)||((d=(r=t.value)==null?void 0:r.client)==null?void 0:d.telephone)||"-"},ae=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.email)||((d=(r=t.value)==null?void 0:r.client)==null?void 0:d.email)||null},oe=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.ville)||((d=(r=t.value)==null?void 0:r.adresse)==null?void 0:d.ville)||"-"},q=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.adresse)||((d=(r=t.value)==null?void 0:r.adresse)==null?void 0:d.adresse)||"-"},ie=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.code_postal)||((d=(r=t.value)==null?void 0:r.adresse)==null?void 0:d.code_postal)||null},se=()=>{var i,e,r,d;return((e=(i=t.value)==null?void 0:i.client_final_data)==null?void 0:e.pays)||((d=(r=t.value)==null?void 0:r.adresse)==null?void 0:d.pays)||"MA"},Fe=async()=>{const i=`${te()}
${M()}
${q()}
${oe()}, ${se()}`;try{await navigator.clipboard.writeText(i),O(n("admin_shipping_address_copied"))}catch{E(n("admin_shipping_address_copy_failed"))}};return je(()=>{I()}),(i,e)=>{var r,d,le,ne;return u(),p("div",Ye,[Ve.value?(u(),p("div",Ze,[a(Le,{indeterminate:"",color:"primary",size:"64"}),e[8]||(e[8]=o("p",{class:"mt-4"},"Chargement de la commande...",-1))])):t.value?(u(),p("div",et,[o("div",tt,[o("div",at,[a(V,{icon:"tabler-arrow-left",variant:"text",onClick:ee}),o("div",null,[o("h1",ot," Commande "+l(((d=(r=t.value)==null?void 0:r.id)==null?void 0:d.slice(0,8))||"Chargement..."),1),t.value?(u(),p("div",it,[a(w,{size:"small",color:K(t.value.statut),variant:"tonal"},{default:s(()=>[m(l(X(t.value.statut)),1)]),_:1},8,["color"]),a(w,{size:"small",color:Y(t.value.confirmation_cc),variant:"tonal"},{default:s(()=>[m(l(Z(t.value.confirmation_cc)),1)]),_:1},8,["color"])])):k("",!0)])]),o("div",st,[g.value?k("",!0):(u(),y(V,{key:0,color:"secondary",variant:"outlined",onClick:J},{default:s(()=>[a(h,{start:"",icon:"tabler-edit"}),e[9]||(e[9]=m(" Modifier "))]),_:1,__:[9]})),g.value?(u(),p(Re,{key:1},[a(V,{color:"error",variant:"outlined",onClick:J},{default:s(()=>e[10]||(e[10]=[m(" Annuler ")])),_:1,__:[10]}),a(V,{color:"success",variant:"elevated",loading:L.value,onClick:ze},{default:s(()=>[a(h,{start:"",icon:"tabler-check"}),e[11]||(e[11]=m(" Sauvegarder "))]),_:1,__:[11]},8,["loading"])],64)):k("",!0),((le=t.value)==null?void 0:le.statut)==="en_attente"&&!g.value?(u(),y(V,{key:2,color:"success",variant:"outlined",onClick:De},{default:s(()=>[a(h,{start:"",icon:"tabler-check"}),e[12]||(e[12]=m(" Confirmer "))]),_:1,__:[12]})):k("",!0),t.value&&t.value.statut==="confirmee"&&!t.value.shipping_parcel&&!g.value?(u(),y(V,{key:3,color:"primary",variant:"elevated",onClick:$e},{default:s(()=>[a(h,{start:"",icon:"tabler-truck"}),e[13]||(e[13]=m(" Envoyer OzonExpress "))]),_:1,__:[13]})):k("",!0),(ne=t.value)!=null&&ne.shipping_parcel?(u(),y(V,{key:4,color:"info",variant:"outlined",onClick:e[0]||(e[0]=f=>_(F).push({name:"admin-orders-shipping-id",params:{id:t.value.id}}))},{default:s(()=>[a(h,{start:"",icon:"tabler-package"}),e[14]||(e[14]=m(" Voir Expédition "))]),_:1,__:[14]})):k("",!0)])]),a(He,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=f=>N.value=f),class:"mb-6"},{default:s(()=>[a(H,{value:"client"},{default:s(()=>[a(h,{start:"",icon:"tabler-user"}),e[15]||(e[15]=m(" Client & Adresse "))]),_:1,__:[15]}),a(H,{value:"articles"},{default:s(()=>[a(h,{start:"",icon:"tabler-package"}),e[16]||(e[16]=m(" Articles "))]),_:1,__:[16]}),a(H,{value:"resume"},{default:s(()=>[a(h,{start:"",icon:"tabler-file-text"}),e[17]||(e[17]=m(" Résumé "))]),_:1,__:[17]})]),_:1},8,["modelValue"]),a(Qe,{modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=f=>N.value=f)},{default:s(()=>[a(Q,{value:"client"},{default:s(()=>[a(P,{class:"mb-6"},{default:s(()=>[a(B,{class:"d-flex align-center justify-space-between"},{default:s(()=>[o("span",null,l(i.$t("orders.client_final.title")),1),q()?(u(),y(V,{key:0,size:"small",color:"primary",variant:"outlined","prepend-icon":"tabler-copy",onClick:Fe},{default:s(()=>[m(l(i.$t("orders.client_final.copy_address")),1)]),_:1})):k("",!0)]),_:1}),a(j,null,{default:s(()=>[a(G,null,{default:s(()=>[a($,{cols:"12",md:"6"},{default:s(()=>[o("div",lt,[o("div",nt,l(i.$t("orders.client_final.name")),1),o("div",rt,l(te()),1)]),o("div",dt,[o("div",ut,l(i.$t("orders.client_final.phone")),1),o("div",mt,[o("a",{href:`tel:${M()}`,class:"text-decoration-none"},l(M()),9,ct)])]),ae()?(u(),p("div",_t,[o("div",ft,l(i.$t("orders.client_final.email")),1),o("div",vt,l(ae()),1)])):k("",!0)]),_:1}),a($,{cols:"12",md:"6"},{default:s(()=>[o("div",pt,[o("div",gt,l(i.$t("orders.client_final.city")),1),o("div",bt,[a(w,{color:"secondary",variant:"tonal",size:"small"},{default:s(()=>[m(l(oe()),1)]),_:1})])]),o("div",yt,[o("div",xt,l(i.$t("orders.client_final.address")),1),o("div",ht,l(q()),1)]),ie()?(u(),p("div",Ct,[o("div",Vt,l(i.$t("orders.client_final.postal_code")),1),o("div",kt,l(ie()),1)])):k("",!0),o("div",wt,[o("div",Tt,l(i.$t("orders.client_final.country")),1),o("div",zt,l(se()),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{value:"articles"},{default:s(()=>[a(P,null,{default:s(()=>[a(B,null,{default:s(()=>e[18]||(e[18]=[m("Articles de la Commande")])),_:1,__:[18]}),a(j,null,{default:s(()=>{var f;return[a(Ge,{headers:[{title:"Produit",key:"produit"},{title:"Variante",key:"variante"},{title:_(n)("admin_preorder_table_quantity"),key:"quantite"},{title:_(n)("admin_preorder_table_recommended_price"),key:"prix_unitaire"},{title:"Prix de vente",key:"sell_price"},{title:"Commission",key:"commission_amount"},{title:_(n)("admin_total"),key:"total_ligne"}],items:((f=t.value)==null?void 0:f.articles)||[],"items-per-page":-1},{"item.produit":s(({item:c})=>{var b;return[o("div",Dt,[(b=c.produit.images)!=null&&b[0]?(u(),y(re,{key:0,size:"40",rounded:""},{default:s(()=>[a(Je,{src:c.produit.images[0].url},null,8,["src"])]),_:2},1024)):(u(),y(re,{key:1,size:"40",color:"grey-lighten-3",rounded:""},{default:s(()=>[a(h,{icon:"tabler-package"})]),_:1})),o("div",null,[o("div",$t,l(c.produit.titre),1)])])]}),"item.variante":s(({item:c})=>[c.variante?(u(),y(w,{key:0,size:"small",color:"info",variant:"tonal"},{default:s(()=>{var b;return[m(l(((b=c.variante)==null?void 0:b.nom)||"-"),1)]}),_:2},1024)):(u(),p("span",Et,"-"))]),"item.prix_unitaire":s(({item:c})=>[o("span",At,l(z(c.prix_unitaire)),1)]),"item.sell_price":s(({item:c})=>[o("span",St,l(z(c.sell_price||c.prix_unitaire)),1)]),"item.commission_amount":s(({item:c})=>[o("span",Ft," +"+l(z(c.commission_amount||0)),1)]),"item.total_ligne":s(({item:c})=>[o("div",Ot,l(z(c.total_ligne)),1)]),_:1},8,["headers","items"])]}),_:1})]),_:1})]),_:1}),a(Q,{value:"resume"},{default:s(()=>[a(G,null,{default:s(()=>[a($,{cols:"12",md:"8"},{default:s(()=>[a(P,null,{default:s(()=>[a(B,null,{default:s(()=>e[19]||(e[19]=[m("Détails de la Commande")])),_:1,__:[19]}),a(j,null,{default:s(()=>{var f,c,b,S;return[a(G,null,{default:s(()=>[a($,{cols:"12",md:"6"},{default:s(()=>{var x;return[g.value?(u(),y(de,{key:0,modelValue:C.value.statut,"onUpdate:modelValue":e[2]||(e[2]=v=>C.value.statut=v),label:"Statut",items:we,variant:"outlined"},null,8,["modelValue"])):(u(),p("div",Nt,[o("div",Pt,l(_(n)("admin_status")),1),a(w,{color:K(((x=t.value)==null?void 0:x.statut)||""),variant:"tonal"},{default:s(()=>{var v;return[m(l(X(((v=t.value)==null?void 0:v.statut)||"")),1)]}),_:1},8,["color"])]))]}),_:1}),a($,{cols:"12",md:"6"},{default:s(()=>{var x;return[g.value?(u(),y(de,{key:0,modelValue:C.value.confirmation_cc,"onUpdate:modelValue":e[3]||(e[3]=v=>C.value.confirmation_cc=v),label:"Confirmation CC",items:Te,variant:"outlined"},null,8,["modelValue"])):(u(),p("div",Bt,[e[20]||(e[20]=o("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Confirmation CC",-1)),a(w,{color:Y(((x=t.value)==null?void 0:x.confirmation_cc)||""),variant:"tonal"},{default:s(()=>{var v;return[m(l(Z(((v=t.value)==null?void 0:v.confirmation_cc)||"")),1)]}),_:1},8,["color"])]))]}),_:1})]),_:1}),g.value?(u(),y(Ke,{key:0,modelValue:C.value.notes,"onUpdate:modelValue":e[4]||(e[4]=x=>C.value.notes=x),label:"Notes",variant:"outlined",rows:"3"},null,8,["modelValue"])):(u(),p("div",jt,[e[21]||(e[21]=o("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Notes",-1)),o("div",Lt,l(((f=t.value)==null?void 0:f.notes)||"Aucune note"),1)])),a(ue,{class:"my-4"}),o("div",Rt,[e[22]||(e[22]=o("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Affilié",-1)),o("div",Ut,l(((c=t.value.affiliate)==null?void 0:c.nom_complet)||"N/A"),1),o("div",It,l(((b=t.value.affiliate)==null?void 0:b.email)||"N/A"),1)]),o("div",Mt,[e[23]||(e[23]=o("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Boutique",-1)),a(w,{color:"info",variant:"tonal"},{default:s(()=>{var x,v;return[m(l(((v=(x=t.value)==null?void 0:x.boutique)==null?void 0:v.nom)||"-"),1)]}),_:1})]),o("div",qt,[e[24]||(e[24]=o("div",{class:"text-body-2 text-medium-emphasis mb-1"},"Date de création",-1)),o("div",Wt,l((S=t.value)!=null&&S.created_at?Se(t.value.created_at):"-"),1)])]}),_:1})]),_:1})]),_:1}),a($,{cols:"12",md:"4"},{default:s(()=>[a(P,null,{default:s(()=>[a(B,null,{default:s(()=>e[25]||(e[25]=[m("Résumé Financier")])),_:1,__:[25]}),a(j,null,{default:s(()=>{var f,c,b,S;return[o("div",Ht,[e[26]||(e[26]=o("span",null,"Total HT:",-1)),o("span",null,l((f=t.value)!=null&&f.total_ht?z(t.value.total_ht):"-"),1)]),a(ue,{class:"my-2"}),o("div",Qt,[e[27]||(e[27]=o("span",null,"Total TTC:",-1)),o("span",null,l((c=t.value)!=null&&c.total_ttc?z(t.value.total_ttc):"-"),1)]),o("div",Gt," Mode de paiement: "+l(((S=(b=t.value)==null?void 0:b.mode_paiement)==null?void 0:S.toUpperCase())||"-"),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(u(),p("div",Jt,[a(h,{icon:"tabler-alert-circle",size:"64",class:"mb-4",color:"error"}),e[29]||(e[29]=o("h3",{class:"text-h6 mb-2"},"Commande introuvable",-1)),e[30]||(e[30]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," La commande demandée n'existe pas ou a été supprimée ",-1)),a(V,{color:"primary",variant:"elevated",onClick:ee},{default:s(()=>e[28]||(e[28]=[m(" Retour à la liste ")])),_:1,__:[28]})])),a(We,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=f=>R.value=f),loading:U.value,text:_(n)("admin_preorder_ozon_confirm_text"),onConfirm:Ee,onCancel:Ae},null,8,["modelValue","loading","text"]),a(qe,{"is-dialog-visible":_(_e),"is-loading":_(fe),"dialog-title":_(ve),"dialog-text":_(pe),"dialog-icon":_(ge),"dialog-color":_(be),"confirm-button-text":_(ye),"cancel-button-text":_(xe),onConfirm:_(he),onCancel:_(Ce)},null,8,["is-dialog-visible","is-loading","dialog-title","dialog-text","dialog-icon","dialog-color","confirm-button-text","cancel-button-text","onConfirm","onCancel"]),a(Xe,{modelValue:_(A).show,"onUpdate:modelValue":e[7]||(e[7]=f=>_(A).show=f),color:_(A).color,timeout:_(A).timeout,location:"top end"},{default:s(()=>[m(l(_(A).message),1)]),_:1},8,["modelValue","color","timeout"])])}}});export{Fa as default};
