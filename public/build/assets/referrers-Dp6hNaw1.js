import{d as se,aL as ne,r as p,V as J,w as oe,o as ie,c as K,b as N,f as r,e,v as i,n,g as a,az as h,t as m,ac as w,h as re,aW as de,b6 as R}from"./main-3LuWNv9W.js";import{a as _,V as I}from"./VRow-aVZbYr4A.js";import{V as f,b as T,c as O}from"./VCard-QqgF9aMj.js";import{V as v}from"./VCardText-Dqaeyxp0.js";import{V as x}from"./VTextField-CsO1UfXI.js";import{V as q}from"./VSelect-V4QjM3w5.js";import{V as H}from"./VSpacer-Ckvg-9-2.js";import{V as A}from"./VChip-D2hyzrT3.js";import{V as P}from"./VDataTable-Dz5dOo4J.js";import{V as ue}from"./VAvatar-CH3JpKwD.js";import{V as me}from"./VImg-DjZhnPY1.js";import{V as _e}from"./VForm-BMJZijf-.js";import{V as pe}from"./VTextarea-BxOghhaY.js";import{V as Q}from"./VDialog-DuTMUR2U.js";/* empty css              */import"./createSimpleFunctional-CbZg_Do-.js";import"./VField-CzoZXYxi.js";import"./forwardRefs-BZg6tG7B.js";import"./VList-DWKF8cD-.js";import"./ssrBoot-DPE17Lki.js";import"./VDivider-D28qXVrs.js";import"./dialog-transition-TWAYErkS.js";import"./VMenu-cCaIVuKn.js";import"./VOverlay-DHKe6cTP.js";import"./lazy-vcHGEOxt.js";import"./VCheckboxBtn-BQUGQfLA.js";import"./VPagination-C9G78dYZ.js";import"./VTable-Dyn4MLHa.js";import"./filter-DJ4i-HET.js";const ce={class:"d-flex justify-space-between align-center mb-6"},fe={class:"text-h4 mb-1"},ve={class:"text-body-1 mb-0"},be={class:"d-flex align-center"},xe={class:"text-sm text-medium-emphasis mb-0"},ge={class:"text-h6"},he={class:"d-flex align-center"},Ve={class:"text-sm text-medium-emphasis mb-0"},ye={class:"text-h6"},we={class:"d-flex align-center"},ke={class:"text-sm text-medium-emphasis mb-0"},Ce={class:"text-h6"},Ie={class:"d-flex align-center"},Ue={class:"text-sm text-medium-emphasis mb-0"},ze={class:"text-h6"},De={class:"d-flex gap-3"},Fe={class:"d-flex align-center"},Ae={key:1},Se={class:"font-weight-medium mb-0"},$e={class:"text-sm text-medium-emphasis mb-0"},Le={class:"font-weight-medium text-success"},Re={class:"font-weight-medium text-warning"},Te={class:"d-flex gap-2"},Be={class:"text-center py-8"},Ee={class:"text-h6 mb-2"},Me={class:"text-body-1"},Ne={class:"text-sm text-medium-emphasis mb-1"},qe={class:"text-h6 text-success"},He={class:"text-sm text-medium-emphasis mb-1"},je={class:"text-h6 text-warning"},We={class:"text-sm text-medium-emphasis mb-1"},Ge={class:"text-h6 text-info"},Je={class:"text-truncate",style:{"max-width":"200px"}},Ke={class:"text-center py-4"},kt=se({__name:"referrers",setup(Oe){const{t:s}=ne(),B=p(!1),V=p([]),k=p([]),S=p(!1),U=p({total_referrers:0,total_points_earned:0,total_points_dispensed:0,total_points_balance:0,total_verified_signups:0,total_signups:0,recent_dispensations:[]}),d=p({search:"",min_balance:"",max_balance:"",min_earned:"",max_earned:"",min_signups:"",max_signups:"",has_dispensations:"",sort_by:"points_balance",sort_order:"desc"}),z=p(!1),g=p(null),y=p({affiliate_id:"",points:0,comment:"",reference:""}),E=p(!1),$=p(!1),D=p({dispensations:[],pagination:{},summary:{}}),M=p(!1),X=J(()=>[{title:s("affiliate"),key:"user",sortable:!1},{title:s("verified_signups"),key:"verified_signups",sortable:!0},{title:s("total_signups"),key:"total_signups",sortable:!0},{title:s("points_earned"),key:"points_earned",sortable:!0},{title:s("points_dispensed"),key:"points_dispensed",sortable:!0},{title:s("points_balance"),key:"points_balance",sortable:!0},{title:s("actions"),key:"actions",sortable:!1}]),j=J(()=>{let o=[...k.value];if(d.value.search){const l=d.value.search.toLowerCase();o=o.filter(t=>t.user.nom_complet.toLowerCase().includes(l)||t.user.email.toLowerCase().includes(l))}if(d.value.min_balance&&(o=o.filter(l=>l.points_balance>=parseInt(d.value.min_balance))),d.value.max_balance&&(o=o.filter(l=>l.points_balance<=parseInt(d.value.max_balance))),d.value.min_earned&&(o=o.filter(l=>l.points_earned>=parseInt(d.value.min_earned))),d.value.max_earned&&(o=o.filter(l=>l.points_earned<=parseInt(d.value.max_earned))),d.value.min_signups&&(o=o.filter(l=>l.total_signups>=parseInt(d.value.min_signups))),d.value.max_signups&&(o=o.filter(l=>l.total_signups<=parseInt(d.value.max_signups))),d.value.has_dispensations!==""){const l=d.value.has_dispensations==="true";o=o.filter(t=>l?t.points_dispensed>0:t.points_dispensed===0)}return S.value||o.sort((l,t)=>{const u=d.value.sort_by,C=d.value.sort_order==="desc"?-1:1;let F,L;return u==="user_name"?(F=l.user.nom_complet,L=t.user.nom_complet):(F=l[u],L=t[u]),typeof F=="string"?F.localeCompare(L)*C:(F-L)*C}),o}),Y=async()=>{B.value=!0;try{const o=await R.get("/admin/referrers");o.data.success&&(k.value=o.data.data,V.value=o.data.data)}catch(o){console.error("Error fetching referrers:",o)}finally{B.value=!1}},c=()=>{V.value=j.value},Z=()=>{d.value={search:"",min_balance:"",max_balance:"",min_earned:"",max_earned:"",min_signups:"",max_signups:"",has_dispensations:"",sort_by:"points_balance",sort_order:"desc"},c()},W=async()=>{try{const o=await R.get("/admin/referrers/statistics");o.data.success&&(U.value=o.data.data)}catch(o){console.error("Error fetching statistics:",o)}},ee=o=>{g.value=o,y.value={affiliate_id:o.id,points:o.points_balance,comment:s("points_dispensation_for_user",{name:o.user.nom_complet}),reference:`REF-${Date.now()}`},z.value=!0},G=async()=>{E.value=!0,S.value=!0;try{const o=await R.post("/admin/referrers/dispensations",y.value);if(o.data.success){if(z.value=!1,g.value){const l=V.value.findIndex(t=>t.id===g.value.id);if(l!==-1){const t=o.data.data.updated_summary;V.value[l].points_dispensed=t.dispensed,V.value[l].points_balance=t.balance;const u=k.value.findIndex(C=>C.id===g.value.id);u!==-1&&(k.value[u].points_dispensed=t.dispensed,k.value[u].points_balance=t.balance)}}W(),console.log("Dispensation created successfully")}}catch(o){console.error("Error creating dispensation:",o)}finally{E.value=!1,setTimeout(()=>{S.value=!1},100)}},te=async o=>{g.value=o,$.value=!0,M.value=!0;try{const l=await R.get(`/admin/referrers/${o.id}/dispensations`);l.data.success&&(D.value=l.data.data)}catch(l){console.error("Error fetching dispensation history:",l)}finally{M.value=!1}},b=o=>new Intl.NumberFormat("fr-FR").format(o),ae=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),le=o=>o===0?"grey":o<100?"orange":o<500?"blue":"green";return oe(j,o=>{S.value||(V.value=o)},{immediate:!0}),ie(()=>{Y(),W()}),(o,l)=>(N(),K("div",null,[r("div",ce,[r("div",null,[r("h4",fe,i(n(s)("referrers_management")),1),r("p",ve,i(n(s)("manage_affiliate_points_and_dispensations")),1)])]),e(I,{class:"mb-6"},{default:a(()=>[e(_,{cols:"12",md:"3"},{default:a(()=>[e(f,null,{default:a(()=>[e(v,null,{default:a(()=>[r("div",be,[e(h,{color:"primary",size:"40",class:"me-4"},{default:a(()=>l[17]||(l[17]=[m("tabler-users")])),_:1,__:[17]}),r("div",null,[r("p",xe,i(n(s)("total_referrers")),1),r("h6",ge,i(U.value.total_referrers||0),1)])])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"3"},{default:a(()=>[e(f,null,{default:a(()=>[e(v,null,{default:a(()=>[r("div",he,[e(h,{color:"success",size:"40",class:"me-4"},{default:a(()=>l[18]||(l[18]=[m("tabler-coins")])),_:1,__:[18]}),r("div",null,[r("p",Ve,i(n(s)("total_points_earned")),1),r("h6",ye,i(b(U.value.total_points_earned||0)),1)])])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"3"},{default:a(()=>[e(f,null,{default:a(()=>[e(v,null,{default:a(()=>[r("div",we,[e(h,{color:"warning",size:"40",class:"me-4"},{default:a(()=>l[19]||(l[19]=[m("tabler-gift")])),_:1,__:[19]}),r("div",null,[r("p",ke,i(n(s)("total_points_dispensed")),1),r("h6",Ce,i(b(U.value.total_points_dispensed||0)),1)])])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"3"},{default:a(()=>[e(f,null,{default:a(()=>[e(v,null,{default:a(()=>[r("div",Ie,[e(h,{color:"info",size:"40",class:"me-4"},{default:a(()=>l[20]||(l[20]=[m("tabler-wallet")])),_:1,__:[20]}),r("div",null,[r("p",Ue,i(n(s)("total_points_balance")),1),r("h6",ze,i(b(U.value.total_points_balance||0)),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{class:"mb-6"},{default:a(()=>[e(T,null,{default:a(()=>[m(i(n(s)("filters")),1)]),_:1}),e(v,null,{default:a(()=>[e(I,null,{default:a(()=>[e(_,{cols:"12",md:"4"},{default:a(()=>[e(x,{modelValue:d.value.search,"onUpdate:modelValue":l[0]||(l[0]=t=>d.value.search=t),label:n(s)("search"),placeholder:n(s)("search_by_name_email"),"prepend-inner-icon":"tabler-search",clearable:"",onInput:c},null,8,["modelValue","label","placeholder"])]),_:1}),e(_,{cols:"12",md:"2"},{default:a(()=>[e(x,{modelValue:d.value.min_balance,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value.min_balance=t),label:n(s)("min_balance"),type:"number",min:"0",onInput:c},null,8,["modelValue","label"])]),_:1}),e(_,{cols:"12",md:"2"},{default:a(()=>[e(x,{modelValue:d.value.max_balance,"onUpdate:modelValue":l[2]||(l[2]=t=>d.value.max_balance=t),label:n(s)("max_balance"),type:"number",min:"0",onInput:c},null,8,["modelValue","label"])]),_:1}),e(_,{cols:"12",md:"2"},{default:a(()=>[e(x,{modelValue:d.value.min_earned,"onUpdate:modelValue":l[3]||(l[3]=t=>d.value.min_earned=t),label:n(s)("min_earned"),type:"number",min:"0",onInput:c},null,8,["modelValue","label"])]),_:1}),e(_,{cols:"12",md:"2"},{default:a(()=>[e(x,{modelValue:d.value.max_earned,"onUpdate:modelValue":l[4]||(l[4]=t=>d.value.max_earned=t),label:n(s)("max_earned"),type:"number",min:"0",onInput:c},null,8,["modelValue","label"])]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(_,{cols:"12",md:"2"},{default:a(()=>[e(x,{modelValue:d.value.min_signups,"onUpdate:modelValue":l[5]||(l[5]=t=>d.value.min_signups=t),label:n(s)("min_signups"),type:"number",min:"0",onInput:c},null,8,["modelValue","label"])]),_:1}),e(_,{cols:"12",md:"2"},{default:a(()=>[e(x,{modelValue:d.value.max_signups,"onUpdate:modelValue":l[6]||(l[6]=t=>d.value.max_signups=t),label:n(s)("max_signups"),type:"number",min:"0",onInput:c},null,8,["modelValue","label"])]),_:1}),e(_,{cols:"12",md:"3"},{default:a(()=>[e(q,{modelValue:d.value.has_dispensations,"onUpdate:modelValue":[l[7]||(l[7]=t=>d.value.has_dispensations=t),c],items:[{value:"",title:n(s)("all")},{value:"true",title:n(s)("with_dispensations")},{value:"false",title:n(s)("without_dispensations")}],label:n(s)("dispensation_status")},null,8,["modelValue","items","label"])]),_:1}),e(_,{cols:"12",md:"3"},{default:a(()=>[e(q,{modelValue:d.value.sort_by,"onUpdate:modelValue":[l[8]||(l[8]=t=>d.value.sort_by=t),c],items:[{value:"points_balance",title:n(s)("points_balance")},{value:"points_earned",title:n(s)("points_earned")},{value:"points_dispensed",title:n(s)("points_dispensed")},{value:"total_signups",title:n(s)("total_signups")},{value:"verified_signups",title:n(s)("verified_signups")},{value:"user_name",title:n(s)("name")}],label:n(s)("sort_by")},null,8,["modelValue","items","label"])]),_:1}),e(_,{cols:"12",md:"2"},{default:a(()=>[e(q,{modelValue:d.value.sort_order,"onUpdate:modelValue":[l[9]||(l[9]=t=>d.value.sort_order=t),c],items:[{value:"desc",title:n(s)("descending")},{value:"asc",title:n(s)("ascending")}],label:n(s)("sort_order")},null,8,["modelValue","items","label"])]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(_,{cols:"12"},{default:a(()=>[r("div",De,[e(w,{color:"primary",onClick:c},{default:a(()=>[e(h,{start:"",icon:"tabler-filter"}),m(" "+i(n(s)("apply_filters")),1)]),_:1}),e(w,{variant:"outlined",onClick:Z},{default:a(()=>[e(h,{start:"",icon:"tabler-filter-off"}),m(" "+i(n(s)("reset_filters")),1)]),_:1}),e(H),e(A,{color:"info",size:"small"},{default:a(()=>[m(i(n(s)("showing_results",{count:V.value.length,total:k.value.length})),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(T,null,{default:a(()=>[m(i(n(s)("referrers_list")),1)]),_:1}),e(v,null,{default:a(()=>[e(P,{headers:X.value,items:V.value,loading:B.value,"item-value":"id",class:"text-no-wrap"},{"item.user":a(({item:t})=>[r("div",Fe,[e(ue,{size:"32",class:"me-3"},{default:a(()=>{var u;return[t.user.photo_profil?(N(),re(me,{key:0,src:t.user.photo_profil},null,8,["src"])):(N(),K("span",Ae,i(((u=t.user.nom_complet)==null?void 0:u.charAt(0))||"A"),1))]}),_:2},1024),r("div",null,[r("p",Se,i(t.user.nom_complet),1),r("p",$e,i(t.user.email),1)])])]),"item.verified_signups":a(({item:t})=>[e(A,{color:"success",size:"small"},{default:a(()=>[m(i(t.verified_signups),1)]),_:2},1024)]),"item.total_signups":a(({item:t})=>[e(A,{color:"info",size:"small"},{default:a(()=>[m(i(t.total_signups),1)]),_:2},1024)]),"item.points_earned":a(({item:t})=>[r("span",Le,i(b(t.points_earned))+" pts ",1)]),"item.points_dispensed":a(({item:t})=>[r("span",Re,i(b(t.points_dispensed))+" pts ",1)]),"item.points_balance":a(({item:t})=>[e(A,{color:le(t.points_balance),size:"small"},{default:a(()=>[m(i(b(t.points_balance))+" pts ",1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[r("div",Te,[e(w,{color:"primary",size:"small",disabled:t.points_balance===0,onClick:u=>ee(t)},{default:a(()=>[e(h,{start:"",icon:"tabler-gift"}),m(" "+i(n(s)("dispense")),1)]),_:2},1032,["disabled","onClick"]),e(w,{color:"info",variant:"outlined",size:"small",onClick:u=>te(t)},{default:a(()=>[e(h,{start:"",icon:"tabler-history"}),m(" "+i(n(s)("history")),1)]),_:2},1032,["onClick"])])]),"no-data":a(()=>[r("div",Be,[e(h,{size:"64",color:"grey",class:"mb-4"},{default:a(()=>l[21]||(l[21]=[m("tabler-users-off")])),_:1,__:[21]}),r("h6",Ee,i(n(s)("no_referrers_found")),1),r("p",Me,i(n(s)("no_referrers_found_message")),1)])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),e(Q,{modelValue:z.value,"onUpdate:modelValue":l[14]||(l[14]=t=>z.value=t),"max-width":"600"},{default:a(()=>[e(f,null,{default:a(()=>[e(T,null,{default:a(()=>[m(i(n(s)("dispense_points")),1)]),_:1}),e(v,null,{default:a(()=>[e(_e,{onSubmit:de(G,["prevent"])},{default:a(()=>[e(I,null,{default:a(()=>[e(_,{cols:"12"},{default:a(()=>{var t,u;return[e(x,{"model-value":(u=(t=g.value)==null?void 0:t.user)==null?void 0:u.nom_complet,label:n(s)("affiliate"),readonly:"",variant:"outlined"},null,8,["model-value","label"])]}),_:1}),e(_,{cols:"12",md:"6"},{default:a(()=>{var t,u;return[e(x,{modelValue:y.value.points,"onUpdate:modelValue":l[10]||(l[10]=C=>y.value.points=C),label:n(s)("points_to_dispense"),hint:`${n(s)("max_balance")}: ${((t=g.value)==null?void 0:t.points_balance)||0} pts`,type:"number",min:1,max:((u=g.value)==null?void 0:u.points_balance)||0,variant:"outlined",required:""},null,8,["modelValue","label","hint","max"])]}),_:1}),e(_,{cols:"12",md:"6"},{default:a(()=>[e(x,{modelValue:y.value.reference,"onUpdate:modelValue":l[11]||(l[11]=t=>y.value.reference=t),label:n(s)("reference"),variant:"outlined"},null,8,["modelValue","label"])]),_:1}),e(_,{cols:"12"},{default:a(()=>[e(pe,{modelValue:y.value.comment,"onUpdate:modelValue":l[12]||(l[12]=t=>y.value.comment=t),label:n(s)("comment"),placeholder:n(s)("dispensation_comment_placeholder"),variant:"outlined",rows:"3",required:""},null,8,["modelValue","label","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(H),e(w,{variant:"outlined",onClick:l[13]||(l[13]=t=>z.value=!1)},{default:a(()=>[m(i(n(s)("cancel")),1)]),_:1}),e(w,{color:"primary",loading:E.value,onClick:G},{default:a(()=>[m(i(n(s)("dispense_points")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:$.value,"onUpdate:modelValue":l[16]||(l[16]=t=>$.value=t),"max-width":"800"},{default:a(()=>[e(f,null,{default:a(()=>[e(T,null,{default:a(()=>{var t,u;return[m(i(n(s)("dispensation_history"))+" - "+i((u=(t=g.value)==null?void 0:t.user)==null?void 0:u.nom_complet),1)]}),_:1}),e(v,null,{default:a(()=>[e(I,{class:"mb-4"},{default:a(()=>[e(_,{cols:"4"},{default:a(()=>[e(f,{variant:"outlined"},{default:a(()=>[e(v,{class:"text-center"},{default:a(()=>{var t;return[r("p",Ne,i(n(s)("points_earned")),1),r("h6",qe,i(b(((t=D.value.summary)==null?void 0:t.earned)||0)),1)]}),_:1})]),_:1})]),_:1}),e(_,{cols:"4"},{default:a(()=>[e(f,{variant:"outlined"},{default:a(()=>[e(v,{class:"text-center"},{default:a(()=>{var t;return[r("p",He,i(n(s)("points_dispensed")),1),r("h6",je,i(b(((t=D.value.summary)==null?void 0:t.dispensed)||0)),1)]}),_:1})]),_:1})]),_:1}),e(_,{cols:"4"},{default:a(()=>[e(f,{variant:"outlined"},{default:a(()=>[e(v,{class:"text-center"},{default:a(()=>{var t;return[r("p",We,i(n(s)("points_balance")),1),r("h6",Ge,i(b(((t=D.value.summary)==null?void 0:t.balance)||0)),1)]}),_:1})]),_:1})]),_:1})]),_:1}),e(P,{headers:[{title:n(s)("date"),key:"created_at"},{title:n(s)("points"),key:"points"},{title:n(s)("comment"),key:"comment"},{title:n(s)("reference"),key:"reference"},{title:n(s)("admin"),key:"created_by_admin"}],items:D.value.dispensations,loading:M.value,"item-value":"id",class:"text-no-wrap"},{"item.created_at":a(({item:t})=>[m(i(ae(t.created_at)),1)]),"item.points":a(({item:t})=>[e(A,{color:"warning",size:"small"},{default:a(()=>[m(i(b(t.points))+" pts ",1)]),_:2},1024)]),"item.comment":a(({item:t})=>[r("span",Je,i(t.comment),1)]),"item.created_by_admin":a(({item:t})=>{var u;return[m(i(((u=t.created_by_admin)==null?void 0:u.nom_complet)||"N/A"),1)]}),"no-data":a(()=>[r("div",Ke,[r("p",null,i(n(s)("no_dispensations_found")),1)])]),_:1},8,["headers","items","loading"])]),_:1}),e(O,null,{default:a(()=>[e(H),e(w,{onClick:l[15]||(l[15]=t=>$.value=!1)},{default:a(()=>[m(i(n(s)("close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{kt as default};
