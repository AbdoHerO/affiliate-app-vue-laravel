import{V as K}from"./VChip-S_h5DeIW.js";import{d as z,aL as M,h as A,b as p,g as s,t as h,v as d,r as u,V as v,w as O,e as t,az as I,m as N,f as m,aW as Q,c as k,n,ac as R,ai as X}from"./main-BGmfaZsq.js";import{u as Y}from"./withdrawals-CSzdcMib.js";import{u as Z}from"./useNotifications-TnKci45M.js";import{V as aa}from"./VDialog-DIYcXxVx.js";import{V as ea,b as ta,c as ra}from"./VCard-hQ_o7lvO.js";import{V as la}from"./VCardText-BzdllyhI.js";import{V as W}from"./VAlert-CPLjIjOe.js";import{V as oa}from"./VForm-9k5StL4q.js";import{V as L}from"./VTextarea-Dm9Swusq.js";import{V as B}from"./VTextField-STn8GDXm.js";import{V as sa,a as q}from"./VRow-Jzvhbj9T.js";import{V as ia}from"./VFileInput-BLh4W2ou.js";import{V as na}from"./VSpacer-B4IQn0G0.js";const Da=z({__name:"WithdrawalStatusBadge",props:{status:{},color:{default:void 0}},setup(g){const C=g,{t:r}=M(),_=i=>{switch(i){case"pending":return r("admin_withdrawals_pending");case"approved":return r("admin_withdrawals_approved");case"in_payment":return r("admin_withdrawals_in_payment");case"paid":return r("admin_withdrawals_paid");case"rejected":return r("admin_withdrawals_rejected");case"canceled":return r("admin_withdrawals_canceled");default:return i}},w={pending:"warning",approved:"info",in_payment:"primary",paid:"success",rejected:"error",canceled:"secondary"},j=i=>C.color||w[i]||"secondary";return(i,e)=>(p(),A(K,{color:j(i.status),variant:"tonal",size:"small"},{default:s(()=>[h(d(_(i.status)),1)]),_:1},8,["color"]))}}),da={class:"d-flex justify-space-between align-center"},ca={class:"text-body-1 font-weight-medium"},ua={class:"text-body-2"},ma={class:"text-end"},pa={class:"text-h6"},_a={class:"text-caption"},wa={key:0},fa={key:1},va={key:2},ha={key:3},Ea=z({__name:"WithdrawalActionDialog",props:{isVisible:{type:Boolean},withdrawal:{},action:{}},emits:["update:isVisible","success","closed"],setup(g,{emit:C}){const r=g,_=C,w=Y(),{showSuccess:j,showError:i}=Z(),{t:e}=M(),S=u(!1),V=u(""),f=u(""),c=u(""),b=u(""),F=u(null),y=u(!1),P=v(()=>{switch(r.action){case"approve":return e("admin_withdrawals_approve_withdrawal");case"reject":return e("admin_withdrawals_reject_withdrawal");case"mark_in_payment":return e("admin_withdrawals_mark_in_payment");case"mark_paid":return e("admin_withdrawals_mark_paid");default:return e("actions.action")}}),$=v(()=>{switch(r.action){case"approve":return"tabler-check";case"reject":return"tabler-x";case"mark_in_payment":return"tabler-clock";case"mark_paid":return"tabler-credit-card";default:return"tabler-help"}}),T=v(()=>{switch(r.action){case"approve":return"success";case"reject":return"error";case"mark_in_payment":return"primary";case"mark_paid":return"success";default:return"primary"}}),G=v(()=>{switch(r.action){case"approve":return e("actions.approve");case"reject":return e("actions.reject");case"mark_in_payment":return e("admin_withdrawals_mark_in_payment_short");case"mark_paid":return e("admin_withdrawals_mark_paid_short");default:return e("actions.confirm")}}),U=v(()=>{switch(r.action){case"reject":return f.value.trim().length>0;default:return!0}});O(()=>r.isVisible,a=>{a&&(H(),y.value=!1)});const H=()=>{V.value="",f.value="",c.value="",b.value="",F.value=null},x=async()=>{y.value||(y.value=!0,_("update:isVisible",!1),await X(),_("closed"),y.value=!1)},J=a=>{const l=a.target;l.files&&l.files.length>0&&(F.value=l.files[0])},D=async()=>{if(!(!U.value||!r.withdrawal)){S.value=!0;try{let a;switch(r.action){case"approve":a=await w.approve(r.withdrawal.id,{note:V.value||void 0});break;case"reject":a=await w.reject(r.withdrawal.id,{reason:f.value});break;case"mark_in_payment":a=await w.markInPayment(r.withdrawal.id,{payment_ref:c.value||void 0});break;case"mark_paid":a=await w.markPaid(r.withdrawal.id,{payment_ref:c.value||void 0,paid_at:b.value||void 0,evidence:F.value||void 0});break;default:throw new Error("Action non supportÃ©e")}a.success?(j(a.message),_("success"),await x()):i(a.message)}catch{i(e("admin_withdrawal_action_error"))}finally{S.value=!1}}};return(a,l)=>(p(),A(aa,{"model-value":a.isVisible,"max-width":"600",persistent:"","onUpdate:modelValue":l[5]||(l[5]=o=>_("update:isVisible",o)),"onClick:outside":x},{default:s(()=>[t(ea,null,{default:s(()=>[t(ta,{class:"d-flex align-center gap-2"},{default:s(()=>[t(I,{icon:$.value,color:T.value},null,8,["icon","color"]),h(" "+d(P.value),1)]),_:1}),t(la,null,{default:s(()=>[a.withdrawal?(p(),A(W,{key:0,color:T.value,variant:"tonal",class:"mb-4"},{default:s(()=>{var o,E;return[m("div",da,[m("div",null,[m("div",ca,d((o=a.withdrawal.user)==null?void 0:o.nom_complet),1),m("div",ua,d((E=a.withdrawal.user)==null?void 0:E.email),1)]),m("div",ma,[m("div",pa,d(a.withdrawal.amount)+" MAD",1),m("div",_a,d(a.withdrawal.commission_count)+" commission(s)",1)])])]}),_:1},8,["color"])):N("",!0),t(oa,{onSubmit:Q(D,["prevent"])},{default:s(()=>[a.action==="approve"?(p(),k("div",wa,[t(L,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=o=>V.value=o),label:n(e)("admin_withdrawals_note_optional"),placeholder:n(e)("admin_withdrawals_note_placeholder"),rows:"3","auto-grow":""},null,8,["modelValue","label","placeholder"])])):a.action==="reject"?(p(),k("div",fa,[t(L,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=o=>f.value=o),label:n(e)("admin_withdrawals_reject_reason"),placeholder:n(e)("admin_withdrawals_reject_placeholder"),rows:"3","auto-grow":"",rules:[o=>!!o||"La raison est requise"],required:""},null,8,["modelValue","label","placeholder","rules"])])):a.action==="mark_in_payment"?(p(),k("div",va,[t(B,{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=o=>c.value=o),label:n(e)("admin_withdrawals_payment_reference_optional"),placeholder:"REF-12345"},null,8,["modelValue","label"])])):a.action==="mark_paid"?(p(),k("div",ha,[t(sa,null,{default:s(()=>[t(q,{cols:"12",md:"6"},{default:s(()=>[t(B,{modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=o=>c.value=o),label:n(e)("admin_withdrawals_payment_reference"),placeholder:"REF-12345"},null,8,["modelValue","label"])]),_:1}),t(q,{cols:"12",md:"6"},{default:s(()=>[t(B,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=o=>b.value=o),label:n(e)("admin_withdrawals_payment_date"),type:"datetime-local"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(ia,{label:n(e)("proof_of_payment_optional"),accept:"image/*,.pdf","prepend-icon":"tabler-paperclip",onChange:J},null,8,["label"]),t(W,{color:"info",variant:"tonal",class:"mt-2"},{default:s(()=>[t(I,{icon:"tabler-info-circle",class:"me-2"}),h(" "+d(n(e)("accepted_formats_info")),1)]),_:1})])):N("",!0)]),_:1})]),_:1}),t(ra,null,{default:s(()=>[t(na),t(R,{variant:"tonal",onClick:x},{default:s(()=>[h(d(n(e)("cancel")),1)]),_:1}),t(R,{color:T.value,loading:S.value,disabled:!U.value,onClick:D},{default:s(()=>[h(d(G.value),1)]),_:1},8,["color","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}});export{Da as _,Ea as a};
