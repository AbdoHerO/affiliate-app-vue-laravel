import{d as Ne,j as Me,aL as Ee,r as c,V as J,D as Re,c as j,o as f,e as i,b as t,g as v,l as g,t as s,m as r,f as l,s as _,az as m,ac as h,p as Qe}from"./main-uLG9IIeX.js";import{u as Ge}from"./preorders-BH6YwS2K.js";import{useQuickConfirm as He}from"./useConfirmAction-C-KKQTYr.js";import{u as Je}from"./useNotifications-DDBS_wPD.js";import{C as Ke}from"./ConfirmActionDialog-uPYgr6qv.js";import{O as We}from"./OzonExpressConfirmDialog-4wkpIU85.js";import{V as K}from"./VCardText-BZtszuIK.js";import{V as Xe,a as C}from"./VRow-aGfXYx3U.js";import{V as W}from"./VTextField-Dxeq5kx5.js";import{V as X}from"./VSelect-sWnAtot-.js";import{V as M,b as Ye,c as Ze}from"./VCard-CB1gT6RB.js";import{V as ne}from"./VSpacer-BCNmCEP9.js";import{V as ea}from"./VDataTableServer-DfLBg0lg.js";import{V as aa}from"./VMenu-DP1p-55V.js";import{V as ta,a as w,b as S}from"./VList-uZDByhc2.js";import{V as la}from"./VDivider-UqGR4x4D.js";import{V as oa}from"./VTooltip-Ce3bfmSx.js";import{V as Y}from"./VChip-B84WcmDa.js";import{V as ra}from"./VBadge-C2esTGRG.js";import{V as se}from"./VCheckbox-BPY3LPcF.js";import{V as na}from"./VTextarea-BuIc6d95.js";import{V as sa}from"./VDialog-DU1pBIct.js";import{V as ia}from"./VSnackbar-BT89hKev.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */import"./VField-CfH1YcVv.js";import"./VImg-BS6_svHJ.js";import"./forwardRefs-Dv_T9a_w.js";import"./lazy-CjF3Yiep.js";import"./dialog-transition-2hF0ajsQ.js";import"./VCheckboxBtn-CogF2AUK.js";import"./VAvatar-bHPDEsYY.js";import"./createSimpleFunctional-DugzUcbB.js";import"./VDataTable-DNqSzzrc.js";import"./VPagination-DYW6O4lq.js";import"./VTable-0U-NvIH3.js";import"./filter-D_SbaZWa.js";import"./ssrBoot-BPhRU-mF.js";const da={class:"d-flex flex-column gap-6"},ua={class:"d-flex justify-space-between align-center mb-6"},ca={class:"text-h4 font-weight-bold mb-1"},_a={class:"text-body-1 mb-0"},ma={class:"d-flex align-center gap-4"},pa={class:"text-body-1 font-weight-medium"},fa={class:"font-weight-medium"},va={class:"text-caption text-medium-emphasis"},ga={key:0,class:"text-caption text-info"},ba={class:"font-weight-medium"},ha={class:"text-caption text-medium-emphasis"},ka={class:"font-weight-bold"},Va={key:1,class:"text-medium-emphasis"},ya={key:0,class:"d-flex align-center gap-1"},xa={class:"text-caption text-success"},Ca={key:1,class:"text-caption text-medium-emphasis"},wa={class:"text-body-2"},Sa={class:"d-flex gap-1"},za={class:"text-center py-8"},Ta={class:"text-h6 mb-2"},Da={class:"text-body-2 text-medium-emphasis"},La={class:"mb-4"},vt=Ne({__name:"index",setup(Ua){const Z=Me(),p=Ge(),{t:a}=Ee(),{confirm:ie,isDialogVisible:de,isLoading:ue,dialogTitle:ce,dialogText:_e,dialogIcon:me,dialogColor:pe,confirmButtonText:fe,cancelButtonText:ve,handleConfirm:ge,handleCancel:be}=He(),{showSuccess:k,showError:y,snackbar:z}=Je(),T=c(""),D=c(""),E=c(""),R=c(""),L=c(""),U=c(""),x=c(15),d=c([]),b=c(!1),P=c(!1),V=c(""),A=c(!1),Q=c(!1),I=c("single"),q=c(""),O=c(!1),N=c(!1),B=c(""),he=J(()=>p.isLoading),G=J(()=>p.preorders),ee=J(()=>p.pagination),ke=[{title:"",key:"select",sortable:!1,width:"50px"},{title:a("table_order_code"),key:"id",sortable:!0},{title:a("table_client"),key:"client",sortable:!1},{title:a("table_city"),key:"city",sortable:!1},{title:a("table_affiliate"),key:"affilie",sortable:!1},{title:a("table_boutique"),key:"boutique",sortable:!1},{title:a("table_total"),key:"total_ttc",sortable:!0},{title:a("table_no_answer"),key:"no_answer_count",sortable:!0,width:"100px"},{title:a("table_status"),key:"statut",sortable:!0},{title:a("table_shipping"),key:"shipping",sortable:!1,width:"120px"},{title:a("table_date"),key:"created_at",sortable:!0},{title:a("table_actions"),key:"actions",sortable:!1,width:"150px"}],Ve=[{title:a("admin_preorders_status_all"),value:""},{title:a("admin_preorders_status_pending"),value:"en_attente"},{title:a("admin_preorders_status_confirmed"),value:"confirmee"},{title:a("admin_preorders_status_unreachable"),value:"injoignable"},{title:a("admin_preorders_status_refused"),value:"refusee"},{title:a("admin_preorders_status_cancelled"),value:"annulee"}],ae=async()=>{await p.fetchPreorders({q:T.value||void 0,statut:D.value||void 0,affilie_id:E.value||void 0,boutique_id:R.value||void 0,from:L.value||void 0,to:U.value||void 0,perPage:x.value})},F=()=>{p.fetchPreorders({page:1,q:T.value||void 0,statut:D.value||void 0,affilie_id:E.value||void 0,boutique_id:R.value||void 0,from:L.value||void 0,to:U.value||void 0,perPage:x.value})},ye=n=>{p.fetchPreorders({page:n})},xe=n=>{n.length>0&&p.fetchPreorders({sort:n[0].key,dir:n[0].order})},Ce=n=>{Z.push({name:"admin-orders-pre-id",params:{id:n.id}})},we=n=>{switch(n){case"en_attente":return"warning";case"confirmee":return"success";case"injoignable":return"orange";case"refusee":return"error";case"annulee":return"secondary";default:return"default"}},te=n=>{switch(n){case"en_attente":return a("admin_preorders_status_pending");case"confirmee":return a("admin_preorders_status_confirmed");case"injoignable":return a("admin_preorders_status_unreachable");case"refusee":return a("admin_preorders_status_refused");case"annulee":return a("admin_preorders_status_cancelled");default:return n}},Se=n=>new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD"}).format(n),ze=n=>new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Te=n=>{var o,e;return((o=n.client_final_data)==null?void 0:o.nom_complet)||((e=n.client)==null?void 0:e.nom_complet)||a("admin_preorders_client_na")},De=n=>{var o,e;return((o=n.client_final_data)==null?void 0:o.telephone)||((e=n.client)==null?void 0:e.telephone)||a("admin_preorders_phone_na")},le=n=>{var o,e;return((o=n.client_final_data)==null?void 0:o.ville)||((e=n.adresse)==null?void 0:e.ville)||null},oe=()=>{T.value="",D.value="",E.value="",R.value="",L.value="",U.value="",d.value=[],b.value=!1,V.value="",p.resetFilters(),ae()},Le=()=>{b.value?d.value=G.value.map(n=>n.id):d.value=[]},Ue=n=>{const o=d.value.indexOf(n);o>-1?d.value.splice(o,1):d.value.push(n),b.value=d.value.length===G.value.length},Pe=async n=>{if(d.value.length===0)return;if(!await ie({title:a("admin_preorders_bulk_change_title"),text:a("admin_preorders_bulk_change_text",{count:d.value.length}),confirmText:a("admin_preorders_bulk_confirm"),cancelText:a("admin_preorders_bulk_cancel")})){V.value="";return}P.value=!0;try{const e=await p.bulkChangeStatus(d.value,n),u=te(n);k(e.message||a("admin.orders.bulkUpdateSuccess",{count:d.value.length,status:u})),d.value=[],b.value=!1,V.value=""}catch(e){y(e.message||a("admin_preorders_bulk_status_error")),V.value="",console.error("Bulk status change error:",e)}finally{P.value=!1}},qe=async()=>{d.value.length!==0&&(I.value="bulk",A.value=!0)},H=async(n,o)=>{try{const e=await p.changeStatus(n,o);k(e.message)}catch(e){y(e.message)}},Oe=async n=>{try{const o=await p.changeStatus(n,"injoignable",void 0,!0);k(o.message)}catch(o){y(o.message)}},Be=async n=>{q.value=n,I.value="single",A.value=!0},Fe=async n=>{q.value=n,B.value="",O.value=!0},$e=async n=>{Q.value=!0;try{if(I.value==="bulk"){const o=await p.bulkSendToShipping(d.value,n);if(o.summary){const{total:e,success:u,errors:$}=o.summary;if($>0)y(a("admin_preorders_ozon_error_bulk",{success:u,total:e,errors:$}));else{const re=a(re==="ramassage"?"admin_preorders_ozon_mode_pickup":"admin_preorders_ozon_mode_stock");k(a("admin_preorders_ozon_success_bulk",{count:u,mode:re}))}}else k(o.message||a("admin_preorders_bulk_send_ozon"));d.value=[],b.value=!1,V.value=""}else{const o=await p.sendToShipping(q.value,n),e=a(n==="ramassage"?"admin_preorders_ozon_mode_pickup":"admin_preorders_ozon_mode_stock");k(a("admin_preorders_ozon_success_single",{mode:e}))}}catch(o){y(o.message||a("admin_preorders_ozon_error")),console.error("OzonExpress shipping error:",o)}finally{Q.value=!1}},je=()=>{},Ae=async()=>{N.value=!0;try{const n=await p.moveToShippingLocal(q.value,B.value||void 0);k(a("admin_preorders_local_shipping_success")),O.value=!1,Z.push({name:"admin-orders-shipping-id",params:{id:q.value}})}catch(n){y(n.message||a("admin_preorders_local_shipping_error"))}finally{N.value=!1}},Ie=()=>{O.value=!1,B.value=""};return Re(()=>{ae()}),(n,o)=>(f(),j("div",da,[i("div",ua,[i("div",null,[i("h1",ca,s(r(a)("admin_preorders_title")),1),i("p",_a,s(r(a)("admin_preorders_description")),1)]),t(h,{color:"primary",variant:"elevated",onClick:oe},{default:l(()=>[t(m,{start:"",icon:"tabler-refresh"}),_(" "+s(r(a)("admin_preorders_refresh")),1)]),_:1})]),t(M,{class:"mb-6"},{default:l(()=>[t(K,null,{default:l(()=>[t(Xe,null,{default:l(()=>[t(C,{cols:"12",md:"3"},{default:l(()=>[t(W,{modelValue:T.value,"onUpdate:modelValue":o[0]||(o[0]=e=>T.value=e),label:r(a)("admin_preorders_search_label"),placeholder:r(a)("admin_preorders_search_placeholder"),"prepend-inner-icon":"tabler-search",clearable:"",onInput:F},null,8,["modelValue","label","placeholder"])]),_:1}),t(C,{cols:"12",md:"2"},{default:l(()=>[t(X,{modelValue:D.value,"onUpdate:modelValue":[o[1]||(o[1]=e=>D.value=e),F],label:r(a)("admin_preorders_status_label"),items:Ve,clearable:""},null,8,["modelValue","label"])]),_:1}),t(C,{cols:"12",md:"2"},{default:l(()=>[t(W,{modelValue:L.value,"onUpdate:modelValue":o[2]||(o[2]=e=>L.value=e),label:r(a)("admin_preorders_date_start"),type:"date",onChange:F},null,8,["modelValue","label"])]),_:1}),t(C,{cols:"12",md:"2"},{default:l(()=>[t(W,{modelValue:U.value,"onUpdate:modelValue":o[3]||(o[3]=e=>U.value=e),label:r(a)("admin_preorders_date_end"),type:"date",onChange:F},null,8,["modelValue","label"])]),_:1}),t(C,{cols:"12",md:"2"},{default:l(()=>[t(X,{modelValue:x.value,"onUpdate:modelValue":[o[4]||(o[4]=e=>x.value=e),F],label:r(a)("admin_preorders_per_page"),items:[10,15,25,50]},null,8,["modelValue","label"])]),_:1}),t(C,{cols:"12",md:"1"},{default:l(()=>[t(h,{color:"secondary",variant:"outlined",block:"",onClick:oe},{default:l(()=>[t(m,{icon:"tabler-filter-off"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),d.value.length>0?(f(),v(M,{key:0,class:"mb-4"},{default:l(()=>[t(K,null,{default:l(()=>[i("div",ma,[t(m,{icon:"tabler-check",color:"primary"}),i("span",pa,s(r(a)("admin_preorders_selected_count",{count:d.value.length})),1),t(ne),t(h,{color:"primary",variant:"elevated",loading:P.value,onClick:qe},{default:l(()=>[t(m,{start:"",icon:"tabler-truck"}),_(" "+s(r(a)("admin_preorders_bulk_send_ozon")),1)]),_:1},8,["loading"]),t(X,{modelValue:V.value,"onUpdate:modelValue":[o[5]||(o[5]=e=>V.value=e),o[6]||(o[6]=e=>e&&Pe(e))],label:r(a)("admin_preorders_bulk_change_status"),placeholder:r(a)("admin_preorders_bulk_select_status"),items:[{title:r(a)("admin_preorders_bulk_confirmed"),value:"confirmee"},{title:r(a)("admin_preorders_bulk_unreachable"),value:"injoignable"},{title:r(a)("admin_preorders_bulk_refused"),value:"refusee"},{title:r(a)("admin_preorders_bulk_cancelled"),value:"annulee"}],style:{"min-width":"180px"},loading:P.value,disabled:P.value,clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","label","placeholder","items","loading","disabled"]),t(h,{color:"error",variant:"outlined",onClick:o[7]||(o[7]=e=>{d.value=[],b.value=!1})},{default:l(()=>[t(m,{icon:"tabler-x"})]),_:1})])]),_:1})]),_:1})):g("",!0),t(M,null,{default:l(()=>[t(ea,{"items-per-page":x.value,"onUpdate:itemsPerPage":o[9]||(o[9]=e=>x.value=e),headers:ke,items:G.value,"items-length":ee.value.total,loading:he.value,page:ee.value.current_page,"onUpdate:page":ye,"onUpdate:sortBy":xe},{"header.select":l(()=>[t(se,{modelValue:b.value,"onUpdate:modelValue":[o[8]||(o[8]=e=>b.value=e),Le]},null,8,["modelValue"])]),"item.select":l(({item:e})=>[t(se,{"model-value":d.value.includes(e.id),"onUpdate:modelValue":u=>Ue(e.id)},null,8,["model-value","onUpdate:modelValue"])]),"item.client":l(({item:e})=>[i("div",null,[i("div",fa,s(Te(e)),1),i("div",va,s(De(e)),1),le(e)?(f(),j("div",ga,s(le(e)),1)):g("",!0)])]),"item.city":l(({item:e})=>[i("div",null,[t(Y,{size:"small",color:"secondary",variant:"tonal"},{default:l(()=>{var u;return[_(s(((u=e.adresse)==null?void 0:u.ville)||r(a)("admin_preorders_city_na")),1)]}),_:2},1024)])]),"item.affilie":l(({item:e})=>{var u,$;return[i("div",null,[i("div",ba,s(((u=e.affiliate)==null?void 0:u.nom_complet)||r(a)("admin_preorders_affiliate_na")),1),i("div",ha,s((($=e.affiliate)==null?void 0:$.email)||r(a)("admin_preorders_email_na")),1)])]}),"item.boutique":l(({item:e})=>[t(Y,{size:"small",color:"info",variant:"tonal"},{default:l(()=>[_(s(e.boutique.nom),1)]),_:2},1024)]),"item.total_ttc":l(({item:e})=>[i("div",ka,s(Se(e.total_ttc)),1)]),"item.no_answer_count":l(({item:e})=>[e.no_answer_count>0?(f(),v(ra,{key:0,content:e.no_answer_count,color:"warning",inline:""},{default:l(()=>[t(m,{icon:"tabler-phone-off",size:"20"})]),_:2},1032,["content"])):(f(),j("span",Va,"0"))]),"item.statut":l(({item:e})=>[t(Y,{size:"small",color:we(e.statut),variant:"tonal"},{default:l(()=>[_(s(te(e.statut)),1)]),_:2},1032,["color"])]),"item.shipping":l(({item:e})=>[e.shipping_parcel?(f(),j("div",ya,[t(m,{icon:"tabler-truck",color:"success",size:"16"}),t(oa,{activator:"parent",location:"top"},{default:l(()=>[_(s(r(a)("admin_preorders_tracking_tooltip",{tracking:e.shipping_parcel.tracking_number})),1)]),_:2},1024),i("span",xa,s(r(a)("admin_preorders_shipped")),1)])):(f(),j("div",Ca,s(r(a)("admin_preorders_not_shipped")),1))]),"item.created_at":l(({item:e})=>[i("div",wa,s(ze(e.created_at)),1)]),"item.actions":l(({item:e})=>[i("div",Sa,[t(h,{size:"small",color:"primary",variant:"text",icon:"tabler-eye",onClick:u=>Ce(e)},null,8,["onClick"]),e.shipping_parcel?g("",!0):(f(),v(aa,{key:0},{activator:l(({props:u})=>[t(h,Qe({size:"small",color:"secondary",variant:"text",icon:"tabler-dots-vertical"},u),null,16)]),default:l(()=>[t(ta,null,{default:l(()=>[e.statut!=="confirmee"?(f(),v(w,{key:0,onClick:u=>H(e.id,"confirmee")},{default:l(()=>[t(S,null,{default:l(()=>[t(m,{start:"",icon:"tabler-check",color:"success"}),_(" "+s(r(a)("admin_preorders_action_confirm")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),t(w,{onClick:u=>Oe(e.id)},{default:l(()=>[t(S,null,{default:l(()=>[t(m,{start:"",icon:"tabler-phone-off",color:"warning"}),_(" "+s(r(a)("admin_preorders_action_unreachable")),1)]),_:1})]),_:2},1032,["onClick"]),e.statut!=="refusee"?(f(),v(w,{key:1,onClick:u=>H(e.id,"refusee")},{default:l(()=>[t(S,null,{default:l(()=>[t(m,{start:"",icon:"tabler-x",color:"error"}),_(" "+s(r(a)("admin_preorders_action_refuse")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),e.statut!=="annulee"?(f(),v(w,{key:2,onClick:u=>H(e.id,"annulee")},{default:l(()=>[t(S,null,{default:l(()=>[t(m,{start:"",icon:"tabler-ban",color:"error"}),_(" "+s(r(a)("admin_preorders_action_cancel")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),e.statut==="confirmee"&&!e.shipping_parcel?(f(),v(la,{key:3})):g("",!0),e.statut==="confirmee"&&!e.shipping_parcel?(f(),v(w,{key:4,onClick:u=>Be(e.id)},{default:l(()=>[t(S,null,{default:l(()=>[t(m,{start:"",icon:"tabler-truck",color:"info"}),_(" "+s(r(a)("admin_preorders_action_send_ozon")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0),e.statut==="confirmee"&&!e.shipping_parcel?(f(),v(w,{key:5,onClick:u=>Fe(e.id)},{default:l(()=>[t(S,null,{default:l(()=>[t(m,{start:"",icon:"tabler-package",color:"warning"}),_(" "+s(r(a)("admin_preorders_action_local_shipping")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024))])]),"no-data":l(()=>[i("div",za,[t(m,{icon:"tabler-package-off",size:"64",class:"mb-4",color:"disabled"}),i("h3",Ta,s(r(a)("admin_preorders_no_data_title")),1),i("p",Da,s(r(a)("admin_preorders_no_data_description")),1)])]),_:1},8,["items-per-page","items","items-length","loading","page"])]),_:1}),t(We,{modelValue:A.value,"onUpdate:modelValue":o[10]||(o[10]=e=>A.value=e),loading:Q.value,text:I.value==="bulk"?r(a)("admin_preorders_ozon_bulk_text",{count:d.value.length}):r(a)("admin_preorders_ozon_single_text"),onConfirm:$e,onCancel:je},null,8,["modelValue","loading","text"]),t(sa,{modelValue:O.value,"onUpdate:modelValue":o[12]||(o[12]=e=>O.value=e),"max-width":"500",persistent:""},{default:l(()=>[t(M,null,{default:l(()=>[t(Ye,{class:"text-h6"},{default:l(()=>[t(m,{start:"",icon:"tabler-package",color:"warning"}),_(" "+s(r(a)("admin_preorders_local_shipping_title")),1)]),_:1}),t(K,null,{default:l(()=>[i("p",La,s(r(a)("admin_preorders_local_shipping_description")),1),t(na,{modelValue:B.value,"onUpdate:modelValue":o[11]||(o[11]=e=>B.value=e),label:r(a)("admin_preorders_local_shipping_note_label"),placeholder:r(a)("admin_preorders_local_shipping_note_placeholder"),rows:"3",variant:"outlined"},null,8,["modelValue","label","placeholder"])]),_:1}),t(Ze,null,{default:l(()=>[t(ne),t(h,{variant:"text",onClick:Ie,disabled:N.value},{default:l(()=>[_(s(r(a)("admin_preorders_local_shipping_cancel")),1)]),_:1},8,["disabled"]),t(h,{color:"warning",variant:"elevated",loading:N.value,onClick:Ae},{default:l(()=>[t(m,{start:"",icon:"tabler-package"}),_(" "+s(r(a)("admin_preorders_local_shipping_confirm")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ke,{"is-dialog-visible":r(de),"is-loading":r(ue),"dialog-title":r(ce),"dialog-text":r(_e),"dialog-icon":r(me),"dialog-color":r(pe),"confirm-button-text":r(fe),"cancel-button-text":r(ve),onConfirm:r(ge),onCancel:r(be)},null,8,["is-dialog-visible","is-loading","dialog-title","dialog-text","dialog-icon","dialog-color","confirm-button-text","cancel-button-text","onConfirm","onCancel"]),t(ia,{modelValue:r(z).show,"onUpdate:modelValue":o[13]||(o[13]=e=>r(z).show=e),color:r(z).color,timeout:r(z).timeout,location:"top end"},{default:l(()=>[_(s(r(z).message),1)]),_:1},8,["modelValue","color","timeout"])]))}});export{vt as default};
